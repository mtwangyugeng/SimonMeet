function Il(e,t){for(var i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();function L(){}const kn=e=>e;function Dl(e,t){for(const i in t)e[i]=t[i];return e}function La(e){return e()}function ms(){return Object.create(null)}function pt(e){e.forEach(La)}function Rt(e){return typeof e=="function"}function Z(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function wl(e){return Object.keys(e).length===0}function Ol(e,...t){if(e==null)return L;const i=e.subscribe(...t);return i.unsubscribe?()=>i.unsubscribe():i}function Fe(e,t,i){e.$$.on_destroy.push(Ol(t,i))}function _n(e,t,i,r){if(e){const n=Na(e,t,i,r);return e[0](n)}}function Na(e,t,i,r){return e[1]&&r?Dl(i.ctx.slice(),e[1](r(t))):i.ctx}function En(e,t,i,r){if(e[2]&&r){const n=e[2](r(i));if(t.dirty===void 0)return n;if(typeof n=="object"){const s=[],a=Math.max(t.dirty.length,n.length);for(let o=0;o<a;o+=1)s[o]=t.dirty[o]|n[o];return s}return t.dirty|n}return t.dirty}function Cn(e,t,i,r,n,s){if(n){const a=Na(t,i,r,s);e.p(a,n)}}function Rn(e){if(e.ctx.length>32){const t=[],i=e.ctx.length/32;for(let r=0;r<i;r++)t[r]=-1;return t}return-1}function gi(e){return e==null?"":e}const $a=typeof window<"u";let Pn=$a?()=>window.performance.now():()=>Date.now(),An=$a?e=>requestAnimationFrame(e):L;const pi=new Set;function xa(e){pi.forEach(t=>{t.c(e)||(pi.delete(t),t.f())}),pi.size!==0&&An(xa)}function In(e){let t;return pi.size===0&&An(xa),{promise:new Promise(i=>{pi.add(t={c:e,f:i})}),abort(){pi.delete(t)}}}function E(e,t){e.appendChild(t)}function Ua(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function Ml(e){const t=w("style");return Ll(Ua(e),t),t.sheet}function Ll(e,t){return E(e.head||e,t),t.sheet}function V(e,t,i){e.insertBefore(t,i||null)}function G(e){e.parentNode&&e.parentNode.removeChild(e)}function w(e){return document.createElement(e)}function ae(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function He(e){return document.createTextNode(e)}function re(){return He(" ")}function Jt(){return He("")}function Le(e,t,i,r){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i,r)}function Fa(e){return function(t){return t.preventDefault(),e.call(this,t)}}function y(e,t,i){i==null?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function Nl(e){return Array.from(e.childNodes)}function ut(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function gs(e,t){e.value=t==null?"":t}function Jr(e,t,i,r){i===null?e.style.removeProperty(t):e.style.setProperty(t,i,r?"important":"")}function di(e,t){for(let i=0;i<e.options.length;i+=1){const r=e.options[i];if(r.__value===t){r.selected=!0;return}}e.selectedIndex=-1}function Re(e,t,i){e.classList[i?"add":"remove"](t)}function $l(e,t,{bubbles:i=!1,cancelable:r=!1}={}){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,i,r,t),n}function vs(e,t){return new e(t)}const hr=new Map;let pr=0;function xl(e){let t=5381,i=e.length;for(;i--;)t=(t<<5)-t^e.charCodeAt(i);return t>>>0}function Ul(e,t){const i={stylesheet:Ml(t),rules:{}};return hr.set(e,i),i}function Dn(e,t,i,r,n,s,a,o=0){const l=16.666/r;let c=`{
`;for(let C=0;C<=1;C+=l){const z=t+(i-t)*s(C);c+=C*100+`%{${a(z,1-z)}}
`}const u=c+`100% {${a(i,1-i)}}
}`,d=`__svelte_${xl(u)}_${o}`,h=Ua(e),{stylesheet:f,rules:v}=hr.get(h)||Ul(h,e);v[d]||(v[d]=!0,f.insertRule(`@keyframes ${d} ${u}`,f.cssRules.length));const T=e.style.animation||"";return e.style.animation=`${T?`${T}, `:""}${d} ${r}ms linear ${n}ms 1 both`,pr+=1,d}function fr(e,t){const i=(e.style.animation||"").split(", "),r=i.filter(t?s=>s.indexOf(t)<0:s=>s.indexOf("__svelte")===-1),n=i.length-r.length;n&&(e.style.animation=r.join(", "),pr-=n,pr||Fl())}function Fl(){An(()=>{pr||(hr.forEach(e=>{const{ownerNode:t}=e.stylesheet;t&&G(t)}),hr.clear())})}function Ga(e,t,i,r){if(!t)return L;const n=e.getBoundingClientRect();if(t.left===n.left&&t.right===n.right&&t.top===n.top&&t.bottom===n.bottom)return L;const{delay:s=0,duration:a=300,easing:o=kn,start:l=Pn()+s,end:c=l+a,tick:u=L,css:d}=i(e,{from:t,to:n},r);let h=!0,f=!1,v;function T(){d&&(v=Dn(e,0,1,a,s,o,d)),s||(f=!0)}function C(){d&&fr(e,v),h=!1}return In(z=>{if(!f&&z>=l&&(f=!0),f&&z>=c&&(u(1,0),C()),!h)return!1;if(f){const x=z-l,I=0+1*o(x/a);u(I,1-I)}return!0}),T(),u(0,1),C}function Ba(e){const t=getComputedStyle(e);if(t.position!=="absolute"&&t.position!=="fixed"){const{width:i,height:r}=t,n=e.getBoundingClientRect();e.style.position="absolute",e.style.width=i,e.style.height=r,Gl(e,n)}}function Gl(e,t){const i=e.getBoundingClientRect();if(t.left!==i.left||t.top!==i.top){const r=getComputedStyle(e),n=r.transform==="none"?"":r.transform;e.style.transform=`${n} translate(${t.left-i.left}px, ${t.top-i.top}px)`}}let Ui;function Li(e){Ui=e}function wr(){if(!Ui)throw new Error("Function called outside component initialization");return Ui}function Bl(e){wr().$$.before_update.push(e)}function wn(e){wr().$$.on_mount.push(e)}function Vl(e){wr().$$.after_update.push(e)}function kt(e){wr().$$.on_destroy.push(e)}function jl(e,t){const i=e.$$.callbacks[t.type];i&&i.slice().forEach(r=>r.call(this,t))}const Oi=[],Wt=[],tr=[],Qr=[],ql=Promise.resolve();let Yr=!1;function Hl(){Yr||(Yr=!0,ql.then(Va))}function $t(e){tr.push(e)}function ys(e){Qr.push(e)}const Ur=new Set;let Qi=0;function Va(){const e=Ui;do{for(;Qi<Oi.length;){const t=Oi[Qi];Qi++,Li(t),Kl(t.$$)}for(Li(null),Oi.length=0,Qi=0;Wt.length;)Wt.pop()();for(let t=0;t<tr.length;t+=1){const i=tr[t];Ur.has(i)||(Ur.add(i),i())}tr.length=0}while(Oi.length);for(;Qr.length;)Qr.pop()();Yr=!1,Ur.clear(),Li(e)}function Kl(e){if(e.fragment!==null){e.update(),pt(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach($t)}}let Ri;function ja(){return Ri||(Ri=Promise.resolve(),Ri.then(()=>{Ri=null})),Ri}function mr(e,t,i){e.dispatchEvent($l(`${t?"intro":"outro"}${i}`))}const ir=new Set;let jt;function Ve(){jt={r:0,c:[],p:jt}}function je(){jt.r||pt(jt.c),jt=jt.p}function A(e,t){e&&e.i&&(ir.delete(e),e.i(t))}function O(e,t,i,r){if(e&&e.o){if(ir.has(e))return;ir.add(e),jt.c.push(()=>{ir.delete(e),r&&(i&&e.d(1),r())}),e.o(t)}else r&&r()}const qa={duration:0};function Or(e,t,i){let r=t(e,i),n=!1,s,a,o=0;function l(){s&&fr(e,s)}function c(){const{delay:d=0,duration:h=300,easing:f=kn,tick:v=L,css:T}=r||qa;T&&(s=Dn(e,0,1,h,d,f,T,o++)),v(0,1);const C=Pn()+d,z=C+h;a&&a.abort(),n=!0,$t(()=>mr(e,!0,"start")),a=In(x=>{if(n){if(x>=z)return v(1,0),mr(e,!0,"end"),l(),n=!1;if(x>=C){const I=f((x-C)/h);v(I,1-I)}}return n})}let u=!1;return{start(){u||(u=!0,fr(e),Rt(r)?(r=r(),ja().then(c)):c())},invalidate(){u=!1},end(){n&&(l(),n=!1)}}}function Ha(e,t,i){let r=t(e,i),n=!0,s;const a=jt;a.r+=1;function o(){const{delay:l=0,duration:c=300,easing:u=kn,tick:d=L,css:h}=r||qa;h&&(s=Dn(e,1,0,c,l,u,h));const f=Pn()+l,v=f+c;$t(()=>mr(e,!1,"start")),In(T=>{if(n){if(T>=v)return d(0,1),mr(e,!1,"end"),--a.r||pt(a.c),!1;if(T>=f){const C=u((T-f)/c);d(1-C,C)}}return n})}return Rt(r)?ja().then(()=>{r=r(),o()}):o(),{end(l){l&&r.tick&&r.tick(1,0),n&&(s&&fr(e,s),n=!1)}}}function rr(e,t){e.d(1),t.delete(e.key)}function Ka(e,t){O(e,1,1,()=>{t.delete(e.key)})}function Wl(e,t){e.f(),rr(e,t)}function zl(e,t){e.f(),Ka(e,t)}function fi(e,t,i,r,n,s,a,o,l,c,u,d){let h=e.length,f=s.length,v=h;const T={};for(;v--;)T[e[v].key]=v;const C=[],z=new Map,x=new Map;for(v=f;v--;){const H=d(n,s,v),le=i(H);let ce=a.get(le);ce?r&&ce.p(H,t):(ce=c(le,H),ce.c()),z.set(le,C[v]=ce),le in T&&x.set(le,Math.abs(v-T[le]))}const I=new Set,U=new Set;function W(H){A(H,1),H.m(o,u),a.set(H.key,H),u=H.first,f--}for(;h&&f;){const H=C[f-1],le=e[h-1],ce=H.key,J=le.key;H===le?(u=H.first,h--,f--):z.has(J)?!a.has(ce)||I.has(ce)?W(H):U.has(J)?h--:x.get(ce)>x.get(J)?(U.add(ce),W(H)):(I.add(J),h--):(l(le,a),h--)}for(;h--;){const H=e[h];z.has(H.key)||l(H,a)}for(;f;)W(C[f-1]);return C}function Ts(e,t,i){const r=e.$$.props[t];r!==void 0&&(e.$$.bound[r]=i,i(e.$$.ctx[r]))}function K(e){e&&e.c()}function j(e,t,i,r){const{fragment:n,after_update:s}=e.$$;n&&n.m(t,i),r||$t(()=>{const a=e.$$.on_mount.map(La).filter(Rt);e.$$.on_destroy?e.$$.on_destroy.push(...a):pt(a),e.$$.on_mount=[]}),s.forEach($t)}function q(e,t){const i=e.$$;i.fragment!==null&&(pt(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function Jl(e,t){e.$$.dirty[0]===-1&&(Oi.push(e),Hl(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ee(e,t,i,r,n,s,a,o=[-1]){const l=Ui;Li(e);const c=e.$$={fragment:null,ctx:[],props:s,update:L,not_equal:n,bound:ms(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:ms(),dirty:o,skip_bound:!1,root:t.target||l.$$.root};a&&a(c.root);let u=!1;if(c.ctx=i?i(e,t.props||{},(d,h,...f)=>{const v=f.length?f[0]:h;return c.ctx&&n(c.ctx[d],c.ctx[d]=v)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](v),u&&Jl(e,d)),h}):[],c.update(),u=!0,pt(c.before_update),c.fragment=r?r(c.ctx):!1,t.target){if(t.hydrate){const d=Nl(t.target);c.fragment&&c.fragment.l(d),d.forEach(G)}else c.fragment&&c.fragment.c();t.intro&&A(e.$$.fragment),j(e,t.target,t.anchor,t.customElement),Va()}Li(l)}class te{$destroy(){q(this,1),this.$destroy=L}$on(t,i){if(!Rt(i))return L;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(i),()=>{const n=r.indexOf(i);n!==-1&&r.splice(n,1)}}$set(t){this.$$set&&!wl(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function bt(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+e+(i.length?" "+i.map(function(n){return"'"+n+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function vi(e){return!!e&&!!e[dt]}function si(e){var t;return!!e&&(function(i){if(!i||typeof i!="object")return!1;var r=Object.getPrototypeOf(i);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return n===Object||typeof n=="function"&&Function.toString.call(n)===rc}(e)||Array.isArray(e)||!!e[Ps]||!!(!((t=e.constructor)===null||t===void 0)&&t[Ps])||On(e)||Mn(e))}function Fi(e,t,i){i===void 0&&(i=!1),Si(e)===0?(i?Object.keys:Un)(e).forEach(function(r){i&&typeof r=="symbol"||t(r,e[r],e)}):e.forEach(function(r,n){return t(n,r,e)})}function Si(e){var t=e[dt];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:On(e)?2:Mn(e)?3:0}function Zr(e,t){return Si(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Ql(e,t){return Si(e)===2?e.get(t):e[t]}function Wa(e,t,i){var r=Si(e);r===2?e.set(t,i):r===3?(e.delete(t),e.add(i)):e[t]=i}function Yl(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function On(e){return tc&&e instanceof Map}function Mn(e){return ic&&e instanceof Set}function Xt(e){return e.o||e.t}function Ln(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=nc(e);delete t[dt];for(var i=Un(t),r=0;r<i.length;r++){var n=i[r],s=t[n];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[n]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[n]})}return Object.create(Object.getPrototypeOf(e),t)}function Nn(e,t){return t===void 0&&(t=!1),$n(e)||vi(e)||!si(e)||(Si(e)>1&&(e.set=e.add=e.clear=e.delete=Zl),Object.freeze(e),t&&Fi(e,function(i,r){return Nn(r,!0)},!0)),e}function Zl(){bt(2)}function $n(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function Pt(e){var t=sc[e];return t||bt(18,e),t}function bs(){return Gi}function Fr(e,t){t&&(Pt("Patches"),e.u=[],e.s=[],e.v=t)}function gr(e){Xr(e),e.p.forEach(Xl),e.p=null}function Xr(e){e===Gi&&(Gi=e.l)}function Ss(e){return Gi={p:[],l:Gi,h:e,m:!0,_:0}}function Xl(e){var t=e[dt];t.i===0||t.i===1?t.j():t.O=!0}function Gr(e,t){t._=t.p.length;var i=t.p[0],r=e!==void 0&&e!==i;return t.h.g||Pt("ES5").S(t,e,r),r?(i[dt].P&&(gr(t),bt(4)),si(e)&&(e=vr(t,e),t.l||yr(t,e)),t.u&&Pt("Patches").M(i[dt].t,e,t.u,t.s)):e=vr(t,i,[]),gr(t),t.u&&t.v(t.u,t.s),e!==za?e:void 0}function vr(e,t,i){if($n(t))return t;var r=t[dt];if(!r)return Fi(t,function(s,a){return ks(e,r,t,s,a,i)},!0),t;if(r.A!==e)return t;if(!r.P)return yr(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var n=r.i===4||r.i===5?r.o=Ln(r.k):r.o;Fi(r.i===3?new Set(n):n,function(s,a){return ks(e,r,n,s,a,i)}),yr(e,n,!1),i&&e.u&&Pt("Patches").R(r,i,e.u,e.s)}return r.o}function ks(e,t,i,r,n,s){if(vi(n)){var a=vr(e,n,s&&t&&t.i!==3&&!Zr(t.D,r)?s.concat(r):void 0);if(Wa(i,r,a),!vi(a))return;e.m=!1}if(si(n)&&!$n(n)){if(!e.h.F&&e._<1)return;vr(e,n),t&&t.A.l||yr(e,n)}}function yr(e,t,i){i===void 0&&(i=!1),e.h.F&&e.m&&Nn(t,i)}function Br(e,t){var i=e[dt];return(i?Xt(i):e)[t]}function _s(e,t){if(t in e)for(var i=Object.getPrototypeOf(e);i;){var r=Object.getOwnPropertyDescriptor(i,t);if(r)return r;i=Object.getPrototypeOf(i)}}function en(e){e.P||(e.P=!0,e.l&&en(e.l))}function Vr(e){e.o||(e.o=Ln(e.t))}function tn(e,t,i){var r=On(t)?Pt("MapSet").N(t,i):Mn(t)?Pt("MapSet").T(t,i):e.g?function(n,s){var a=Array.isArray(n),o={i:a?1:0,A:s?s.A:bs(),P:!1,I:!1,D:{},l:s,t:n,k:null,o:null,j:null,C:!1},l=o,c=rn;a&&(l=[o],c=Mi);var u=Proxy.revocable(l,c),d=u.revoke,h=u.proxy;return o.k=h,o.j=d,h}(t,i):Pt("ES5").J(t,i);return(i?i.A:bs()).p.push(r),r}function ec(e){return vi(e)||bt(22,e),function t(i){if(!si(i))return i;var r,n=i[dt],s=Si(i);if(n){if(!n.P&&(n.i<4||!Pt("ES5").K(n)))return n.t;n.I=!0,r=Es(i,s),n.I=!1}else r=Es(i,s);return Fi(r,function(a,o){n&&Ql(n.t,a)===o||Wa(r,a,t(o))}),s===3?new Set(r):r}(e)}function Es(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return Ln(e)}var Cs,Gi,xn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",tc=typeof Map<"u",ic=typeof Set<"u",Rs=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",za=xn?Symbol.for("immer-nothing"):((Cs={})["immer-nothing"]=!0,Cs),Ps=xn?Symbol.for("immer-draftable"):"__$immer_draftable",dt=xn?Symbol.for("immer-state"):"__$immer_state",rc=""+Object.prototype.constructor,Un=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,nc=Object.getOwnPropertyDescriptors||function(e){var t={};return Un(e).forEach(function(i){t[i]=Object.getOwnPropertyDescriptor(e,i)}),t},sc={},rn={get:function(e,t){if(t===dt)return e;var i=Xt(e);if(!Zr(i,t))return function(n,s,a){var o,l=_s(s,a);return l?"value"in l?l.value:(o=l.get)===null||o===void 0?void 0:o.call(n.k):void 0}(e,i,t);var r=i[t];return e.I||!si(r)?r:r===Br(e.t,t)?(Vr(e),e.o[t]=tn(e.A.h,r,e)):r},has:function(e,t){return t in Xt(e)},ownKeys:function(e){return Reflect.ownKeys(Xt(e))},set:function(e,t,i){var r=_s(Xt(e),t);if(r!=null&&r.set)return r.set.call(e.k,i),!0;if(!e.P){var n=Br(Xt(e),t),s=n==null?void 0:n[dt];if(s&&s.t===i)return e.o[t]=i,e.D[t]=!1,!0;if(Yl(i,n)&&(i!==void 0||Zr(e.t,t)))return!0;Vr(e),en(e)}return e.o[t]===i&&typeof i!="number"&&(i!==void 0||t in e.o)||(e.o[t]=i,e.D[t]=!0,!0)},deleteProperty:function(e,t){return Br(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,Vr(e),en(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var i=Xt(e),r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:r.enumerable,value:i[t]}},defineProperty:function(){bt(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){bt(12)}},Mi={};Fi(rn,function(e,t){Mi[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Mi.deleteProperty=function(e,t){return Mi.set.call(this,e,t,void 0)},Mi.set=function(e,t,i){return rn.set.call(this,e[0],t,i,e[0])};var ac=function(){function e(i){var r=this;this.g=Rs,this.F=!0,this.produce=function(n,s,a){if(typeof n=="function"&&typeof s!="function"){var o=s;s=n;var l=r;return function(T){var C=this;T===void 0&&(T=o);for(var z=arguments.length,x=Array(z>1?z-1:0),I=1;I<z;I++)x[I-1]=arguments[I];return l.produce(T,function(U){var W;return(W=s).call.apply(W,[C,U].concat(x))})}}var c;if(typeof s!="function"&&bt(6),a!==void 0&&typeof a!="function"&&bt(7),si(n)){var u=Ss(r),d=tn(r,n,void 0),h=!0;try{c=s(d),h=!1}finally{h?gr(u):Xr(u)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(T){return Fr(u,a),Gr(T,u)},function(T){throw gr(u),T}):(Fr(u,a),Gr(c,u))}if(!n||typeof n!="object"){if((c=s(n))===void 0&&(c=n),c===za&&(c=void 0),r.F&&Nn(c,!0),a){var f=[],v=[];Pt("Patches").M(n,c,f,v),a(f,v)}return c}bt(21,n)},this.produceWithPatches=function(n,s){if(typeof n=="function")return function(c){for(var u=arguments.length,d=Array(u>1?u-1:0),h=1;h<u;h++)d[h-1]=arguments[h];return r.produceWithPatches(c,function(f){return n.apply(void 0,[f].concat(d))})};var a,o,l=r.produce(n,s,function(c,u){a=c,o=u});return typeof Promise<"u"&&l instanceof Promise?l.then(function(c){return[c,a,o]}):[l,a,o]},typeof(i==null?void 0:i.useProxies)=="boolean"&&this.setUseProxies(i.useProxies),typeof(i==null?void 0:i.autoFreeze)=="boolean"&&this.setAutoFreeze(i.autoFreeze)}var t=e.prototype;return t.createDraft=function(i){si(i)||bt(8),vi(i)&&(i=ec(i));var r=Ss(this),n=tn(this,i,void 0);return n[dt].C=!0,Xr(r),n},t.finishDraft=function(i,r){var n=i&&i[dt],s=n.A;return Fr(s,r),Gr(void 0,s)},t.setAutoFreeze=function(i){this.F=i},t.setUseProxies=function(i){i&&!Rs&&bt(20),this.g=i},t.applyPatches=function(i,r){var n;for(n=r.length-1;n>=0;n--){var s=r[n];if(s.path.length===0&&s.op==="replace"){i=s.value;break}}n>-1&&(r=r.slice(n+1));var a=Pt("Patches").$;return vi(i)?a(i,r):this.produce(i,function(o){return a(o,r)})},e}(),ht=new ac,oc=ht.produce;ht.produceWithPatches.bind(ht);ht.setAutoFreeze.bind(ht);ht.setUseProxies.bind(ht);ht.applyPatches.bind(ht);ht.createDraft.bind(ht);ht.finishDraft.bind(ht);const lc=oc;function cc(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(let r=0;r<i.length;r++)if(!Object.prototype.hasOwnProperty.call(t,i[r])||!Object.is(e[i[r]],t[i[r]]))return!1;return!0}function uc(e){let t;const i=new Set,r=(c,u)=>{const d=typeof c=="function"?c(t):c;if(d!==t){const h=t;t=u?d:Object.assign({},t,d),i.forEach(f=>f(t,h))}},n=()=>t,s=(c,u=n,d=Object.is)=>{let h=u(t);function f(){const v=u(t);if(!d(h,v)){const T=h;c(h=v,T)}}return i.add(f),()=>i.delete(f)},l={setState:r,getState:n,subscribe:(c,u,d)=>u||d?s(c,u,d):(i.add(c),()=>i.delete(c)),destroy:()=>i.clear()};return t=e(r,n,l),l}let Ja=!0,Qa=!0;function nr(e,t,i){const r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function li(e,t,i){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,n=r.addEventListener;r.addEventListener=function(a,o){if(a!==t)return n.apply(this,arguments);const l=c=>{const u=i(c);u&&(o.handleEvent?o.handleEvent(u):o(u))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(o,l),n.apply(this,[a,l])};const s=r.removeEventListener;r.removeEventListener=function(a,o){if(a!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(o))return s.apply(this,arguments);const l=this._eventMap[t].get(o);return this._eventMap[t].delete(o),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[a,l])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function dc(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Ja=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function hc(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Qa=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Ya(){if(typeof window=="object"){if(Ja)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Fn(e,t){!Qa||console.warn(e+" is deprecated, please use "+t+" instead.")}function pc(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator)return t.browser="Not a browser.",t;const{navigator:i}=e;if(i.mozGetUserMedia)t.browser="firefox",t.version=nr(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=nr(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=nr(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function As(e){return Object.prototype.toString.call(e)==="[object Object]"}function Za(e){return As(e)?Object.keys(e).reduce(function(t,i){const r=As(e[i]),n=r?Za(e[i]):e[i],s=r&&!Object.keys(n).length;return n===void 0||s?t:Object.assign(t,{[i]:n})},{}):e}function nn(e,t,i){!t||i.has(t.id)||(i.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?nn(e,e.get(t[r]),i):r.endsWith("Ids")&&t[r].forEach(n=>{nn(e,e.get(n),i)})}))}function Is(e,t,i){const r=i?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;const s=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&s.push(a)}),s.forEach(a=>{e.forEach(o=>{o.type===r&&o.trackId===a.id&&nn(e,o,n)})}),n}const Ds=Ya;function Xa(e,t){const i=e&&e.navigator;if(!i.mediaDevices)return;const r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const l={};return Object.keys(o).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof o[c]=="object"?o[c]:{ideal:o[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,f){return h?h+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(u.ideal!==void 0){l.optional=l.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",c)]=u.ideal,l.optional.push(h),h={},h[d("max",c)]=u.ideal,l.optional.push(h)):(h[d("",c)]=u.ideal,l.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(h,c)]=u[h])})}),o.advanced&&(l.optional=(l.optional||[]).concat(o.advanced)),l},n=function(o,l){if(t.version>=61)return l(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const c=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};o=JSON.parse(JSON.stringify(o)),c(o.audio,"autoGainControl","googAutoGainControl"),c(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let c=o.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=t.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete o.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return i.mediaDevices.enumerateDevices().then(h=>{h=h.filter(v=>v.kind==="videoinput");let f=h.find(v=>d.some(T=>v.label.toLowerCase().includes(T)));return!f&&h.length&&d.includes("back")&&(f=h[h.length-1]),f&&(o.video.deviceId=c.exact?{exact:f.deviceId}:{ideal:f.deviceId}),o.video=r(o.video),Ds("chrome: "+JSON.stringify(o)),l(o)})}o.video=r(o.video)}return Ds("chrome: "+JSON.stringify(o)),l(o)},s=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(o,l,c){n(o,u=>{i.webkitGetUserMedia(u,l,d=>{c&&c(s(d))})})};if(i.getUserMedia=a.bind(i),i.mediaDevices.getUserMedia){const o=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(l){return n(l,c=>o(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function fc(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&!!e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(n=>{const s=r.video&&r.video.width,a=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:o||3}},s&&(r.video.mandatory.maxWidth=s),a&&(r.video.mandatory.maxHeight=a),e.navigator.mediaDevices.getUserMedia(r)})}}}function eo(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function to(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",n=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===n.track.id):s={track:n.track};const a=new Event("track");a.track=n.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[r.stream],this.dispatchEvent(a)}),r.stream.getTracks().forEach(n=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===n.id):s={track:n};const a=new Event("track");a.track=n,a.receiver=s,a.transceiver={receiver:s},a.streams=[r.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else li(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function io(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(n,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=n.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:n}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,l){let c=n.apply(this,arguments);return c||(c=t(this,o),this._senders.push(c)),c};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const l=this._senders.indexOf(o);l!==-1&&this._senders.splice(l,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(a=>{const o=this._senders.find(l=>l.track===a);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ro(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,n,s]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const a=function(l){const c={};return l.result().forEach(d=>{const h={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(f=>{h[f]=d.stat(f)}),c[h.id]=h}),c},o=function(l){return new Map(Object.keys(l).map(c=>[c,l[c]]))};if(arguments.length>=2){const l=function(c){n(o(a(c)))};return t.apply(this,[l,r])}return new Promise((l,c)=>{t.apply(this,[function(u){l(o(a(u)))},c])}).then(n,s)}}function no(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=i.apply(this,[]);return s.forEach(a=>a._pc=this),s});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>Is(a,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=i.apply(this,[]);return n.forEach(s=>s._pc=this),n}),li(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(s=>Is(s,n.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let n,s,a;return this.getSenders().forEach(o=>{o.track===r&&(n?a=!0:n=o)}),this.getReceivers().forEach(o=>(o.track===r&&(s?a=!0:s=o),o.track===r)),a||n&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function so(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(l)===-1&&this._shimmedLocalStreams[o.id].push(l):this._shimmedLocalStreams[o.id]=[o,l],l};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();i.apply(this,arguments);const l=this.getSenders().filter(c=>o.indexOf(c)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const l=this._shimmedLocalStreams[o].indexOf(a);l!==-1&&this._shimmedLocalStreams[o].splice(l,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),n.apply(this,arguments)}}function ao(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return so(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const u=i.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new e.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}r.apply(this,[u])};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},e.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(T=>T===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(T=>T.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[d.id];if(v)v.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const T=new e.MediaStream([u]);this._streams[d.id]=T,this._reverseStreams[T.id]=d,this.addStream(T)}return this.getSenders().find(T=>T.track===u)};function s(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const f=c._reverseStreams[h],v=c._streams[f.id];d=d.replace(new RegExp(v.id,"g"),f.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function a(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const f=c._reverseStreams[h],v=c._streams[f.id];d=d.replace(new RegExp(f.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],d={[c](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[v=>{const T=s(this,v);h[0].apply(null,[T])},v=>{h[1]&&h[1].apply(null,v)},arguments[2]]):u.apply(this,arguments).then(v=>s(this,v))}};e.RTCPeerConnection.prototype[c]=d[c]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=a(this,arguments[0]),o.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:s(this,c)}}),e.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(T=>u.track===T)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function sn(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!!e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const r=e.RTCPeerConnection.prototype[i],n={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=n[i]})}function oo(e,t){li(e,"negotiationneeded",i=>{const r=i.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return i})}const ws=Object.freeze(Object.defineProperty({__proto__:null,shimMediaStream:eo,shimOnTrack:to,shimGetSendersWithDtmf:io,shimGetStats:ro,shimSenderReceiverGetStats:no,shimAddTrackRemoveTrackWithNative:so,shimAddTrackRemoveTrack:ao,shimPeerConnection:sn,fixNegotiationNeeded:oo,shimGetUserMedia:Xa,shimGetDisplayMedia:fc},Symbol.toStringTag,{value:"Module"}));function lo(e,t){const i=e&&e.navigator,r=e&&e.MediaStreamTrack;if(i.getUserMedia=function(n,s,a){Fn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(n).then(s,a)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const n=function(a,o,l){o in a&&!(l in a)&&(a[l]=a[o],delete a[o])},s=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a.audio,"autoGainControl","mozAutoGainControl"),n(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},r&&r.prototype.getSettings){const a=r.prototype.getSettings;r.prototype.getSettings=function(){const o=a.apply(this,arguments);return n(o,"mozAutoGainControl","autoGainControl"),n(o,"mozNoiseSuppression","noiseSuppression"),o}}if(r&&r.prototype.applyConstraints){const a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),n(o,"autoGainControl","mozAutoGainControl"),n(o,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[o])}}}}function mc(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function co(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function an(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const s=e.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=a[n]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,a,o]=arguments;return r.apply(this,[s||null]).then(l=>{if(t.version<53&&!a)try{l.forEach(c=>{c.type=i[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:i[u.type]||u.type}))})}return l}).then(a,o)}}function uo(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(s=>s._pc=this),n});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const n=i.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ho(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r}),li(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function po(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(i){Fn("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&i.getTracks().includes(r.track)&&this.removeTrack(r)})})}function fo(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function mo(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const n=r.length>0;n&&r.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(n){const{sender:a}=s,o=a.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=r,a.sendEncodings=r,this.setParametersPromises.push(a.setParameters(o).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function go(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function vo(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function yo(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const Os=Object.freeze(Object.defineProperty({__proto__:null,shimOnTrack:co,shimPeerConnection:an,shimSenderGetStats:uo,shimReceiverGetStats:ho,shimRemoveStream:po,shimRTCDataChannel:fo,shimAddTransceiver:mo,shimGetParameters:go,shimCreateOffer:vo,shimCreateAnswer:yo,shimGetUserMedia:lo,shimGetDisplayMedia:mc},Symbol.toStringTag,{value:"Module"}));function To(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(n=>t.call(this,n,r)),r.getVideoTracks().forEach(n=>t.call(this,n,r))},e.RTCPeerConnection.prototype.addTrack=function(r,...n){return n&&n.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(i);if(r===-1)return;this._localStreams.splice(r,1);const n=i.getTracks();this.getSenders().forEach(s=>{n.includes(s.track)&&this.removeTrack(s)})})}}function bo(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const s=new Event("addstream");s.stream=n,this.dispatchEvent(s)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,r.dispatchEvent(a)})}),t.apply(r,arguments)}}}function So(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h},t.createAnswer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=r.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h};let o=function(l,c,u){const d=n.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d};t.setLocalDescription=o,o=function(l,c,u){const d=s.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},t.setRemoteDescription=o,o=function(l,c,u){const d=a.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},t.addIceCandidate=o}function ko(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const i=t.mediaDevices,r=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=n=>r(_o(n))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(r,n,s){t.mediaDevices.getUserMedia(r).then(n,s)}.bind(t))}function _o(e){return e&&e.video!==void 0?Object.assign({},e,{video:Za(e.video)}):e}function Eo(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,n){if(r&&r.iceServers){const s=[];for(let a=0;a<r.iceServers.length;a++){let o=r.iceServers[a];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(Fn("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,s.push(o)):s.push(r.iceServers[a])}r.iceServers=s}return new t(r,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function Co(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ro(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const n=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):r.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Po(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const Ms=Object.freeze(Object.defineProperty({__proto__:null,shimLocalStreamsAPI:To,shimRemoteStreamsAPI:bo,shimCallbacksAPI:So,shimGetUserMedia:ko,shimConstraints:_o,shimRTCIceServerUrls:Eo,shimTrackEventTransceiver:Co,shimCreateOfferLegacy:Ro,shimAudioContext:Po},Symbol.toStringTag,{value:"Module"}));var gc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Gn={exports:{}};(function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(i){return i.split(`
m=`).map((n,s)=>(s>0?"m="+n:n).trim()+`\r
`)},t.getDescription=function(i){const r=t.splitSections(i);return r&&r[0]},t.getMediaSections=function(i){const r=t.splitSections(i);return r.shift(),r},t.matchPrefix=function(i,r){return t.splitLines(i).filter(n=>n.indexOf(r)===0)},t.parseCandidate=function(i){let r;i.indexOf("a=candidate:")===0?r=i.substring(12).split(" "):r=i.substring(10).split(" ");const n={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":n.relatedAddress=r[s+1];break;case"rport":n.relatedPort=parseInt(r[s+1],10);break;case"tcptype":n.tcpType=r[s+1];break;case"ufrag":n.ufrag=r[s+1],n.usernameFragment=r[s+1];break;default:n[r[s]]===void 0&&(n[r[s]]=r[s+1]);break}return n},t.writeCandidate=function(i){const r=[];r.push(i.foundation);const n=i.component;n==="rtp"?r.push(1):n==="rtcp"?r.push(2):r.push(n),r.push(i.protocol.toUpperCase()),r.push(i.priority),r.push(i.address||i.ip),r.push(i.port);const s=i.type;return r.push("typ"),r.push(s),s!=="host"&&i.relatedAddress&&i.relatedPort&&(r.push("raddr"),r.push(i.relatedAddress),r.push("rport"),r.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(r.push("ufrag"),r.push(i.usernameFragment||i.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(i){return i.substr(14).split(" ")},t.parseRtpMap=function(i){let r=i.substr(9).split(" ");const n={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),n.name=r[0],n.clockRate=parseInt(r[1],10),n.channels=r.length===3?parseInt(r[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(i){let r=i.payloadType;i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType);const n=i.channels||i.numChannels||1;return"a=rtpmap:"+r+" "+i.name+"/"+i.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(i){const r=i.substr(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+`\r
`},t.parseFmtp=function(i){const r={};let n;const s=i.substr(i.indexOf(" ")+1).split(";");for(let a=0;a<s.length;a++)n=s[a].trim().split("="),r[n[0].trim()]=n[1];return r},t.writeFmtp=function(i){let r="",n=i.payloadType;if(i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const s=[];Object.keys(i.parameters).forEach(a=>{i.parameters[a]!==void 0?s.push(a+"="+i.parameters[a]):s.push(a)}),r+="a=fmtp:"+n+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(i){const r=i.substr(i.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(i){let r="",n=i.payloadType;return i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+n+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(i){const r=i.indexOf(" "),n={ssrc:parseInt(i.substr(7,r-7),10)},s=i.indexOf(":",r);return s>-1?(n.attribute=i.substr(r+1,s-r-1),n.value=i.substr(s+1)):n.attribute=i.substr(r+1),n},t.parseSsrcGroup=function(i){const r=i.substr(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(n=>parseInt(n,10))}},t.getMid=function(i){const r=t.matchPrefix(i,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(i){const r=i.substr(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(i,r){return{role:"auto",fingerprints:t.matchPrefix(i+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,r){let n="a=setup:"+r+`\r
`;return i.fingerprints.forEach(s=>{n+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),n},t.parseCryptoLine=function(i){const r=i.substr(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const r=i.substr(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,r){return t.matchPrefix(i+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,r){const n=t.matchPrefix(i+r,"a=ice-ufrag:")[0],s=t.matchPrefix(i+r,"a=ice-pwd:")[0];return n&&s?{usernameFragment:n.substr(12),password:s.substr(10)}:null},t.writeIceParameters=function(i){let r="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(i){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(i)[0].split(" ");for(let a=3;a<s.length;a++){const o=s[a],l=t.matchPrefix(i,"a=rtpmap:"+o+" ")[0];if(l){const c=t.parseRtpMap(l),u=t.matchPrefix(i,"a=fmtp:"+o+" ");switch(c.parameters=u.length?t.parseFmtp(u[0]):{},c.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),r.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(c.name.toUpperCase());break}}}return t.matchPrefix(i,"a=extmap:").forEach(a=>{r.headerExtensions.push(t.parseExtmap(a))}),r},t.writeRtpDescription=function(i,r){let n="";n+="m="+i+" ",n+=r.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=r.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(a=>{n+=t.writeRtpMap(a),n+=t.writeFmtp(a),n+=t.writeRtcpFb(a)});let s=0;return r.codecs.forEach(a=>{a.maxptime>s&&(s=a.maxptime)}),s>0&&(n+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(a=>{n+=t.writeExtmap(a)}),n},t.parseRtpEncodingParameters=function(i){const r=[],n=t.parseRtpParameters(i),s=n.fecMechanisms.indexOf("RED")!==-1,a=n.fecMechanisms.indexOf("ULPFEC")!==-1,o=t.matchPrefix(i,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),l=o.length>0&&o[0].ssrc;let c;const u=t.matchPrefix(i,"a=ssrc-group:FID").map(h=>h.substr(17).split(" ").map(v=>parseInt(v,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),n.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let f={ssrc:l,codecPayloadType:parseInt(h.parameters.apt,10)};l&&c&&(f.rtx={ssrc:c}),r.push(f),s&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},r.push(f))}}),r.length===0&&l&&r.push({ssrc:l});let d=t.matchPrefix(i,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substr(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substr(5),10)*1e3*.95-50*40*8:d=void 0,r.forEach(h=>{h.maxBitrate=d})),r},t.parseRtcpParameters=function(i){const r={},n=t.matchPrefix(i,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const s=t.matchPrefix(i,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const a=t.matchPrefix(i,"a=rtcp-mux");return r.mux=a.length>0,r},t.writeRtcpParameters=function(i){let r="";return i.reducedSize&&(r+=`a=rtcp-rsize\r
`),i.mux&&(r+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(r+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),r},t.parseMsid=function(i){let r;const n=t.matchPrefix(i,"a=msid:");if(n.length===1)return r=n[0].substr(7).split(" "),{stream:r[0],track:r[1]};const s=t.matchPrefix(i,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},t.parseSctpDescription=function(i){const r=t.parseMLine(i),n=t.matchPrefix(i,"a=max-message-size:");let s;n.length>0&&(s=parseInt(n[0].substr(19),10)),isNaN(s)&&(s=65536);const a=t.matchPrefix(i,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:r.fmt,maxMessageSize:s};const o=t.matchPrefix(i,"a=sctpmap:");if(o.length>0){const l=o[0].substr(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},t.writeSctpDescription=function(i,r){let n=[];return i.protocol!=="DTLS/SCTP"?n=["m="+i.kind+" 9 "+i.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:n=["m="+i.kind+" 9 "+i.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&n.push("a=max-message-size:"+r.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(i,r,n){let s;const a=r!==void 0?r:2;return i?s=i:s=t.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+s+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,r){const n=t.splitLines(i);for(let s=0;s<n.length;s++)switch(n[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[s].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substr(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){const n=t.splitLines(i)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(i){const n=t.matchPrefix(i,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const r=t.splitLines(i);for(let n=0;n<r.length;n++)if(r[n].length<2||r[n].charAt(1)!=="=")return!1;return!0},e.exports=t})(Gn);const mi=Gn.exports,vc=Il({__proto__:null,default:mi},[Gn.exports]);function sr(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const n=new t(r),s=mi.parseCandidate(r.candidate),a=Object.assign(n,s);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,li(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function on(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||li(e,"icecandidate",t=>{if(t.candidate){const i=mi.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function ar(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(o){if(!o||!o.sdp)return!1;const l=mi.splitSections(o.sdp);return l.shift(),l.some(c=>{const u=mi.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(o){const l=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},n=function(o){let l=65536;return t.browser==="firefox"&&(t.version<57?o===-1?l=16384:l=2147483637:t.version<60?l=t.version===57?65535:65536:l=2147483637),l},s=function(o,l){let c=65536;t.browser==="firefox"&&t.version===57&&(c=65535);const u=mi.matchPrefix(o.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(c=2147483637),c},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const l=r(arguments[0]),c=n(l),u=s(arguments[0],l);let d;c===0&&u===0?d=Number.POSITIVE_INFINITY:c===0||u===0?d=Math.max(c,u):d=Math.min(c,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return a.apply(this,arguments)}}function or(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,n){const s=r.send;r.send=function(){const o=arguments[0],l=o.length||o.size||o.byteLength;if(r.readyState==="open"&&n.sctp&&l>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const n=i.apply(this,arguments);return t(n,this),n},li(e,"datachannel",r=>(t(r.channel,r.target),r))}function ln(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const r=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const s=n.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",n);s.dispatchEvent(a)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function cn(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=n.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&n instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:n.type,sdp:s}):n.sdp=s}return i.apply(this,arguments)}}function lr(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const i=e.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function cr(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const i=e.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return i.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?i.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>i.apply(this,[a]))})}const yc=Object.freeze(Object.defineProperty({__proto__:null,shimRTCIceCandidate:sr,shimRTCIceCandidateRelayProtocol:on,shimMaxMessageSize:ar,shimSendThrowTypeError:or,shimConnectionState:ln,removeExtmapAllowMixed:cn,shimAddIceCandidateNullOrEmpty:lr,shimParameterlessSetLocalDescription:cr},Symbol.toStringTag,{value:"Module"}));function Tc({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=Ya,r=pc(e),n={browserDetails:r,commonShim:yc,extractVersion:nr,disableLog:dc,disableWarnings:hc,sdp:vc};switch(r.browser){case"chrome":if(!ws||!sn||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),n;if(r.version===null)return i("Chrome shim can not determine version, not shimming."),n;i("adapter.js shimming chrome."),n.browserShim=ws,lr(e,r),cr(e),Xa(e,r),eo(e),sn(e,r),to(e),ao(e,r),io(e),ro(e),no(e),oo(e,r),sr(e),on(e),ln(e),ar(e,r),or(e),cn(e,r);break;case"firefox":if(!Os||!an||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),n;i("adapter.js shimming firefox."),n.browserShim=Os,lr(e,r),cr(e),lo(e,r),an(e,r),co(e),po(e),uo(e),ho(e),fo(e),mo(e),go(e),vo(e),yo(e),sr(e),ln(e),ar(e,r),or(e);break;case"safari":if(!Ms||!t.shimSafari)return i("Safari shim is not included in this adapter release."),n;i("adapter.js shimming safari."),n.browserShim=Ms,lr(e,r),cr(e),Eo(e),Ro(e),So(e),To(e),bo(e),Co(e),ko(e),Po(e),sr(e),on(e),ar(e,r),or(e),cn(e,r);break;default:i("Unsupported browser!");break}return n}const Tr=Tc({window:typeof window>"u"?void 0:window});var un={exports:{}};(function(e,t){(function(i,r){var n="1.0.32",s="",a="?",o="function",l="undefined",c="object",u="string",d="major",h="model",f="name",v="type",T="vendor",C="version",z="architecture",x="console",I="mobile",U="tablet",W="smarttv",H="wearable",le="embedded",ce=350,J="Amazon",ue="Apple",ye="ASUS",he="BlackBerry",Ne="Browser",Ge="Chrome",ie="Edge",at="Firefox",ot="Google",p="Huawei",b="LG",k="Microsoft",_="Motorola",R="Opera",S="Samsung",P="Sharp",D="Sony",M="Xiaomi",N="Zebra",X="Facebook",We=function(pe,Pe){var fe={};for(var Be in pe)Pe[Be]&&Pe[Be].length%2===0?fe[Be]=Pe[Be].concat(pe[Be]):fe[Be]=pe[Be];return fe},me=function(pe){for(var Pe={},fe=0;fe<pe.length;fe++)Pe[pe[fe].toUpperCase()]=pe[fe];return Pe},_e=function(pe,Pe){return typeof pe===u?De(Pe).indexOf(De(pe))!==-1:!1},De=function(pe){return pe.toLowerCase()},Ze=function(pe){return typeof pe===u?pe.replace(/[^\d\.]/g,s).split(".")[0]:r},Zt=function(pe,Pe){if(typeof pe===u)return pe=pe.replace(/^\s\s*/,s).replace(/\s\s*$/,s),typeof Pe===l?pe:pe.substring(0,ce)},Dt=function(pe,Pe){for(var fe=0,Be,ge,Ji,Me,Ci,Et;fe<Pe.length&&!Ci;){var ps=Pe[fe],fs=Pe[fe+1];for(Be=ge=0;Be<ps.length&&!Ci;)if(Ci=ps[Be++].exec(pe),Ci)for(Ji=0;Ji<fs.length;Ji++)Et=Ci[++ge],Me=fs[Ji],typeof Me===c&&Me.length>0?Me.length===2?typeof Me[1]==o?this[Me[0]]=Me[1].call(this,Et):this[Me[0]]=Me[1]:Me.length===3?typeof Me[1]===o&&!(Me[1].exec&&Me[1].test)?this[Me[0]]=Et?Me[1].call(this,Et,Me[2]):r:this[Me[0]]=Et?Et.replace(Me[1],Me[2]):r:Me.length===4&&(this[Me[0]]=Et?Me[3].call(this,Et.replace(Me[1],Me[2])):r):this[Me]=Et||r;fe+=2}},wt=function(pe,Pe){for(var fe in Pe)if(typeof Pe[fe]===c&&Pe[fe].length>0){for(var Be=0;Be<Pe[fe].length;Be++)if(_e(Pe[fe][Be],pe))return fe===a?r:fe}else if(_e(Pe[fe],pe))return fe===a?r:fe;return pe},Ei={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},mt={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Xe={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,C],[/opios[\/ ]+([\w\.]+)/i],[C,[f,R+" Mini"]],[/\bopr\/([\w\.]+)/i],[C,[f,R]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[f,C],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[f,"UC"+Ne]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[C,[f,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[C,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[f,"IE"]],[/yabrowser\/([\w\.]+)/i],[C,[f,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+Ne],C],[/\bfocus\/([\w\.]+)/i],[C,[f,at+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[f,R+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[f,R+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[f,"MIUI "+Ne]],[/fxios\/([-\w\.]+)/i],[C,[f,at]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 "+Ne]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 "+Ne],C],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[f,C],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,X],C],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[f,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[f,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[f,Ge+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,Ge+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[f,"Android "+Ne]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,C],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[C,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[C,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[C,wt,Ei]],[/(webkit|khtml)\/([\w\.]+)/i],[f,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[f,at+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[f,C]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[z,"amd64"]],[/(ia32(?=;))/i],[[z,De]],[/((?:i[346]|x)86)[;\)]/i],[[z,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[z,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[z,"armhf"]],[/windows (ce|mobile); ppc;/i],[[z,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[z,/ower/,s,De]],[/(sun4\w)[;\)]/i],[[z,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[z,De]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[T,S],[v,U]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[T,S],[v,I]],[/\((ip(?:hone|od)[\w ]*);/i],[h,[T,ue],[v,I]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[T,ue],[v,U]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[T,p],[v,U]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[T,p],[v,I]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[T,M],[v,I]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[T,M],[v,U]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[T,"OPPO"],[v,I]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[T,"Vivo"],[v,I]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[h,[T,"Realme"],[v,I]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[T,_],[v,I]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[T,_],[v,U]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[T,b],[v,U]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[T,b],[v,I]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[T,"Lenovo"],[v,U]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[T,"Nokia"],[v,I]],[/(pixel c)\b/i],[h,[T,ot],[v,U]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[T,ot],[v,I]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[T,D],[v,I]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[T,D],[v,U]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[T,"OnePlus"],[v,I]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[T,J],[v,U]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[T,J],[v,I]],[/(playbook);[-\w\),; ]+(rim)/i],[h,T,[v,U]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[T,he],[v,I]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[T,ye],[v,U]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[T,ye],[v,I]],[/(nexus 9)/i],[h,[T,"HTC"],[v,U]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony(?!-bra))[-_ ]?([-\w]*)/i],[T,[h,/_/g," "],[v,I]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[T,"Acer"],[v,U]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[T,"Meizu"],[v,I]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[T,P],[v,I]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[T,h,[v,I]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[T,h,[v,U]],[/(surface duo)/i],[h,[T,k],[v,U]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[T,"Fairphone"],[v,I]],[/(u304aa)/i],[h,[T,"AT&T"],[v,I]],[/\bsie-(\w*)/i],[h,[T,"Siemens"],[v,I]],[/\b(rct\w+) b/i],[h,[T,"RCA"],[v,U]],[/\b(venue[\d ]{2,7}) b/i],[h,[T,"Dell"],[v,U]],[/\b(q(?:mv|ta)\w+) b/i],[h,[T,"Verizon"],[v,U]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[T,"Barnes & Noble"],[v,U]],[/\b(tm\d{3}\w+) b/i],[h,[T,"NuVision"],[v,U]],[/\b(k88) b/i],[h,[T,"ZTE"],[v,U]],[/\b(nx\d{3}j) b/i],[h,[T,"ZTE"],[v,I]],[/\b(gen\d{3}) b.+49h/i],[h,[T,"Swiss"],[v,I]],[/\b(zur\d{3}) b/i],[h,[T,"Swiss"],[v,U]],[/\b((zeki)?tb.*\b) b/i],[h,[T,"Zeki"],[v,U]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[T,"Dragon Touch"],h,[v,U]],[/\b(ns-?\w{0,9}) b/i],[h,[T,"Insignia"],[v,U]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[T,"NextBook"],[v,U]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[T,"Voice"],h,[v,I]],[/\b(lvtel\-)?(v1[12]) b/i],[[T,"LvTel"],h,[v,I]],[/\b(ph-1) /i],[h,[T,"Essential"],[v,I]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[T,"Envizen"],[v,U]],[/\b(trio[-\w\. ]+) b/i],[h,[T,"MachSpeed"],[v,U]],[/\btu_(1491) b/i],[h,[T,"Rotor"],[v,U]],[/(shield[\w ]+) b/i],[h,[T,"Nvidia"],[v,U]],[/(sprint) (\w+)/i],[T,h,[v,I]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[T,k],[v,I]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[T,N],[v,U]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[T,N],[v,I]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[T,h,[v,x]],[/droid.+; (shield) bui/i],[h,[T,"Nvidia"],[v,x]],[/(playstation [345portablevi]+)/i],[h,[T,D],[v,x]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[T,k],[v,x]],[/smart-tv.+(samsung)/i],[T,[v,W]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[T,S],[v,W]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[T,b],[v,W]],[/(apple) ?tv/i],[T,[h,ue+" TV"],[v,W]],[/crkey/i],[[h,Ge+"cast"],[T,ot],[v,W]],[/droid.+aft(\w)( bui|\))/i],[h,[T,J],[v,W]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[T,P],[v,W]],[/(bravia[\w ]+)( bui|\))/i],[h,[T,D],[v,W]],[/(mitv-\w{5}) bui/i],[h,[T,M],[v,W]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[T,Zt],[h,Zt],[v,W]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[v,W]],[/((pebble))app/i],[T,h,[v,H]],[/droid.+; (glass) \d/i],[h,[T,ot],[v,H]],[/droid.+; (wt63?0{2,3})\)/i],[h,[T,N],[v,H]],[/(quest( 2)?)/i],[h,[T,X],[v,H]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[T,[v,le]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[h,[v,I]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[v,U]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[v,U]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[v,I]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[T,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[f,ie+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[f,C],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,C],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[f,[C,wt,mt]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,"Windows"],[C,wt,mt]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,"Mac OS"],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[C,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,C],[/\(bb(10);/i],[C,[f,he]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[C,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[f,at+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[f,"webOS"]],[/crkey\/([\d\.]+)/i],[C,[f,Ge+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[f,"Chromium OS"],C],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,C],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[f,C]]},yt=function(pe,Pe){if(typeof pe===c&&(Pe=pe,pe=r),!(this instanceof yt))return new yt(pe,Pe).getResult();var fe=pe||(typeof i!==l&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:s),Be=Pe?We(Xe,Pe):Xe;return this.getBrowser=function(){var ge={};return ge[f]=r,ge[C]=r,Dt.call(ge,fe,Be.browser),ge.major=Ze(ge.version),ge},this.getCPU=function(){var ge={};return ge[z]=r,Dt.call(ge,fe,Be.cpu),ge},this.getDevice=function(){var ge={};return ge[T]=r,ge[h]=r,ge[v]=r,Dt.call(ge,fe,Be.device),ge},this.getEngine=function(){var ge={};return ge[f]=r,ge[C]=r,Dt.call(ge,fe,Be.engine),ge},this.getOS=function(){var ge={};return ge[f]=r,ge[C]=r,Dt.call(ge,fe,Be.os),ge},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return fe},this.setUA=function(ge){return fe=typeof ge===u&&ge.length>ce?Zt(ge,ce):ge,this},this.setUA(fe),this};yt.VERSION=n,yt.BROWSER=me([f,C,d]),yt.CPU=me([z]),yt.DEVICE=me([h,T,v,x,I,W,U,H,le]),yt.ENGINE=yt.OS=me([f,C]),e.exports&&(t=e.exports=yt),t.UAParser=yt;var ui=typeof i!==l&&(i.jQuery||i.Zepto);if(ui&&!ui.ua){var zi=new yt;ui.ua=zi.getResult(),ui.ua.get=function(){return zi.getUA()},ui.ua.set=function(pe){zi.setUA(pe);var Pe=zi.getResult();for(var fe in Pe)ui.ua[fe]=Pe[fe]}}})(typeof window=="object"?window:gc)})(un,un.exports);var Yi,bc=new Uint8Array(16);function Sc(){if(!Yi&&(Yi=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Yi))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Yi(bc)}const kc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function _c(e){return typeof e=="string"&&kc.test(e)}var et=[];for(var jr=0;jr<256;++jr)et.push((jr+256).toString(16).substr(1));function Ec(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=(et[e[t+0]]+et[e[t+1]]+et[e[t+2]]+et[e[t+3]]+"-"+et[e[t+4]]+et[e[t+5]]+"-"+et[e[t+6]]+et[e[t+7]]+"-"+et[e[t+8]]+et[e[t+9]]+"-"+et[e[t+10]]+et[e[t+11]]+et[e[t+12]]+et[e[t+13]]+et[e[t+14]]+et[e[t+15]]).toLowerCase();if(!_c(i))throw TypeError("Stringified UUID is invalid");return i}function ki(e,t,i){e=e||{};var r=e.random||(e.rng||Sc)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){i=i||0;for(var n=0;n<16;++n)t[i+n]=r[n];return t}return Ec(r)}var Mr={exports:{}};/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */(function(e,t){(function(i){var r=Object.hasOwnProperty,n=Array.isArray?Array.isArray:function(b){return Object.prototype.toString.call(b)==="[object Array]"},s=10,a=typeof process=="object"&&typeof process.nextTick=="function",o=typeof Symbol=="function",l=typeof Reflect=="object",c=typeof setImmediate=="function",u=c?setImmediate:setTimeout,d=o?l&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(p){var b=Object.getOwnPropertyNames(p);return b.push.apply(b,Object.getOwnPropertySymbols(p)),b}:Object.keys;function h(){this._events={},this._conf&&f.call(this,this._conf)}function f(p){p&&(this._conf=p,p.delimiter&&(this.delimiter=p.delimiter),p.maxListeners!==i&&(this._maxListeners=p.maxListeners),p.wildcard&&(this.wildcard=p.wildcard),p.newListener&&(this._newListener=p.newListener),p.removeListener&&(this._removeListener=p.removeListener),p.verboseMemoryLeak&&(this.verboseMemoryLeak=p.verboseMemoryLeak),p.ignoreErrors&&(this.ignoreErrors=p.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function v(p,b){var k="(node) warning: possible EventEmitter memory leak detected. "+p+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(k+=" Event name: "+b+"."),typeof process<"u"&&process.emitWarning){var _=new Error(k);_.name="MaxListenersExceededWarning",_.emitter=this,_.count=p,process.emitWarning(_)}else console.error(k),console.trace&&console.trace()}var T=function(p,b,k){var _=arguments.length;switch(_){case 0:return[];case 1:return[p];case 2:return[p,b];case 3:return[p,b,k];default:for(var R=new Array(_);_--;)R[_]=arguments[_];return R}};function C(p,b){for(var k={},_,R=p.length,S=b?b.length:0,P=0;P<R;P++)_=p[P],k[_]=P<S?b[P]:i;return k}function z(p,b,k){this._emitter=p,this._target=b,this._listeners={},this._listenersCount=0;var _,R;if((k.on||k.off)&&(_=k.on,R=k.off),b.addEventListener?(_=b.addEventListener,R=b.removeEventListener):b.addListener?(_=b.addListener,R=b.removeListener):b.on&&(_=b.on,R=b.off),!_&&!R)throw Error("target does not implement any known event API");if(typeof _!="function")throw TypeError("on method must be a function");if(typeof R!="function")throw TypeError("off method must be a function");this._on=_,this._off=R;var S=p._observers;S?S.push(this):p._observers=[this]}Object.assign(z.prototype,{subscribe:function(p,b,k){var _=this,R=this._target,S=this._emitter,P=this._listeners,D=function(){var M=T.apply(null,arguments),N={data:M,name:b,original:p};if(k){var X=k.call(R,N);X!==!1&&S.emit.apply(S,[N.name].concat(M));return}S.emit.apply(S,[b].concat(M))};if(P[p])throw Error("Event '"+p+"' is already listening");this._listenersCount++,S._newListener&&S._removeListener&&!_._onNewListener?(this._onNewListener=function(M){M===b&&P[p]===null&&(P[p]=D,_._on.call(R,p,D))},S.on("newListener",this._onNewListener),this._onRemoveListener=function(M){M===b&&!S.hasListeners(M)&&P[p]&&(P[p]=null,_._off.call(R,p,D))},P[p]=null,S.on("removeListener",this._onRemoveListener)):(P[p]=D,_._on.call(R,p,D))},unsubscribe:function(p){var b=this,k=this._listeners,_=this._emitter,R,S,P=this._off,D=this._target,M;if(p&&typeof p!="string")throw TypeError("event must be a string");function N(){b._onNewListener&&(_.off("newListener",b._onNewListener),_.off("removeListener",b._onRemoveListener),b._onNewListener=null,b._onRemoveListener=null);var X=ce.call(_,b);_._observers.splice(X,1)}if(p){if(R=k[p],!R)return;P.call(D,p,R),delete k[p],--this._listenersCount||N()}else{for(S=d(k),M=S.length;M-- >0;)p=S[M],P.call(D,p,k[p]);this._listeners={},this._listenersCount=0,N()}}});function x(p,b,k,_){var R=Object.assign({},b);if(!p)return R;if(typeof p!="object")throw TypeError("options must be an object");var S=Object.keys(p),P=S.length,D,M,N;function X(me){throw Error('Invalid "'+D+'" option value'+(me?". Reason: "+me:""))}for(var We=0;We<P;We++){if(D=S[We],!_&&!r.call(b,D))throw Error('Unknown "'+D+'" option');M=p[D],M!==i&&(N=k[D],R[D]=N?N(M,X):M)}return R}function I(p,b){return(typeof p!="function"||!p.hasOwnProperty("prototype"))&&b("value must be a constructor"),p}function U(p){var b="value must be type of "+p.join("|"),k=p.length,_=p[0],R=p[1];return k===1?function(S,P){if(typeof S===_)return S;P(b)}:k===2?function(S,P){var D=typeof S;if(D===_||D===R)return S;P(b)}:function(S,P){for(var D=typeof S,M=k;M-- >0;)if(D===p[M])return S;P(b)}}var W=U(["function"]),H=U(["object","function"]);function le(p,b,k){var _,R,S=0,P,D=new p(function(M,N,X){k=x(k,{timeout:0,overload:!1},{timeout:function(De,Ze){return De*=1,(typeof De!="number"||De<0||!Number.isFinite(De))&&Ze("timeout must be a positive number"),De}}),_=!k.overload&&typeof p.prototype.cancel=="function"&&typeof X=="function";function We(){R&&(R=null),S&&(clearTimeout(S),S=0)}var me=function(De){We(),M(De)},_e=function(De){We(),N(De)};_?b(me,_e,X):(R=[function(De){_e(De||Error("canceled"))}],b(me,_e,function(De){if(P)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof De!="function")throw TypeError("onCancel callback must be a function");R.push(De)}),P=!0),k.timeout>0&&(S=setTimeout(function(){var De=Error("timeout");De.code="ETIMEDOUT",S=0,D.cancel(De),N(De)},k.timeout))});return _||(D.cancel=function(M){if(!!R){for(var N=R.length,X=1;X<N;X++)R[X](M);R[0](M),R=null}}),D}function ce(p){var b=this._observers;if(!b)return-1;for(var k=b.length,_=0;_<k;_++)if(b[_]._target===p)return _;return-1}function J(p,b,k,_,R){if(!k)return null;if(_===0){var S=typeof b;if(S==="string"){var P,D,M=0,N=0,X=this.delimiter,We=X.length;if((D=b.indexOf(X))!==-1){P=new Array(5);do P[M++]=b.slice(N,D),N=D+We;while((D=b.indexOf(X,N))!==-1);P[M++]=b.slice(N),b=P,R=M}else b=[b],R=1}else S==="object"?R=b.length:(b=[b],R=1)}var me=null,_e,De,Ze,Zt,Dt,wt=b[_],Ei=b[_+1],mt,Xe;if(_===R)k._listeners&&(typeof k._listeners=="function"?(p&&p.push(k._listeners),me=[k]):(p&&p.push.apply(p,k._listeners),me=[k]));else if(wt==="*"){for(mt=d(k),D=mt.length;D-- >0;)_e=mt[D],_e!=="_listeners"&&(Xe=J(p,b,k[_e],_+1,R),Xe&&(me?me.push.apply(me,Xe):me=Xe));return me}else if(wt==="**"){for(Dt=_+1===R||_+2===R&&Ei==="*",Dt&&k._listeners&&(me=J(p,b,k,R,R)),mt=d(k),D=mt.length;D-- >0;)_e=mt[D],_e!=="_listeners"&&(_e==="*"||_e==="**"?(k[_e]._listeners&&!Dt&&(Xe=J(p,b,k[_e],R,R),Xe&&(me?me.push.apply(me,Xe):me=Xe)),Xe=J(p,b,k[_e],_,R)):_e===Ei?Xe=J(p,b,k[_e],_+2,R):Xe=J(p,b,k[_e],_,R),Xe&&(me?me.push.apply(me,Xe):me=Xe));return me}else k[wt]&&(me=J(p,b,k[wt],_+1,R));if(De=k["*"],De&&J(p,b,De,_+1,R),Ze=k["**"],Ze)if(_<R)for(Ze._listeners&&J(p,b,Ze,R,R),mt=d(Ze),D=mt.length;D-- >0;)_e=mt[D],_e!=="_listeners"&&(_e===Ei?J(p,b,Ze[_e],_+2,R):_e===wt?J(p,b,Ze[_e],_+1,R):(Zt={},Zt[_e]=Ze[_e],J(p,b,{"**":Zt},_+1,R)));else Ze._listeners?J(p,b,Ze,R,R):Ze["*"]&&Ze["*"]._listeners&&J(p,b,Ze["*"],R,R);return me}function ue(p,b,k){var _=0,R=0,S,P=this.delimiter,D=P.length,M;if(typeof p=="string")if((S=p.indexOf(P))!==-1){M=new Array(5);do M[_++]=p.slice(R,S),R=S+D;while((S=p.indexOf(P,R))!==-1);M[_++]=p.slice(R)}else M=[p],_=1;else M=p,_=p.length;if(_>1){for(S=0;S+1<_;S++)if(M[S]==="**"&&M[S+1]==="**")return}var N=this.listenerTree,X;for(S=0;S<_;S++)if(X=M[S],N=N[X]||(N[X]={}),S===_-1)return N._listeners?(typeof N._listeners=="function"&&(N._listeners=[N._listeners]),k?N._listeners.unshift(b):N._listeners.push(b),!N._listeners.warned&&this._maxListeners>0&&N._listeners.length>this._maxListeners&&(N._listeners.warned=!0,v.call(this,N._listeners.length,X))):N._listeners=b,!0;return!0}function ye(p,b,k,_){for(var R=d(p),S=R.length,P,D,M,N=p._listeners,X;S-- >0;)D=R[S],P=p[D],D==="_listeners"?M=k:M=k?k.concat(D):[D],X=_||typeof D=="symbol",N&&b.push(X?M:M.join(this.delimiter)),typeof P=="object"&&ye.call(this,P,b,M,X);return b}function he(p){for(var b=d(p),k=b.length,_,R,S;k-- >0;)R=b[k],_=p[R],_&&(S=!0,R!=="_listeners"&&!he(_)&&delete p[R]);return S}function Ne(p,b,k){this.emitter=p,this.event=b,this.listener=k}Ne.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function Ge(p,b,k){if(k===!0)R=!0;else if(k===!1)_=!0;else{if(!k||typeof k!="object")throw TypeError("options should be an object or true");var _=k.async,R=k.promisify,S=k.nextTick,P=k.objectify}if(_||S||R){var D=b,M=b._origin||b;if(S&&!a)throw Error("process.nextTick is not supported");R===i&&(R=b.constructor.name==="AsyncFunction"),b=function(){var N=arguments,X=this,We=this.event;return R?S?Promise.resolve():new Promise(function(me){u(me)}).then(function(){return X.event=We,D.apply(X,N)}):(S?process.nextTick:u)(function(){X.event=We,D.apply(X,N)})},b._async=!0,b._origin=M}return[b,P?new Ne(this,p,b):this]}function ie(p){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,f.call(this,p)}ie.EventEmitter2=ie,ie.prototype.listenTo=function(p,b,k){if(typeof p!="object")throw TypeError("target musts be an object");var _=this;k=x(k,{on:i,off:i,reducers:i},{on:W,off:W,reducers:H});function R(S){if(typeof S!="object")throw TypeError("events must be an object");var P=k.reducers,D=ce.call(_,p),M;D===-1?M=new z(_,p,k):M=_._observers[D];for(var N=d(S),X=N.length,We,me=typeof P=="function",_e=0;_e<X;_e++)We=N[_e],M.subscribe(We,S[We]||We,me?P:P&&P[We])}return n(b)?R(C(b)):R(typeof b=="string"?C(b.split(/\s+/)):b),this},ie.prototype.stopListeningTo=function(p,b){var k=this._observers;if(!k)return!1;var _=k.length,R,S=!1;if(p&&typeof p!="object")throw TypeError("target should be an object");for(;_-- >0;)R=k[_],(!p||R._target===p)&&(R.unsubscribe(b),S=!0);return S},ie.prototype.delimiter=".",ie.prototype.setMaxListeners=function(p){p!==i&&(this._maxListeners=p,this._conf||(this._conf={}),this._conf.maxListeners=p)},ie.prototype.getMaxListeners=function(){return this._maxListeners},ie.prototype.event="",ie.prototype.once=function(p,b,k){return this._once(p,b,!1,k)},ie.prototype.prependOnceListener=function(p,b,k){return this._once(p,b,!0,k)},ie.prototype._once=function(p,b,k,_){return this._many(p,1,b,k,_)},ie.prototype.many=function(p,b,k,_){return this._many(p,b,k,!1,_)},ie.prototype.prependMany=function(p,b,k,_){return this._many(p,b,k,!0,_)},ie.prototype._many=function(p,b,k,_,R){var S=this;if(typeof k!="function")throw new Error("many only accepts instances of Function");function P(){return--b===0&&S.off(p,P),k.apply(this,arguments)}return P._origin=k,this._on(p,P,_,R)},ie.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var p=arguments[0],b,k=this.wildcard,_,R,S,P,D;if(p==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(k&&(b=p,p!=="newListener"&&p!=="removeListener"&&typeof p=="object")){if(R=p.length,o){for(S=0;S<R;S++)if(typeof p[S]=="symbol"){D=!0;break}}D||(p=p.join(this.delimiter))}var M=arguments.length,N;if(this._all&&this._all.length)for(N=this._all.slice(),S=0,R=N.length;S<R;S++)switch(this.event=p,M){case 1:N[S].call(this,p);break;case 2:N[S].call(this,p,arguments[1]);break;case 3:N[S].call(this,p,arguments[1],arguments[2]);break;default:N[S].apply(this,arguments)}if(k)N=[],J.call(this,N,b,this.listenerTree,0,R);else if(N=this._events[p],typeof N=="function"){switch(this.event=p,M){case 1:N.call(this);break;case 2:N.call(this,arguments[1]);break;case 3:N.call(this,arguments[1],arguments[2]);break;default:for(_=new Array(M-1),P=1;P<M;P++)_[P-1]=arguments[P];N.apply(this,_)}return!0}else N&&(N=N.slice());if(N&&N.length){if(M>3)for(_=new Array(M-1),P=1;P<M;P++)_[P-1]=arguments[P];for(S=0,R=N.length;S<R;S++)switch(this.event=p,M){case 1:N[S].call(this);break;case 2:N[S].call(this,arguments[1]);break;case 3:N[S].call(this,arguments[1],arguments[2]);break;default:N[S].apply(this,_)}return!0}else if(!this.ignoreErrors&&!this._all&&p==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},ie.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var p=arguments[0],b=this.wildcard,k,_,R,S,P,D;if(p==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(b&&(k=p,p!=="newListener"&&p!=="removeListener"&&typeof p=="object")){if(S=p.length,o){for(P=0;P<S;P++)if(typeof p[P]=="symbol"){_=!0;break}}_||(p=p.join(this.delimiter))}var M=[],N=arguments.length,X;if(this._all)for(P=0,S=this._all.length;P<S;P++)switch(this.event=p,N){case 1:M.push(this._all[P].call(this,p));break;case 2:M.push(this._all[P].call(this,p,arguments[1]));break;case 3:M.push(this._all[P].call(this,p,arguments[1],arguments[2]));break;default:M.push(this._all[P].apply(this,arguments))}if(b?(X=[],J.call(this,X,k,this.listenerTree,0)):X=this._events[p],typeof X=="function")switch(this.event=p,N){case 1:M.push(X.call(this));break;case 2:M.push(X.call(this,arguments[1]));break;case 3:M.push(X.call(this,arguments[1],arguments[2]));break;default:for(R=new Array(N-1),D=1;D<N;D++)R[D-1]=arguments[D];M.push(X.apply(this,R))}else if(X&&X.length){if(X=X.slice(),N>3)for(R=new Array(N-1),D=1;D<N;D++)R[D-1]=arguments[D];for(P=0,S=X.length;P<S;P++)switch(this.event=p,N){case 1:M.push(X[P].call(this));break;case 2:M.push(X[P].call(this,arguments[1]));break;case 3:M.push(X[P].call(this,arguments[1],arguments[2]));break;default:M.push(X[P].apply(this,R))}}else if(!this.ignoreErrors&&!this._all&&p==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(M)},ie.prototype.on=function(p,b,k){return this._on(p,b,!1,k)},ie.prototype.prependListener=function(p,b,k){return this._on(p,b,!0,k)},ie.prototype.onAny=function(p){return this._onAny(p,!1)},ie.prototype.prependAny=function(p){return this._onAny(p,!0)},ie.prototype.addListener=ie.prototype.on,ie.prototype._onAny=function(p,b){if(typeof p!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),b?this._all.unshift(p):this._all.push(p),this},ie.prototype._on=function(p,b,k,_){if(typeof p=="function")return this._onAny(p,b),this;if(typeof b!="function")throw new Error("on only accepts instances of Function");this._events||h.call(this);var R=this,S;return _!==i&&(S=Ge.call(this,p,b,_),b=S[0],R=S[1]),this._newListener&&this.emit("newListener",p,b),this.wildcard?(ue.call(this,p,b,k),R):(this._events[p]?(typeof this._events[p]=="function"&&(this._events[p]=[this._events[p]]),k?this._events[p].unshift(b):this._events[p].push(b),!this._events[p].warned&&this._maxListeners>0&&this._events[p].length>this._maxListeners&&(this._events[p].warned=!0,v.call(this,this._events[p].length,p))):this._events[p]=b,R)},ie.prototype.off=function(p,b){if(typeof b!="function")throw new Error("removeListener only takes instances of Function");var k,_=[];if(this.wildcard){var R=typeof p=="string"?p.split(this.delimiter):p.slice();if(_=J.call(this,null,R,this.listenerTree,0),!_)return this}else{if(!this._events[p])return this;k=this._events[p],_.push({_listeners:k})}for(var S=0;S<_.length;S++){var P=_[S];if(k=P._listeners,n(k)){for(var D=-1,M=0,N=k.length;M<N;M++)if(k[M]===b||k[M].listener&&k[M].listener===b||k[M]._origin&&k[M]._origin===b){D=M;break}if(D<0)continue;return this.wildcard?P._listeners.splice(D,1):this._events[p].splice(D,1),k.length===0&&(this.wildcard?delete P._listeners:delete this._events[p]),this._removeListener&&this.emit("removeListener",p,b),this}else(k===b||k.listener&&k.listener===b||k._origin&&k._origin===b)&&(this.wildcard?delete P._listeners:delete this._events[p],this._removeListener&&this.emit("removeListener",p,b))}return this.listenerTree&&he(this.listenerTree),this},ie.prototype.offAny=function(p){var b=0,k=0,_;if(p&&this._all&&this._all.length>0){for(_=this._all,b=0,k=_.length;b<k;b++)if(p===_[b])return _.splice(b,1),this._removeListener&&this.emit("removeListenerAny",p),this}else{if(_=this._all,this._removeListener)for(b=0,k=_.length;b<k;b++)this.emit("removeListenerAny",_[b]);this._all=[]}return this},ie.prototype.removeListener=ie.prototype.off,ie.prototype.removeAllListeners=function(p){if(p===i)return!this._events||h.call(this),this;if(this.wildcard){var b=J.call(this,null,p,this.listenerTree,0),k,_;if(!b)return this;for(_=0;_<b.length;_++)k=b[_],k._listeners=null;this.listenerTree&&he(this.listenerTree)}else this._events&&(this._events[p]=null);return this},ie.prototype.listeners=function(p){var b=this._events,k,_,R,S,P;if(p===i){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!b)return[];for(k=d(b),S=k.length,R=[];S-- >0;)_=b[k[S]],typeof _=="function"?R.push(_):R.push.apply(R,_);return R}else{if(this.wildcard){if(P=this.listenerTree,!P)return[];var D=[],M=typeof p=="string"?p.split(this.delimiter):p.slice();return J.call(this,D,M,P,0),D}return b?(_=b[p],_?typeof _=="function"?[_]:_:[]):[]}},ie.prototype.eventNames=function(p){var b=this._events;return this.wildcard?ye.call(this,this.listenerTree,[],null,p):b?d(b):[]},ie.prototype.listenerCount=function(p){return this.listeners(p).length},ie.prototype.hasListeners=function(p){if(this.wildcard){var b=[],k=typeof p=="string"?p.split(this.delimiter):p.slice();return J.call(this,b,k,this.listenerTree,0),b.length>0}var _=this._events,R=this._all;return!!(R&&R.length||_&&(p===i?d(_).length:_[p]))},ie.prototype.listenersAny=function(){return this._all?this._all:[]},ie.prototype.waitFor=function(p,b){var k=this,_=typeof b;return _==="number"?b={timeout:b}:_==="function"&&(b={filter:b}),b=x(b,{timeout:0,filter:i,handleError:!1,Promise,overload:!1},{filter:W,Promise:I}),le(b.Promise,function(R,S,P){function D(){var M=b.filter;if(!(M&&!M.apply(k,arguments)))if(k.off(p,D),b.handleError){var N=arguments[0];N?S(N):R(T.apply(null,arguments).slice(1))}else R(T.apply(null,arguments))}P(function(){k.off(p,D)}),k._on(p,D,!1)},{timeout:b.timeout,overload:b.overload})};function at(p,b,k){k=x(k,{Promise,timeout:0,overload:!1},{Promise:I});var _=k.Promise;return le(_,function(R,S,P){var D;if(typeof p.addEventListener=="function"){D=function(){R(T.apply(null,arguments))},P(function(){p.removeEventListener(b,D)}),p.addEventListener(b,D,{once:!0});return}var M=function(){N&&p.removeListener("error",N),R(T.apply(null,arguments))},N;b!=="error"&&(N=function(X){p.removeListener(b,M),S(X)},p.once("error",N)),P(function(){N&&p.removeListener("error",N),p.removeListener(b,M)}),p.once(b,M)},{timeout:k.timeout,overload:k.overload})}var ot=ie.prototype;Object.defineProperties(ie,{defaultMaxListeners:{get:function(){return ot._maxListeners},set:function(p){if(typeof p!="number"||p<0||Number.isNaN(p))throw TypeError("n must be a non-negative number");ot._maxListeners=p},enumerable:!0},once:{value:at,writable:!0,configurable:!0}}),Object.defineProperties(ot,{_maxListeners:{value:s,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),typeof i=="function"&&i.amd?i(function(){return ie}):e.exports=ie})()})(Mr);var Ao={},Bn={exports:{}},Ls=Bn.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Ls).forEach(function(e){var t=Ls[e];t.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})});(function(e){var t=function(o){return String(Number(o))===o?Number(o):o},i=function(o,l,c,u){if(u&&!c)l[u]=t(o[1]);else for(var d=0;d<c.length;d+=1)o[d+1]!=null&&(l[c[d]]=t(o[d+1]))},r=function(o,l,c){var u=o.name&&o.names;o.push&&!l[o.push]?l[o.push]=[]:u&&!l[o.name]&&(l[o.name]={});var d=o.push?{}:u?l[o.name]:l;i(c.match(o.reg),d,o.names,o.name),o.push&&l[o.push].push(d)},n=Bn.exports,s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(o){var l={},c=[],u=l;return o.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],f=d.slice(2);h==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var v=0;v<(n[h]||[]).length;v+=1){var T=n[h][v];if(T.reg.test(f))return r(T,u,f)}}),l.media=c,l};var a=function(o,l){var c=l.split(/=(.+)/,2);return c.length===2?o[c[0]]=t(c[1]):c.length===1&&l.length>1&&(o[c[0]]=void 0),o};e.parseParams=function(o){return o.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(o){return o.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(o){for(var l=[],c=o.split(" ").map(t),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},e.parseImageAttributes=function(o){return o.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(a,{})})},e.parseSimulcastStreamList=function(o){return o.split(";").map(function(l){return l.split(",").map(function(c){var u,d=!1;return c[0]!=="~"?u=t(c):(u=t(c.substring(1,c.length)),d=!0),{scid:u,paused:d}})})}})(Ao);var qr=Bn.exports,Cc=/%[sdv%]/g,Rc=function(e){var t=1,i=arguments,r=i.length;return e.replace(Cc,function(n){if(t>=r)return n;var s=i[t];switch(t+=1,n){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},Pi=function(e,t,i){var r=t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format,n=[e+"="+r];if(t.names)for(var s=0;s<t.names.length;s+=1){var a=t.names[s];t.name?n.push(i[t.name][a]):n.push(i[t.names[s]])}else n.push(i[t.name]);return Rc.apply(null,n)},Pc=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Ac=["i","c","b","a"],Ic=function(e,t){t=t||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var i=t.outerOrder||Pc,r=t.innerOrder||Ac,n=[];return i.forEach(function(s){qr[s].forEach(function(a){a.name in e&&e[a.name]!=null?n.push(Pi(s,a,e)):a.push in e&&e[a.push]!=null&&e[a.push].forEach(function(o){n.push(Pi(s,a,o))})})}),e.media.forEach(function(s){n.push(Pi("m",qr.m[0],s)),r.forEach(function(a){qr[a].forEach(function(o){o.name in s&&s[o.name]!=null?n.push(Pi(a,o,s)):o.push in s&&s[o.push]!=null&&s[o.push].forEach(function(l){n.push(Pi(a,o,l))})})})}),n.join(`\r
`)+`\r
`},ci=Ao,Dc=Ic,wc=Dc,Io=ci.parse;ci.parseParams;ci.parseFmtpConfig;ci.parsePayloads;ci.parseRemoteCandidates;ci.parseImageAttributes;ci.parseSimulcastStreamList;var Oc=Object.defineProperty,Mc=Object.defineProperties,Lc=Object.getOwnPropertyDescriptors,br=Object.getOwnPropertySymbols,Do=Object.prototype.hasOwnProperty,wo=Object.prototype.propertyIsEnumerable,Ns=(e,t,i)=>t in e?Oc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,se=(e,t)=>{for(var i in t||(t={}))Do.call(t,i)&&Ns(e,i,t[i]);if(br)for(var i of br(t))wo.call(t,i)&&Ns(e,i,t[i]);return e},Ye=(e,t)=>Mc(e,Lc(t)),$s=(e,t)=>{var i={};for(var r in e)Do.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&br)for(var r of br(e))t.indexOf(r)<0&&wo.call(e,r)&&(i[r]=e[r]);return i},Nc=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),g=(e,t,i)=>new Promise((r,n)=>{var s=l=>{try{o(i.next(l))}catch(c){n(c)}},a=l=>{try{o(i.throw(l))}catch(c){n(c)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,a);o((i=i.apply(e,t)).next())}),$c=Nc((e,t)=>{t.exports={name:"@100mslive/hms-video",version:"0.6.1",license:"MIT",main:"dist/index.cjs.js",typings:"dist/index.d.ts",module:"dist/index.js",files:["dist","src"],engines:{node:">=10"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",test:"jest --maxWorkers=1",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",format:"prettier --write src/**/*.ts"},author:"100ms <tech-common@100ms.live>",devDependencies:{"@types/sdp-transform":"^2.4.4","@types/ua-parser-js":"^0.7.36","@types/uuid":"^8.3.0","jest-canvas-mock":"^2.3.1",tslib:"^2.2.0"},dependencies:{eventemitter2:"^6.4.7","sdp-transform":"^2.14.1","ua-parser-js":"^1.0.1",uuid:"^8.3.2","webrtc-adapter":"^8.0.0"},gitHead:"b4d98c849c3e4ae4e583b2e2c8f9813193cf1d7c"}}),Lr=class{constructor(e){this.key=e,this.storage=null}getStorage(){return _i&&!this.storage&&(Bc(),this.storage=window.localStorage),this.storage}get(){var e;let t=(e=this.getStorage())==null?void 0:e.getItem(this.key);return t?JSON.parse(t):void 0}set(e){var t;let i=JSON.stringify(e);(t=this.getStorage())==null||t.setItem(this.key,i)}clear(){var e;(e=this.getStorage())==null||e.removeItem(this.key)}},Ni=new un.exports.UAParser,xs,Vn=typeof window>"u"&&!((xs=Ni.getBrowser().name)!=null&&xs.toLowerCase().includes("electron")),_i=typeof window<"u",lt;(function(e){e.PROD="prod",e.QA="qa",e.DEV="dev"})(lt||(lt={}));var xc=()=>Ni.getDevice().type==="mobile",Uc=()=>{let e,t=new Lr("hms-analytics-deviceId"),i=t.get();return i?e=i:(e=ki(),t.set(e)),e},Fc=()=>typeof document<"u"&&document.hidden,Gc=class{constructor(){this.valuesMap=new Map}getItem(e){return this.valuesMap.has(e)?String(this.valuesMap.get(e)):null}setItem(e,t){this.valuesMap.set(e,t)}removeItem(e){this.valuesMap.delete(e)}clear(){this.valuesMap.clear()}key(e){if(arguments.length===0)throw new TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");return Array.from(this.valuesMap.keys())[e]}get length(){return this.valuesMap.size}},Bc=()=>{_i&&!localStorage&&(window.localStorage=new Gc)},ze;(function(e){e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.TIME=4]="TIME",e[e.TIMEEND=5]="TIMEEND",e[e.ERROR=6]="ERROR",e[e.NONE=7]="NONE"})(ze||(ze={}));var Vc=typeof window<"u"&&typeof window.expect<"u",m=class{static v(e,...t){this.log(0,e,...t)}static d(e,...t){this.log(1,e,...t)}static i(e,...t){this.log(2,e,...t)}static w(e,...t){this.log(3,e,...t)}static e(e,...t){this.log(6,e,...t)}static time(e){this.log(4,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(5,"[HMSPerformanceTiming]",e,e)}static cleanUp(){performance.clearMarks(),performance.clearMeasures()}static log(e,t,...i){if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:{console.log(t,...i);break}case 1:{console.debug(t,...i);break}case 2:{console.info(t,...i);break}case 3:{console.warn(t,...i);break}case 6:{console.error(t,...i);break}case 4:{performance.mark(i[0]);break}case 5:{let r=i[0];try{let n=performance.measure(r,r);this.log(1,t,r,n==null?void 0:n.duration),performance.clearMarks(r),performance.clearMeasures(r)}catch(n){this.log(1,t,r,n)}break}}}};m.level=Vc?7:0;var Oo=class{constructor({sender:e,message:t,type:i="chat",recipientPeer:r,recipientRoles:n,time:s}){this.sender=e,this.message=t,this.type=i,this.recipientPeer=r,this.recipientRoles=n,this.time=s}toSignalParams(){var e,t;let i=(e=this.recipientRoles)==null?void 0:e.map(s=>s.name),r=(t=this.recipientPeer)==null?void 0:t.peerId,n={info:{message:this.message,type:this.type}};return i!=null&&i.length&&(n.roles=i),r&&(n.peer_id=r),n}toString(){var e;return`{
      sender: ${this.sender};
      recipientPeer: ${this.recipientPeer};
      recipientRoles: ${(e=this.recipientRoles)==null?void 0:e.map(t=>t.name)};
      message: ${this.message};
      time: ${this.time};
      type: ${this.type};
    }`}},jc=class{constructor(e,t){this.id=e,this.store=t,this.recording={server:{running:!1},browser:{running:!1},hls:{running:!1}},this.rtmp={running:!1},this.hls={running:!1,variants:[]}}get localPeer(){return this.store.getLocalPeer()}get peers(){return this.store.getPeers()}},jn=class{constructor({peerId:e,name:t,isLocal:i,customerUserId:r,metadata:n,role:s,joinedAt:a}){this.customerUserId="",this.metadata="",this.auxiliaryTracks=[],this.name=t,this.peerId=e,this.isLocal=i,this.customerUserId=r,this.metadata=n,this.joinedAt=a,s&&(this.role=s)}updateRole(e){this.role=e}updateName(e){this.name=e}updateMetadata(e){this.metadata=e}toString(){var e;return`{
      name: ${this.name};
      role: ${(e=this.role)==null?void 0:e.name};
      peerId: ${this.peerId};
      customerUserId: ${this.customerUserId};
    }`}},Mo=class{};Mo.makePeerId=()=>ki();var qc=class extends jn{constructor(e){super(Ye(se({},e),{peerId:Mo.makePeerId(),isLocal:!0})),this.isLocal=!0,this.auxiliaryTracks=[]}},Hc=class extends jn{constructor(e){super(Ye(se({},e),{isLocal:!1})),this.isLocal=!1,this.auxiliaryTracks=[],this.fromRoomState=!1,this.fromRoomState=!!e.fromRoomState}},ri;(function(e){e.CUSTOM="CUSTOM",e.LOCAL="LOCAL",e.HMS="HMS"})(ri||(ri={}));function Kc(){if(_i&&window){let e=window.location.hostname;return e==="localhost"||e==="127.0.0.1"?ri.LOCAL:e.includes("app.100ms.live")?ri.HMS:ri.CUSTOM}return ri.CUSTOM}var ur=Kc(),Us=$c().version;function dn(e=lt.PROD,t){let i="web",r=ur!==ri.LOCAL&&e===lt.PROD?"prod":"debug";if(Vn)return Fs({os:"web_nodejs",os_version:process.version,sdk:i,sdk_version:Us,env:r,domain:ur,framework:"node",framework_version:process.version,framework_sdk_version:t==null?void 0:t.sdkVersion});let n=Ni.getOS(),s=Ni.getDevice(),a=Ni.getBrowser(),o=Hr(`web_${n.name}`),l=n.version||"",c=Hr(`${a.name}_${a.version}`),u=c;return s.type&&(u=`${Hr(`${s.vendor}_${s.type}`)}/${c}`),Fs({os:o,os_version:l,sdk:i,sdk_version:Us,device_model:u,env:r,domain:ur,framework:t==null?void 0:t.type,framework_version:t==null?void 0:t.version,framework_sdk_version:t==null?void 0:t.sdkVersion})}function Hr(e){return e.replace(/ /g,"_")}var Fs=(e,t=",")=>Object.keys(e).filter(i=>!!e[i]).map(i=>`${i}:${e[i]}`).join(t),Je=class{constructor({name:e,level:t,properties:i,includesPII:r,timestamp:n}){this.metadata={peer:{},userAgent:dn()},this.name=e,this.level=t,this.includesPII=r||!1,this.properties=i||{},this.timestamp=n||new Date().getTime(),this.event_id=ki(),this.device_id=Uc()}toSignalParams(){return{name:this.name,info:Ye(se({},this.properties),{timestamp:this.timestamp,domain:ur}),timestamp:new Date().getTime()}}},hn;(function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"})(hn||(hn={}));var Oe;(function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"})(Oe||(Oe={}));var Q=class extends Error{constructor(e,t,i,r,n,s=!1){super(r),this.code=e,this.name=t,this.message=r,this.description=n,this.isTerminal=s,Object.setPrototypeOf(this,Q.prototype),this.action=i.toString()}toAnalyticsProperties(){return{error_name:this.name,error_code:this.code,error_message:this.message,error_description:this.description,action:this.action,is_terminal:this.isTerminal}}addNativeError(e){this.nativeError=e}toString(){var e;return`{
      code: ${this.code};
      name: ${this.name};
      action: ${this.action};
      message: ${this.message};
      description: ${this.description};
      isTerminal: ${this.isTerminal};
      nativeError: ${(e=this.nativeError)==null?void 0:e.message};
    }`}},Ae=class{static connect(e,t,i=new Date,r=new Date,n){let s=this.eventNameFor("connect",e===void 0),a=e?Oe.ERROR:Oe.INFO,o=this.getPropertiesWithError(Ye(se({},t),{[this.KEY_REQUESTED_AT]:i==null?void 0:i.getTime(),[this.KEY_RESPONDED_AT]:r==null?void 0:r.getTime(),endpoint:n}),e);return new Je({name:s,level:a,properties:o})}static disconnect(e,t){let i="disconnected",r=e?Oe.ERROR:Oe.INFO,n=this.getPropertiesWithError(t,e);return new Je({name:i,level:r,properties:n})}static preview(e){var t=e,{error:i}=t,r=$s(t,["error"]);let n=this.eventNameFor("preview",i===void 0),s=i?Oe.ERROR:Oe.INFO,a=this.getPropertiesWithError(r,i);return new Je({name:n,level:s,properties:a})}static join(e){var t=e,{error:i}=t,r=$s(t,["error"]);let n=this.eventNameFor("join",i===void 0),s=i?Oe.ERROR:Oe.INFO,a=this.getPropertiesWithError(Ye(se({},r),{is_preview_called:!!r.is_preview_called}),i);return new Je({name:n,level:s,properties:a})}static publish({devices:e,settings:t,error:i}){let r=this.eventNameFor("publish",i===void 0),n=i?Oe.ERROR:Oe.INFO,s=this.getPropertiesWithError({devices:e,audio:t==null?void 0:t.audio,video:t==null?void 0:t.video},i);return new Je({name:r,level:n,properties:s})}static subscribeFail(e){let t=this.eventNameFor("subscribe",!1),i=Oe.ERROR,r=this.getErrorProperties(e);return new Je({name:t,level:i,properties:r})}static leave(){return new Je({name:"leave",level:Oe.INFO})}static autoplayError(){return new Je({name:"autoplayError",level:Oe.ERROR})}static deviceChange({selection:e,type:t,devices:i,error:r}){let n=this.eventNameFor(r?"publish":`device.${t}`,r===void 0),s=r?Oe.ERROR:Oe.INFO,a=this.getPropertiesWithError({selection:e,devices:i},r);return new Je({name:n,level:s,properties:a})}static performance(e){let t="perf.stats",i=Oe.INFO,r=e.toAnalyticsProperties();return new Je({name:t,level:i,properties:r})}static rtcStats(e){let t="rtc.stats",i=Oe.INFO,r=e.toAnalyticsProperties();return new Je({name:t,level:i,properties:r})}static degradationStats(e,t){let i="video.degradation.stats",r=Oe.INFO,n={degradedAt:e.degradedAt,trackId:e.trackId};if(!t&&e.degradedAt instanceof Date){let s=new Date,a=s.valueOf()-e.degradedAt.valueOf();n=Ye(se({},n),{duration:a,restoredAt:s})}return new Je({name:i,level:r,properties:n})}static audioDetectionFail(e,t){let i=this.getPropertiesWithError({device:t},e),r=Oe.ERROR,n="audiopresence.failed";return new Je({name:n,level:r,properties:i})}static previewNetworkQuality(e){return new Je({name:"perf.networkquality.preview",level:e.error?Oe.ERROR:Oe.INFO,properties:e})}static eventNameFor(e,t){return`${e}.${t?"success":"failed"}`}static getPropertiesWithError(e,t){let i=this.getErrorProperties(t);return e=se(se({},i),e),e}static getErrorProperties(e){return e?e instanceof Q?e.toAnalyticsProperties():{error_name:e.name,error_message:e.message,error_description:e.cause}:{}}};Ae.KEY_REQUESTED_AT="requested_at",Ae.KEY_RESPONDED_AT="responded_at";var Ee;(function(e){e.INIT="init_response_time",e.WEBSOCKET_CONNECT="ws_connect_time",e.ON_POLICY_CHANGE="on_policy_change_time",e.LOCAL_TRACKS="local_tracks_time",e.JOIN="join_time",e.PREVIEW="preview_time"})(Ee||(Ee={}));var Wc=class{constructor(){this.eventPerformanceMeasures={}}start(e){performance.mark(e)}end(e){var t;try{this.eventPerformanceMeasures[e]=performance.measure(e,e),m.d("[HMSPerformanceTiming]",e,(t=this.eventPerformanceMeasures[e])==null?void 0:t.duration)}catch(i){m.w("[AnalyticsTimer]",`Error in measuring performance for event ${e}`,{error:i})}}getTimeTaken(e){var t;return(t=this.eventPerformanceMeasures[e])==null?void 0:t.duration}getTimes(...e){return e.reduce((t,i)=>Ye(se({},t),{[i]:this.getTimeTaken(i)}),{})}cleanUp(){this.eventPerformanceMeasures={}}},ne={WebSocketConnectionErrors:{FAILED_TO_CONNECT:1e3,WEBSOCKET_CONNECTION_LOST:1003,ABNORMAL_CLOSE:1006},InitAPIErrors:{SERVER_ERRORS:2e3,INIT_CONFIG_NOT_AVAILABLE:2002,ENDPOINT_UNREACHABLE:2003,INVALID_TOKEN_FORMAT:2004},TracksErrors:{GENERIC_TRACK:3e3,CANT_ACCESS_CAPTURE_DEVICE:3001,DEVICE_NOT_AVAILABLE:3002,DEVICE_IN_USE:3003,DEVICE_LOST_MIDWAY:3008,NOTHING_TO_RETURN:3005,INVALID_VIDEO_SETTINGS:3006,CODEC_CHANGE_NOT_PERMITTED:3007,AUTOPLAY_ERROR:3008,OVER_CONSTRAINED:3009,NO_AUDIO_DETECTED:3010,SYSTEM_DENIED_PERMISSION:3011,CURRENT_TAB_NOT_SHARED:3012},WebrtcErrors:{CREATE_OFFER_FAILED:4001,CREATE_ANSWER_FAILED:4002,SET_LOCAL_DESCRIPTION_FAILED:4003,SET_REMOTE_DESCRIPTION_FAILED:4004,ICE_FAILURE:4005},WebsocketMethodErrors:{SERVER_ERRORS:5e3,ALREADY_JOINED:5001,CANNOT_JOIN_PREVIEW_IN_PROGRESS:5002},GenericErrors:{NOT_CONNECTED:6e3,SIGNALLING:6001,UNKNOWN:6002,NOT_READY:6003,JSON_PARSING_FAILED:6004,TRACK_METADATA_MISSING:6005,RTC_TRACK_MISSING:6006,PEER_METADATA_MISSING:6007,INVALID_ROLE:6008,PREVIEW_IN_PROGRESS:6009,MISSING_MEDIADEVICES:6010,MISSING_RTCPEERCONNECTION:6011},PlaylistErrors:{NO_ENTRY_TO_PLAY:8001,NO_ENTRY_IS_PLAYING:8002}},F;(function(e){e.NONE="NONE",e.TRACK="TRACK",e.INIT="INIT",e.PUBLISH="PUBLISH",e.UNPUBLISH="UNPUBLISH",e.JOIN="JOIN",e.SUBSCRIBE="SUBSCRIBE",e.DATA_CHANNEL_SEND="DATA_CHANNEL_SEND",e.RESTART_ICE="RESTART_ICE",e.VIDEO_PLUGINS="VIDEO_PLUGINS",e.AUDIO_PLUGINS="AUDIO_PLUGINS",e.AUTOPLAY="AUTOPLAY",e.RECONNECT_SIGNAL="RECONNECT_SIGNAL",e.VALIDATION="VALIDATION",e.PLAYLIST="PLAYLIST",e.PREVIEW="PREVIEW"})(F||(F={}));var B={WebSocketConnectionErrors:{FailedToConnect(e,t=""){return new Q(ne.WebSocketConnectionErrors.FAILED_TO_CONNECT,"WebsocketFailedToConnect",e,`[WS]: ${t}`,`[WS]: ${t}`)},WebSocketConnectionLost(e,t=""){return new Q(ne.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,"WebSocketConnectionLost",e,"Network connection lost ",t)},AbnormalClose(e,t=""){return new Q(ne.WebSocketConnectionErrors.ABNORMAL_CLOSE,"WebSocketAbnormalClose",e,"Websocket closed abnormally",t)}},InitAPIErrors:{ServerErrors(e,t,i=""){return new Q(e,"ServerErrors",t,`[INIT]: Server error ${i}`,i,!0)},EndpointUnreachable(e,t=""){return new Q(ne.InitAPIErrors.ENDPOINT_UNREACHABLE,"EndpointUnreachable",e,`Endpoint is not reachable - ${t}`,t)},InvalidTokenFormat(e,t=""){return new Q(ne.InitAPIErrors.INVALID_TOKEN_FORMAT,"InvalidTokenFormat",e,`Token is not in proper JWT format - ${t}`,t,!0)},InitConfigNotAvailable(e,t=""){return new Q(ne.InitAPIErrors.INIT_CONFIG_NOT_AVAILABLE,"InitError",e,`[INIT]: ${t}`,`[INIT]: ${t}`)}},TracksErrors:{GenericTrack(e,t=""){return new Q(ne.TracksErrors.GENERIC_TRACK,"GenericTrack",e,`[TRACK]: ${t}`,`[TRACK]: ${t}`)},CantAccessCaptureDevice(e,t,i=""){return new Q(ne.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,"CantAccessCaptureDevice",e,`User denied permission to access capture device - ${t}`,i)},DeviceNotAvailable(e,t,i=""){return new Q(ne.TracksErrors.DEVICE_NOT_AVAILABLE,"DeviceNotAvailable",e,`[TRACK]: Capture device is no longer available - ${t}`,i)},DeviceInUse(e,t,i=""){return new Q(ne.TracksErrors.DEVICE_IN_USE,"DeviceInUse",e,`[TRACK]: Capture device is in use by another application - ${t}`,i)},DeviceLostMidway(e,t,i=""){return new Q(ne.TracksErrors.DEVICE_LOST_MIDWAY,"DeviceLostMidway",e,`Lost access to capture device midway - ${t}`,i)},NothingToReturn(e,t="",i="There is no media to return. Please select either video or audio or both."){return new Q(ne.TracksErrors.NOTHING_TO_RETURN,"NothingToReturn",e,i,t)},InvalidVideoSettings(e,t=""){return new Q(ne.TracksErrors.INVALID_VIDEO_SETTINGS,"InvalidVideoSettings",e,"Cannot enable simulcast when no video settings are provided",t)},AutoplayBlocked(e,t=""){return new Q(ne.TracksErrors.AUTOPLAY_ERROR,"AutoplayBlocked",e,"Autoplay blocked because the user didn't interact with the document first",t)},CodecChangeNotPermitted(e,t=""){return new Q(ne.TracksErrors.CODEC_CHANGE_NOT_PERMITTED,"CodecChangeNotPermitted",e,"Codec can't be changed mid call.",t)},OverConstrained(e,t,i=""){return new Q(ne.TracksErrors.OVER_CONSTRAINED,"OverConstrained",e,`[TRACK]: Requested constraints cannot be satisfied with the device hardware - ${t}`,i)},NoAudioDetected(e,t="Please check the mic or use another audio input"){return new Q(ne.TracksErrors.NO_AUDIO_DETECTED,"NoAudioDetected",e,"No audio input detected from microphone",t)},SystemDeniedPermission(e,t,i=""){return new Q(ne.TracksErrors.SYSTEM_DENIED_PERMISSION,"SystemDeniedPermission",e,`Operating System denied permission to access capture device - ${t}`,i)},CurrentTabNotShared(){return new Q(ne.TracksErrors.CURRENT_TAB_NOT_SHARED,"CurrentTabNotShared",F.TRACK,"The app requires you to share the current tab","You must screen share the current tab in order to proceed")}},WebrtcErrors:{CreateOfferFailed(e,t=""){return new Q(ne.WebrtcErrors.CREATE_OFFER_FAILED,"CreateOfferFailed",e,`[${e.toString()}]: Failed to create offer. `,t)},CreateAnswerFailed(e,t=""){return new Q(ne.WebrtcErrors.CREATE_ANSWER_FAILED,"CreateAnswerFailed",e,`[${e.toString()}]: Failed to create answer. `,t)},SetLocalDescriptionFailed(e,t=""){return new Q(ne.WebrtcErrors.SET_LOCAL_DESCRIPTION_FAILED,"SetLocalDescriptionFailed",e,`[${e.toString()}]: Failed to set offer. `,t)},SetRemoteDescriptionFailed(e,t=""){return new Q(ne.WebrtcErrors.SET_REMOTE_DESCRIPTION_FAILED,"SetRemoteDescriptionFailed",e,`[${e.toString()}]: Failed to set answer. `,t)},ICEFailure(e,t=""){return new Q(ne.WebrtcErrors.ICE_FAILURE,"ICEFailure",e,`[${e.toString()}]: Ice connection state FAILED`,t)}},WebsocketMethodErrors:{ServerErrors(e,t,i){return new Q(e,"ServerErrors",t,i,i,!0)},AlreadyJoined(e,t=""){return new Q(ne.WebsocketMethodErrors.ALREADY_JOINED,"AlreadyJoined",e,"[JOIN]: You have already joined this room.",t)},CannotJoinPreviewInProgress(e,t=""){return new Q(ne.WebsocketMethodErrors.CANNOT_JOIN_PREVIEW_IN_PROGRESS,"CannotJoinPreviewInProgress",e,"[JOIN]: Cannot join if preview is in progress",t)}},GenericErrors:{NotConnected(e,t=""){return new Q(ne.GenericErrors.NOT_CONNECTED,"NotConnected",e,"Client is not connected",t)},Signalling(e,t){return new Q(ne.GenericErrors.SIGNALLING,"Signalling",e,`Unknown signalling error: ${e.toString()} ${t} `,t)},Unknown(e,t){return new Q(ne.GenericErrors.UNKNOWN,"Unknown",e,`Unknown exception: ${t}`,t)},NotReady(e,t=""){return new Q(ne.GenericErrors.NOT_READY,"NotReady",e,t,t)},JsonParsingFailed(e,t,i=""){return new Q(ne.GenericErrors.JSON_PARSING_FAILED,"JsonParsingFailed",e,`Failed to parse JSON message - ${t}`,i)},TrackMetadataMissing(e,t=""){return new Q(ne.GenericErrors.TRACK_METADATA_MISSING,"TrackMetadataMissing",e,"Track Metadata Missing",t)},RTCTrackMissing(e,t=""){return new Q(ne.GenericErrors.RTC_TRACK_MISSING,"RTCTrackMissing",e,"RTC Track missing",t)},PeerMetadataMissing(e,t=""){return new Q(ne.GenericErrors.PEER_METADATA_MISSING,"PeerMetadataMissing",e,"Peer Metadata Missing",t)},ValidationFailed(e,t){return new Q(ne.GenericErrors.INVALID_ROLE,"ValidationFailed",F.VALIDATION,e,t?JSON.stringify(t):"")},InvalidRole(e,t){return new Q(ne.GenericErrors.INVALID_ROLE,"InvalidRole",e,"Invalid role. Join with valid role",t,!0)},PreviewAlreadyInProgress(e,t=""){return new Q(ne.GenericErrors.PREVIEW_IN_PROGRESS,"PreviewAlreadyInProgress",e,"[Preview]: Cannot join if preview is in progress",t)},MissingMediaDevices(){return new Q(ne.GenericErrors.MISSING_MEDIADEVICES,"MissingMediaDevices",F.JOIN,"navigator.mediaDevices is undefined. 100ms SDK won't work on this website as WebRTC is not supported on HTTP endpoints(missing navigator.mediaDevices). Please ensure you're using the SDK either on localhost or a valid HTTPS endpoint.","",!0)},MissingRTCPeerConnection(){return new Q(ne.GenericErrors.MISSING_RTCPEERCONNECTION,"MissingRTCPeerConnection",F.JOIN,"RTCPeerConnection which is a core requirement for WebRTC call was not found, this could be due to an unsupported browser or browser extensions blocking WebRTC","",!0)}},MediaPluginErrors:{PlatformNotSupported(e,t=""){return new Q(7001,"PlatformNotSupported",e,"Check HMS Docs to see the list of supported platforms",t)},InitFailed(e,t=""){return new Q(7002,"InitFailed",e,"Plugin init failed",t)},ProcessingFailed(e,t=""){return new Q(7003,"ProcessingFailed",e,"Plugin processing failed",t)},AddAlreadyInProgress(e,t=""){return new Q(7004,"AddAlreadyInProgress",e,"Plugin add already in progress",t)},DeviceNotSupported(e,t=""){return new Q(7005,"DeviceNotSupported",e,"Check HMS Docs to see the list of supported devices",t)}},PlaylistErrors:{NoEntryToPlay(e,t){return new Q(ne.PlaylistErrors.NO_ENTRY_TO_PLAY,"NoEntryToPlay",e,"Reached end of playlist",t)},NoEntryPlaying(e,t){return new Q(ne.PlaylistErrors.NO_ENTRY_IS_PLAYING,"NoEntryIsPlaying",e,"No entry is playing at this time",t)}}},Mt;(function(e){e.UNKNOWN="unknown(video or audio)",e.AUDIO="audio",e.VIDEO="video",e.AV="audio, video",e.SCREEN="screen"})(Mt||(Mt={}));function zc(e,t){let i=e.toLowerCase();return i.includes("device not found")?B.TracksErrors.DeviceNotAvailable(F.TRACK,t,e):i.includes("permission denied")?B.TracksErrors.CantAccessCaptureDevice(F.TRACK,t,e):B.TracksErrors.GenericTrack(F.TRACK,e)}function Jc(e,t=""){if(Tr.browserDetails.browser==="chrome"&&e.name==="NotAllowedError"&&e.message.includes("denied by system"))return B.TracksErrors.SystemDeniedPermission(F.TRACK,t,e.message);if(Tr.browserDetails.browser==="firefox"&&e.name==="NotFoundError"){let i=B.TracksErrors.SystemDeniedPermission(F.TRACK,t,e.message);return i.description=`Capture device is either blocked at Operating System level or not available - ${t}`,i}switch(e.name){case"OverconstrainedError":return B.TracksErrors.OverConstrained(F.TRACK,t,e.constraint);case"NotAllowedError":return B.TracksErrors.CantAccessCaptureDevice(F.TRACK,t,e.message);case"NotFoundError":return B.TracksErrors.DeviceNotAvailable(F.TRACK,t,e.message);case"NotReadableError":return B.TracksErrors.DeviceInUse(F.TRACK,t,e.message);case"TypeError":return B.TracksErrors.NothingToReturn(F.TRACK,e.message);default:return zc(e.message,t)}}function Sr(e,t){let i=Jc(e,t);return i.addNativeError(e),i}var ti;(function(e){e.RECORDING_STATE_UPDATED="RECORDING_STATE_UPDATED",e.BROWSER_RECORDING_STATE_UPDATED="BROWSER_RECORDING_STATE_UPDATED",e.SERVER_RECORDING_STATE_UPDATED="SERVER_RECORDING_STATE_UPDATED",e.RTMP_STREAMING_STATE_UPDATED="RTMP_STREAMING_STATE_UPDATED",e.HLS_STREAMING_STATE_UPDATED="HLS_STREAMING_STATE_UPDATED"})(ti||(ti={}));var Qe;(function(e){e[e.PEER_JOINED=0]="PEER_JOINED",e[e.PEER_LEFT=1]="PEER_LEFT",e[e.AUDIO_TOGGLED=2]="AUDIO_TOGGLED",e[e.VIDEO_TOGGLED=3]="VIDEO_TOGGLED",e[e.BECAME_DOMINANT_SPEAKER=4]="BECAME_DOMINANT_SPEAKER",e[e.RESIGNED_DOMINANT_SPEAKER=5]="RESIGNED_DOMINANT_SPEAKER",e[e.STARTED_SPEAKING=6]="STARTED_SPEAKING",e[e.STOPPED_SPEAKING=7]="STOPPED_SPEAKING",e[e.ROLE_UPDATED=8]="ROLE_UPDATED",e[e.PEER_LIST=9]="PEER_LIST",e[e.NAME_UPDATED=10]="NAME_UPDATED",e[e.METADATA_UPDATED=11]="METADATA_UPDATED"})(Qe||(Qe={}));var ke;(function(e){e[e.TRACK_ADDED=0]="TRACK_ADDED",e[e.TRACK_REMOVED=1]="TRACK_REMOVED",e[e.TRACK_MUTED=2]="TRACK_MUTED",e[e.TRACK_UNMUTED=3]="TRACK_UNMUTED",e[e.TRACK_DESCRIPTION_CHANGED=4]="TRACK_DESCRIPTION_CHANGED",e[e.TRACK_DEGRADED=5]="TRACK_DEGRADED",e[e.TRACK_RESTORED=6]="TRACK_RESTORED"})(ke||(ke={}));var ct;(function(e){e.NONE="none",e.LOW="low",e.MEDIUM="medium",e.HIGH="high"})(ct||(ct={}));var Qc={f:ct.HIGH,h:ct.MEDIUM,q:ct.LOW},pn;(function(e){e.VP8="vp8",e.VP9="vp9",e.H264="h264"})(pn||(pn={}));var fn;(function(e){e.OPUS="opus"})(fn||(fn={}));var de;(function(e){e.audio="audio",e.video="video"})(de||(de={}));var Bi=class{constructor(){this._volume=1,this._codec=fn.OPUS,this._maxBitrate=32,this._deviceId="default",this._advanced=[{googEchoCancellation:{exact:!0}},{googExperimentalEchoCancellation:{exact:!0}},{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}},{googHighpassFilter:{exact:!0}},{googAudioMirroring:{exact:!0}}]}volume(e){if(!(0<=e&&e<=1))throw Error("volume can only be in range [0.0, 1.0]");return this._volume=e,this}codec(e){return this._codec=e,this}maxBitrate(e){if(e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}build(){return new qn(this._volume,this._codec,this._maxBitrate,this._deviceId,this._advanced)}},qn=class{constructor(e,t,i,r,n){this.volume=e,this.codec=t,this.maxBitrate=i,this.deviceId=r,this.advanced=n}toConstraints(){return{deviceId:this.deviceId,advanced:this.advanced}}toAnalyticsProperties(){return{audio_bitrate:this.maxBitrate,audio_codec:this.codec}}},yi=class{constructor(){this._width=320,this._height=180,this._codec=pn.VP8,this._maxFramerate=30,this._maxBitrate=150,this._advanced=[]}setWidth(e){return this._width=e,this}setHeight(e){return this._height=e,this}codec(e){return this._codec=e,this}maxFramerate(e){if(e&&e<=0)throw Error("maxFramerate should be >= 1");return this._maxFramerate=e,this}maxBitrate(e,t=!0){if(typeof e=="number"&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,!this._maxBitrate&&t&&(this._maxBitrate=15e4),this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}build(){return new Hn(this._width,this._height,this._codec,this._maxFramerate,this._deviceId,this._advanced,this._maxBitrate)}},Hn=class{constructor(e,t,i,r,n,s,a){this.width=e,this.height=t,this.codec=i,this.maxFramerate=r,this.maxBitrate=a,this.deviceId=n,this.advanced=s}toConstraints(e){let t="ideal";return e&&(t="max"),{width:{[t]:this.width},height:{[t]:this.height},frameRate:this.maxFramerate,deviceId:this.deviceId}}toAnalyticsProperties(){return{width:this.width,height:this.height,video_bitrate:this.maxBitrate,framerate:this.maxFramerate,video_codec:this.codec}}},Gs=class{constructor(){this._video=new yi().build(),this._audio=new Bi().build(),this._screen=new yi().build(),this._simulcast=!1}video(e){return this._video=e,this}audio(e){return this._audio=e,this}screen(e){return this._screen=e,this}simulcast(e){return this._simulcast=e,this}build(){if(this._audio===null&&this._video===null)throw B.TracksErrors.NothingToReturn(F.TRACK);if(this._video===null&&this._simulcast)throw B.TracksErrors.InvalidVideoSettings(F.TRACK,"Cannot enable simulcast when no video settings are provided");return new mn(this._video,this._audio,this._simulcast,this._screen||void 0)}},mn=class{constructor(e,t,i,r=null){this.video=e,this.audio=t,this.simulcast=i,this.screen=r}toAnalyticsProperties(){let e={audio_enabled:this.audio!==null,video_enabled:this.video!==null};return this.audio&&(e=se(se({},this.audio.toAnalyticsProperties()),e)),this.video&&(e=se(se({},this.video.toAnalyticsProperties()),e)),e}},Lo=class{constructor(e){this.tracks=new Array,this.nativeStream=e,this.id=e.id}},kr=e=>e?`{
    trackId: ${e.id};
    kind: ${e.kind};
    enabled: ${e.enabled};
    muted: ${e.muted};
    readyState: ${e.readyState};
  }`:"",Kn=class{constructor(e,t,i){this.logIdentifier="",this.stream=e,this.nativeTrack=t,this.source=i}get enabled(){return this.nativeTrack.enabled}get trackId(){return this.firstTrackId||this.sdpTrackId||this.nativeTrack.id}getMediaTrackSettings(){return this.nativeTrack.getSettings()}setEnabled(e){return g(this,null,function*(){this.nativeTrack.enabled=e})}setSdpTrackId(e){this.sdpTrackId=e}setFirstTrackId(e){this.firstTrackId=e}cleanup(){var e;(e=this.nativeTrack)==null||e.stop()}toString(){return`{
      streamId: ${this.stream.id};
      peerId: ${this.peerId};
      trackId: ${this.trackId};
      logIdentifier: ${this.logIdentifier};
      source: ${this.source};
      enabled: ${this.enabled};
      nativeTrack: ${kr(this.nativeTrack)};
    }`}},xe;(function(e){e.AUDIO="audio",e.VIDEO="video"})(xe||(xe={}));var No=class extends Lo{constructor(e,t){super(e),this.audio=!0,this.video=ct.NONE,this.connection=t}setAudio(e){this.audio!==e&&(this.audio=e,this.syncWithApiChannel(!1))}setVideoLayerLocally(e,t){this.video=e,m.d(`[Remote stream] ${t} - ${this.id}`,`Setting layer field to - ${e}`)}setVideoLayer(e,t){this.setVideoLayerLocally(e,t),m.d(`[Remote stream] ${t} - ${this.id}`,`Switching to ${e} layer`),this.syncWithApiChannel()}getSimulcastLayer(){return this.video}isAudioSubscribed(){return this.audio}syncWithApiChannel(e=!0){let t={streamId:this.id,audio:this.audio};e&&(t.video=this.video,t.framerate=this.video),this.connection.sendOverApiDataChannel(JSON.stringify(t))}},Wn=class extends Kn{constructor(e,t,i){if(super(e,t,i),this.type=xe.AUDIO,this.audioElement=null,t.kind!=="audio")throw new Error("Expected 'track' kind = 'audio'")}getVolume(){return this.audioElement?this.audioElement.volume*100:null}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.subscribeToAudio(e===0?!1:this.enabled),this.audioElement&&(this.audioElement.volume=e/100)}setAudioElement(e){this.audioElement=e}getAudioElement(){return this.audioElement}getOutputDevice(){return this.outputDevice}cleanup(){super.cleanup(),this.audioElement&&(this.audioElement.srcObject=null,this.audioElement.remove(),this.audioElement=null)}setOutputDevice(e){return g(this,null,function*(){var t;if(!this.audioElement){m.d("audio-track","no audio element to set output");return}try{typeof this.audioElement.setSinkId=="function"&&(yield(t=this.audioElement)==null?void 0:t.setSinkId(e.deviceId),this.outputDevice=e)}catch(i){m.d("audio-track",i)}})}removeSink(){var e;this.audioElement&&((e=window.HMS)==null?void 0:e.AUDIO_SINK)&&(this.audioElement.srcObject=null,this.subscribeToAudio(!1))}addSink(){var e,t;if(!this.nativeTrack||!this.audioElement||!((e=window.HMS)!=null&&e.AUDIO_SINK))return;let i=this.audioElement.srcObject;i instanceof MediaStream&&((t=i.getAudioTracks()[0])==null?void 0:t.id)===this.nativeTrack.id||(this.audioElement.srcObject=new MediaStream([this.nativeTrack]),this.subscribeToAudio(!0))}subscribeToAudio(e){this.stream instanceof No&&this.stream.setAudio(e)}},Yc=class{constructor(){this.storage=new Lr("hms-device-selection"),this.remember=!1,this.TAG="HMSDeviceStorage"}setDevices(e){this.devices=e}rememberDevices(e){this.remember=e}updateSelection(e,{deviceId:t,groupId:i}){if(!this.devices||!this.remember)return;let r=this.devices[e].find(s=>this.isSame({deviceId:t,groupId:i},s));if(!r){m.w(this.TAG,`Could not find device with deviceId: ${t}, groupId: ${i}`);return}let n=this.storage.get()||{};n[e]=r,this.storage.set(n)}getSelection(){if(this.remember)return this.storage.get()}cleanup(){this.remember=!1,this.devices=void 0}isSame(e,t){return e.deviceId===t.deviceId&&(e.groupId===t.groupId||!e.groupId)}},zt=new Yc,Bs;(function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"})(Bs||(Bs={}));var Ti;(function(e){e.PLATFORM_NOT_SUPPORTED="PLATFORM_NOT_SUPPORTED",e.DEVICE_NOT_SUPPORTED="DEVICE_NOT_SUPPORTED"})(Ti||(Ti={}));var _r=class{static failure(e,t){let i="mediaPlugin.failed",r=Oe.ERROR,n=se({plugin_name:e},t.toAnalyticsProperties());return new Je({name:i,level:r,properties:n})}static audioPluginFailure(e,t,i){let r="mediaPlugin.failed",n=Oe.ERROR,s=se({plugin_name:e,sampleRate:t},i.toAnalyticsProperties());return new Je({name:r,level:n,properties:s})}static audioPluginStats({pluginName:e,duration:t,loadTime:i,sampleRate:r}){let n="mediaPlugin.stats",s=Oe.INFO,a={plugin_name:e,duration:t,load_time:i,sampleRate:r};return new Je({name:n,level:s,properties:a})}static stats({pluginName:e,duration:t,loadTime:i,avgPreProcessingTime:r,avgProcessingTime:n,inputFrameRate:s,pluginFrameRate:a}){let o="mediaPlugin.stats",l=Oe.INFO,c={plugin_name:e,duration:t,load_time:i,avg_preprocessing_time:r,avg_processing_time:n,input_frame_rate:s,plugin_frame_rate:a};return new Je({name:o,level:l,properties:c})}},Kr="AudioPluginsAnalytics",Zc=class{constructor(e){this.eventBus=e,this.initTime={},this.addedTimestamps={},this.pluginAdded={},this.pluginSampleRate={}}added(e,t){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.pluginSampleRate[e]=t}removed(e){if(this.pluginAdded[e]){let t={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],sampleRate:this.pluginSampleRate[e]};this.eventBus.analytics.publish(_r.audioPluginStats(t)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(_r.audioPluginFailure(e,this.pluginSampleRate[e],t)),this.clean(e))}initWithTime(e,t){return g(this,null,function*(){if(this.initTime[e]){m.i(Kr,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);return}let i;try{i=yield this.timeInMs(t),m.i(Kr,`Time taken for Plugin ${e} initialization : ${i}`)}catch(r){let n=B.MediaPluginErrors.InitFailed(F.AUDIO_PLUGINS,`failed during initialization of plugin${r.message||r}`);throw m.e(Kr,n),this.failure(e,n),n}i&&(this.initTime[e]=i)})}timeInMs(e){return g(this,null,function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)})}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.pluginAdded[e],delete this.pluginSampleRate[e]}},Ot="AudioPluginsManager",Xc=48e3,eu=()=>navigator.userAgent.indexOf("Firefox")!==-1,tu=class{constructor(e,t){this.pluginAddInProgress=!1,this.hmsTrack=e,this.pluginsMap=new Map,this.analytics=new Zc(t),this.createAudioContext()}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e){return g(this,null,function*(){var t;let i=(t=e.getName)==null?void 0:t.call(e);if(!i){m.w("no name provided by the plugin");return}if(this.pluginAddInProgress){let r=B.MediaPluginErrors.AddAlreadyInProgress(F.AUDIO_PLUGINS,"Add Plugin is already in Progress");throw this.analytics.added(i,this.audioContext.sampleRate),this.analytics.failure(i,r),m.w("can't add another plugin when previous add is in progress"),r}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e)}finally{this.pluginAddInProgress=!1}})}addPluginInternal(e){return g(this,null,function*(){var t;let i=(t=e.getName)==null?void 0:t.call(e);if(this.pluginsMap.get(i)){m.w(Ot,`plugin - ${i} already added.`);return}yield this.validateAndThrow(i,e);try{this.pluginsMap.size===0?yield this.initAudioNodes():this.prevAudioNode&&this.prevAudioNode.disconnect(),this.analytics.added(i,this.audioContext.sampleRate),yield this.analytics.initWithTime(i,()=>g(this,null,function*(){return e.init()})),this.pluginsMap.set(i,e),yield this.processPlugin(e),yield this.connectToDestination()}catch(r){throw m.e(Ot,"failed to add plugin",r),r}})}validatePlugin(e){return e.checkSupport(this.audioContext)}validateAndThrow(e,t){return g(this,null,function*(){let i=this.validatePlugin(t);if(i.isSupported)m.i(Ot,`plugin is supported,- ${t.getName()}`);else if(this.analytics.added(e,this.audioContext.sampleRate),i.errType===Ti.PLATFORM_NOT_SUPPORTED){let r=B.MediaPluginErrors.PlatformNotSupported(F.AUDIO_PLUGINS,"platform not supported, see docs");throw this.analytics.failure(e,r),yield this.cleanup(),r}else if(i.errType===Ti.DEVICE_NOT_SUPPORTED){let r=B.MediaPluginErrors.DeviceNotSupported(F.AUDIO_PLUGINS,"audio device not supported, see docs");throw this.analytics.failure(e,r),yield this.cleanup(),r}})}removePlugin(e){return g(this,null,function*(){yield this.removePluginInternal(e),this.pluginsMap.size===0?(yield this.cleanup(),m.i(Ot,"No plugins left, stopping plugins loop"),yield this.hmsTrack.setProcessedTrack(void 0)):yield this.reprocessPlugins()})}cleanup(){return g(this,null,function*(){var e,t,i;for(let r of this.pluginsMap.values())yield this.removePluginInternal(r);yield this.hmsTrack.setProcessedTrack(void 0),(e=this.sourceNode)==null||e.disconnect(),(t=this.prevAudioNode)==null||t.disconnect(),(i=this.outputTrack)==null||i.stop(),this.sourceNode=void 0,this.destinationNode=void 0,this.prevAudioNode=void 0,this.outputTrack=void 0})}closeContext(){return g(this,null,function*(){var e;(e=this.audioContext)==null||e.close(),this.audioContext=void 0})}reprocessPlugins(){return g(this,null,function*(){if(this.pluginsMap.size===0||!this.sourceNode)return;let e=Array.from(this.pluginsMap.values());yield this.cleanup(),yield this.initAudioNodes();for(let t of e)yield this.addPlugin(t)})}initAudioNodes(){return g(this,null,function*(){if(this.audioContext){if(!this.sourceNode){let e=new MediaStream([this.hmsTrack.nativeTrack]);this.sourceNode=this.audioContext.createMediaStreamSource(e)}if(!this.destinationNode){this.destinationNode=this.audioContext.createMediaStreamDestination(),this.outputTrack=this.destinationNode.stream.getAudioTracks()[0];try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(e){throw m.e(Ot,"error in setting processed track",e),e}}}})}processPlugin(e){return g(this,null,function*(){try{let t=yield e.processAudioTrack(this.audioContext,this.prevAudioNode||this.sourceNode);this.prevAudioNode&&this.prevAudioNode.connect(t),this.prevAudioNode=t}catch(t){let i=e.getName();m.e(Ot,`error in processing plugin ${i}`,t),yield this.removePluginInternal(e)}})}connectToDestination(){return g(this,null,function*(){try{this.prevAudioNode&&this.destinationNode&&this.prevAudioNode.context===this.destinationNode.context&&this.prevAudioNode.connect(this.destinationNode)}catch(e){m.e(Ot,"error in connecting to destination node",e)}})}removePluginInternal(e){return g(this,null,function*(){var t;let i=(t=e.getName)==null?void 0:t.call(e);if(!this.pluginsMap.get(i)){m.w(Ot,`plugin - ${i} not found to remove.`);return}m.i(Ot,`removing plugin ${i}`),this.pluginsMap.delete(i),e.stop(),this.analytics.removed(i)})}createAudioContext(){this.audioContext||(eu()?this.audioContext=new AudioContext:this.audioContext=new AudioContext({sampleRate:Xc}))}};function iu(e){return g(this,null,function*(){try{return(yield navigator.mediaDevices.getUserMedia({audio:e?e.toConstraints():!1})).getAudioTracks()[0]}catch(t){throw Sr(t,Mt.AUDIO)}})}function ru(e){return g(this,null,function*(){try{return(yield navigator.mediaDevices.getUserMedia({video:e?e.toConstraints():!1})).getVideoTracks()[0]}catch(t){throw Sr(t,Mt.VIDEO)}})}function Wr(e){return"canvas"in e||e.label==="MediaStreamAudioDestinationNode"||e.label===""}var zn=class{constructor(e=1/0){this.capacity=e,this.storage=[]}size(){return this.storage.length}toList(){return this.storage.slice(0)}enqueue(e){this.size()===this.capacity&&this.dequeue(),this.storage.push(e)}dequeue(){return this.storage.shift()}aggregate(e){return e(this.storage)}};function Ht(e){if(e<0)throw Error("`ms` should be a positive integer");return new Promise(t=>setTimeout(t,e))}var nu=35,su=5,au=class{constructor(e,t,i){this.track=e,this.audioLevelEvent=t,this.silenceEvent=i,this.TAG="[TrackAudioLevelMonitor]",this.audioLevel=0,this.isMonitored=!1,this.interval=100,this.historyInterval=700,this.history=new zn(this.historyInterval/this.interval),this.detectSilence=()=>g(this,null,function*(){let r=30,n=10,s=0;for(;this.isMonitored;){if(this.track.enabled)if(this.isSilentThisInstant()){if(s++,s>n){this.silenceEvent.publish({track:this.track});break}}else break;yield Ht(r)}});try{let r=new MediaStream([this.track.nativeTrack]);this.analyserNode=this.createAnalyserNodeForStream(r)}catch(r){m.w(this.TAG,"Unable to initialize AudioContext",r)}}start(){this.stop(),this.isMonitored=!0,m.d(this.TAG,"Starting track Monitor",`${this.track}`),this.loop().then(()=>m.d(this.TAG,"Stopping track Monitor",`${this.track}`))}stop(){if(!this.analyserNode){m.d(this.TAG,"AudioContext not initialized");return}this.sendAudioLevel(0),this.isMonitored=!1}loop(){return g(this,null,function*(){for(;this.isMonitored;)this.sendAudioLevel(this.getMaxAudioLevelOverPeriod()),yield Ht(this.interval)})}sendAudioLevel(e=0){if(e=e>nu?e:0,Math.abs(this.audioLevel-e)>su){this.audioLevel=e;let t={track:this.track,audioLevel:this.audioLevel};this.audioLevelEvent.publish(t)}}getMaxAudioLevelOverPeriod(){if(!this.analyserNode){m.d(this.TAG,"AudioContext not initialized");return}let e=this.calculateAudioLevel();return e!==void 0&&this.history.enqueue(e),this.history.aggregate(t=>Math.max(...t))}calculateAudioLevel(){if(!this.analyserNode){m.d(this.TAG,"AudioContext not initialized");return}let e=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(e);let t=.009,i=t;for(let n of e)i=Math.max(i,(n-128)/128);let r=(Math.log(t)-Math.log(i))/Math.log(t);return Math.ceil(Math.min(Math.max(r*100,0),100))}isSilentThisInstant(){if(!this.analyserNode){m.d(this.TAG,"AudioContext not initialized");return}let e=new Uint8Array(this.analyserNode.fftSize);return this.analyserNode.getByteTimeDomainData(e),!e.some(t=>t!==128&&t!==0)}createAnalyserNodeForStream(e){let t=new AudioContext,i=t.createAnalyser();return t.createMediaStreamSource(e).connect(i),i}};function Vs(e,t){return function(i){return i in e&&e[i]!==t[i]}}var ou="HMSLocalAudioTrack",Vi=class extends Wn{constructor(e,t,i,r,n=new Bi().build()){super(e,t,i),this.eventBus=r,this.handleSettingsChange=s=>g(this,null,function*(){let a=this.stream,o=Vs(s,this.settings);o("maxBitrate")&&s.maxBitrate&&(yield a.setMaxBitrate(s.maxBitrate,this)),o("advanced")&&(yield this.nativeTrack.applyConstraints(s.toConstraints()))}),this.handleDeviceChange=(s,a=!1)=>g(this,null,function*(){Vs(s,this.settings)("deviceId")&&(yield this.replaceTrackWith(s),a||zt.updateSelection("audioInput",{deviceId:s.deviceId,groupId:this.nativeTrack.getSettings().groupId}))}),e.tracks.push(this),this.settings=n,n.deviceId==="default"&&!Wr(t)&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new tu(this,r),this.setFirstTrackId(t.id)}replaceTrackWith(e){return g(this,null,function*(){let t=this.nativeTrack,i=this.enabled,r=Boolean(this.audioLevelMonitor);t==null||t.stop();let n=yield iu(e);n.enabled=i;let s=this.stream;yield s.replaceSenderTrack(t,this.processedTrack||n),yield s.replaceStreamTrack(t,n),this.nativeTrack=n,r&&this.initAudioLevelMonitor();try{yield this.pluginsManager.reprocessPlugins()}catch(a){this.eventBus.audioPluginFailed.publish(a)}})}setEnabled(e){var t=i=>super[i];return g(this,null,function*(){e!==this.enabled&&(e&&Wr(this.nativeTrack)&&(yield this.replaceTrackWith(this.settings)),yield t("setEnabled").call(this,e),e&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),this.eventBus.localAudioEnabled.publish({enabled:e,track:this}),this.stream.trackUpdate(this))})}isPublishedTrackId(e){return this.publishedTrackId===e}setSettings(e,t=!1){return g(this,null,function*(){let i=this.buildNewSettings(e);if(yield this.handleDeviceChange(i,t),Wr(this.nativeTrack)){this.settings=i;return}yield this.handleSettingsChange(i),this.settings=i})}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(e){return g(this,null,function*(){return this.pluginsManager.addPlugin(e)})}removePlugin(e){return g(this,null,function*(){return this.pluginsManager.removePlugin(e)})}validatePlugin(e){return this.pluginsManager.validatePlugin(e)}setProcessedTrack(e){return g(this,null,function*(){if(!e){this.processedTrack&&(yield this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack)),this.processedTrack=void 0;return}e!==this.processedTrack&&(this.processedTrack?yield this.stream.replaceSenderTrack(this.processedTrack,e):yield this.stream.replaceSenderTrack(this.nativeTrack,e),this.processedTrack=e)})}initAudioLevelMonitor(){this.audioLevelMonitor&&this.destroyAudioLevelMonitor(),m.d(ou,"Monitor Audio Level for",this,this.getMediaTrackSettings().deviceId),this.audioLevelMonitor=new au(this,this.eventBus.trackAudioLevelUpdate,this.eventBus.localAudioSilence),this.audioLevelMonitor.start(),this.audioLevelMonitor.detectSilence()}destroyAudioLevelMonitor(){var e;(e=this.audioLevelMonitor)==null||e.stop(),this.audioLevelMonitor=void 0}cleanup(){var e=t=>super[t];return g(this,null,function*(){var t;e("cleanup").call(this),yield this.pluginsManager.cleanup(),yield this.pluginsManager.closeContext(),(t=this.processedTrack)==null||t.stop(),this.destroyAudioLevelMonitor()})}getTrackIDBeingSent(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}getTrackBeingSent(){return this.processedTrack||this.nativeTrack}buildNewSettings(e){let{volume:t,codec:i,maxBitrate:r,deviceId:n,advanced:s}=se(se({},this.settings),e);return new qn(t,i,r,n,s)}},Jn=class extends Wn{setEnabled(e){var t=i=>super[i];return g(this,null,function*(){e!==this.enabled&&(yield t("setEnabled").call(this,e),this.subscribeToAudio(e))})}},$o=class extends Kn{constructor(e,t,i){if(super(e,t,i),this.type=xe.VIDEO,this.sinkCount=0,t.kind!=="video")throw new Error("Expected 'track' kind = 'video'")}hasSinks(){return this.sinkCount>0}addSink(e){this.addSinkInternal(e,this.nativeTrack)}removeSink(e){e.srcObject!==null&&(e.srcObject=null,this.sinkCount>0&&this.sinkCount--)}addSinkInternal(e,t){var i;let r=e.srcObject;r!==null&&r instanceof MediaStream&&((i=r.getVideoTracks()[0])==null?void 0:i.id)===t.id||(e.srcObject=new MediaStream([t]),this.sinkCount++)}},Er;(function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"})(Er||(Er={}));var gn;(function(e){e["2D"]="2d",e.WEBGL="webgl",e.WEBGL2="webgl2"})(gn||(gn={}));var js=class{constructor(){this.total=0,this.count=0}add(e){this.count++,this.total+=e}getAvg(){return Math.floor(this.total/this.count)}reset(){this.total=0,this.count=0}},Zi="VideoPluginsAnalytics",lu=class{constructor(e){this.eventBus=e,this.initTime={},this.preProcessingAvgs=new js,this.addedTimestamps={},this.processingAvgs={},this.pluginAdded={},this.pluginInputFrameRate={},this.pluginFrameRate={}}added(e,t,i){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.processingAvgs[e]=new js,this.pluginInputFrameRate[e]=t,this.pluginFrameRate[e]=i||t}removed(e){var t;if(this.pluginAdded[e]){let i={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],avgPreProcessingTime:this.preProcessingAvgs.getAvg(),avgProcessingTime:(t=this.processingAvgs[e])==null?void 0:t.getAvg(),inputFrameRate:this.pluginInputFrameRate[e],pluginFrameRate:this.pluginFrameRate[e]};this.eventBus.analytics.publish(_r.stats(i)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(_r.failure(e,t)),this.clean(e))}initWithTime(e,t){return g(this,null,function*(){if(this.initTime[e]){m.i(Zi,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);return}let i;try{i=yield this.timeInMs(t),m.i(Zi,`Time taken for Plugin ${e} initialization : ${i}`)}catch(r){let n=B.MediaPluginErrors.InitFailed(F.VIDEO_PLUGINS,`failed during initialization of plugin${r.message||r}`);throw m.e(Zi,n),this.failure(e,n),n}i&&(this.initTime[e]=i)})}preProcessWithTime(e){return g(this,null,function*(){let t=yield this.timeInMs(e);this.preProcessingAvgs.add(t)})}processWithTime(e,t){return g(this,null,function*(){var i;let r;try{r=yield this.timeInMs(t)}catch(n){let s=B.MediaPluginErrors.ProcessingFailed(F.VIDEO_PLUGINS,`Failed during processing of plugin${n.message||n}`);throw m.e(Zi,s),this.failure(e,s),s}r&&((i=this.processingAvgs[e])==null||i.add(r))})}timeInMs(e){return g(this,null,function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)})}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.processingAvgs[e],delete this.pluginAdded[e],delete this.pluginInputFrameRate[e],delete this.pluginFrameRate[e]}},qs=24,cu=320,uu=240,nt="VideoPluginsManager",du=class{constructor(e,t){this.pluginsLoopRunning=!1,this.pluginsLoopState="paused",this.pluginAddInProgress=!1,this.hmsTrack=e,this.pluginsMap=new Map,this.pluginNumFramesToSkip={},this.pluginNumFramesSkipped={},this.analytics=new lu(t),this.canvases=new Array}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e,t){return g(this,null,function*(){var i;if(this.pluginAddInProgress){let r=(i=e.getName)==null?void 0:i.call(e);if(!r||r===""){m.w("no name provided by the plugin");return}let n=B.MediaPluginErrors.AddAlreadyInProgress(F.VIDEO_PLUGINS,"Add Plugin is already in Progress");throw this.analytics.failure(r,n),m.w("can't add another plugin when previous add is in progress"),n}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e,t)}finally{this.pluginAddInProgress=!1}})}addPluginInternal(e,t){return g(this,null,function*(){var i,r;let n=(i=e.getName)==null?void 0:i.call(e);if(!n||n===""){m.w("no name provided by the plugin");return}if(this.pluginsMap.has(n)){m.w(nt,`plugin - ${e.getName()} already added.`);return}let s=this.hmsTrack.getMediaTrackSettings().frameRate||qs,a=0;t&&t>0?(m.i(nt,`adding plugin ${e.getName()} with framerate ${t}`),t<s&&(a=Math.ceil(s/t)-1),this.analytics.added(n,s,t)):(m.i(nt,`adding plugin ${e.getName()}`),this.analytics.added(n,s)),m.i(nt,"numFrames to skip processing",a),this.pluginNumFramesToSkip[n]=a,this.pluginNumFramesSkipped[n]=a,this.validateAndThrow(n,e);try{if(yield this.analytics.initWithTime(n,()=>g(this,null,function*(){return yield e.init()})),this.pluginsMap.set(n,e),this.pluginsMap.size+1>this.canvases.length)for(let o=this.canvases.length;o<=this.pluginsMap.size;o++)this.canvases[o]=document.createElement("canvas");yield this.startPluginsLoop((r=e.getContextType)==null?void 0:r.call(e))}catch(o){throw m.e(nt,"failed to add plugin",o),yield this.removePlugin(e),o}})}validatePlugin(e){return e.checkSupport()}validateAndThrow(e,t){let i=this.validatePlugin(t);if(i.isSupported)m.i(nt,`plugin is supported,- ${t.getName()}`);else{let r;switch(i.errType){case Ti.PLATFORM_NOT_SUPPORTED:throw r=B.MediaPluginErrors.PlatformNotSupported(F.VIDEO_PLUGINS,"platform not supported, see docs"),this.analytics.failure(e,r),r;case Ti.DEVICE_NOT_SUPPORTED:throw r=B.MediaPluginErrors.DeviceNotSupported(F.VIDEO_PLUGINS,"video device not supported, see docs"),this.analytics.failure(e,r),r}}}removePlugin(e){return g(this,null,function*(){let t=e.getName();if(!this.pluginsMap.get(t)){m.w(nt,`plugin - ${t} not found to remove.`);return}m.i(nt,`removing plugin ${t}`),this.removePluginEntry(t),this.pluginsMap.size===0&&(m.i(nt,"No plugins left, stopping plugins loop"),yield this.stopPluginsLoop()),e.stop(),this.analytics.removed(t)})}removePluginEntry(e){this.pluginsMap.delete(e),this.pluginNumFramesToSkip[e]&&delete this.pluginNumFramesToSkip[e],this.pluginNumFramesSkipped[e]&&delete this.pluginNumFramesSkipped[e]}waitForRestart(){return g(this,null,function*(){if(!(!this.pluginsLoopRunning||this.pluginsLoopState==="running"))for(;this.pluginsLoopState==="paused";)yield Ht(100)})}cleanup(){return g(this,null,function*(){var e;for(let t of this.pluginsMap.values())yield this.removePlugin(t);(e=this.outputTrack)==null||e.stop()})}initElementsAndStream(e){this.inputCanvas||(this.inputCanvas=document.createElement("canvas")),this.outputCanvas=document.createElement("canvas"),this.inputVideo||(this.inputVideo=document.createElement("video")),this.inputCanvas.getContext("2d"),this.outputCanvas.getContext(e||gn["2D"]);let t=this.outputCanvas.captureStream();this.outputTrack=t.getVideoTracks()[0]}startPluginsLoop(e){return g(this,null,function*(){if(!this.pluginsLoopRunning){this.initElementsAndStream(e),this.pluginsLoopRunning=!0;try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(t){throw this.pluginsLoopRunning=!1,m.e(nt,"error in setting processed track",t),t}this.pluginsLoop().then(()=>{m.d(nt,"processLoop stopped")})}})}stopPluginsLoop(){return g(this,null,function*(){var e;this.pluginsLoopRunning=!1,yield this.hmsTrack.setProcessedTrack(void 0),this.resetCanvases(),(e=this.outputTrack)==null||e.stop(),this.inputVideo&&(this.inputVideo.srcObject=null,this.inputVideo=void 0)})}pluginsLoop(){return g(this,null,function*(){for(;this.pluginsLoopRunning;){let e=this.hmsTrack.getMediaTrackSettings().frameRate||qs,t=Math.floor(1e3/e);if(!this.hmsTrack.enabled||this.hmsTrack.nativeTrack.readyState==="ended"){this.pluginsLoopState==="running"&&this.resetCanvases(),this.pluginsLoopState="paused",yield Ht(t);continue}let i=0;try{yield this.analytics.preProcessWithTime(()=>g(this,null,function*(){return yield this.doPreProcessing()}));let r=Date.now();yield this.processFramesThroughPlugins(),i=Math.floor(Date.now()-r),i>t&&(i=t)}catch(r){m.e(nt,"error in plugins loop",r)}this.pluginsLoopState="running",yield Ht(t-i)}})}doPreProcessing(){return g(this,null,function*(){yield this.addTrackToVideo(),yield this.updateInputCanvas()})}processFramesThroughPlugins(){return g(this,null,function*(){this.canvases[0]=this.inputCanvas;let e=0;for(let t of this.pluginsMap.values()){let i=t.getName();if(t){try{let r=this.checkIfSkipRequired(i);if(t.getPluginType()===Er.TRANSFORM){let n=(s,a)=>g(this,null,function*(){try{yield t.processVideoFrame(s,a,r)}catch(o){m.e(nt,`error in processing plugin ${i}`,o)}});if(r)e===this.pluginsMap.size-1?yield n(this.canvases[e],this.outputCanvas):yield n(this.canvases[e],this.canvases[e+1]);else{let s=this.canvases[e],a=this.canvases[e+1];e===this.pluginsMap.size-1?yield this.analytics.processWithTime(i,()=>g(this,null,function*(){return n(s,this.outputCanvas)})):yield this.analytics.processWithTime(i,()=>g(this,null,function*(){return n(s,a)}))}}else t.getPluginType()===Er.ANALYZE&&!r&&(yield this.analytics.processWithTime(i,()=>g(this,null,function*(){return yield t.processVideoFrame(this.inputCanvas)})))}catch(r){m.e(nt,`error in processing plugin ${i}`,r),yield this.removePlugin(t)}e++}}})}addTrackToVideo(){return g(this,null,function*(){var e;if(!this.inputVideo)return;let t=this.inputVideo.srcObject;t!==null&&t instanceof MediaStream&&((e=t.getVideoTracks()[0])==null?void 0:e.id)===this.hmsTrack.nativeTrack.id||(this.inputVideo.pause(),this.inputVideo.srcObject=new MediaStream([this.hmsTrack.nativeTrack]),this.inputVideo.muted=!0,this.inputVideo.playsInline=!0,yield this.inputVideo.play())})}updateInputCanvas(){return g(this,null,function*(){if(!this.inputCanvas||!this.inputVideo)return;let{width:e=cu,height:t=uu}=this.hmsTrack.getMediaTrackSettings();this.inputCanvas.height!==t&&(this.inputCanvas.height=t),this.inputCanvas.width!==e&&(this.inputCanvas.width=e),this.inputCanvas.getContext("2d").drawImage(this.inputVideo,0,0,e,t)})}resetCanvases(){if(!this.outputCanvas||!this.inputCanvas)return;let e=this.inputCanvas.getContext("2d");e&&(e.fillStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height)),this.canvases=[]}checkIfSkipRequired(e){let t=!1;return this.pluginNumFramesSkipped[e]<this.pluginNumFramesToSkip[e]?(this.pluginNumFramesSkipped[e]++,t=!0):(t=!1,this.pluginNumFramesSkipped[e]=0),t}};function Hs(e,t){return function(i){return i in e&&e[i]!==t[i]}}var ni=class extends $o{constructor(e,t,i,r,n=new yi().build()){super(e,t,i),this.eventBus=r,this.TAG="LocalVideoTrack",this.isCurrentTab=!1,this.buildNewSettings=s=>{let{width:a,height:o,codec:l,maxFramerate:c,maxBitrate:u,deviceId:d,advanced:h}=se(se({},this.settings),s);return new Hn(a,o,l,c,d,h,u)},this.handleSettingsChange=s=>g(this,null,function*(){let a=this.stream,o=Hs(s,this.settings);o("maxBitrate")&&s.maxBitrate&&(yield a.setMaxBitrate(s.maxBitrate,this)),(o("width")||o("height")||o("advanced"))&&(yield this.nativeTrack.applyConstraints(s.toConstraints()))}),this.handleDeviceChange=(s,a=!1)=>g(this,null,function*(){if(Hs(s,this.settings)("deviceId")&&this.source==="regular"){if(this.enabled){let o=yield this.replaceTrackWith(s);yield this.replaceSender(o,this.enabled),this.nativeTrack=o}a||zt.updateSelection("videoInput",{deviceId:s.deviceId,groupId:this.nativeTrack.getSettings().groupId})}}),e.tracks.push(this),this.settings=n,n.deviceId==="default"&&t.enabled&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new du(this,r),this.setFirstTrackId(this.trackId)}setEnabled(e){var t=i=>super[i];return g(this,null,function*(){if(e!==this.enabled){if(this.source==="regular"){let i;e?i=yield this.replaceTrackWith(this.settings):i=yield this.replaceTrackWithBlank(),yield this.replaceSender(i,e),this.nativeTrack=i,e&&(yield this.pluginsManager.waitForRestart(),this.settings=this.buildNewSettings({deviceId:i.getSettings().deviceId}))}yield t("setEnabled").call(this,e),this.eventBus.localVideoEnabled.publish({enabled:e,track:this}),this.stream.trackUpdate(this)}})}isPublishedTrackId(e){return this.publishedTrackId===e}addSink(e){this.addSinkInternal(e,this.processedTrack||this.nativeTrack)}setSettings(e,t=!1){return g(this,null,function*(){let i=this.buildNewSettings(e);if(yield this.handleDeviceChange(i,t),!this.enabled){this.settings=i;return}yield this.handleSettingsChange(i),this.settings=i})}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(e,t){return g(this,null,function*(){return this.pluginsManager.addPlugin(e,t)})}removePlugin(e){return g(this,null,function*(){return this.pluginsManager.removePlugin(e)})}validatePlugin(e){return this.pluginsManager.validatePlugin(e)}cleanup(){var e=t=>super[t];return g(this,null,function*(){var t;e("cleanup").call(this),yield this.pluginsManager.cleanup(),(t=this.processedTrack)==null||t.stop()})}cropTo(e){return g(this,null,function*(){if(!!e&&this.source==="screen")try{this.nativeTrack.cropTo&&(yield this.nativeTrack.cropTo(e))}catch(t){throw m.e(this.TAG,"failed to crop screenshare capture - ",t),B.TracksErrors.GenericTrack(F.TRACK,"failed to crop screenshare capture")}})}getCaptureHandle(){if(this.nativeTrack.getCaptureHandle)return this.nativeTrack.getCaptureHandle()}setProcessedTrack(e){return g(this,null,function*(){if(!this.nativeTrack.enabled){this.processedTrack=e;return}if(!e){this.processedTrack&&(yield this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack)),this.processedTrack=void 0;return}e!==this.processedTrack&&(this.processedTrack?yield this.stream.replaceSenderTrack(this.processedTrack,e):yield this.stream.replaceSenderTrack(this.nativeTrack,e),this.processedTrack=e)})}getTrackIDBeingSent(){return this.getTrackBeingSent().id}getTrackBeingSent(){return this.enabled?this.processedTrack||this.nativeTrack:this.nativeTrack}replaceTrackWith(e){return g(this,null,function*(){let t=this.nativeTrack;t==null||t.stop();let i=yield ru(e);return this.settings.deviceId==="default"&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),i})}replaceTrackWithBlank(){return g(this,null,function*(){let e=this.nativeTrack;return e==null||e.stop(),Rr.getEmptyVideoTrack(e)})}replaceSender(e,t){return g(this,null,function*(){let i=this.stream;t?yield i.replaceSenderTrack(this.nativeTrack,this.processedTrack||e):yield i.replaceSenderTrack(this.processedTrack||this.nativeTrack,e),yield i.replaceStreamTrack(this.nativeTrack,e)})}},Ai="renegotiation-callback-id",xo="ion-sfu",Uo=100,vn=5,hu=60,pu=12e3,fu=1e3,mu=5,Ii="SUBSCRIBE_ICE_CONNECTION_CALLBACK_ID",gu=6e4,vu=1e3,yu="https://event.100ms.live/v2/client/report",Tu="https://event-nonprod.100ms.live/v2/client/report",bu=100,tt={DEVICE_CHANGE:"device-change",LOCAL_AUDIO_ENABLED:"local-audio-enabled",LOCAL_VIDEO_ENABLED:"local-video-enabled",STATS_UPDATE:"stats-update",RTC_STATS_UPDATE:"rtc-stats-update",TRACK_DEGRADED:"track-degraded",TRACK_RESTORED:"track-restored",TRACK_AUDIO_LEVEL_UPDATE:"track-audio-level-update",LOCAL_AUDIO_SILENCE:"local-audio-silence",ANALYTICS:"analytics",AUDIO_PLUGIN_FAILED:"audio-plugin-failed",POLICY_CHANGE:"policy-change",LOCAL_ROLE_UPDATE:"local-role-update",AUDIO_TRACK_UPDATE:"audio-track-update",AUDIO_TRACK_ADDED:"audio-track-added",AUDIO_TRACK_REMOVED:"audio-track-removed",AUTOPLAY_ERROR:"autoplay-error"},ai=class extends $o{constructor(){super(...arguments),this._degraded=!1,this._degradedAt=null,this._layerDefinitions=[],this.history=new Su}get degraded(){return this._degraded}get degradedAt(){return this._degradedAt}setEnabled(e){var t=i=>super[i];return g(this,null,function*(){e!==this.enabled&&(yield t("setEnabled").call(this,e))})}preferLayer(e){!this.shouldSendVideoLayer(e,"preferLayer")||(this.stream.setVideoLayer(e,this.logIdentifier),this.pushInHistory(`uiPreferLayer-${e}`))}getSimulcastLayer(){return this.stream.getSimulcastLayer()}addSink(e){super.addSink(e),this.updateLayer("addSink"),this.pushInHistory("uiSetLayer-high")}removeSink(e){super.removeSink(e),this.updateLayer("removeSink"),this._degraded=!1,this.pushInHistory("uiSetLayer-none")}getSimulcastDefinitions(){return[...this._layerDefinitions]}setSimulcastDefinitons(e){this._layerDefinitions=e}setLayerFromServer(e,t){this._degraded=t,this._degradedAt=t?new Date:this._degradedAt,this.stream.setVideoLayerLocally(e,this.logIdentifier),this.pushInHistory(`sfuLayerUpdate-${e}`)}setDegradedFromSdk(e){this._degraded=e,this._degradedAt=e?new Date:this._degradedAt,this.updateLayer("sdkDegradation"),this.pushInHistory(e?"sdkDegraded-none":"sdkRecovered-high")}updateLayer(e){let t=this.degraded||!this.hasSinks()?ct.NONE:ct.HIGH;!this.shouldSendVideoLayer(t,e)||this.stream.setVideoLayer(t,this.logIdentifier)}pushInHistory(e){}shouldSendVideoLayer(e,t){let i=this.getSimulcastLayer();return this.degraded&&e===ct.NONE?!0:i===e?(m.d(`[Remote Track] ${this.logIdentifier}`,`Not sending update, already on layer ${e}, source=${t}`),!1):!0}},Su=class{constructor(){this.history=[]}push(e){e.time=new Date().toISOString().split("T")[1],this.history.push(e)}},Xi="HMSLocalStream",Cr=class extends Lo{constructor(){super(...arguments),this.connection=null}setConnection(e){this.connection=e}addTransceiver(e,t){let i=[];if(e instanceof ni)if(t.length>0)m.v(Xi,"Simulcast enabled with layers",t),i.push(...t);else{let n={active:this.nativeStream.active};e.settings.maxBitrate&&!Vn&&(n.maxBitrate=e.settings.maxBitrate),i.push(n)}let r=this.connection.addTransceiver(e.getTrackBeingSent(),{streams:[this.nativeStream],direction:"sendonly",sendEncodings:i});return this.setPreferredCodec(r,e.nativeTrack.kind),r}setMaxBitrate(e,t){return g(this,null,function*(){var i;yield(i=this.connection)==null?void 0:i.setMaxBitrate(e,t)})}setPreferredCodec(e,t){}replaceTrack(e,t){return g(this,null,function*(){yield this.replaceSenderTrack(e,t),e.stop(),this.replaceStreamTrack(e,t)})}replaceStreamTrack(e,t){this.nativeStream.addTrack(t),this.nativeStream.removeTrack(e)}replaceSenderTrack(e,t){return g(this,null,function*(){var i;let r=(i=this.connection)==null?void 0:i.getSenders().find(n=>n.track&&n.track.id===e.id);if(r===void 0){m.w(Xi,`No sender found for trackId=${e.id}`);return}yield r.replaceTrack(t)})}removeSender(e){let t=0;this.connection.getSenders().forEach(i=>{var r,n;if(((r=i.track)==null?void 0:r.id)===e.trackId||((n=i.track)==null?void 0:n.id)===e.getTrackIDBeingSent()){this.connection.removeTrack(i),t+=1;let s=this.tracks.indexOf(e);s!==-1?this.tracks.splice(s,1):m.e(Xi,`Cannot find ${e.trackId} in locally stored tracks`)}}),t!==1&&m.e(Xi,`Removed ${t} sender's, expected to remove 1`)}trackUpdate(e){var t;(t=this.connection)==null||t.trackUpdate(e)}},Fo={audioContext:null,getAudioContext(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContext},resumeContext(){this.getAudioContext().resume().catch(e=>{m.e("AudioContext",e)})}},Ks={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default"},Di,Rr=class{constructor(e,t,i,r,n){this.store=e,this.observer=t,this.deviceManager=i,this.eventBus=r,this.analyticsTimer=n,this.TAG="[LocalTrackManager]",this.setScreenCaptureHandleConfig()}getTracksToPublish(e){return g(this,null,function*(){let t=this.getAVTrackSettings(e);if(!t)return[];let i=!!t.audio,r=!!t.video,n=[],{videoTrack:s,audioTrack:a}=yield this.updateCurrentLocalTrackSettings(t),o=(s==null?void 0:s.stream)||(a==null?void 0:a.stream),l=Boolean(s&&this.store.getTrackById(s.trackId)),c=Boolean(a&&this.store.getTrackById(a.trackId));if(l&&c)return[];let u={audio:i&&!a&&(e.isAudioMuted?"empty":!0),video:r&&!s&&(e.isVideoMuted?"empty":!0)};this.analyticsTimer.start(Ee.LOCAL_TRACKS);try{m.d(this.TAG,"Init Local Tracks",{fetchTrackOptions:u}),n=yield this.getLocalTracks(u,t,o)}catch(d){n=yield this.retryGetLocalTracks(d,t,u,o)}return this.analyticsTimer.end(Ee.LOCAL_TRACKS),s&&r&&!l&&n.push(s),a&&i&&!c&&n.push(a),n})}getLocalTracks(){return g(this,arguments,function*(e={audio:!0,video:!0},t,i){try{let r=yield this.getNativeLocalTracks(e,t);return this.createHMSLocalTracks(r,t,i)}catch(r){throw this.eventBus.analytics.publish(Ae.publish({devices:this.deviceManager.getDevices(),error:r,settings:t})),r}})}getNativeLocalTracks(){return g(this,arguments,function*(e={audio:!1,video:!1},t){let i=new mn(e.video===!0?t.video:null,e.audio===!0?t.audio:null,t.simulcast),r=[];return(i.audio||i.video)&&r.push(...yield this.getAVTracks(i)),r.push(...this.getEmptyTracks(e)),r})}getLocalScreen(e){return g(this,null,function*(){let t=yield this.getOrDefaultScreenshareConfig(e),{video:i,audio:r}=this.getScreenshareSettings(t.videoOnly),n={video:Ye(se({},i.toConstraints(!0)),{displaySurface:t.displaySurface}),preferCurrentTab:t.preferCurrentTab,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio};if(r){let d=r.toConstraints();delete d.advanced,n.audio=Ye(se({},d),{autoGainControl:!1,noiseSuppression:!1,googAutoGainControl:!1,echoCancellation:!1})}let s;try{m.d("retrieving screenshare with ",{config:t},{constraints:n}),s=yield navigator.mediaDevices.getDisplayMedia(n)}catch(d){m.w(this.TAG,"error in getting screenshare - ",d);let h=Sr(d,Mt.SCREEN);throw this.eventBus.analytics.publish(Ae.publish({error:h,devices:this.deviceManager.getDevices(),settings:new mn(i,r,!1)})),h}let a=[],o=new Cr(s),l=s.getVideoTracks()[0],c=new ni(o,l,"screen",this.eventBus,i);try{let d=this.validateCurrentTabCapture(c,t.forceCurrentTab);c.isCurrentTab=d,yield c.cropTo(t.cropTarget)}catch(d){throw s.getTracks().forEach(h=>h.stop()),d}a.push(c);let u=s.getAudioTracks()[0];if(u){let d=new Vi(o,u,"screen",this.eventBus,r);a.push(d)}return m.v(this.TAG,"getLocalScreen",a),a})}setScreenCaptureHandleConfig(e){var t;!((t=navigator.mediaDevices)!=null&&t.setCaptureHandleConfig)||this.isInIframe()||(e=e||{},Object.assign(e,{handle:ki(),exposeOrigin:!1,permittedOrigins:[window.location.origin]}),m.d("setting capture handle - ",e.handle),navigator.mediaDevices.setCaptureHandleConfig(e),this.captureHandleIdentifier=e.handle)}validateCurrentTabCapture(e,t){let i=e.getCaptureHandle(),r=!!(this.captureHandleIdentifier&&(i==null?void 0:i.handle)===this.captureHandleIdentifier);if(t&&!r)throw m.e(this.TAG,"current tab was not shared with forceCurrentTab as true"),B.TracksErrors.CurrentTabNotShared();return r}requestPermissions(){return g(this,null,function*(){try{(yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(e=>e.stop())}catch(e){m.e(this.TAG,e)}})}static getEmptyVideoTrack(e){var t,i,r;let n=((t=e==null?void 0:e.getSettings())==null?void 0:t.width)||320,s=((i=e==null?void 0:e.getSettings())==null?void 0:i.height)||240,a=10;Di||(Di=Object.assign(document.createElement("canvas"),{width:n,height:s}),(r=Di.getContext("2d"))==null||r.fillRect(0,0,n,s));let o=Di.captureStream(a).getVideoTracks()[0],l=setInterval(()=>{if(o.readyState==="ended"){clearInterval(l);return}let c=Di.getContext("2d");if(c){let u=c.getImageData(0,0,1,1).data[0]===0?1:0;c.fillStyle=`rgb(${u}, 0, 0)`,c.fillRect(0,0,1,1)}},1e3/a);return o.onended=()=>{clearInterval(l)},o.enabled=!1,o}static getEmptyAudioTrack(){let e=Fo.getAudioContext(),t=e.createOscillator(),i=e.createMediaStreamDestination();t.connect(i),t.start();let r=i.stream.getAudioTracks()[0];return r.enabled=!1,r}getAVTracks(e){return g(this,null,function*(){try{let t=yield navigator.mediaDevices.getUserMedia({audio:e.audio?e.audio.toConstraints():!1,video:e.video?e.video.toConstraints():!1});return t.getVideoTracks().concat(t.getAudioTracks())}catch(t){yield this.deviceManager.init();let i=!!(!this.deviceManager.hasWebcamPermission&&e.video),r=!!(!this.deviceManager.hasMicrophonePermission&&e.audio),n=this.getErrorType(i,r);throw Sr(t,n)}})}getAVTrackSettings(e){let t=this.getAudioSettings(e),i=this.getVideoSettings(e);return!t&&!i?null:new Gs().video(i).audio(t).build()}isInIframe(){try{return window.self!==window.top}catch{return!0}}retryGetLocalTracks(e,t,i,r){return g(this,null,function*(){if(e instanceof Q&&e.action===F.TRACK){this.observer.onFailure(e);let n=e.code===ne.TracksErrors.OVER_CONSTRAINED,s=e.message.includes("audio"),a=e.message.includes("video");if(n){let o=new Gs().video(new Hn).audio(new qn).build();m.w(this.TAG,"Fetch AV Tracks failed with overconstrained error",{fetchTrackOptions:i},{error:e});try{return yield this.getLocalTracks(i,o,r)}catch(l){let c=l instanceof Q?l.nativeError:l,u=l;if((c==null?void 0:c.name)==="OverconstrainedError"){let d=B.TracksErrors.GenericTrack(F.TRACK,"Overconstrained error after dropping all constraints");d.addNativeError(c),u=d}return yield this.retryGetLocalTracks(u,t,i,r)}}i.audio=s?"empty":i.audio,i.video=a?"empty":i.video,m.w(this.TAG,"Fetch AV Tracks failed",{fetchTrackOptions:i},e);try{return yield this.getLocalTracks(i,t,r)}catch(o){return m.w(this.TAG,"Fetch empty tacks failed",o),i.audio=i.audio&&"empty",i.video=i.video&&"empty",this.observer.onFailure(o),yield this.getLocalTracks(i,t,r)}}else return m.w(this.TAG,"Fetch AV Tracks failed - unknown exception",e),this.observer.onFailure(e),[]})}getErrorType(e,t){return e&&t?Mt.AV:e?Mt.VIDEO:t?Mt.AUDIO:Mt.UNKNOWN}getEmptyTracks(e){let t=[];return e.audio==="empty"&&t.push(Rr.getEmptyAudioTrack()),e.video==="empty"&&t.push(Rr.getEmptyVideoTrack()),t}updateCurrentLocalTrackSettings(e){return g(this,null,function*(){let t=this.store.getLocalPeerTracks(),i=t.find(s=>s.type===xe.VIDEO&&s.source==="regular"),r=t.find(s=>s.type===xe.AUDIO&&s.source==="regular"),n=t.find(s=>s.type===xe.VIDEO&&s.source==="screen");return e!=null&&e.video&&(yield i==null?void 0:i.setSettings(e.video)),e!=null&&e.audio&&(yield r==null?void 0:r.setSettings(e.audio)),e!=null&&e.screen&&(yield n==null?void 0:n.setSettings(e.screen)),{videoTrack:i,audioTrack:r}})}getAudioSettings(e){var t;let i=this.store.getPublishParams();if(!i||!((t=i.allowed)!=null&&t.includes("audio")))return null;let r=this.store.getLocalPeer(),n=r==null?void 0:r.audioTrack,s=(n==null?void 0:n.settings.deviceId)||e.audioInputDeviceId;return new Bi().codec(i.audio.codec).maxBitrate(i.audio.bitRate).deviceId(s||Ks.audioInputDeviceId).build()}getVideoSettings(e){var t;let i=this.store.getPublishParams();if(!i||!((t=i.allowed)!=null&&t.includes("video")))return null;let r=this.store.getLocalPeer(),n=r==null?void 0:r.videoTrack,s=(n==null?void 0:n.settings.deviceId)||e.videoDeviceId,a=i.video,{width:o=a.width,height:l=a.height}=this.store.getSimulcastDimensions("regular")||{};return new yi().codec(a.codec).maxBitrate(a.bitRate).maxFramerate(a.frameRate).setWidth(o).setHeight(l).deviceId(s||Ks.videoDeviceId).build()}getScreenshareSettings(e=!1){let{screen:t}=this.store.getPublishParams(),i=this.store.getSimulcastDimensions("screen");return{video:new yi().maxBitrate(t.bitRate,!1).codec(t.codec).maxFramerate(t.frameRate).setWidth((i==null?void 0:i.width)||t.width).setHeight((i==null?void 0:i.height)||t.height).build(),audio:e?void 0:new Bi().build()}}getOrDefaultScreenshareConfig(e){return g(this,null,function*(){var t;let i=Object.assign({videoOnly:!1,audioOnly:!1,forceCurrentTab:!1,preferCurrentTab:!1,selfBrowserSurface:"exclude",surfaceSwitching:"include",systemAudio:"exclude",displaySurface:"monitor"},e||{});return i.forceCurrentTab&&(i.videoOnly=!0,i.preferCurrentTab=!0,i.selfBrowserSurface="include",i.surfaceSwitching="exclude"),i.preferCurrentTab&&(i.selfBrowserSurface="include"),i.cropElement&&((t=window.CropTarget)==null?void 0:t.fromElement)&&(i.cropTarget=yield window.CropTarget.fromElement(i.cropElement)),i})}createHMSLocalTracks(e,t,i){let r=e.find(a=>a.kind==="video"),n=e.find(a=>a.kind==="audio");i?e.forEach(a=>i==null?void 0:i.nativeStream.addTrack(a)):i=new Cr(new MediaStream(e));let s=[];if(n&&(t==null?void 0:t.audio)){let a=new Vi(i,n,"regular",this.eventBus,t.audio);s.push(a)}if(r&&(t==null?void 0:t.video)){let a=new ni(i,r,"regular",this.eventBus,t.video);s.push(a)}return s}},ku=class{constructor(e,t){this.eventBus=e,this.listener=t,this.TAG="NetworkTestManager",this.controller=new AbortController,this.start=i=>g(this,null,function*(){var r;if(!i)return;let{url:n,timeout:s,scoreMap:a}=i,o=this.controller.signal,l=Date.now(),c=0,u=Ht(s).then(()=>{this.controller.abort()});try{let d=(r=(yield fetch(`${n}?${Date.now()}`,{signal:o})).body)==null?void 0:r.getReader();if(!d)throw Error("unable to process request");let h=()=>g(this,null,function*(){if(d)try{let f=!1;for(;!f;){let{value:v,done:T}=yield d.read();f=T,v&&(c+=v.byteLength,this.sendScore({scoreMap:a,downloadedSize:c,startTime:l}))}}catch(f){m.e(this.TAG,f)}});return Promise.race([h(),u]).then(()=>{this.sendScore({scoreMap:a,downloadedSize:c,startTime:l,finished:!0})}).catch(f=>{m.e(this.TAG,f),this.updateScoreToListener(0),this.eventBus.analytics.publish(Ae.previewNetworkQuality({error:f.message}))})}catch(d){m.e(this.TAG,d),d.name!=="AbortError"&&(this.updateScoreToListener(0),this.eventBus.analytics.publish(Ae.previewNetworkQuality({error:d.message})))}}),this.stop=()=>{this.controller.signal.aborted||this.controller.abort()},this.sendScore=({scoreMap:i,downloadedSize:r,startTime:n,finished:s=!1})=>{let a=(Date.now()-n)/1e3,o=r/1024/a*8,l=-1;for(let c in i){let u=i[c];o>=u.low&&(!u.high||o<=u.high)&&(l=Number(c))}this.updateScoreToListener(l),s&&this.eventBus.analytics.publish(Ae.previewNetworkQuality({score:l,downLink:o.toFixed(2)}))}}updateScoreToListener(e){var t,i;e!==this.score&&(this.score=e,(i=(t=this.listener)==null?void 0:t.onNetworkQuality)==null||i.call(t,e))}},_u=class{constructor(e,t,i,r,n){this.store=e,this.transport=t,this.publish=i,this.removeAuxiliaryTrack=r,this.listener=n,this.handleLocalPeerRoleUpdate=s=>g(this,[s],function*({oldRole:a,newRole:o}){var l,c;let u=this.store.getLocalPeer();if(!u)return;let d=new Set(a.publishParams.allowed||[]),h=new Set(o.publishParams.allowed||[]),f=this.removeTrack(d,h,"video"),v=this.removeTrack(d,h,"audio"),T=this.removeTrack(d,h,"screen");yield this.removeVideoTracks(f),yield this.removeAudioTrack(v),yield this.removeScreenTracks(T),this.store.setPublishParams(o.publishParams);let C=((l=this.store.getConfig())==null?void 0:l.settings)||{isAudioMuted:!0,isVideoMuted:!0,audioInputDeviceId:"default",videoDeviceId:"default",audioOutputDeviceId:"default"};yield this.publish(Ye(se({},C),{isAudioMuted:!0,isVideoMuted:!0})),(c=this.listener)==null||c.onPeerUpdate(Qe.ROLE_UPDATED,u)})}removeVideoTracks(e){return g(this,null,function*(){var t;if(!e)return;let i=this.store.getLocalPeer();i!=null&&i.videoTrack&&(yield this.transport.unpublish([i.videoTrack]),(t=this.listener)==null||t.onTrackUpdate(ke.TRACK_REMOVED,i.videoTrack,i),i.videoTrack=void 0),yield this.removeAuxTracks(r=>r.source!=="screen"&&r.type==="video")})}removeAudioTrack(e){return g(this,null,function*(){var t;if(!e)return;let i=this.store.getLocalPeer();i!=null&&i.audioTrack&&(yield this.transport.unpublish([i.audioTrack]),(t=this.listener)==null||t.onTrackUpdate(ke.TRACK_REMOVED,i.audioTrack,i),i.audioTrack=void 0),yield this.removeAuxTracks(r=>r.source!=="screen"&&r.type==="audio")})}removeScreenTracks(e){return g(this,null,function*(){!e||(yield this.removeAuxTracks(t=>t.source==="screen"))})}removeAuxTracks(e){return g(this,null,function*(){let t=this.store.getLocalPeer();if(t!=null&&t.auxiliaryTracks){let i=[...t.auxiliaryTracks];for(let r of i)e(r)&&(yield this.removeAuxiliaryTrack(r.trackId))}})}removeTrack(e,t,i){return e.has(i)&&!t.has(i)}},Eu=class{constructor(e){this.store=e,this.primitiveComparator=(t,i)=>t===i?0:Number(t)-Number(i),this.stringComparator=(t,i)=>t===i?0:t<i?-1:1}getPeerComparators(){return{videoEnabled:(e,t)=>{var i,r;return this.primitiveComparator(Boolean((i=e.videoTrack)==null?void 0:i.enabled),Boolean((r=t.videoTrack)==null?void 0:r.enabled))},audioEnabled:(e,t)=>{var i,r;return this.primitiveComparator(Boolean((i=e.audioTrack)==null?void 0:i.enabled),Boolean((r=t.audioTrack)==null?void 0:r.enabled))},screenShare:(e,t)=>this.primitiveComparator(e.auxiliaryTracks.some(i=>i.source==="screen"),t.auxiliaryTracks.some(i=>i.source==="screen")),audioLevel:(e,t)=>{var i,r;return this.primitiveComparator(((i=this.store.getSpeakers().find(n=>n.peer&&n.peer.peerId===(e==null?void 0:e.peerId)))==null?void 0:i.audioLevel)||-1,((r=this.store.getSpeakers().find(n=>n.peer&&n.peer.peerId===(t==null?void 0:t.peerId)))==null?void 0:r.audioLevel)||-1)},rolePriority:(e,t)=>{var i,r;return this.primitiveComparator(((i=t.role)==null?void 0:i.priority)||0,((r=e.role)==null?void 0:r.priority)||0)}}}getTrackComparators(){return{video:(e,t)=>this.primitiveComparator(e.type===xe.VIDEO,t.type===xe.VIDEO),audio:(e,t)=>this.primitiveComparator(e.type===xe.AUDIO,t.type===xe.AUDIO),enabled:(e,t)=>this.primitiveComparator(Boolean(e.enabled),Boolean(t.enabled)),peerAudioLevel:(e,t)=>{let i=this.store.getPeerByTrackId(e.trackId),r=this.store.getPeerByTrackId(t.trackId);return this.getPeerComparators().audioLevel(i,r)},audioLevel:(e,t)=>{var i,r;return this.primitiveComparator(((i=this.store.getSpeakers().find(n=>n.track.trackId===e.trackId))==null?void 0:i.audioLevel)||0,((r=this.store.getSpeakers().find(n=>n.track.trackId===t.trackId))==null?void 0:r.audioLevel)||0)},screenShare:(e,t)=>this.primitiveComparator(e.source==="screen",t.source==="screen"),rolePriority:(e,t)=>{var i,r,n,s;return this.primitiveComparator(((r=(i=this.store.getPeerByTrackId(t.trackId))==null?void 0:i.role)==null?void 0:r.priority)||0,((s=(n=this.store.getPeerByTrackId(e.trackId))==null?void 0:n.role)==null?void 0:s.priority)||0)}}}},Cu=class{constructor(){this.TAG="[HTTPAnalyticsTransport]",this.failedEvents=new Lr("client-events"),this.isConnected=!0,this.env=null}setEnv(e){this.env=e,this.flushFailedEvents()}sendEvent(e){if(!this.env){this.addEventToStorage(e);return}let t={event:e.name,payload:e.properties,event_id:String(e.timestamp),peer:e.metadata.peer,timestamp:e.timestamp,device_id:e.device_id},i=this.env===lt.PROD?yu:Tu;fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.metadata.token}`,user_agent_v2:e.metadata.userAgent},body:JSON.stringify(t)}).then(r=>{if(r.status===401){this.removeFromStorage(e);return}if(r.status!==200)throw Error(r.statusText);this.removeFromStorage(e)}).catch(r=>{m.v(this.TAG,"Failed to send event",r,e),this.addEventToStorage(e)})}flushFailedEvents(){let e=this.failedEvents.get();e==null||e.forEach(t=>this.sendEvent(t))}addEventToStorage(e){let t=this.failedEvents.get()||[];t.find(i=>i.timestamp===e.timestamp)||(t.length===bu&&t.shift(),t.push(e),this.failedEvents.set(t))}removeFromStorage(e){let t=this.failedEvents.get()||[],i=t.findIndex(r=>r.timestamp===e.timestamp);i>-1&&(t.splice(i,1),this.failedEvents.set(t))}},Pr=new Cu,Ru=class{constructor(){this.comparator=new Eu(this),this.knownRoles={},this.peers={},this.tracks={},this.peerTrackStates={},this.speakers=[],this.videoLayers=null,this.screenshareLayers=null,this.roleDetailsArrived=!1,this.env=lt.PROD,this.userAgent=dn(this.env)}getConfig(){return this.config}getEnv(){return this.env}getPublishParams(){return this.publishParams}getComparator(){return this.comparator}getRoom(){return this.room}getPolicyForRole(e){return this.knownRoles[e]}getKnownRoles(){return this.knownRoles}getLocalPeer(){if(this.localPeerId&&this.peers[this.localPeerId])return this.peers[this.localPeerId]}getRemotePeers(){return Object.values(this.peers).filter(e=>!e.isLocal)}getPeers(){return Object.values(this.peers)}getPeerById(e){if(this.peers[e])return this.peers[e]}getTracksMap(){return this.tracks}getTracks(){return Object.values(this.tracks)}getVideoTracks(){return this.getTracks().filter(e=>e.type===xe.VIDEO)}getRemoteVideoTracks(){return this.getTracks().filter(e=>e instanceof ai)}getAudioTracks(){return this.getTracks().filter(e=>e.type===xe.AUDIO)}getPeerTracks(e){let t=e?this.peers[e]:void 0,i=[];return t!=null&&t.videoTrack&&i.push(t.videoTrack),t!=null&&t.audioTrack&&i.push(t.audioTrack),i.concat((t==null?void 0:t.auxiliaryTracks)||[])}getLocalPeerTracks(){return this.getPeerTracks(this.localPeerId)}getTrackById(e){var t,i;let r=this.tracks[e];if(r)return r;let n=this.getLocalPeer();if(n){if((t=n.audioTrack)!=null&&t.isPublishedTrackId(e))return n.audioTrack;if((i=n.videoTrack)!=null&&i.isPublishedTrackId(e))return n.videoTrack}}getPeerByTrackId(e){let t=this.tracks[e];return t.peerId?this.peers[t.peerId]:void 0}getSpeakers(){return this.speakers}getSpeakerPeers(){return this.speakers.map(e=>e.peer)}getUserAgent(){return this.userAgent}createAndSetUserAgent(e){this.userAgent=dn(this.env,e)}setRoom(e){this.room=e}setKnownRoles(e){this.knownRoles=e,this.roleDetailsArrived=!0,this.updatePeersPolicy()}hasRoleDetailsArrived(){return this.roleDetailsArrived}setConfig(e){var t,i,r;if(zt.rememberDevices(Boolean(e.rememberDeviceSelection)),e.rememberDeviceSelection){let n=zt.getSelection();n&&(e.settings||(e.settings={}),(t=n.audioInput)!=null&&t.deviceId&&(e.settings.audioInputDeviceId=e.settings.audioInputDeviceId||n.audioInput.deviceId),(i=n.audioOutput)!=null&&i.deviceId&&(e.settings.audioOutputDeviceId=e.settings.audioOutputDeviceId||n.audioOutput.deviceId),(r=n.videoInput)!=null&&r.deviceId&&(e.settings.videoDeviceId=e.settings.videoDeviceId||n.videoInput.deviceId))}this.config=e,this.setEnv()}setPublishParams(e){this.publishParams=e}addPeer(e){this.peers[e.peerId]=e,e.isLocal&&(this.localPeerId=e.peerId)}addTrack(e){this.tracks[e.trackId]=e}getTrackState(e){return this.peerTrackStates[e]}setTrackState(e){this.peerTrackStates[e.trackInfo.track_id]=e}removePeer(e){this.localPeerId===e&&(this.localPeerId=void 0),delete this.peers[e]}removeTrack(e){delete this.tracks[e]}updateSpeakers(e){this.speakers=e}updateAudioOutputVolume(e){this.getAudioTracks().forEach(t=>t.setVolume(e))}updateAudioOutputDevice(e){return g(this,null,function*(){let t=[];this.getAudioTracks().forEach(i=>{t.push(i.setOutputDevice(e))}),yield Promise.all(t)})}getSubscribeDegradationParams(){var e,t;let i=(t=(e=this.getLocalPeer())==null?void 0:e.role)==null?void 0:t.subscribeParams.subscribeDegradation;if(i&&Object.keys(i).length>0)return i}getSimulcastLayers(e){var t,i;return e==="screen"?((t=this.screenshareLayers)==null?void 0:t.layers)||[]:((i=this.videoLayers)==null?void 0:i.layers)||[]}getSimulcastDimensions(e){let t=e==="screen"?this.screenshareLayers:this.videoLayers,i=t==null?void 0:t.width,r=t==null?void 0:t.height;return{width:i,height:r}}convertSimulcastLayers(e){return Ye(se({},e),{layers:(e.layers||[]).map(t=>Ye(se({},t),{maxBitrate:t.maxBitrate*1e3}))})}setVideoSimulcastLayers(e){this.videoLayers=this.convertSimulcastLayers(e)}setScreenshareSimulcastLayers(e){this.screenshareLayers=this.convertSimulcastLayers(e)}getSimulcastDefinitionsForPeer(e,t){var i;if(!e.role)return[];let r=this.getPolicyForRole(e.role.name).publishParams,n;t==="regular"?n=r.videoSimulcastLayers:t==="screen"&&(n=r.screenSimulcastLayers);let s=n==null?void 0:n.width,a=n==null?void 0:n.height;return((i=n==null?void 0:n.layers)==null?void 0:i.map(o=>{let l=Qc[o.rid],c={width:s&&o.scaleResolutionDownBy?s/o.scaleResolutionDownBy:void 0,height:a&&o.scaleResolutionDownBy?a/o.scaleResolutionDownBy:void 0};return{layer:l,resolution:c}}))||[]}cleanUp(){let e=this.getTracks();for(let t of e)t.cleanup();this.room=void 0,this.config=void 0,this.localPeerId=void 0,this.roleDetailsArrived=!1}setErrorListener(e){this.errorListener=e}updatePeersPolicy(){this.getPeers().forEach(e=>{var t;if(!e.role){(t=this.errorListener)==null||t.onError(B.GenericErrors.InvalidRole(F.VALIDATION,""));return}e.role=this.getPolicyForRole(e.role.name)})}setEnv(){var e;let t=((e=this.config)==null?void 0:e.initEndpoint).split("https://")[1],i=lt.PROD;t.startsWith(lt.PROD)?i=lt.PROD:t.startsWith(lt.QA)?i=lt.QA:t.startsWith(lt.DEV)&&(i=lt.DEV),this.env=i,Pr.setEnv(i)}},Ws="AnalyticsEventsService",Pu=class{constructor(e){this.store=e,this.bufferSize=Uo,this.transport=null,this.pendingEvents=[],this.level=hn.INFO}setTransport(e){this.transport=e}reset(){this.transport=null,this.pendingEvents=[]}queue(e){if(e.level>=this.level&&(this.pendingEvents.push(e),this.pendingEvents.length>this.bufferSize)){let t=this.pendingEvents.shift();m.d(Ws,"Max buffer size reached","Removed event to accommodate new events",t)}return this}flushFailedClientEvents(){Pr.flushFailedEvents()}flush(){var e;try{for(;this.pendingEvents.length>0;){let t=this.pendingEvents.shift();t&&(t.metadata.peer.peer_id=(e=this.store.getLocalPeer())==null?void 0:e.peerId,t.metadata.userAgent=this.store.getUserAgent(),this.transport&&this.transport.transportProvider.isConnected?this.transport.sendEvent(t):this.sendClientEventOnHTTP(t))}}catch(t){m.w(Ws,"Flush Failed",t)}}sendClientEventOnHTTP(e){var t,i,r,n;let s=this.store.getRoom(),a=this.store.getLocalPeer();e.metadata.token=(t=this.store.getConfig())==null?void 0:t.authToken,e.metadata.peer={session_id:s.sessionId,room_id:s.id,room_name:s.name,template_id:s.templateId,joined_at:(i=s.joinedAt)==null?void 0:i.getTime(),session_started_at:(r=s.startedAt)==null?void 0:r.getTime(),role:(n=a==null?void 0:a.role)==null?void 0:n.name,user_name:a==null?void 0:a.name,user_data:a==null?void 0:a.metadata},Pr.sendEvent(e)}},zs={autoplayFailed:void 0,initialized:!1,autoplayCheckPromise:void 0},Au=class{constructor(e,t,i){this.store=e,this.deviceManager=t,this.eventBus=i,this.autoPausedTracks=new Set,this.TAG="[AudioSinkManager]:",this.volume=100,this.state=se({},zs),this.handleAudioPaused=r=>{var n;let s=(n=r.target.srcObject)==null?void 0:n.getAudioTracks()[0];if(!(s!=null&&s.enabled))return;m.d(this.TAG,"Audio Paused",r.target.id);let a=this.store.getTrackById(r.target.id);a&&(xc()?setTimeout(()=>g(this,null,function*(){a&&(yield this.playAudioFor(a))}),500):this.autoPausedTracks.add(a))},this.handleTrackUpdate=({track:r,enabled:n})=>{var s;(s=window.HMS)!=null&&s.AUDIO_SINK&&(n?(r.addSink(),this.playAudioFor(r)):r.removeSink()),m.d(this.TAG,"Track updated",`${r}`)},this.handleTrackAdd=r=>g(this,[r],function*({track:n,peer:s}){var a,o,l;let c=document.createElement("audio");c.style.display="none",c.id=n.trackId,c.addEventListener("pause",this.handleAudioPaused),n.setAudioElement(c),n.setVolume(this.volume),m.d(this.TAG,"Audio track added",`${n}`),(a=this.audioSink)==null||a.append(c),this.outputDevice&&(yield n.setOutputDevice(this.outputDevice)),(o=window.HMS)!=null&&o.AUDIO_SINK?n.enabled?n.addSink():n.removeSink():c.srcObject=new MediaStream([n.nativeTrack]),(l=this.listener)==null||l.onTrackUpdate(ke.TRACK_ADDED,n,s),yield this.handleAutoplayError(n)}),this.handleAutoplayError=r=>g(this,null,function*(){if(this.state.autoplayFailed===void 0&&(this.state.autoplayCheckPromise||(this.state.autoplayCheckPromise=new Promise(n=>{this.playAudioFor(r).then(n)})),yield this.state.autoplayCheckPromise),this.state.autoplayFailed){this.autoPausedTracks.add(r);return}yield this.playAudioFor(r)}),this.handleAudioDeviceChange=r=>{r.error||!r.selection||r.type==="video"||this.unpauseAudioTracks()},this.handleTrackRemove=r=>{this.autoPausedTracks.delete(r);let n=document.getElementById(r.trackId);n&&(n.removeEventListener("pause",this.handleAudioPaused),n.srcObject=null,n.remove(),r.setAudioElement(null)),this.audioSink&&this.audioSink.childElementCount===0&&(this.state.autoplayCheckPromise=void 0,this.state.autoplayFailed=void 0),m.d(this.TAG,"Audio track removed",`${r}`)},this.unpauseAudioTracks=()=>g(this,null,function*(){let r=[];this.autoPausedTracks.forEach(n=>{r.push(this.playAudioFor(n))}),yield Promise.all(r)}),this.eventBus.audioTrackAdded.subscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.subscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.subscribe(this.handleTrackUpdate),this.eventBus.deviceChange.subscribe(this.handleAudioDeviceChange)}setListener(e){this.listener=e}get outputDevice(){return this.deviceManager.outputDevice}getVolume(){return this.volume}setVolume(e){this.store.updateAudioOutputVolume(e),this.volume=e}unblockAutoplay(){return g(this,null,function*(){this.autoPausedTracks.size>0&&this.unpauseAudioTracks()})}init(e){if(this.state.initialized)return;this.state.initialized=!0;let t=document.createElement("div");t.id=`HMS-SDK-audio-sink-${ki()}`,(e&&document.getElementById(e)||document.body).append(t),this.audioSink=t}cleanUp(){var e;(e=this.audioSink)==null||e.remove(),this.audioSink=void 0,this.eventBus.audioTrackAdded.unsubscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.unsubscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.unsubscribe(this.handleTrackUpdate),this.eventBus.deviceChange.unsubscribe(this.handleAudioDeviceChange),this.autoPausedTracks=new Set,this.state=se({},zs)}playAudioFor(e){return g(this,null,function*(){let t=e.getAudioElement();if(!t){m.w(this.TAG,"No audio element found on track",e.trackId);return}try{yield t.play(),this.state.autoplayFailed=!1,this.autoPausedTracks.delete(e),m.d(this.TAG,"Played track",`${e}`)}catch(i){this.autoPausedTracks.add(e),m.e(this.TAG,"Failed to play track",`${e}`,i);let r=i;if(!this.state.autoplayFailed&&r.name==="NotAllowedError"){this.state.autoplayFailed=!0;let n=B.TracksErrors.AutoplayBlocked(F.AUTOPLAY,"");n.addNativeError(r),this.eventBus.analytics.publish(Ae.autoplayError()),this.eventBus.autoplayError.publish(n)}}})}},Iu=class{constructor(e,t){this.store=e,this.eventBus=t,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.hasWebcamPermission=!1,this.hasMicrophonePermission=!1,this.TAG="[Device Manager]:",this.initialized=!1,this.videoInputChanged=!1,this.audioInputChanged=!1,this.updateOutputDevice=r=>g(this,null,function*(){let n=this.audioOutput.find(s=>s.deviceId===r);return n&&(this.outputDevice=n,yield this.store.updateAudioOutputDevice(n),zt.updateSelection("audioOutput",{deviceId:n.deviceId,groupId:n.groupId})),n}),this.getCurrentSelection=()=>{var r,n;let s=this.store.getLocalPeer(),a=this.createIdentifier((r=s==null?void 0:s.audioTrack)==null?void 0:r.getMediaTrackSettings()),o=this.createIdentifier((n=s==null?void 0:s.videoTrack)==null?void 0:n.getMediaTrackSettings()),l=this.audioInput.find(u=>this.createIdentifier(u)===a),c=this.videoInput.find(u=>this.createIdentifier(u)===o);return{audioInput:l,videoInput:c,audioOutput:this.outputDevice}},this.computeChange=(r,n)=>r.length!==n.length?!0:n.some(s=>!r.includes(this.createIdentifier(s))),this.enumerateDevices=()=>g(this,null,function*(){try{let r=yield navigator.mediaDevices.enumerateDevices(),n=this.videoInput.map(this.createIdentifier),s=this.audioInput.map(this.createIdentifier);this.audioInput=[],this.audioOutput=[],this.videoInput=[],r.forEach(a=>{a.kind==="audioinput"&&a.label?(this.hasMicrophonePermission=!0,this.audioInput.push(a)):a.kind==="audiooutput"?this.audioOutput.push(a):a.kind==="videoinput"&&a.label&&(this.hasWebcamPermission=!0,this.videoInput.push(a))}),this.videoInputChanged=this.computeChange(n,this.videoInput),this.audioInputChanged=this.computeChange(s,this.audioInput),zt.setDevices({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput]}),this.logDevices("Enumerate Devices")}catch(r){m.e(this.TAG,"Failed enumerating devices",r)}}),this.handleDeviceChange=()=>g(this,null,function*(){yield this.enumerateDevices(),this.logDevices("After Device Change");let r=this.store.getLocalPeer();yield this.setOutputDevice(!0),yield this.handleAudioInputDeviceChange(r==null?void 0:r.audioTrack),yield this.handleVideoInputDeviceChange(r==null?void 0:r.videoTrack),this.eventBus.analytics.publish(Ae.deviceChange({selection:this.getCurrentSelection(),type:"change",devices:this.getDevices()}))}),this.handleAudioInputDeviceChange=r=>g(this,null,function*(){if(!r){m.d(this.TAG,"No Audio track on local peer");return}if(!this.audioInputChanged){m.d(this.TAG,"No Change in AudioInput Device");return}let n=this.getNewAudioInputDevice();if(!n||!n.deviceId){this.eventBus.analytics.publish(Ae.deviceChange({selection:{audioInput:n},error:new Error("Audio device not found"),devices:this.getDevices(),type:"audioInput"})),m.w(this.TAG,"Audio device not found");return}let{settings:s}=r,a=new Bi().codec(s.codec).maxBitrate(s.maxBitrate).deviceId(n.deviceId).build();try{yield r.setSettings(a,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"audioInput"}),this.logDevices("Audio Device Change Success")}catch(o){m.e(this.TAG,"[Audio Device Change]",o),this.eventBus.analytics.publish(Ae.deviceChange({selection:{audioInput:n},devices:this.getDevices(),type:"audioInput",error:o})),this.eventBus.deviceChange.publish({error:o,selection:n,type:"audioInput",devices:this.getDevices()})}}),this.handleVideoInputDeviceChange=r=>g(this,null,function*(){if(!r){m.d(this.TAG,"No video track on local peer");return}if(!this.videoInputChanged){m.d(this.TAG,"No Change in VideoInput Device");return}let n=this.videoInput[0];if(!n||!n.deviceId){this.eventBus.analytics.publish(Ae.deviceChange({selection:{videoInput:n},error:new Error("Video device not found"),devices:this.getDevices(),type:"video"})),m.w(this.TAG,"Video device not found");return}let{settings:s}=r,a=new yi().codec(s.codec).maxBitrate(s.maxBitrate).maxFramerate(s.maxFramerate).setWidth(s.width).setHeight(s.height).deviceId(n.deviceId).build();try{yield r.setSettings(a,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"video"}),this.logDevices("Video Device Change Success")}catch(o){m.e(this.TAG,"[Video Device Change]",o),this.eventBus.analytics.publish(Ae.deviceChange({selection:{videoInput:n},devices:this.getDevices(),type:"video",error:o})),this.eventBus.deviceChange.publish({error:o,type:"video",selection:n,devices:this.getDevices()})}});let i=({enabled:r,track:n})=>r&&n.source==="regular";this.eventBus.localVideoEnabled.waitFor(i).then(()=>g(this,null,function*(){yield this.enumerateDevices(),this.videoInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()})})),this.eventBus.localAudioEnabled.waitFor(i).then(()=>g(this,null,function*(){yield this.enumerateDevices(),this.audioInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()})}))}init(e=!1){return g(this,null,function*(){this.initialized&&!e||(!this.initialized&&navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),this.initialized=!0,yield this.enumerateDevices(),this.logDevices("Init"),yield this.setOutputDevice(),this.eventBus.deviceChange.publish({devices:this.getDevices()}),this.eventBus.analytics.publish(Ae.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()})))})}getDevices(){return{audioInput:this.audioInput,audioOutput:this.audioOutput,videoInput:this.videoInput}}cleanUp(){this.initialized=!1,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.outputDevice=void 0,navigator.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange)}createIdentifier(e){return e?`${e.deviceId}${e.groupId}`:""}getNewAudioInputDevice(){let e=this.audioInput.find(t=>t.deviceId==="default");return e?this.audioInput.find(t=>t.label!==e.label&&e.label.includes(t.label)):this.audioInput[0]}setOutputDevice(e=!1){return g(this,null,function*(){let t=this.getNewAudioInputDevice(),i=this.createIdentifier(this.outputDevice);this.outputDevice=this.getAudioOutputDeviceMatchingInput(t),this.outputDevice||(this.outputDevice=this.audioOutput.find(r=>this.createIdentifier(r)===i),this.outputDevice||(this.outputDevice=this.audioOutput.find(r=>r.deviceId==="default")||this.audioOutput[0])),yield this.store.updateAudioOutputDevice(this.outputDevice),e&&i!==this.createIdentifier(this.outputDevice)&&(this.eventBus.analytics.publish(Ae.deviceChange({selection:{audioOutput:this.outputDevice},devices:this.getDevices(),type:"audioOutput"})),this.eventBus.deviceChange.publish({selection:this.outputDevice,type:"audioOutput",devices:this.getDevices()}))})}getAudioOutputDeviceMatchingInput(e){var t,i;let r=((i=(t=this.store.getConfig())==null?void 0:t.settings)==null?void 0:i.speakerAutoSelectionBlacklist)||[];if(r==="all")return;let n=(e==null?void 0:e.label.toLowerCase())||"";if(!r.some(s=>n.includes(s.toLowerCase()))&&(e==null?void 0:e.groupId))return this.audioOutput.find(s=>e.deviceId!=="default"&&s.label===e.label)}logDevices(e=""){m.d(this.TAG,e,JSON.stringify({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput],selected:this.getCurrentSelection()},null,4))}},Du=class{constructor(e,t){this.deviceManager=e,this.audioSinkManager=t}getVolume(){return this.audioSinkManager.getVolume()}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.audioSinkManager.setVolume(e)}getDevice(){return this.deviceManager.outputDevice}setDevice(e){return this.deviceManager.updateOutputDevice(e)}unblockAutoplay(){return g(this,null,function*(){yield this.audioSinkManager.unblockAutoplay()})}},it=class{constructor(e,t){this.eventName=e,this.eventEmitter=t,this.publish=i=>{this.eventEmitter.emit(this.eventName,i)},this.subscribe=i=>{this.eventEmitter.on(this.eventName,i)},this.subscribeOnce=i=>{this.eventEmitter.once(this.eventName,i)},this.unsubscribe=i=>{this.eventEmitter.off(this.eventName,i)},this.waitFor=i=>this.eventEmitter.waitFor(this.eventName,{filter:i}),this.removeAllListeners=()=>{this.eventEmitter.removeAllListeners(this.eventName)}}},wu=class{constructor(){this.eventEmitter=new Mr.exports.EventEmitter2,this.deviceChange=new it(tt.DEVICE_CHANGE,this.eventEmitter),this.localAudioEnabled=new it(tt.LOCAL_AUDIO_ENABLED,this.eventEmitter),this.localVideoEnabled=new it(tt.LOCAL_VIDEO_ENABLED,this.eventEmitter),this.statsUpdate=new it(tt.STATS_UPDATE,this.eventEmitter),this.trackDegraded=new it(tt.TRACK_DEGRADED,this.eventEmitter),this.trackRestored=new it(tt.TRACK_RESTORED,this.eventEmitter),this.trackAudioLevelUpdate=new it(tt.TRACK_AUDIO_LEVEL_UPDATE,this.eventEmitter),this.audioPluginFailed=new it(tt.AUDIO_PLUGIN_FAILED,this.eventEmitter),this.localAudioSilence=new it(tt.LOCAL_AUDIO_SILENCE,this.eventEmitter),this.analytics=new it(tt.ANALYTICS,this.eventEmitter),this.policyChange=new it(tt.POLICY_CHANGE,this.eventEmitter),this.localRoleUpdate=new it(tt.LOCAL_ROLE_UPDATE,this.eventEmitter),this.audioTrackUpdate=new it(tt.AUDIO_TRACK_UPDATE,this.eventEmitter),this.audioTrackAdded=new it(tt.AUDIO_TRACK_ADDED,this.eventEmitter),this.audioTrackRemoved=new it(tt.AUDIO_TRACK_REMOVED,this.eventEmitter),this.autoplayError=new it(tt.AUTOPLAY_ERROR,this.eventEmitter)}},Ou=class{constructor(e,t,i){this.store=e,this.listener=t,this.audioListener=i}handleActiveSpeakers(e){var t,i,r;let n=e["speaker-list"],s=n.map(o=>({audioLevel:o.level,peer:this.store.getPeerById(o.peer_id),track:this.store.getTrackById(o.track_id)}));(t=this.audioListener)==null||t.onAudioLevelUpdate(s),this.store.updateSpeakers(s);let a=n[0];if(a){let o=this.store.getPeerById(a.peer_id);(i=this.listener)==null||i.onPeerUpdate(Qe.BECAME_DOMINANT_SPEAKER,o)}else(r=this.listener)==null||r.onPeerUpdate(Qe.RESIGNED_DOMINANT_SPEAKER,null)}},ve;(function(e){e.ROOM_STATE="room-state",e.PEER_JOIN="on-peer-join",e.PEER_LEAVE="on-peer-leave",e.PEER_LIST="peer-list",e.TRACK_METADATA_ADD="on-track-add",e.TRACK_UPDATE="on-track-update",e.CHANGE_TRACK_MUTE_STATE_UPDATE="on-change-track-mute-state-request",e.ACTIVE_SPEAKERS="active-speakers",e.CONNECTION_QUALITY="on-connection-quality-update",e.SFU_STATS="sfu-stats",e.ON_SFU_TRACK_LAYER_UPDATE="on-track-layer-update",e.BROADCAST="on-broadcast",e.ROLE_CHANGE="on-role-change",e.POLICY_CHANGE="on-policy-change",e.ROLE_CHANGE_REQUEST="on-role-change-request",e.TRACK_UPDATE_REQUEST="on-track-update-request",e.PEER_UPDATE="on-peer-update",e.PEER_LEAVE_REQUEST="on-peer-leave-request",e.UNSUPPORTED="unsupported",e.RTMP_START="on-rtmp-start",e.RTMP_STOP="on-rtmp-stop",e.RECORDING_START="on-record-start",e.RECORDING_STOP="on-record-stop",e.HLS_START="on-hls-start",e.HLS_STOP="on-hls-stop"})(ve||(ve={}));var Mu=class{constructor(e,t){this.store=e,this.listener=t}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t){e===ve.BROADCAST&&this.handleBroadcast(t)}handleBroadcast(e){var t;let i=e.peer,r=e.info,n=e.roles,s=this.getSender(i),a=e.private?this.store.getLocalPeer():void 0,o=[];if(n!=null&&n.length){let c=this.store.getKnownRoles();for(let u of n)c[u]&&o.push(c[u])}let l=new Oo(Ye(se({},r),{sender:s,recipientRoles:o,recipientPeer:a,time:new Date(e.timestamp)}));m.d(this.TAG,`Received Message from sender=${i==null?void 0:i.peer_id}: ${l}`),(t=this.listener)==null||t.onMessageReceived(l)}getSender(e){let t=e?this.store.getPeerById(e.peer_id):void 0;return!t&&e&&(t=new jn({peerId:e.peer_id,name:e.info.name,isLocal:!1,customerUserId:e.info.user_id,metadata:e.info.data})),t}},Lu=class{constructor(e){this.listener=e}handleQualityUpdate(e){var t;let i=e.peers.map(r=>({peerID:r.peer_id,downlinkQuality:r.downlink_score}));(t=this.listener)==null||t.onConnectionQualityUpdate(i)}},Nu=class{constructor(e,t,i,r){this.store=e,this.peerManager=t,this.trackManager=i,this.listener=r,this.handleInitialPeerList=n=>{let s=Object.values(n.peers);this.peerManager.handlePeerList(s)},this.handleReconnectPeerList=n=>{this.handleRepeatedPeerList(n.peers)},this.handlePreviewRoomState=n=>{if(!this.store.hasRoleDetailsArrived())return;let s=n.peers;if(s==null){n.peer_count===0&&this.handleRepeatedPeerList({});return}Object.keys(s).forEach(a=>{s[a].tracks={},s[a].is_from_room_state=!0}),this.handleRepeatedPeerList(s)},this.handleRepeatedPeerList=n=>{let s=this.store.getRemotePeers(),a=Object.values(n),o=s.filter(l=>!n[l.peerId]);m.d(this.TAG,`${o}`),o.forEach(l=>{var c;let u={peer_id:l.peerId,role:((c=l.role)==null?void 0:c.name)||"",info:{name:l.name,data:l.metadata||"",user_id:l.customerUserId||""},tracks:{}};this.peerManager.handlePeerLeave(u)}),a.forEach(l=>{let c=this.store.getPeerById(l.peer_id),u=Object.values(l.tracks);c?(this.store.getPeerTracks(c.peerId).forEach(d=>{var h;l.tracks[d.trackId]||(this.removePeerTrack(c,d.trackId),(h=this.listener)==null||h.onTrackUpdate(ke.TRACK_REMOVED,d,c))}),u.forEach(d=>{this.store.getTrackById(d.track_id)||this.store.setTrackState({peerId:c.peerId,trackInfo:d})}),this.trackManager.handleTrackUpdate({peer:{info:l.info,peer_id:l.peer_id},tracks:l.tracks}),this.peerManager.handlePeerUpdate(l)):this.peerManager.handlePeerJoin(l)})}}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t,i){if(e===ve.PEER_LIST){let r=t;i?(m.d(this.TAG,"RECONNECT_PEER_LIST event",JSON.stringify(r,null,2)),this.handleReconnectPeerList(r)):(m.d(this.TAG,"PEER_LIST event",JSON.stringify(r,null,2)),this.handleInitialPeerList(r))}else if(e===ve.ROOM_STATE){let r=t;this.handlePreviewRoomState(r)}}removePeerTrack(e,t){var i,r;if(((i=e.audioTrack)==null?void 0:i.trackId)===t)e.audioTrack=void 0;else if(((r=e.videoTrack)==null?void 0:r.trackId)===t)e.videoTrack=void 0;else{let n=e.auxiliaryTracks.findIndex(s=>s.trackId===t);n>=0&&e.auxiliaryTracks.splice(n,1)}}},Tt=e=>e?new Date(e):void 0,$u=class{constructor(e,t,i){this.store=e,this.trackManager=t,this.listener=i,this.handlePeerList=r=>{var n,s;if(r.length===0){(n=this.listener)==null||n.onPeerUpdate(Qe.PEER_LIST,[]);return}let a=[],o=new Set(r.map(l=>l.peer_id));this.store.getRemotePeers().forEach(({peerId:l,fromRoomState:c})=>{!o.has(l)&&c&&this.store.removePeer(l)});for(let l of r)a.push(this.makePeer(l));(s=this.listener)==null||s.onPeerUpdate(Qe.PEER_LIST,a),this.trackManager.processPendingTracks()},this.handlePeerJoin=r=>{var n;let s=this.makePeer(r);(n=this.listener)==null||n.onPeerUpdate(Qe.PEER_JOINED,s),this.trackManager.processPendingTracks()},this.handlePeerLeave=r=>{var n,s,a,o;let l=this.store.getPeerById(r.peer_id);this.store.removePeer(r.peer_id),m.d(this.TAG,"PEER_LEAVE",r.peer_id,`remainingPeers=${this.store.getPeers().length}`),l&&(l.audioTrack&&((n=this.listener)==null||n.onTrackUpdate(ke.TRACK_REMOVED,l.audioTrack,l)),l.videoTrack&&((s=this.listener)==null||s.onTrackUpdate(ke.TRACK_REMOVED,l.videoTrack,l)),(a=l.auxiliaryTracks)==null||a.forEach(c=>{var u;(u=this.listener)==null||u.onTrackUpdate(ke.TRACK_REMOVED,c,l)}),(o=this.listener)==null||o.onPeerUpdate(Qe.PEER_LEFT,l))}}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t){switch(e){case ve.PEER_JOIN:{let i=t;this.handlePeerJoin(i);break}case ve.PEER_LEAVE:{let i=t;this.handlePeerLeave(i);break}case ve.PEER_UPDATE:this.handlePeerUpdate(t);break}}handlePeerUpdate(e){var t;let i=this.store.getPeerById(e.peer_id);if(i){if(i.role&&i.role.name!==e.role){let r=this.store.getPolicyForRole(e.role);i.updateRole(r),(t=this.listener)==null||t.onPeerUpdate(Qe.ROLE_UPDATED,i)}this.handlePeerInfoUpdate(se({peer:i},e.info))}}handlePeerInfoUpdate({peer:e,name:t,data:i}){var r,n;!e||(t&&e.name!==t&&(e.updateName(t),(r=this.listener)==null||r.onPeerUpdate(Qe.NAME_UPDATED,e)),i&&e.metadata!==i&&(e.updateMetadata(i),(n=this.listener)==null||n.onPeerUpdate(Qe.METADATA_UPDATED,e)))}makePeer(e){let t=new Hc({peerId:e.peer_id,name:e.info.name,customerUserId:e.info.user_id,metadata:e.info.data,role:this.store.getPolicyForRole(e.role),joinedAt:Tt(e.joined_at),fromRoomState:!!e.is_from_room_state});this.store.addPeer(t),m.d(this.TAG,"adding to the peerList",t.toString());for(let i in e.tracks)this.store.setTrackState({peerId:e.peer_id,trackInfo:e.tracks[i]});return t}},xu=class{constructor(e,t){this.store=e,this.eventBus=t}handlePolicyChange(e){var t;let i=this.store.getLocalPeer();if(i&&!i.role){let n=e.known_roles[e.name];i.updateRole(n)}this.store.setKnownRoles(e.known_roles),this.store.getRoom().templateId=e.template_id;let r=(t=e.known_roles[e.name])==null?void 0:t.publishParams;if(this.store.setPublishParams(r),this.setSimulcastLayers(r),(i==null?void 0:i.role)&&i.role.name!==e.name){let n=this.store.getPolicyForRole(e.name),s=i.role;i.updateRole(n),this.eventBus.localRoleUpdate.publish({oldRole:s,newRole:n})}this.eventBus.policyChange.publish(e)}setSimulcastLayers(e){if(e&&Object.keys(e).length>0){let{videoSimulcastLayers:t,screenSimulcastLayers:i}=e;this.store.setVideoSimulcastLayers(t),this.store.setScreenshareSimulcastLayers(i)}}},Uu=class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){switch(e){case ve.ROLE_CHANGE_REQUEST:this.handleRoleChangeRequest(t);break;case ve.TRACK_UPDATE_REQUEST:this.handleTrackUpdateRequest(t);break;case ve.CHANGE_TRACK_MUTE_STATE_UPDATE:this.handleChangeTrackStateRequest(t);break;default:return}}handleRoleChangeRequest(e){var t;let i={requestedBy:e.requested_by?this.store.getPeerById(e.requested_by):void 0,role:this.store.getPolicyForRole(e.role),token:e.token};(t=this.listener)==null||t.onRoleChangeRequest(i)}handleTrackUpdateRequest(e){let{requested_by:t,track_id:i,mute:r}=e,n=t?this.store.getPeerById(t):void 0,s=this.store.getLocalPeerTracks().find(o=>o.publishedTrackId===i);if(!s)return;let a=()=>{var o;(o=this.listener)==null||o.onChangeTrackStateRequest({requestedBy:n,track:s,enabled:!r})};if(r){if(s.enabled===!r)return;s.setEnabled(!r).then(a)}else a()}handleChangeTrackStateRequest(e){var t;let{type:i,source:r,value:n,requested_by:s}=e,a=s?this.store.getPeerById(s):void 0,o=!n,l=this.getTracksToBeUpdated({type:i,source:r,enabled:o});if(l.length!==0)if(o)(t=this.listener)==null||t.onChangeMultiTrackStateRequest({requestedBy:a,tracks:l,type:i,source:r,enabled:!0});else{let c=[];for(let u of l)c.push(u.setEnabled(!1));Promise.all(c).then(()=>{var u;(u=this.listener)==null||u.onChangeMultiTrackStateRequest({requestedBy:a,tracks:l,enabled:!1})})}}getTracksToBeUpdated({type:e,source:t,enabled:i}){let r=this.store.getLocalPeerTracks();return e&&(r=r.filter(n=>n.type===e)),t&&(r=r.filter(n=>n.source===t)),r.filter(n=>n.enabled!==i)}},Fu=class{constructor(e,t){this.store=e,this.listener=t,this.TAG="RoomUpdateManager"}handleNotification(e,t){switch(e){case ve.PEER_LIST:this.onRoomState(t.room);break;case ve.RTMP_START:this.onRTMPStart(t);break;case ve.RTMP_STOP:this.onRTMPStop(t);break;case ve.RECORDING_START:this.onRecordingStart(t);break;case ve.RECORDING_STOP:this.onRecordingStop(t);break;case ve.ROOM_STATE:this.handlePreviewRoomState(t);break;default:this.onHLS(e,t);break}}handlePreviewRoomState(e){let{room:t}=e;this.onRoomState(t,e.peer_count)}onRoomState(e,t){var i,r,n;let{recording:s,streaming:a,session_id:o,started_at:l,name:c}=e,u=this.store.getRoom();u.peerCount=t,u.name=c,u.recording.server.running=!!(s!=null&&s.sfu.enabled),u.recording.browser.running=!!(s!=null&&s.browser.enabled),u.rtmp.running=!!((i=a==null?void 0:a.rtmp)!=null&&i.enabled),u.rtmp.startedAt=Tt((r=a==null?void 0:a.rtmp)==null?void 0:r.started_at),u.recording.server.startedAt=Tt(s==null?void 0:s.sfu.started_at),u.recording.browser.startedAt=Tt(s==null?void 0:s.browser.started_at),u.recording.hls=this.getPeerListHLSRecording(s),u.hls=this.convertHls(a==null?void 0:a.hls),u.sessionId=o,u.startedAt=Tt(l),(n=this.listener)==null||n.onRoomUpdate(ti.RECORDING_STATE_UPDATED,u)}onRTMPStart(e){var t;this.setRTMPStatus(!((t=e.error)!=null&&t.code),e)}onRTMPStop(e){this.setRTMPStatus(!1,e)}onRecordingStart(e){var t;this.setRecordingStatus(!((t=e.error)!=null&&t.code),e)}onRecordingStop(e){this.setRecordingStatus(!1,e)}onHLS(e,t){var i,r;if(![ve.HLS_START,ve.HLS_STOP].includes(e))return;let n=this.store.getRoom();t.enabled=e===ve.HLS_START&&!((i=t.error)!=null&&i.code),n.hls=this.convertHls(t),n.recording.hls=this.getHLSRecording(t),(r=this.listener)==null||r.onRoomUpdate(ti.HLS_STREAMING_STATE_UPDATED,n)}convertHls(e){var t;let i={running:!!(e!=null&&e.enabled),variants:[],error:this.toSdkError(e==null?void 0:e.error)};return(t=e==null?void 0:e.variants)==null||t.forEach(r=>{i.variants.push({meetingURL:r.meeting_url,url:r.url,metadata:r.metadata,startedAt:Tt(r.started_at)})}),i}getHLSRecording(e){var t,i,r;let n={running:!1};return e!=null&&e.hls_recording&&(n={running:!!(e!=null&&e.enabled),singleFilePerLayer:!!((t=e.hls_recording)!=null&&t.single_file_per_layer),hlsVod:!!((i=e.hls_recording)!=null&&i.hls_vod),startedAt:Tt((r=e==null?void 0:e.variants)==null?void 0:r[0].started_at),error:this.toSdkError(e.error)}),n}getPeerListHLSRecording(e){var t,i;let r=e==null?void 0:e.hls;return{running:!!(r!=null&&r.enabled),startedAt:Tt(r==null?void 0:r.started_at),singleFilePerLayer:!!((t=r==null?void 0:r.config)!=null&&t.single_file_per_layer),hlsVod:!!((i=r==null?void 0:r.config)!=null&&i.hls_vod)}}setRecordingStatus(e,t){var i;let r=this.store.getRoom(),n;t.type==="sfu"?(r.recording.server={running:e,startedAt:e?Tt(t.started_at):void 0,error:this.toSdkError(t.error)},n=ti.SERVER_RECORDING_STATE_UPDATED):(r.recording.browser={running:e,startedAt:e?Tt(t.started_at):void 0,error:this.toSdkError(t.error)},n=ti.BROWSER_RECORDING_STATE_UPDATED),(i=this.listener)==null||i.onRoomUpdate(n,r)}setRTMPStatus(e,t){var i;let r=this.store.getRoom();r.rtmp={running:e,startedAt:e?Tt(t.started_at):void 0,error:this.toSdkError(t.error)},(i=this.listener)==null||i.onRoomUpdate(ti.RTMP_STREAMING_STATE_UPDATED,r)}toSdkError(e){if(!(e!=null&&e.code))return;let t=e.message||"error in streaming/recording",i=new Q(e.code,"ServerErrors",F.NONE,t,t);return m.e(this.TAG,"error in streaming/recording",i),i}},Gu=class{constructor(e,t,i){this.store=e,this.eventBus=t,this.listener=i,this.tracksToProcess=new Map,this.handleTrackAdd=r=>{m.d(this.TAG,"ONTRACKADD",`${r}`),this.store.addTrack(r),this.tracksToProcess.set(r.trackId,r),this.processPendingTracks()},this.handleTrackRemove=r=>{var n;m.d(this.TAG,"ONTRACKREMOVE",`${r}`);let s=this.store.getTrackState(r.trackId);if(!s)return;r.type===xe.AUDIO&&this.eventBus.audioTrackRemoved.publish(r);let a=this.store.getPeerById(s.peerId);!a||(this.removePeerTracks(a,r),this.store.removeTrack(r.trackId),(n=this.listener)==null||n.onTrackUpdate(ke.TRACK_REMOVED,r,a))},this.handleTrackLayerUpdate=r=>{var n,s;for(let a in r.tracks){let o=r.tracks[a],l=this.store.getTrackById(a);if(!l)continue;let c=this.store.getPeerByTrackId(a);if(!!c&&l instanceof ai){let u=this.isTrackDegraded(o.expected_layer,o.current_layer);l.setLayerFromServer(o.current_layer,u),u?(n=this.listener)==null||n.onTrackUpdate(ke.TRACK_DEGRADED,l,c):(s=this.listener)==null||s.onTrackUpdate(ke.TRACK_RESTORED,l,c)}}},this.handleTrackUpdate=r=>{var n,s;let a=this.store.getPeerById(r.peer.peer_id);if(a)for(let o in r.tracks){let l=Object.assign({},(n=this.store.getTrackState(o))==null?void 0:n.trackInfo),c=r.tracks[o],u=this.store.getTrackById(o);if(this.store.setTrackState({peerId:r.peer.peer_id,trackInfo:se(se({},l),c)}),!u||this.tracksToProcess.has(o))this.processPendingTracks();else{u.setEnabled(!c.mute);let d=this.processTrackUpdate(u,l,c);d&&((s=this.listener)==null||s.onTrackUpdate(d,u,a))}}}}get TAG(){return`[${this.constructor.name}]`}isTrackDegraded(e,t){let i=r=>{switch(r){case ct.HIGH:return 3;case ct.MEDIUM:return 2;case ct.LOW:return 1;case ct.NONE:return 0}};return i(t)<i(e)}handleTrackMetadataAdd(e){m.d(this.TAG,"TRACK_METADATA_ADD",JSON.stringify(e,null,2));for(let t in e.tracks)this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:e.tracks[t]});this.processPendingTracks()}processPendingTracks(){new Map(this.tracksToProcess).forEach(e=>{var t;let i=this.store.getTrackState(e.trackId);if(!i)return;let r=this.store.getPeerById(i.peerId);!r||(e.source=i.trackInfo.source,e.peerId=r.peerId,e.logIdentifier=r.name,e.setEnabled(!i.trackInfo.mute),this.addAudioTrack(r,e),this.addVideoTrack(r,e),e.type===xe.AUDIO?this.eventBus.audioTrackAdded.publish({track:e,peer:r}):(t=this.listener)==null||t.onTrackUpdate(ke.TRACK_ADDED,e,r),this.tracksToProcess.delete(e.trackId))})}removePeerTracks(e,t){var i,r;let n=e.auxiliaryTracks.indexOf(t);n>-1?e.auxiliaryTracks.splice(n,1):t.type===xe.AUDIO&&((i=e.audioTrack)==null?void 0:i.trackId)===t.trackId?e.audioTrack=void 0:t.type===xe.VIDEO&&((r=e.videoTrack)==null?void 0:r.trackId)===t.trackId&&(e.videoTrack=void 0)}addAudioTrack(e,t){t.type===xe.AUDIO&&(!e.audioTrack&&t.source==="regular"?e.audioTrack=t:e.auxiliaryTracks.push(t))}addVideoTrack(e,t){if(t.type!==xe.VIDEO)return;let i=t,r=this.store.getSimulcastDefinitionsForPeer(e,i.source);i.setSimulcastDefinitons(r),!e.videoTrack&&t.source==="regular"?e.videoTrack=i:e.auxiliaryTracks.push(i)}processTrackUpdate(e,t,i){let r;return e.setEnabled(!i.mute),t.mute!==i.mute?(r=i.mute?ke.TRACK_MUTED:ke.TRACK_UNMUTED,e.type===xe.AUDIO&&this.eventBus.audioTrackUpdate.publish({track:e,enabled:!i.mute})):t.description!==i.description&&(r=ke.TRACK_DESCRIPTION_CHANGED),r}},Bu=class{constructor(e,t,i,r,n){this.store=e,this.listener=i,this.audioListener=r,this.connectionQualityListener=n,this.TAG="[HMSNotificationManager]",this.hasConsistentRoomStateArrived=!1,this.ignoreNotification=s=>{if(s===ve.PEER_LIST)this.hasConsistentRoomStateArrived=!0;else if(s===ve.ROOM_STATE)return this.hasConsistentRoomStateArrived;return!1},this.handleTrackAdd=s=>{this.trackManager.handleTrackAdd(s)},this.handleTrackRemove=s=>{this.trackManager.handleTrackRemove(s)},this.updateLocalPeer=({name:s,metadata:a})=>{let o=this.store.getLocalPeer();this.peerManager.handlePeerInfoUpdate({peer:o,name:s,data:a})},this.trackManager=new Gu(this.store,t,this.listener),this.peerManager=new $u(this.store,this.trackManager,this.listener),this.peerListManager=new Nu(this.store,this.peerManager,this.trackManager,this.listener),this.broadcastManager=new Mu(this.store,this.listener),this.policyChangeManager=new xu(this.store,t),this.requestManager=new Uu(this.store,this.listener),this.activeSpeakerManager=new Ou(this.store,this.listener,this.audioListener),this.connectionQualityManager=new Lu(this.connectionQualityListener),this.roomUpdateManager=new Fu(this.store,this.listener)}setListener(e){this.listener=e,this.trackManager.listener=e,this.peerManager.listener=e,this.peerListManager.listener=e,this.broadcastManager.listener=e,this.requestManager.listener=e,this.activeSpeakerManager.listener=e,this.roomUpdateManager.listener=e}setAudioListener(e){this.audioListener=e,this.activeSpeakerManager.audioListener=e}setConnectionQualityListener(e){this.connectionQualityListener=e,this.connectionQualityManager.listener=e}handleNotification(e,t=!1){var i,r;let n=e.method,s=e.params;[ve.ACTIVE_SPEAKERS,ve.SFU_STATS,ve.CONNECTION_QUALITY].includes(n)||m.d(this.TAG,`Received notification - ${n}`,{notification:s}),n===ve.SFU_STATS&&((i=window.HMS)==null?void 0:i.ON_SFU_STATS)&&typeof((r=window.HMS)==null?void 0:r.ON_SFU_STATS)=="function"&&window.HMS.ON_SFU_STATS(e.params),!this.ignoreNotification(n)&&(this.roomUpdateManager.handleNotification(n,s),this.peerManager.handleNotification(n,s),this.requestManager.handleNotification(n,s),this.peerListManager.handleNotification(n,s,t),this.broadcastManager.handleNotification(n,s),this.handleIsolatedMethods(n,s))}handleIsolatedMethods(e,t){switch(e){case ve.TRACK_METADATA_ADD:{this.trackManager.handleTrackMetadataAdd(t);break}case ve.TRACK_UPDATE:{this.trackManager.handleTrackUpdate(t);break}case ve.ON_SFU_TRACK_LAYER_UPDATE:{this.trackManager.handleTrackLayerUpdate(t);break}case ve.ACTIVE_SPEAKERS:this.activeSpeakerManager.handleActiveSpeakers(t);break;case ve.CONNECTION_QUALITY:this.connectionQualityManager.handleQualityUpdate(t);break;case ve.POLICY_CHANGE:this.policyChangeManager.handlePolicyChange(t);break}}},Js=class{constructor(e){this.type=e.type,this.source=e.source||"regular",this.description="",e instanceof Kn?(this.mute=!e.enabled,this.track_id=e.publishedTrackId,this.stream_id=e.stream.id):(this.mute=e.mute,this.track_id=e.track_id,this.stream_id=e.stream_id)}},Go=class{constructor(e){this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(e),this.source.connect(this.audioContext.destination)}resumeContext(){this.audioContext.state==="suspended"&&(m.d(this.TAG,"AudioContext is resumed"),this.audioContext.resume())}getAudioTrack(){return this.destinationNode&&this.source.disconnect(this.destinationNode),this.destinationNode=this.audioContext.createMediaStreamDestination(),this.source.connect(this.destinationNode),this.destinationNode.stream.getAudioTracks()[0]}cleanup(){this.audioContext.state!=="closed"&&this.audioContext.close()}get TAG(){return"AudioContextManager"}},Qn=class extends Mr.exports.EventEmitter2{on(e,t){return super.on(e,t)}off(e,t){return super.off(e,t)}emit(e,t){return super.emit(e,t)}listeners(e){return super.listeners(e)}},Vu=class extends Qn{constructor(){super(...arguments),this.audioElement=null,this.seeked=!1}play(e){return g(this,null,function*(){return this.audioElement=this.getAudioElement(),new Promise((t,i)=>{this.audioElement=this.getAudioElement(),this.audioElement.src=e,this.seeked=!1,this.audioElement.onerror=()=>{let r=`Error loading ${e}`;m.e(this.TAG,r),this.stop(),i(r)},this.audioElement.oncanplaythrough=()=>g(this,null,function*(){try{if(!this.audioElement)return;if(this.audioContextManager.resumeContext(),this.track)this.seeked?this.seeked=!1:(yield this.audioElement.play(),t([this.track]));else{yield this.audioElement.play();let r=this.audioContextManager.getAudioTrack();this.track=r,t([r])}}catch(r){m.e(this.TAG,"Error playing audio",e,r.message),i(r)}}),this.audioElement.onseeked=()=>{this.seeked=!0}})})}getTracks(){return this.track?[this.track.id]:[]}getElement(){return this.audioElement}stop(){var e,t,i;(e=this.audioElement)==null||e.pause(),(t=this.audioElement)==null||t.removeAttribute("src"),this.audioElement=null,(i=this.audioContextManager)==null||i.cleanup(),this.track=void 0}getAudioElement(){if(this.audioElement)return this.audioElement;let e=document.createElement("audio");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",t=>this.emit("progress",t)),e.addEventListener("ended",()=>{this.emit("ended",null)}),this.audioContextManager=new Go(e),e}get TAG(){return"PlaylistAudioManager"}},ju=class extends Qn{constructor(){super(...arguments),this.videoElement=null,this.canvasContext=null,this.tracks=[],this.DEFAUL_FPS=24,this.seeked=!1,this.drawImage=()=>{var e,t,i;this.videoElement&&!this.videoElement.paused&&!this.videoElement.ended&&((i=this.canvasContext)==null||i.drawImage(this.videoElement,0,0,(e=this.canvas)==null?void 0:e.width,(t=this.canvas)==null?void 0:t.height),this.timer=setTimeout(()=>{this.drawImage()},1e3/this.DEFAUL_FPS))}}play(e){return this.videoElement=this.getVideoElement(),this.createCanvas(),new Promise((t,i)=>{this.videoElement=this.getVideoElement(),this.videoElement.src=e,this.seeked=!1,this.videoElement.onerror=()=>{let r=`Error loading ${e}`;m.e(this.TAG,r),this.stop(),i(r)},this.videoElement.oncanplaythrough=()=>g(this,null,function*(){var r,n,s;try{if(!this.videoElement)return;if(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight,this.tracks.length===0){this.clearCanvasAndTracks();let a=this.canvas.captureStream();if(!a){m.e(this.TAG,"Browser does not support captureStream");return}this.videoElement.onplay=this.drawImage,this.audioContextManager.resumeContext(),yield this.videoElement.play();let o=this.audioContextManager.getAudioTrack();a.addTrack(o),a.getTracks().forEach(l=>{this.tracks.push(l)}),t(this.tracks)}else this.seeked?(this.seeked=!1,(s=this.canvasContext)==null||s.drawImage(this.videoElement,0,0,(r=this.canvas)==null?void 0:r.width,(n=this.canvas)==null?void 0:n.height)):(yield this.videoElement.play(),t(this.tracks))}catch(a){m.e(this.TAG,"Error playing video",e,a.message),i(a)}}),this.videoElement.onseeked=()=>{this.seeked=!0}})}getTracks(){return this.tracks.map(e=>e.id)}getElement(){return this.videoElement}stop(){var e,t,i;(e=this.videoElement)==null||e.pause(),(t=this.videoElement)==null||t.removeAttribute("src"),this.videoElement=null,(i=this.audioContextManager)==null||i.cleanup(),this.clearCanvasAndTracks()}clearCanvasAndTracks(){var e;this.tracks=[],(e=this.canvasContext)==null||e.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(this.timer)}getVideoElement(){if(this.videoElement)return this.videoElement;let e=document.createElement("video");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",t=>this.emit("progress",t)),e.addEventListener("ended",()=>{this.emit("ended",null)}),this.audioContextManager=new Go(e),e}createCanvas(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"))}get TAG(){return"PlaylistVideoManager"}},er={audio:{list:[],currentIndex:-1,isAutoplayOn:!0},video:{list:[],currentIndex:-1,isAutoplayOn:!0}},qu=class extends Qn{constructor(e,t){super(),this.sdk=e,this.eventBus=t,this.state={audio:se({},er.audio),video:se({},er.video)},this.TAG="[PlaylistManager]",this.handlePausePlaylist=i=>g(this,[i],function*({enabled:r,track:n}){var s;if(r)return;let a;n.source==="audioplaylist"&&(a=de.audio),n.source==="videoplaylist"&&(a=de.video),a&&((s=this.getElement(a))==null||s.pause())}),this.addTrack=(i,r)=>g(this,null,function*(){yield this.sdk.addTrack(i,r),m.d(this.TAG,"Playlist track added",kr(i))}),this.removeTrack=i=>g(this,null,function*(){yield this.sdk.removeTrack(i),m.d(this.TAG,"Playlist track removed",i)}),this.audioManager=new Vu,this.videoManager=new ju,this.addListeners()}getList(e=de.audio){return this.state[e].list}setList(e){if(!e||e.length===0){m.w(this.TAG,"Please pass in a list of HMSPlaylistItem's");return}e.forEach(t=>{this.state[t.type].list.includes(t)||this.state[t.type].list.push(t)})}clearList(e){return g(this,null,function*(){this.isPlaying(e)&&(yield this.stop(e)),this.state[e].list=[]})}removeItem(e,t){return g(this,null,function*(){let{list:i,currentIndex:r}=this.state[t],n=i.findIndex(s=>e===s.id);return n>-1?(r===n&&this.isPlaying(t)&&(yield this.stop(t)),i.splice(n,1),!0):!1})}seek(e,t=de.audio){let{currentIndex:i}=this.state[t];if(i===-1)throw B.PlaylistErrors.NoEntryToPlay(F.PLAYLIST,"No item is currently playing");let r=this.getElement(t);if(r){let n=Math.max(r.currentTime+e,0);r.currentTime=Math.min(n,r.duration)}}seekTo(e,t=de.audio){let{currentIndex:i}=this.state[t];if(i===-1)throw B.PlaylistErrors.NoEntryToPlay(F.PLAYLIST,"No item is currently playing");if(e<0)throw Error("value cannot be negative");let r=this.getElement(t);r&&(r.currentTime=Math.min(e,r.duration))}setVolume(e,t=de.audio){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");let i=this.getElement(t);i&&(i.volume=e*.01)}getVolume(e=de.audio){let t=this.getElement(e);return t?t.volume*100:0}getCurrentTime(e=de.audio){let t=this.getElement(e);return(t==null?void 0:t.currentTime)||0}getCurrentIndex(e=de.audio){return this.state[e].currentIndex}getCurrentProgress(e=de.audio){var t;let{list:i,currentIndex:r}=this.state[e],n=(t=i[r])==null?void 0:t.url,s=this.getElement(e);return!n||!s?0:Math.floor(100*(s.currentTime/s.duration))}getCurrentSelection(e=de.audio){let{list:t,currentIndex:i}=this.state[e];if(i!==-1)return t[i]}isPlaying(e=de.audio){let t=this.getElement(e);return!!t&&!t.paused}setIsAutoplayOn(e=de.audio,t){this.state[e].isAutoplayOn=t}getPlaybackRate(e=de.audio){let t=this.getElement(e);return t?t.playbackRate:1}setPlaybackRate(e=de.audio,t){if(t<.25||t>2)throw Error("Please pass a value between 0.25 and 2.0");let i=this.getElement(e);i&&(i.playbackRate=t)}setEnabled(e,t){return g(this,arguments,function*(i,{id:r,type:n=de.audio}){let s=this.state[n].list.findIndex(o=>o.id===r);if(!r||s===-1){m.w(this.TAG,"Pass a valid id");return}let a=this.state[n].list[s].url;i?yield this.play(a,n):yield this.pause(a,n),this.state[n].currentIndex=s,this.setDuration(n)})}playNext(){return g(this,arguments,function*(e=de.audio){let{list:t,currentIndex:i}=this.state[e];if(i>=t.length-1)throw B.PlaylistErrors.NoEntryToPlay(F.PLAYLIST,"Reached end of playlist");yield this.play(t[i+1].url,e),this.state[e].currentIndex=i+1,this.setDuration(e)})}playPrevious(){return g(this,arguments,function*(e=de.audio){let{list:t,currentIndex:i}=this.state[e];if(i<=0)throw B.PlaylistErrors.NoEntryToPlay(F.PLAYLIST,"Reached start of playlist");yield this.play(t[i-1].url,e),this.state[e].currentIndex=i-1,this.setDuration(e)})}stop(){return g(this,arguments,function*(e=de.audio){var t;let i=e===de.audio?this.audioManager:this.videoManager;(t=i.getElement())==null||t.pause(),yield this.removeTracks(e),i.stop(),this.state[e].currentIndex=-1})}cleanup(){this.state={audio:se({},er.audio),video:se({},er.video)},this.eventBus.localAudioEnabled.unsubscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.unsubscribe(this.handlePausePlaylist),this.audioManager.stop(),this.videoManager.stop()}onProgress(e){this.videoManager.on("progress",()=>{try{e({type:de.video,progress:this.getCurrentProgress(de.video)})}catch{m.e(this.TAG,"Error in onProgress callback")}}),this.audioManager.on("progress",()=>{try{e({type:de.audio,progress:this.getCurrentProgress(de.audio)})}catch{m.e(this.TAG,"Error in onProgress callback")}})}onNewTrackStart(e){this.on("newTrackStart",e)}onPlaylistEnded(e){this.on("playlistEnded",e)}onCurrentTrackEnded(e){this.on("currentTrackEnded",e)}getElement(e=de.audio){return e===de.audio?this.audioManager.getElement():this.videoManager.getElement()}removeTracks(){return g(this,arguments,function*(e=de.audio){let t=(e===de.audio?this.audioManager:this.videoManager).getTracks();for(let i of t)yield this.removeTrack(i)})}play(e){return g(this,arguments,function*(t,i=de.audio){let r=i===de.audio?this.audioManager:this.videoManager,n=r.getElement();if(this.isItemCurrentlyPlaying(t,i)){m.w(this.TAG,`The ${i} is currently playing`);return}if(n!=null&&n.src.includes(t))yield n.play();else{n==null||n.pause();let s=yield r.play(t);for(let a of s)yield this.addTrack(a,i===de.audio?"audioplaylist":"videoplaylist")}})}isItemCurrentlyPlaying(e,t){let i=this.getElement(t);return!!(i&&!i.paused&&i.src.includes(e))}setDuration(e=de.audio){let t=this.getElement(e),{list:i,currentIndex:r}=this.state[e];i[r]&&(i[r].duration=(t==null?void 0:t.duration)||0),this.emit("newTrackStart",i[r])}pause(e){return g(this,arguments,function*(t,i=de.audio){let r=this.getElement(i);r&&!r.paused&&r.src.includes(t)?(r.pause(),m.d(this.TAG,"paused url",t)):m.w(this.TAG,"The passed in url is not currently playing")})}addListeners(){this.audioManager.on("ended",()=>this.handleEnded(de.audio)),this.videoManager.on("ended",()=>this.handleEnded(de.video)),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist)}handleEnded(){return g(this,arguments,function*(e=de.audio){let{list:t,currentIndex:i,isAutoplayOn:r}=this.state[e];i===t.length-1?(yield this.stop(e),this.emit("playlistEnded",e)):r?this.playNext(e):yield this.pause(t[i].url,e),this.emit("currentTrackEnded",t[i])})}},Hu=class{constructor(e,t,i="",r="",n="https://prod-init.100ms.live/init",s=!1){this.authToken=e,this.peerId=t,this.peerName=i,this.data=r,this.endpoint=n,this.autoSubscribeVideo=s}},we;(function(e){e[e.ConnectFailed=0]="ConnectFailed",e[e.SignalDisconnect=1]="SignalDisconnect",e[e.JoinWSMessageFailed=2]="JoinWSMessageFailed",e[e.PublishIceConnectionFailed=3]="PublishIceConnectionFailed",e[e.SubscribeIceConnectionFailed=4]="SubscribeIceConnectionFailed"})(we||(we={}));var Ku={[0]:[],[1]:[],[2]:[1],[3]:[1],[4]:[1]},be;(function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Joined="Joined",e.Preview="Preview",e.Failed="Failed",e.Reconnecting="Reconnecting",e.Leaving="Leaving"})(be||(be={}));var Wu=class{constructor(e){this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i,e(t,i)})}},Ft="[RetryScheduler]",zu=class{constructor(e,t){this.onStateChange=e,this.sendEvent=t,this.inProgress=new Map,this.retryTaskIds=[]}schedule(e){return g(this,arguments,function*({category:t,error:i,task:r,originalState:n,maxFailedRetries:s=vn,changeState:a=!0}){yield this.scheduleTask({category:t,error:i,changeState:a,task:r,originalState:n,maxFailedRetries:s})})}reset(){this.retryTaskIds.forEach(e=>clearTimeout(e)),this.retryTaskIds=[],this.inProgress.clear()}scheduleTask(e){return g(this,arguments,function*({category:t,error:i,changeState:r,task:n,originalState:s,maxFailedRetries:a=vn,failedRetryCount:o=0}){if(m.d(Ft,"schedule: ",{category:we[t],error:i}),o===0){let h=this.inProgress.get(t);if(h){m.d(Ft,`schedule: Already a task for ${we[t]} scheduled, waiting for its completion`),yield h.promise;return}let f=new Wu((v,T)=>{});this.inProgress.set(t,f),this.sendEvent(i,t)}let l=!1,c=Ku[t];for(let h in c){let f=c[parseInt(h)];try{let v=this.inProgress.get(f);v&&(m.d(Ft,`schedule: Suspending retry task of ${we[t]}, waiting for ${we[f]} to recover`),yield v.promise,m.d(Ft,`schedule: Resuming retry task ${we[t]} as it's dependency ${we[f]} is recovered`))}catch{m.d(Ft,`schedule: Stopping retry task of ${we[t]} as it's dependency ${we[f]} failed to recover`),l=!0;break}}if(o>=a||l){if(i.description+=`. [${we[t]}] Could not recover after ${o} tries`,l&&(i.description+=` Could not recover all of it's required dependencies - [${c.map(h=>we[h]).toString()}]`),i.isTerminal=!0,this.inProgress.delete(t),this.sendEvent(i,t),this.reset(),r)this.onStateChange(be.Failed,i);else throw i;return}r&&this.onStateChange(be.Reconnecting,i);let u=this.getDelayForRetryCount(t,o);m.i(Ft,`schedule: [${we[t]}] [failedRetryCount=${o}] Scheduling retry task in ${u}ms`);let d;try{d=yield this.setTimeoutPromise(n,u)}catch(h){d=!1,m.w(Ft,`[${we[t]}] Un-caught exception ${h.name} in retry-task, initiating retry`,h)}if(d){let h=this.inProgress.get(t);this.inProgress.delete(t),h==null||h.resolve(o),r&&this.inProgress.size===0&&this.onStateChange(s),m.i(Ft,`schedule: [${we[t]}] [failedRetryCount=${o}] Recovered \u267B\uFE0F`)}else yield this.scheduleTask({category:t,error:i,changeState:r,task:n,originalState:s,maxFailedRetries:a,failedRetryCount:o+1})})}getBaseDelayForTask(e,t){return e===we.JoinWSMessageFailed?2:Math.pow(2,t)}getDelayForRetryCount(e,t){let i=this.getBaseDelayForTask(e,t),r=e===we.JoinWSMessageFailed?Math.random()*2:Math.random();return Math.round(Math.min(i+r,hu)*1e3)}setTimeoutPromise(e,t){return g(this,null,function*(){return new Promise((i,r)=>{let n=window.setTimeout(()=>g(this,null,function*(){try{let s=yield e();s&&this.retryTaskIds.splice(this.retryTaskIds.indexOf(n),1),i(s)}catch(s){r(s)}}),t);this.retryTaskIds.push(n)})})}},Ju=class extends zn{constructor(){super(Uo),this.localStorage=new Lr("hms-analytics"),this.localStorage.clear(),this.initLocalStorageQueue()}enqueue(e){super.enqueue(e),this.localStorage.set(this.storage)}dequeue(){let e=super.dequeue();return this.localStorage.set(this.storage),e}initLocalStorageQueue(){var e;(e=this.localStorage.get())==null||e.forEach(t=>{let i=new Je(t);super.enqueue(i)})}},Qu=class{constructor(){this.TAG="AnalyticsTransport"}sendEvent(e){try{this.sendSingleEvent(e),this.flushFailedEvents()}catch(t){m.w(this.TAG,"sendEvent failed",t)}}flushFailedEvents(e){var t;try{for(m.d(this.TAG,"Flushing failed events",this.failedEvents);this.failedEvents.size()>0;){let i=this.failedEvents.dequeue();i&&(((t=i.metadata)==null?void 0:t.peer.peer_id)===e||!i.metadata.peer.peer_id?this.sendSingleEvent(i):Pr.sendEvent(i))}}catch(i){m.w(this.TAG,"flushFailedEvents failed",i)}}sendSingleEvent(e){try{this.transportProvider.sendEvent(e),m.d(this.TAG,"Sent event",e.name,e)}catch(t){throw m.w(this.TAG,`${this.transportProvider.TAG}.sendEvent failed, adding to local storage events`,{event:e,error:t}),this.failedEvents.enqueue(e),t}}},Yu=class extends Qu{constructor(e){super(),this.transportProvider=e,this.failedEvents=new Ju}},gt;(function(e){e[e.Publish=0]="Publish",e[e.Subscribe=1]="Subscribe"})(gt||(gt={}));var Bo="VALIDATIONS";function oi(e){return e!=null}var Qs=()=>{if(!oi(RTCPeerConnection)){let e=B.GenericErrors.MissingRTCPeerConnection();throw m.e(Bo,e),e}},Ys=()=>{if(!oi(navigator.mediaDevices)){let e=B.GenericErrors.MissingMediaDevices();throw m.e(Bo,e),e}};function Zu(e,t){var i;let r=Io(e.sdp);if(!((i=r.origin)!=null&&i.username.startsWith("mozilla")))return e;let n=t?Array.from(t.values()):[];return r.media.forEach(s=>{var a,o,l;let c=(a=s.msid)==null?void 0:a.split(" ")[0],u=(o=n.find(d=>d.type===s.type&&d.stream_id===c))==null?void 0:o.track_id;u&&(s.msid=(l=s.msid)==null?void 0:l.replace(/\s(.+)/,` ${u}`))}),{type:e.type,sdp:wc(r)}}function Xu(e,t){var i;if(!(e!=null&&e.sdp)||!t)return;let r=Io(e.sdp).media.find(n=>oi(n.mid)&&parseInt(n.mid)===parseInt(t));return(i=r==null?void 0:r.msid)==null?void 0:i.split(" ")[1]}function ed(e){return e.sdp.includes("usedtx=1")?e:{type:e.type,sdp:e.sdp.replace("useinbandfec=1","useinbandfec=1;usedtx=1")}}var Gt="HMSConnection",Vo=class{constructor(e,t){this.candidates=new Array,this.role=e,this.signal=t}get iceConnectionState(){return this.nativeConnection.iceConnectionState}get connectionState(){return this.nativeConnection.connectionState}get action(){return this.role===gt.Publish?F.PUBLISH:F.SUBSCRIBE}addTransceiver(e,t){return this.nativeConnection.addTransceiver(e,t)}createOffer(e,t){return g(this,null,function*(){try{let i=yield this.nativeConnection.createOffer(t);return m.d(Gt,`[role=${this.role}] createOffer offer=${JSON.stringify(i,null,1)}`),ed(Zu(i,e))}catch(i){throw B.WebrtcErrors.CreateOfferFailed(this.action,i.message)}})}createAnswer(e=void 0){return g(this,null,function*(){try{let t=yield this.nativeConnection.createAnswer(e);return m.d(Gt,`[role=${this.role}] createAnswer answer=${JSON.stringify(t,null,1)}`),t}catch(t){throw B.WebrtcErrors.CreateAnswerFailed(this.action,t.message)}})}setLocalDescription(e){return g(this,null,function*(){try{m.d(Gt,`[role=${this.role}] setLocalDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setLocalDescription(e)}catch(t){throw B.WebrtcErrors.SetLocalDescriptionFailed(this.action,t.message)}})}setRemoteDescription(e){return g(this,null,function*(){try{m.d(Gt,`[role=${this.role}] setRemoteDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setRemoteDescription(e)}catch(t){throw B.WebrtcErrors.SetRemoteDescriptionFailed(this.action,t.message)}})}addIceCandidate(e){return g(this,null,function*(){m.d(Gt,`[role=${this.role}] addIceCandidate candidate=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.addIceCandidate(e)})}get remoteDescription(){return this.nativeConnection.remoteDescription}getSenders(){return this.nativeConnection.getSenders()}logSelectedIceCandidatePairs(){(this.role===gt.Publish?this.getSenders():this.getReceivers()).forEach(e=>{var t;let i=(t=e.track)==null?void 0:t.kind;try{if(e.transport){let r=e.transport.iceTransport,n=()=>{if(typeof r.getSelectedCandidatePair=="function"){let s=r.getSelectedCandidatePair();m.d(Gt,`${gt[this.role]} connection`,`selected ${i||"unknown"} candidate pair`,JSON.stringify(s,null,2))}};typeof r.onselectedcandidatepairchange=="function"&&(r.onselectedcandidatepairchange=n),n()}}catch(r){m.w(Gt,`Error in logging selected ice candidate pair for ${gt[this.role]} connection`,r)}})}removeTrack(e){this.nativeConnection.removeTrack(e)}setMaxBitrate(e,t){return g(this,null,function*(){let i=this.getSenders().find(r=>{var n;return((n=r==null?void 0:r.track)==null?void 0:n.id)===t.getTrackIDBeingSent()});if(i){let r=i.getParameters();r.encodings.length>0&&(r.encodings[0].maxBitrate=e*1e3),yield i.setParameters(r)}else m.w(Gt,`no sender found to setMaxBitrate for track - ${t.trackId}, sentTrackId - ${t.getTrackIDBeingSent()}`)})}getStats(){return g(this,null,function*(){return yield this.nativeConnection.getStats()})}close(){return g(this,null,function*(){this.nativeConnection.close()})}getReceivers(){return this.nativeConnection.getReceivers()}},td="HMSPublishConnection",id=class extends Vo{constructor(e,t,i,r){super(gt.Publish,e),this.observer=i,this.transport=r,this.nativeConnection=new RTCPeerConnection(t),this.nativeConnection.createDataChannel(xo,{protocol:"SCTP"}),this.nativeConnection.onicecandidate=({candidate:n})=>{n&&e.trickle(this.role,n)},this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)}}initAfterJoin(){this.nativeConnection.onnegotiationneeded=()=>g(this,null,function*(){m.d(td,"onnegotiationneeded"),yield this.observer.onRenegotiationNeeded()})}trackUpdate(e){this.transport.trackUpdate(e)}},rd=class{constructor(e,t,i=""){this.TAG="HMSDataChannel",this.nativeChannel=e,this.observer=t,this.metadata=i,e.onmessage=r=>{this.observer.onMessage(r.data)}}get id(){return this.nativeChannel.id}get label(){return this.nativeChannel.label}get readyState(){return this.nativeChannel.readyState}send(e){m.d(this.TAG,`[${this.metadata}] Sending [size=${e.length}] message=${e}`),this.nativeChannel.send(e)}close(){this.nativeChannel.close()}},nd=class extends Vo{constructor(e,t,i){super(gt.Subscribe,e),this.TAG="[HMSSubscribeConnection]",this.remoteStreams=new Map,this.pendingMessageQueue=[],this.handlePendingApiMessages=()=>{this.pendingMessageQueue.length>0&&(m.d(this.TAG,"Found pending message queue, sending messages"),this.pendingMessageQueue.forEach(r=>this.sendOverApiDataChannel(r)),this.pendingMessageQueue.length=0)},this.observer=i,this.nativeConnection=new RTCPeerConnection(t),this.initNativeConnectionCallbacks()}initNativeConnectionCallbacks(){this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)},this.nativeConnection.ondatachannel=e=>{e.channel.label===xo&&(this.apiChannel=new rd(e.channel,{onMessage:t=>{this.observer.onApiChannelMessage(t)}},`role=${this.role}`),e.channel.onopen=this.handlePendingApiMessages)},this.nativeConnection.onicecandidate=e=>{e.candidate!==null&&this.signal.trickle(this.role,e.candidate)},this.nativeConnection.ontrack=e=>{var t;let i=e.streams[0],r=i.id;if(!this.remoteStreams.has(r)){let l=new No(i,this);this.remoteStreams.set(r,l),i.onremovetrack=c=>{let u=l.tracks.findIndex(d=>d.nativeTrack.id===c.track.id);if(u>=0){let d=l.tracks[u];this.observer.onTrackRemove(d),l.tracks.splice(u,1),l.tracks.length===0&&this.remoteStreams.delete(r)}}}let n=this.remoteStreams.get(r),s=e.track.kind==="audio"?Jn:ai,a=new s(n,e.track),o=Xu(this.remoteDescription,(t=e.transceiver)==null?void 0:t.mid);o&&a.setSdpTrackId(o),n.tracks.push(a),this.observer.onTrackAdd(a)}}sendOverApiDataChannel(e){this.apiChannel&&this.apiChannel.readyState==="open"?this.apiChannel.send(e):(m.w(this.TAG,`API Data channel not ${this.apiChannel?"open":"present"}, queueing`,e),this.pendingMessageQueue.push(e))}close(){var e=t=>super[t];return g(this,null,function*(){var t;yield e("close").call(this),(t=this.apiChannel)==null||t.close()})}},sd=class{constructor(e,t){this.store=e,this.eventBus=t,this.TAG="[TrackDegradationController]",this.MAX_RECOVER_GRACE_PERIOD=120,this.recoverAttemptCount=0,this.packetsLost=0;let i=this.store.getSubscribeDegradationParams();this.PACKETS_LOST_THRESHOLD=i.packetLossThreshold,this.MIN_DEGRADE_GRACE_PERIOD=i.degradeGracePeriodSeconds,this.MIN_RECOVER_GRACE_PERIOD=i.recoverGracePeriodSeconds,this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD}get isAttemptingRecover(){return Boolean(this.recoveringTrack)}handleRtcStatsChange(e){let t=e>this.packetsLost+this.PACKETS_LOST_THRESHOLD;this.packetsLost=e,t?this.degrade():this.recover()}degrade(){if(this.degradeGracePeriod>0){this.degradeGracePeriod--;return}if(this.isAttemptingRecover)return this.cancelRecovery();m.d(this.TAG,"Packet loss increased, Degrading",{packetsLost:this.packetsLost}),this.degradeActiveTracksByHalf(),this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD}recover(){if(this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod>0){this.recoverGracePeriod--;return}this.recoveringTrack=this.getActiveTracks(!0).find(e=>e.degraded),this.recoveringTrack&&(m.d(this.TAG,"Packet lost stable, recovering track",this.recoveringTrack),this.recoveringTrack.setDegradedFromSdk(!1),this.eventBus.trackRestored.publish(this.recoveringTrack),this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD)}cleanUp(){this.eventBus.trackDegraded.removeAllListeners(),this.eventBus.trackRestored.removeAllListeners()}degradeActiveTracksByHalf(){let e=this.getActiveTracks(!1);if(!e.length)return;m.d(this.TAG,{activeTracks:[...e]});let t=Math.ceil(e.length/2);for(;t--;){let i=e.pop();i.setDegradedFromSdk(!0),this.eventBus.trackDegraded.publish(i)}}getActiveTracks(e){return this.store.getRemoteVideoTracks().filter(t=>t.hasSinks()&&(!t.degraded||e)).sort((t,i)=>{let r=this.store.getComparator().getTrackComparators();return-1*(r.screenShare(t,i)||r.rolePriority(t,i)||r.peerAudioLevel(t,i)||this.store.getComparator().stringComparator(t.trackId,i.trackId))}).slice(0)}cancelRecovery(){this.recoveringTrack&&(this.recoveringTrack.setDegradedFromSdk(!0),this.eventBus.trackDegraded.publish(this.recoveringTrack)),this.recoveringTrack=void 0,this.recoverAttemptCount++,this.recoverGracePeriod=this.getDelayForRecoverCount(this.recoverAttemptCount),this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,m.d(this.TAG,"Recover Attempt Failed",{count:this.recoverAttemptCount,delay:this.recoverGracePeriod})}getDelayForRecoverCount(e){let t=this.MIN_RECOVER_GRACE_PERIOD+this.MIN_RECOVER_GRACE_PERIOD*e;return Math.min(t,this.MAX_RECOVER_GRACE_PERIOD)}},ad=e=>{let t=e.stream instanceof Cr,i=t?"publish":"subscribe",r=t?e.getTrackBeingSent():e.nativeTrack;return{peerConnectionType:i,nativeTrack:r}},od=(e,t,i,r)=>g(void 0,null,function*(){var n;let{peerConnectionType:s,nativeTrack:a}=ad(t),o;try{o=yield(n=e[s])==null?void 0:n.call(e,a)}catch(d){m.w("[HMSWebrtcStats]","Error in getting track stats",t,a,d)}let l=ld(o),c=jo(s==="publish"?"bytesSent":"bytesReceived",l,r),u=yn("packetsLost",l,r);return l!=null&&l.remote&&Object.assign(l.remote,{packetsLostRate:yn("packetsLost",l.remote,r==null?void 0:r.remote)}),l&&Object.assign(l,{bitrate:c,packetsLostRate:u,peerId:t.peerId,peerName:i,codec:l.codec})}),ld=e=>{let t,i,r={};e==null||e.forEach(a=>{switch(a.type){case"inbound-rtp":t=a;break;case"outbound-rtp":t=a;break;case"remote-inbound-rtp":i=a;break;case"codec":r[a.id]=a.mimeType;break}});let n=t!=null&&t.codecId?r[t.codecId]:void 0,s;return n&&(s=n.substring(n.indexOf("/")+1)),t&&Object.assign(t,{remote:i,codec:s})},Zs=(e,t,i)=>{let r=cd(t),n=jo(e==="publish"?"bytesSent":"bytesReceived",r,i&&i[e]);return r&&Object.assign(r,{bitrate:n})},cd=e=>{let t;return e.forEach(i=>{i.type==="transport"&&(t=e.get(i.selectedCandidatePairId))}),t||e.forEach(i=>{i.type==="candidate-pair"&&i.selected&&(t=i)}),t},ud=e=>{let t={packetsLost:0,jitter:0};return e==null||e.forEach(i=>{i.packetsLost&&(t.packetsLost+=i.packetsLost),i.jitter>t.jitter&&(t.jitter=i.jitter)}),t},dd=(e,t)=>Array.from(new Set(e.concat(t))),jo=(e,t,i)=>yn(e,t,i)*8,yn=(e,t,i)=>{let r=t&&t[e],n=i?i[e]:null;return[t,i,oi(r),oi(n)].every(s=>!!s)?qo(r,n,t==null?void 0:t.timestamp,i==null?void 0:i.timestamp)*1e3:0},qo=(e,t,i,r)=>oi(e)&&oi(t)&&i&&r?(e-t)/(i-r):0,hd=class{constructor(e,t){this.getStats=e,this.store=t,this.TAG="[HMSWebrtcStats]",this.peerStats={},this.trackStats={};var i;this.localPeerID=(i=this.store.getLocalPeer())==null?void 0:i.peerId}getLocalPeerStats(){return this.peerStats[this.localPeerID]}getTrackStats(e){return this.trackStats[e]}updateStats(){return g(this,null,function*(){yield this.updateLocalPeerStats(),yield this.updateTrackStats()})}updateLocalPeerStats(){return g(this,null,function*(){var e,t,i,r,n,s;let a=this.getLocalPeerStats(),o;try{o=yield(t=(e=this.getStats).publish)==null?void 0:t.call(e)}catch(T){m.w(this.TAG,"Error in getting publish stats",T)}let l=o&&Zs("publish",o,a),c;try{c=yield(r=(i=this.getStats).subscribe)==null?void 0:r.call(i)}catch(T){m.w(this.TAG,"Error in getting subscribe stats",T)}let u=c&&Zs("subscribe",c,a),{packetsLost:d,jitter:h}=ud(c),f=qo(d,(n=a==null?void 0:a.subscribe)==null?void 0:n.packetsLost,u==null?void 0:u.timestamp,(s=a==null?void 0:a.subscribe)==null?void 0:s.timestamp),v=u&&Object.assign(u,{packetsLostRate:f,jitter:h,packetsLost:d});this.peerStats[this.localPeerID]={publish:l,subscribe:v}})}updateTrackStats(){return g(this,null,function*(){var e;let t=this.store.getTracksMap(),i=dd(Object.keys(this.trackStats),Object.keys(t));for(let r of i){let n=t[r];if(n){let s=n.peerId&&((e=this.store.getPeerById(n.peerId))==null?void 0:e.name),a=this.getTrackStats(n.trackId),o=yield od(this.getStats,n,s,a);o&&(this.trackStats[r]=o)}else delete this.trackStats[r]}})}},pd=class{constructor(e,t,i,r){this.store=e,this.eventBus=t,this.publishConnection=i,this.subscribeConnection=r,this.TAG="[HMSWebrtcInternals]",this.interval=vu,this.isMonitored=!1,this.handleStatsUpdate=()=>g(this,null,function*(){var n;yield(n=this.hmsStats)==null?void 0:n.updateStats(),this.eventBus.statsUpdate.publish(this.hmsStats)})}getPublishPeerConnection(){return this.publishConnection}getSubscribePeerConnection(){return this.subscribeConnection}getCurrentStats(){return this.hmsStats}onStatsChange(e){return this.eventBus.statsUpdate.subscribe(e),()=>{this.eventBus.statsUpdate.unsubscribe(e)}}setPeerConnections({publish:e,subscribe:t}){var i,r;this.publishConnection=e,this.subscribeConnection=t,this.hmsStats=new hd({publish:(i=this.publishConnection)==null?void 0:i.getStats.bind(this.publishConnection),subscribe:(r=this.subscribeConnection)==null?void 0:r.getStats.bind(this.subscribeConnection)},this.store)}start(){return g(this,null,function*(){if(this.isMonitored){m.d(this.TAG,"Already started");return}this.stop(),this.isMonitored=!0,m.d(this.TAG,"Starting Webrtc Stats Monitor"),this.startLoop().then(()=>m.d(this.TAG,"Stopping Webrtc Stats Monitor")).catch(e=>m.e(this.TAG,e.message))})}stop(){this.isMonitored=!1}startLoop(){return g(this,null,function*(){for(;this.isMonitored;)yield this.handleStatsUpdate(),yield Ht(this.interval)})}cleanUp(){this.stop(),this.eventBus.statsUpdate.removeAllListeners()}},Tn="InitService",fd=class{static handleError(e,t){switch(e.status){case 404:throw B.InitAPIErrors.EndpointUnreachable(F.INIT,t.message||e.statusText);case 200:break;default:throw B.InitAPIErrors.ServerErrors(t.code||e.status,F.INIT,t.message||(e==null?void 0:e.statusText))}}static fetchInitConfig(e){return g(this,arguments,function*({token:t,peerId:i,userAgent:r,initEndpoint:n="https://prod-init.100ms.live",region:s=""}){m.d(Tn,`fetchInitConfig: initEndpoint=${n} token=${t} peerId=${i} region=${s} `);let a=md(n,i,r,s);try{let o=yield fetch(a,{headers:{Authorization:`Bearer ${t}`}}),l=yield o.json();return this.handleError(o,l),m.d(Tn,`config is ${JSON.stringify(l,null,2)}`),gd(l)}catch(o){let l=o;throw["Failed to fetch","NetworkError"].some(c=>l.message.includes(c))?B.InitAPIErrors.EndpointUnreachable(F.INIT,l.message):l}})}};function md(e,t,i,r){try{let n=new URL("/init",e);return r&&r.trim().length>0&&n.searchParams.set("region",r.trim()),n.searchParams.set("peer_id",t),n.searchParams.set("user_agent_v2",i),n.toString()}catch(n){let s=n;throw m.e(Tn,s.name,s.message),s}}function gd(e){var t;return Ye(se({},e),{rtcConfiguration:Ye(se({},e.rtcConfiguration),{iceServers:(t=e.rtcConfiguration)==null?void 0:t.ice_servers})})}var $i;(function(e){e.FLAG_SERVER_SUB_DEGRADATION="subscribeDegradation",e.FLAG_SERVER_SIMULCAST="simulcast",e.FLAG_NON_WEBRTC_DISABLE_OFFER="nonWebRTCDisableOffer"})($i||($i={}));var Te;(function(e){e.JOIN="join",e.OFFER="offer",e.ANSWER="answer",e.TRICKLE="trickle",e.TRACK_UPDATE="track-update",e.BROADCAST="broadcast",e.ANALYTICS="analytics",e.SERVER_ERROR="on-error",e.SERVER_WARNING="on-warning",e.SDK_NOTIFICATION="sdk-notification",e.LEAVE="leave",e.END_ROOM="end-room",e.PING="ping",e.ROLE_CHANGE_REQUEST="role-change-request",e.ROLE_CHANGE="role-change",e.TRACK_UPDATE_REQUEST="track-update-request",e.PEER_LEAVE_REQUEST="peer-leave-request",e.CHANGE_TRACK_MUTE_STATE_REQUEST="change-track-mute-state-request",e.START_RTMP_OR_RECORDING_REQUEST="rtmp-start",e.STOP_RTMP_AND_RECORDING_REQUEST="rtmp-stop",e.UPDATE_PEER_METADATA="peer-update",e.START_HLS_STREAMING="hls-start",e.STOP_HLS_STREAMING="hls-stop",e.HLS_TIMED_METADATA="hls-timed-metadata",e.SET_METADATA="set-metadata",e.GET_METADATA="get-metadata"})(Te||(Te={}));function vd(e){switch(e){case Te.JOIN:return F.JOIN;case Te.OFFER:return F.PUBLISH;case Te.ANSWER:return F.SUBSCRIBE;case Te.TRACK_UPDATE:return F.TRACK;default:return F.NONE}}var yd=class{constructor(e){this.TAG="[SIGNAL]: ",this.pongResponseTimes=new zn(mu),this.isJoinCompleted=!1,this.pendingTrickle=[],this.socket=null,this.callbacks=new Map,this._isConnected=!1,this.id=0,this.onCloseHandler=()=>{},this.offlineListener=()=>{m.d(this.TAG,"Window network offline"),this.setIsConnected(!1,"Window network offline")},this.onlineListener=()=>{m.d(this.TAG,"Window network online"),this.observer.onNetworkOnline()},this.observer=e,window.addEventListener("offline",this.offlineListener),window.addEventListener("online",this.onlineListener),this.onMessageHandler=this.onMessageHandler.bind(this)}get isConnected(){return this._isConnected}setIsConnected(e,t=""){m.d(this.TAG,`isConnected set id: ${this.id}, oldValue: ${this._isConnected}, newValue: ${e}`),this._isConnected!==e&&(this._isConnected&&!e?(this._isConnected=e,this.observer.onOffline(t)):!this._isConnected&&e&&(this._isConnected=e,this.observer.onOnline()))}getPongResponseTimes(){return this.pongResponseTimes.toList()}internalCall(e,t){return g(this,null,function*(){var i;let r=ki(),n={method:e,params:t,id:r,jsonrpc:"2.0"};(i=this.socket)==null||i.send(JSON.stringify(n));try{return yield new Promise((s,a)=>{this.callbacks.set(r,{resolve:s,reject:a})})}catch(s){let a=s;throw B.WebsocketMethodErrors.ServerErrors(Number(a.code),vd(e),a.message)}})}notify(e,t){var i;let r={method:e,params:t};(i=this.socket)==null||i.send(JSON.stringify(r))}open(e){return new Promise((t,i)=>{let r=!1;this.socket&&(this.socket.close(),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)),this.socket=new WebSocket(e);let n=a=>{m.e(this.TAG,"Error from websocket",a),r=!0,i(B.WebSocketConnectionErrors.FailedToConnect(F.JOIN,`Error opening websocket connection - ${a}`))};this.onCloseHandler=a=>{m.e(`Websocket closed code=${a.code}`),r?this.setIsConnected(!1,`code: ${a.code}${a.code!==1e3?", unexpected websocket close":""}`):(r=!0,i(B.WebSocketConnectionErrors.AbnormalClose(F.JOIN,`Error opening websocket connection - websocket closed unexpectedly with code=${a.code}`)))},this.socket.addEventListener("error",n);let s=()=>{var a,o;r=!0,t(),this.setIsConnected(!0),this.id++,(a=this.socket)==null||a.removeEventListener("open",s),(o=this.socket)==null||o.removeEventListener("error",n),this.pingPongLoop(this.id)};this.socket.addEventListener("open",s),this.socket.addEventListener("close",this.onCloseHandler),this.socket.addEventListener("message",this.onMessageHandler)})}close(){return g(this,null,function*(){window.removeEventListener("offline",this.offlineListener),window.removeEventListener("online",this.onlineListener),this.socket?(this.socket.close(1e3,"Normal Close"),this.setIsConnected(!1,"code: 1000, normal websocket close"),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)):this.setIsConnected(!1,"websocket not connected yet")})}join(e,t,i,r,n){return g(this,null,function*(){if(!this.isConnected)throw B.WebSocketConnectionErrors.WebSocketConnectionLost(F.JOIN,"Failed to send join over WS connection");let s={name:e,disableVidAutoSub:i,data:t,offer:n,server_sub_degrade:r},a=yield this.internalCall(Te.JOIN,s);return this.isJoinCompleted=!0,this.pendingTrickle.forEach(({target:o,candidate:l})=>this.trickle(o,l)),this.pendingTrickle.length=0,m.d(this.TAG,`join: response=${JSON.stringify(a,null,1)}`),a})}trickle(e,t){this.isJoinCompleted?this.notify(Te.TRICKLE,{target:e,candidate:t}):this.pendingTrickle.push({target:e,candidate:t})}offer(e,t){return g(this,null,function*(){return yield this.call(Te.OFFER,{desc:e,tracks:Object.fromEntries(t)})})}answer(e){this.notify(Te.ANSWER,{desc:e})}trackUpdate(e){this.notify(Te.TRACK_UPDATE,{version:"1.0",tracks:Object.fromEntries(e)})}broadcast(e){return g(this,null,function*(){return yield this.call(Te.BROADCAST,se({version:"1.0"},e.toSignalParams()))})}leave(){this.notify(Te.LEAVE,{version:"1.0"})}endRoom(e,t){return g(this,null,function*(){yield this.call(Te.END_ROOM,{lock:e,reason:t})})}sendEvent(e){if(!this.isConnected)throw Error(`${this.TAG} not connected. Could not send event ${e}`);this.notify(Te.ANALYTICS,e.toSignalParams())}ping(e){let t=Date.now(),i=new Promise(n=>{setTimeout(()=>{n(Date.now()-t)},e+1)}),r=this.internalCall(Te.PING,{timestamp:t}).then(()=>Date.now()-t).catch(()=>Date.now()-t);return Promise.race([i,r])}requestRoleChange(e){return g(this,null,function*(){yield this.call(Te.ROLE_CHANGE_REQUEST,e)})}acceptRoleChangeRequest(e){return g(this,null,function*(){yield this.call(Te.ROLE_CHANGE,e)})}requestTrackStateChange(e){return g(this,null,function*(){yield this.call(Te.TRACK_UPDATE_REQUEST,e)})}requestMultiTrackStateChange(e){return g(this,null,function*(){yield this.call(Te.CHANGE_TRACK_MUTE_STATE_REQUEST,e)})}removePeer(e){return g(this,null,function*(){yield this.call(Te.PEER_LEAVE_REQUEST,e)})}startRTMPOrRecording(e){return g(this,null,function*(){yield this.call(Te.START_RTMP_OR_RECORDING_REQUEST,se({version:"1.0"},e))})}stopRTMPAndRecording(){return g(this,null,function*(){yield this.call(Te.STOP_RTMP_AND_RECORDING_REQUEST,{version:"1.0"})})}startHLSStreaming(e){return g(this,null,function*(){yield this.call(Te.START_HLS_STREAMING,se({version:"1.0"},e))})}stopHLSStreaming(e){return g(this,null,function*(){yield this.call(Te.STOP_HLS_STREAMING,se({version:"1.0"},e))})}sendHLSTimedMetadata(e){return g(this,null,function*(){yield this.call(Te.HLS_TIMED_METADATA,se({version:"1.0"},e))})}updatePeer(e){return g(this,null,function*(){yield this.call(Te.UPDATE_PEER_METADATA,se({version:"1.0"},e))})}setSessionMetadata(e){return g(this,null,function*(){yield this.call(Te.SET_METADATA,se({version:"1.0"},e))})}getSessionMetadata(){return this.call(Te.GET_METADATA,{version:"1.0"})}onMessageHandler(e){let t=e.data,i=JSON.parse(t);if(i.id)this.handleResponseWithId(i);else if(i.method)this.handleResponseWithMethod(i);else throw Error(`WebSocket message has no 'method' or 'id' field, message=${i}`)}handleResponseWithId(e){let t=e,i=t.id;if(this.callbacks.has(i)){let r=this.callbacks.get(i);this.callbacks.delete(i),t.result?r.resolve(t.result):r.reject(t.error)}else this.observer.onNotification(t)}handleResponseWithMethod(e){switch(e.method){case Te.OFFER:this.observer.onOffer(e.params);break;case Te.TRICKLE:this.observer.onTrickle(e.params);break;case Te.SERVER_ERROR:this.observer.onServerError(B.WebsocketMethodErrors.ServerErrors(Number(e.params.code),F.NONE,e.params.message));break;case Te.SERVER_WARNING:m.w(this.TAG,e.params);break;default:this.observer.onNotification(e);break}}pingPongLoop(e){return g(this,null,function*(){var t,i;let r=((t=window.HMS)==null?void 0:t.PING_TIMEOUT)||pu;if(this.isConnected){let n=yield this.ping(r);this.pongResponseTimes.enqueue(n),n>r?(m.d(this.TAG,`Pong timeout ${e}, pageHidden=${Fc()}`),this.id===e&&this.setIsConnected(!1,"ping pong failure")):setTimeout(()=>this.pingPongLoop(e),((i=window.HMS)==null?void 0:i.PING_INTERVAL)||fu)}})}call(e,t){return g(this,null,function*(){let i=3,r=B.WebsocketMethodErrors.ServerErrors(500,e,`Default ${e} error`);for(let n=0;n<i;n++)try{return m.d(this.TAG,`Try number ${n+1} sending ${e}`,t),yield this.internalCall(e,t)}catch(s){if(r=s,m.e(this.TAG,`Failed sending ${e}`,{method:e,try:n+1,params:t,error:r}),!(parseInt(`${r.code/100}`)===5||r.code===429))break;let a=(2+Math.random()*2)*1e3;yield Ht(a)}throw m.e(`Sending ${e} over WS failed after ${i} retries`,{method:e,params:t,error:r}),r})}},Td=()=>{if(!_i||typeof navigator.connection>"u")return;let e=navigator.connection;return{downlink:e.downlink,downlinkMax:e.downlinkMax,effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,type:e.type}},oe="[HMSTransport]:",bd=class{constructor(e,t,i,r,n,s){this.observer=e,this.deviceManager=t,this.store=i,this.eventBus=r,this.analyticsEventsService=n,this.analyticsTimer=s,this.state=be.Disconnected,this.trackStates=new Map,this.publishConnection=null,this.subscribeConnection=null,this.maxSubscribeBitrate=0,this.joinRetryCount=0,this.callbacks=new Map,this.signalObserver={onOffer:c=>g(this,null,function*(){try{if(!this.subscribeConnection)return;yield this.subscribeConnection.setRemoteDescription(c),m.d(oe,`[SUBSCRIBE] Adding ${this.subscribeConnection.candidates.length} ice-candidates`,this.subscribeConnection.candidates);for(let d of this.subscribeConnection.candidates)yield this.subscribeConnection.addIceCandidate(d);this.subscribeConnection.candidates.length=0;let u=yield this.subscribeConnection.createAnswer();yield this.subscribeConnection.setLocalDescription(u),this.signal.answer(u),m.d(oe,"[role=SUBSCRIBE] onOffer renegotiation DONE \u2705")}catch(u){m.d(oe,"[role=SUBSCRIBE] onOffer renegotiation FAILED \u274C"),this.state=be.Failed;let d;throw u instanceof Q?d=u:d=B.GenericErrors.Unknown(F.PUBLISH,u.message),this.eventBus.analytics.publish(Ae.subscribeFail(d)),d}}),onTrickle:c=>g(this,null,function*(){let u=c.target===gt.Publish?this.publishConnection:this.subscribeConnection;u!=null&&u.remoteDescription?yield u.addIceCandidate(c.candidate):u==null||u.candidates.push(c.candidate)}),onNotification:c=>this.observer.onNotification(c),onServerError:c=>g(this,null,function*(){yield this.observer.onStateChange(be.Failed,c)}),onFailure:c=>{this.joinParameters&&this.retryScheduler.schedule({category:we.SignalDisconnect,error:c,task:this.retrySignalDisconnectTask,originalState:this.state})},onOffline:c=>g(this,null,function*(){m.d(oe,"socket offline",be[this.state]);try{this.state!==be.Leaving&&this.joinParameters&&this.retryScheduler.schedule({category:we.SignalDisconnect,error:B.WebSocketConnectionErrors.WebSocketConnectionLost(F.RECONNECT_SIGNAL,c),task:this.retrySignalDisconnectTask,originalState:this.state})}catch(u){console.error(u)}}),onOnline:()=>{var c;m.d(oe,"socket online",be[this.state]),this.analyticsSignalTransport.flushFailedEvents((c=this.store.getLocalPeer())==null?void 0:c.peerId)},onNetworkOnline:()=>{this.analyticsEventsService.flushFailedClientEvents()}},this.signal=new yd(this.signalObserver),this.analyticsSignalTransport=new Yu(this.signal),this.publishConnectionObserver={onRenegotiationNeeded:()=>g(this,null,function*(){yield this.performPublishRenegotiation()}),onIceConnectionChange:c=>g(this,null,function*(){(c==="disconnected"?m.w.bind(m):m.d.bind(m))(oe,`Publish ice connection state change: ${c}`)}),onConnectionStateChange:c=>g(this,null,function*(){var u;(c==="disconnected"?m.w.bind(m):m.d.bind(m))(oe,`Publish connection state change: ${c}`),c==="connected"&&((u=this.publishConnection)==null||u.logSelectedIceCandidatePairs()),c==="failed"&&(yield this.handleIceConnectionFailure(gt.Publish))})},this.subscribeConnectionObserver={onApiChannelMessage:c=>{this.observer.onNotification(JSON.parse(c))},onTrackAdd:c=>{m.d(oe,"[Subscribe] onTrackAdd",kr(c.nativeTrack)),this.observer.onTrackAdd(c)},onTrackRemove:c=>{m.d(oe,"[Subscribe] onTrackRemove",kr(c.nativeTrack)),this.observer.onTrackRemove(c)},onIceConnectionChange:c=>g(this,null,function*(){if((c==="disconnected"?m.w.bind(m):m.d.bind(m))(oe,`Subscribe ice connection state change: ${c}`),c==="connected"){let u=this.callbacks.get(Ii);this.callbacks.delete(Ii),u&&u.promise.resolve(!0)}}),onConnectionStateChange:c=>g(this,null,function*(){var u;if((c==="disconnected"?m.w.bind(m):m.d.bind(m))(oe,`Subscribe connection state change: ${c}`),c==="failed"&&(yield this.handleIceConnectionFailure(gt.Subscribe)),c==="connected"){(u=this.subscribeConnection)==null||u.logSelectedIceCandidatePairs();let d=this.callbacks.get(Ii);this.callbacks.delete(Ii),d&&d.promise.resolve(!0)}})},this.handleLocalRoleUpdate=c=>g(this,[c],function*({oldRole:u,newRole:d}){!(!this.doesRoleNeedWebRTC(u)&&this.doesRoleNeedWebRTC(d))||(m.i(oe,"Local peer role updated to webrtc role, creating PeerConnections and performing inital publish negotiation \u23F3"),this.createPeerConnections(),yield this.negotiateOnFirstPublish())}),this.retryPublishIceFailedTask=()=>g(this,null,function*(){if(this.publishConnection&&(this.publishConnection.iceConnectionState!=="connected"||this.publishConnection.connectionState!=="connected")){let c=new Promise((u,d)=>{this.callbacks.set(Ai,{promise:{resolve:u,reject:d},action:F.RESTART_ICE,extra:{}})});yield this.performPublishRenegotiation({iceRestart:!0}),yield c}return!0}),this.retrySubscribeIceFailedTask=()=>g(this,null,function*(){if(this.subscribeConnection&&(this.subscribeConnection.iceConnectionState!=="connected"||this.subscribeConnection.connectionState!=="connected")){let c=new Promise((d,h)=>{this.callbacks.set(Ii,{promise:{resolve:d,reject:h},action:F.RESTART_ICE,extra:{}})}),u=new Promise(d=>{setTimeout(d,gu,!1)});return Promise.race([c,u])}return!0}),this.retrySignalDisconnectTask=()=>g(this,null,function*(){if(m.d(oe,"retrySignalDisconnectTask",{signalConnected:this.signal.isConnected}),!this.signal.isConnected)try{yield this.internalConnect(this.joinParameters.authToken,this.joinParameters.endpoint,this.joinParameters.peerId)}catch{}let c=this.store.getRoom().joinedAt?this.signal.isConnected&&(yield this.retryPublishIceFailedTask()):this.signal.isConnected;return this.signal.trackUpdate(this.trackStates),c});var a,o;this.webrtcInternals=new pd(this.store,this.eventBus,(a=this.publishConnection)==null?void 0:a.nativeConnection,(o=this.subscribeConnection)==null?void 0:o.nativeConnection);let l=(c,u)=>g(this,null,function*(){c!==this.state&&(this.state=c,yield this.observer.onStateChange(this.state,u))});this.retryScheduler=new zu(l,this.sendErrorAnalyticsEvent.bind(this)),this.eventBus.statsUpdate.subscribe(c=>{var u,d;let h=((d=(u=c.getLocalPeerStats())==null?void 0:u.subscribe)==null?void 0:d.bitrate)||0;this.maxSubscribeBitrate=Math.max(this.maxSubscribeBitrate,h)})}getWebrtcInternals(){return this.webrtcInternals}isFlagEnabled(e){var t;let i=(t=this.initConfig)==null?void 0:t.config;return((i==null?void 0:i.enabledFlags)||[]).includes(e)}preview(e,t,i,r,n=!1){return g(this,null,function*(){let s=yield this.connect(e,t,i,r,n);return this.state=be.Preview,this.observer.onStateChange(this.state),s})}join(e,t,i,r,n=!1){return g(this,null,function*(){m.d(oe,"join: started \u23F0");try{(!this.signal.isConnected||!this.initConfig)&&(yield this.connect(e,r,t,i,n)),this.validateNotDisconnected("connect");let s=this.isFlagEnabled($i.FLAG_SERVER_SUB_DEGRADATION);this.initConfig&&(yield this.waitForLocalRoleAvailability(),yield this.createConnectionsAndNegotiateJoin(i,n,s),yield this.initRtcStatsMonitor(),m.d(oe,"\u2705 join: Negotiated over PUBLISH connection"))}catch(s){m.e(oe,`join: failed \u274C [token=${e}]`,s),this.state=be.Failed;let a=s;throw a.isTerminal=a.isTerminal||a.code===500,yield this.observer.onStateChange(this.state,a),a}m.i(oe,"\u2705 join: successful"),this.state=be.Joined,this.observer.onStateChange(this.state)})}connect(e,t,i,r,n=!1){return g(this,null,function*(){this.setTransportStateForConnect(),this.joinParameters=new Hu(e,i,r.name,r.metaData,t,n);try{return yield this.internalConnect(e,t,i)}catch(s){if(s instanceof Q&&([ne.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,ne.WebSocketConnectionErrors.FAILED_TO_CONNECT,ne.WebSocketConnectionErrors.ABNORMAL_CLOSE,ne.InitAPIErrors.ENDPOINT_UNREACHABLE].includes(s.code)||s.code.toString().startsWith("5")||s.code.toString().startsWith("429"))){let a=()=>g(this,null,function*(){return yield this.internalConnect(e,t,i),Boolean(this.initConfig&&this.initConfig.endpoint)});yield this.retryScheduler.schedule({category:we.ConnectFailed,error:s,task:a,originalState:this.state,maxFailedRetries:vn,changeState:!1})}else throw s}})}leave(e){return g(this,null,function*(){var t,i,r,n;this.retryScheduler.reset(),this.joinParameters=void 0,m.d(oe,"leaving in transport");try{if(this.state=be.Leaving,(t=this.webrtcInternals)==null||t.cleanUp(),(i=this.trackDegradationController)==null||i.cleanUp(),yield(r=this.publishConnection)==null?void 0:r.close(),yield(n=this.subscribeConnection)==null?void 0:n.close(),e)try{this.signal.leave(),m.d(oe,"signal leave done")}catch(s){m.w(oe,"failed to send leave on websocket to server",s)}this.analyticsEventsService.flushFailedClientEvents(),this.analyticsEventsService.reset(),yield this.signal.close()}catch(s){this.eventBus.analytics.publish(Ae.disconnect(s)),m.e(oe,"leave: FAILED \u274C",s)}finally{this.state=be.Disconnected,this.observer.onStateChange(this.state)}})}publish(e){return g(this,null,function*(){for(let t of e)try{yield this.publishTrack(t)}catch(i){this.eventBus.analytics.publish(Ae.publish({devices:this.deviceManager.getDevices(),error:i}))}})}unpublish(e){return g(this,null,function*(){for(let t of e)yield this.unpublishTrack(t)})}sendMessage(e){return g(this,null,function*(){return yield this.signal.broadcast(e)})}trackUpdate(e){let t=Array.from(this.trackStates.values()).find(i=>e.type===i.type&&e.source===i.source);if(t){let i=new Js(Ye(se({},t),{mute:!e.enabled}));this.trackStates.set(t.track_id,i),m.d(oe,"Track Update",this.trackStates,e),this.signal.trackUpdate(new Map([[t.track_id,i]]))}}changeRole(e,t,i=!1){return g(this,null,function*(){yield this.signal.requestRoleChange({requested_for:e.peerId,role:t,force:i})})}acceptRoleChange(e){return g(this,null,function*(){yield this.signal.acceptRoleChangeRequest({role:e.role.name,token:e.token})})}endRoom(e,t){return g(this,null,function*(){yield this.signal.endRoom(e,t)})}removePeer(e,t){return g(this,null,function*(){yield this.signal.removePeer({requested_for:e,reason:t})})}startRTMPOrRecording(e){return g(this,null,function*(){var t;let i={meeting_url:e.meetingURL,record:e.record};(t=e.rtmpURLs)!=null&&t.length&&(i.rtmp_urls=e.rtmpURLs),e.resolution&&(i.resolution=e.resolution),yield this.signal.startRTMPOrRecording(i)})}stopRTMPOrRecording(){return g(this,null,function*(){yield this.signal.stopRTMPAndRecording()})}startHLSStreaming(e){return g(this,null,function*(){let t={};e&&e.variants&&e.variants.length>0&&(t.variants=e.variants.map(i=>{let r={meeting_url:i.meetingURL};return i.metadata&&(r.metadata=i.metadata),r})),e!=null&&e.recording&&(t.hls_recording={single_file_per_layer:e.recording.singleFilePerLayer,hls_vod:e.recording.hlsVod}),yield this.signal.startHLSStreaming(t)})}stopHLSStreaming(e){return g(this,null,function*(){var t;if(e){let i={variants:(t=e==null?void 0:e.variants)==null?void 0:t.map(r=>{let n={meeting_url:r.meetingURL};return r.metadata&&(n.metadata=r.metadata),n})};yield this.signal.stopHLSStreaming(i)}yield this.signal.stopHLSStreaming()})}sendHLSTimedMetadata(e){return g(this,null,function*(){if(e.length>0){let t={metadata_objs:e};yield this.signal.sendHLSTimedMetadata(t)}})}changeName(e){return g(this,null,function*(){let t=this.store.getLocalPeer();t&&t.name!==e&&(yield this.signal.updatePeer({name:e}))})}changeMetadata(e){return g(this,null,function*(){yield this.signal.updatePeer({data:e})})}getSessionMetadata(){return this.signal.getSessionMetadata()}setSessionMetadata(e){return g(this,null,function*(){yield this.signal.setSessionMetadata({data:e})})}changeTrackState(e){return g(this,null,function*(){yield this.signal.requestTrackStateChange(e)})}changeMultiTrackState(e){return g(this,null,function*(){yield this.signal.requestMultiTrackStateChange(e)})}publishTrack(e){return g(this,null,function*(){e.publishedTrackId=e.getTrackIDBeingSent(),m.d(oe,`\u23F3 publishTrack: trackId=${e.trackId}, toPublishTrackId=${e.publishedTrackId}`,`${e}`),this.trackStates.set(e.publishedTrackId,new Js(e));let t=new Promise((s,a)=>{this.callbacks.set(Ai,{promise:{resolve:s,reject:a},action:F.PUBLISH,extra:{}})}),i=e.stream;i.setConnection(this.publishConnection);let r=this.store.getSimulcastLayers(e.source);i.addTransceiver(e,r),m.time(`publish-${e.trackId}-${e.type}`),yield t,m.timeEnd(`publish-${e.trackId}-${e.type}`),this.store.addTrack(e);let n=e.settings.maxBitrate;n&&(yield i.setMaxBitrate(n,e).then(()=>{m.d(oe,`Setting maxBitrate for ${e.source} ${e.type} to ${n} kpbs`)}).catch(s=>m.w(oe,"Failed setting maxBitrate",s))),m.d(oe,`\u2705 publishTrack: trackId=${e.trackId}`,`${e}`,this.callbacks)})}unpublishTrack(e){return g(this,null,function*(){if(m.d(oe,`\u23F3 unpublishTrack: trackId=${e.trackId}`,`${e}`),e.publishedTrackId&&this.trackStates.has(e.publishedTrackId))this.trackStates.delete(e.publishedTrackId);else{let i=Array.from(this.trackStates.values()).find(r=>e.type===r.type&&e.source===r.source);i&&this.trackStates.delete(i.track_id)}let t=new Promise((i,r)=>{this.callbacks.set(Ai,{promise:{resolve:i,reject:r},action:F.UNPUBLISH,extra:{}})});e.stream.removeSender(e),yield t,yield e.cleanup(),this.store.removeTrack(e.trackId),m.d(oe,`\u2705 unpublishTrack: trackId=${e.trackId}`,this.callbacks)})}waitForLocalRoleAvailability(){if(!this.store.hasRoleDetailsArrived())return new Promise(e=>{this.eventBus.policyChange.subscribeOnce(()=>e())})}createConnectionsAndNegotiateJoin(e,t=!1,i=!0){return g(this,null,function*(){let r=this.doesLocalPeerNeedWebRTC();r&&this.createPeerConnections(),yield this.negotiateJoinWithRetry({name:e.name,data:e.metaData,autoSubscribeVideo:t,serverSubDegrade:i,isWebRTC:r})})}createPeerConnections(){this.initConfig&&(this.publishConnection||(this.publishConnection=new id(this.signal,this.initConfig.rtcConfiguration,this.publishConnectionObserver,this)),this.subscribeConnection||(this.subscribeConnection=new nd(this.signal,this.initConfig.rtcConfiguration,this.subscribeConnectionObserver)))}negotiateJoinWithRetry(e){return g(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n,isWebRTC:s=!0}){try{yield this.negotiateJoin({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n,isWebRTC:s})}catch(a){m.e(oe,"Join negotiation failed \u274C",a);let o=a instanceof Q?a:B.WebsocketMethodErrors.ServerErrors(500,F.JOIN,`Websocket join error - ${a.message}`);if(parseInt(`${o.code/100}`)===5||o.code===429){this.joinRetryCount=0,o.isTerminal=!1;let l=()=>g(this,null,function*(){return this.joinRetryCount++,yield this.negotiateJoin({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n,isWebRTC:s})});yield this.retryScheduler.schedule({category:we.JoinWSMessageFailed,error:o,task:l,originalState:be.Joined,maxFailedRetries:3,changeState:!1})}else throw a}})}negotiateJoin(e){return g(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n,isWebRTC:s=!0}){return s?yield this.negotiateJoinWebRTC({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n}):yield this.negotiateJoinNonWebRTC({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n})})}negotiateJoinWebRTC(e){return g(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n}){if(m.d(oe,"\u23F3 join: Negotiating over PUBLISH connection"),!this.publishConnection)return m.e(oe,"Publish peer connection not found, cannot negotiate"),!1;let s=yield this.publishConnection.createOffer();yield this.publishConnection.setLocalDescription(s);let a=yield this.signal.join(t,i,!r,n,s);yield this.publishConnection.setRemoteDescription(a);for(let o of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(o);return this.publishConnection.initAfterJoin(),!!a})}negotiateJoinNonWebRTC(e){return g(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n}){return m.d(oe,"\u23F3 join: Negotiating Non-WebRTC"),!!(yield this.signal.join(t,i,!r,n))})}negotiateOnFirstPublish(){return g(this,null,function*(){if(m.d(oe,"\u23F3 Negotiating offer over PUBLISH connection"),!this.publishConnection)return m.e(oe,"Publish peer connection not found, cannot negotiate"),!1;let e=yield this.publishConnection.createOffer(this.trackStates);yield this.publishConnection.setLocalDescription(e);let t=yield this.signal.offer(e,this.trackStates);yield this.publishConnection.setRemoteDescription(t);for(let i of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(i);return this.publishConnection.initAfterJoin(),!!t})}performPublishRenegotiation(e){return g(this,null,function*(){m.d(oe,"\u23F3 [role=PUBLISH] onRenegotiationNeeded START",this.trackStates);let t=this.callbacks.get(Ai);if(t){if(!this.publishConnection){m.e(oe,"Publish peer connection not found, cannot renegotiate");return}try{let i=yield this.publishConnection.createOffer(this.trackStates,e);yield this.publishConnection.setLocalDescription(i),m.time("renegotiation-offer-exchange");let r=yield this.signal.offer(i,this.trackStates);this.callbacks.delete(Ai),m.timeEnd("renegotiation-offer-exchange"),yield this.publishConnection.setRemoteDescription(r),t.promise.resolve(!0),m.d(oe,"[role=PUBLISH] onRenegotiationNeeded DONE \u2705")}catch(i){let r;i instanceof Q?r=i:r=B.GenericErrors.Unknown(F.PUBLISH,i.message),t.promise.reject(r),m.d(oe,"[role=PUBLISH] onRenegotiationNeeded FAILED \u274C")}}})}handleIceConnectionFailure(e){return g(this,null,function*(){e===gt.Publish?this.retryScheduler.schedule({category:we.PublishIceConnectionFailed,error:B.WebrtcErrors.ICEFailure(F.PUBLISH),task:this.retryPublishIceFailedTask,originalState:be.Joined}):this.retryScheduler.schedule({category:we.SubscribeIceConnectionFailed,error:B.WebrtcErrors.ICEFailure(F.SUBSCRIBE),task:this.retrySubscribeIceFailedTask,originalState:be.Joined,maxFailedRetries:1})})}internalConnect(e,t,i){return g(this,null,function*(){m.d(oe,"connect: started \u23F0");let r=new Date;try{return this.analyticsTimer.start(Ee.INIT),this.initConfig=yield fd.fetchInitConfig({token:e,peerId:i,userAgent:this.store.getUserAgent(),initEndpoint:t}),this.analyticsTimer.end(Ee.INIT),this.validateNotDisconnected("post init"),yield this.openSignal(e,i),m.d(oe,"Adding Analytics Transport: JsonRpcSignal"),this.analyticsEventsService.setTransport(this.analyticsSignalTransport),this.analyticsEventsService.flush(),this.initConfig}catch(n){throw this.state!==be.Reconnecting&&this.eventBus.analytics.publish(Ae.connect(n,this.getAdditionalAnalyticsProperties(),r,new Date,t)),m.d(oe,"\u274C internal connect: failed",n),n}})}validateNotDisconnected(e){if(this.state===be.Disconnected)throw m.w(oe,"aborting join as transport state is disconnected"),B.GenericErrors.ValidationFailed(`leave called before join could complete - stage=${e}`)}openSignal(e,t){return g(this,null,function*(){if(!this.initConfig)throw B.InitAPIErrors.InitConfigNotAvailable(F.INIT,"Init Config not found");m.d(oe,"\u23F3 internal connect: connecting to ws endpoint",this.initConfig.endpoint);let i=new URL(this.initConfig.endpoint);i.searchParams.set("peer",t),i.searchParams.set("token",e),i.searchParams.set("user_agent_v2",this.store.getUserAgent()),this.endpoint=i.toString(),this.analyticsTimer.start(Ee.WEBSOCKET_CONNECT),yield this.signal.open(this.endpoint),this.analyticsTimer.end(Ee.WEBSOCKET_CONNECT),this.analyticsTimer.start(Ee.ON_POLICY_CHANGE),m.d(oe,"\u2705 internal connect: connected to ws endpoint")})}initRtcStatsMonitor(){return g(this,null,function*(){var e,t,i,r;(i=this.webrtcInternals)==null||i.setPeerConnections({publish:(e=this.publishConnection)==null?void 0:e.nativeConnection,subscribe:(t=this.subscribeConnection)==null?void 0:t.nativeConnection}),this.store.getSubscribeDegradationParams()&&(this.isFlagEnabled($i.FLAG_SERVER_SUB_DEGRADATION)||(yield(r=this.webrtcInternals)==null?void 0:r.start(),this.trackDegradationController=new sd(this.store,this.eventBus),this.eventBus.statsUpdate.subscribe(n=>{var s,a,o;(o=this.trackDegradationController)==null||o.handleRtcStatsChange(((a=(s=n.getLocalPeerStats())==null?void 0:s.subscribe)==null?void 0:a.packetsLost)||0)})),this.eventBus.trackDegraded.subscribe(n=>{this.eventBus.analytics.publish(Ae.degradationStats(n,!0)),this.observer.onTrackDegrade(n)}),this.eventBus.trackRestored.subscribe(n=>{this.eventBus.analytics.publish(Ae.degradationStats(n,!1)),this.observer.onTrackRestore(n)}))})}doesRoleNeedWebRTC(e){var t,i;if(!this.isFlagEnabled($i.FLAG_NON_WEBRTC_DISABLE_OFFER))return!0;let r=Boolean(e.publishParams.allowed&&((t=e.publishParams.allowed)==null?void 0:t.length)>0),n=Boolean(e.subscribeParams.subscribeToRoles&&((i=e.subscribeParams.subscribeToRoles)==null?void 0:i.length)>0);return r||n}doesLocalPeerNeedWebRTC(){var e;let t=(e=this.store.getLocalPeer())==null?void 0:e.role;return t?this.doesRoleNeedWebRTC(t):!0}setTransportStateForConnect(){if(this.state===be.Failed&&(this.state=be.Disconnected),this.state!==be.Disconnected&&this.state!==be.Reconnecting)throw B.WebsocketMethodErrors.AlreadyJoined(F.JOIN,`Cannot join a meeting in ${this.state} state`);this.state===be.Disconnected&&(this.state=be.Connecting,this.observer.onStateChange(this.state))}sendErrorAnalyticsEvent(e,t){let i=this.getAdditionalAnalyticsProperties(),r;switch(t){case we.ConnectFailed:r=Ae.connect(e,i);break;case we.SignalDisconnect:r=Ae.disconnect(e,i);break;case we.JoinWSMessageFailed:r=Ae.join({error:e,time:this.analyticsTimer.getTimeTaken(Ee.JOIN),init_response_time:this.analyticsTimer.getTimeTaken(Ee.INIT),ws_connect_time:this.analyticsTimer.getTimeTaken(Ee.WEBSOCKET_CONNECT),on_policy_change_time:this.analyticsTimer.getTimeTaken(Ee.ON_POLICY_CHANGE),local_tracks_time:this.analyticsTimer.getTimeTaken(Ee.LOCAL_TRACKS),retries_join:this.joinRetryCount});break;case we.PublishIceConnectionFailed:r=Ae.publish({error:e});break;case we.SubscribeIceConnectionFailed:r=Ae.subscribeFail(e);break}this.eventBus.analytics.publish(r)}getAdditionalAnalyticsProperties(){var e,t,i,r,n,s,a,o;let l=Td(),c=typeof document<"u"&&document.hidden,u=this.store.getRemoteVideoTracks().filter(f=>f.degraded).length,d=(r=(i=(t=(e=this.getWebrtcInternals())==null?void 0:e.getCurrentStats())==null?void 0:t.getLocalPeerStats())==null?void 0:i.publish)==null?void 0:r.bitrate,h=(o=(a=(s=(n=this.getWebrtcInternals())==null?void 0:n.getCurrentStats())==null?void 0:s.getLocalPeerStats())==null?void 0:a.subscribe)==null?void 0:o.bitrate;return{network_info:l,document_hidden:c,num_degraded_tracks:u,bitrate:{publish:d,subscribe:h},max_sub_bitrate:this.maxSubscribeBitrate,recent_pong_response_times:this.signal.getPongResponseTimes(),transport_state:this.state}}};function Xs(e){if(!e||e.length===0)throw B.InitAPIErrors.InvalidTokenFormat(F.INIT,"Token cannot be an empty string or undefined or null");let t=e.split(".");if(t.length!==3)throw B.InitAPIErrors.InvalidTokenFormat(F.INIT,"Expected 3 '.' separate fields - header, payload and signature respectively");let i=atob(t[1]);try{let r=JSON.parse(i);return{roomId:r.room_id,userId:r.user_id,role:r.role}}catch(r){throw B.InitAPIErrors.InvalidTokenFormat(F.INIT,`couldn't parse to json - ${r.message}`)}}var ea={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default"},ta={published:!1,isInitialised:!1,isReconnecting:!1,isPreviewInProgress:!1,deviceManagersInitialised:!1},Sd=class{constructor(){this.TAG="[HMSSdk]:",this.transportState=be.Disconnected,this.analyticsTimer=new Wc,this.sdkState=se({},ta),this.handleAutoplayError=e=>{var t,i;(i=(t=this.errorListener)==null?void 0:t.onError)==null||i.call(t,e)},this.observer={onNotification:e=>{if(e.method===ve.PEER_LEAVE_REQUEST){this.handlePeerLeaveRequest(e.params);return}e.method===ve.POLICY_CHANGE&&this.analyticsTimer.end(Ee.ON_POLICY_CHANGE),this.notificationManager.handleNotification(e,this.sdkState.isReconnecting)},onTrackAdd:e=>{this.notificationManager.handleTrackAdd(e)},onTrackRemove:e=>{this.notificationManager.handleTrackRemove(e)},onTrackDegrade:e=>{var t,i;m.d(this.TAG,"Sending Track Update Track Degraded",e),(i=this.listener)==null||i.onTrackUpdate(ke.TRACK_DEGRADED,e,(t=this.store)==null?void 0:t.getPeerByTrackId(e.trackId))},onTrackRestore:e=>{var t,i;m.d(this.TAG,"Sending Track Update Track Restored",e),(i=this.listener)==null||i.onTrackUpdate(ke.TRACK_RESTORED,e,(t=this.store)==null?void 0:t.getPeerByTrackId(e.trackId))},onFailure:e=>{var t;(t=this.errorListener)==null||t.onError(e)},onStateChange:(e,t)=>g(this,null,function*(){var i,r,n,s;switch(e){case be.Preview:case be.Joined:this.transportState===be.Reconnecting&&((i=this.listener)==null||i.onReconnected());break;case be.Failed:yield this.leave(),(n=(r=this.errorListener)==null?void 0:r.onError)==null||n.call(r,t),this.sdkState.isReconnecting=!1;break;case be.Reconnecting:this.sdkState.isReconnecting=!0,(s=this.listener)==null||s.onReconnecting(t);break}this.transportState=e,m.d(this.TAG,"Transport State Change",this.transportState)})},this.handlePeerLeaveRequest=e=>{var t;let i=e.requested_by?this.store.getPeerById(e.requested_by):void 0,r={roomEnded:e.room_end,reason:e.reason,requestedBy:i};(t=this.listener)==null||t.onRemovedFromRoom(r),this.internalLeave(!1)},this.handleDeviceChange=e=>{var t,i,r,n,s,a;if(m.d(this.TAG,"Device Change event",e),(i=(t=this.deviceChangeListener)==null?void 0:t.onDeviceChange)==null||i.call(t,e),e.error&&e.type){let o=e.type.includes("audio")?(r=this.localPeer)==null?void 0:r.audioTrack:(n=this.localPeer)==null?void 0:n.videoTrack;(s=this.errorListener)==null||s.onError(e.error),[ne.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,ne.TracksErrors.DEVICE_IN_USE,ne.TracksErrors.DEVICE_NOT_AVAILABLE].includes(e.error.code)&&o&&(o.setEnabled(!1),(a=this.listener)==null||a.onTrackUpdate(ke.TRACK_MUTED,o,this.localPeer))}},this.handleAudioPluginError=e=>{var t;m.e(this.TAG,"Audio Plugin Error event",e),(t=this.errorListener)==null||t.onError(e)},this.handleLocalRoleUpdate=e=>g(this,[e],function*({oldRole:t,newRole:i}){var r;yield this.transport.handleLocalRoleUpdate({oldRole:t,newRole:i}),yield(r=this.roleChangeManager)==null?void 0:r.handleLocalPeerRoleUpdate({oldRole:t,newRole:i})}),this.sendAudioPresenceFailed=()=>{let e=B.TracksErrors.NoAudioDetected(F.PREVIEW);this.sendAnalyticsEvent(Ae.audioDetectionFail(e,this.deviceManager.getCurrentSelection().audioInput))},this.sendJoinAnalyticsEvent=(e=!1,t)=>{this.eventBus.analytics.publish(Ae.join(Ye(se({error:t},this.analyticsTimer.getTimes(Ee.INIT,Ee.WEBSOCKET_CONNECT,Ee.ON_POLICY_CHANGE,Ee.LOCAL_TRACKS)),{time:this.analyticsTimer.getTimeTaken(Ee.JOIN),is_preview_called:e})))},this.sendPreviewAnalyticsEvent=e=>{this.eventBus.analytics.publish(Ae.preview(Ye(se({error:e},this.analyticsTimer.getTimes(Ee.INIT,Ee.WEBSOCKET_CONNECT,Ee.ON_POLICY_CHANGE,Ee.LOCAL_TRACKS)),{time:this.analyticsTimer.getTimeTaken(Ee.PREVIEW)})))},this.sendAnalyticsEvent=e=>{this.analyticsEventsService.queue(e).flush()}}initStoreAndManagers(){if(this.sdkState.isInitialised){this.notificationManager.setListener(this.listener),this.audioSinkManager.setListener(this.listener);return}this.sdkState.isInitialised=!0,this.store=new Ru,this.eventBus=new wu,this.networkTestManager=new ku(this.eventBus,this.listener),this.playlistManager=new qu(this,this.eventBus),this.notificationManager=new Bu(this.store,this.eventBus,this.listener,this.audioListener),this.deviceManager=new Iu(this.store,this.eventBus),this.audioSinkManager=new Au(this.store,this.deviceManager,this.eventBus),this.audioOutput=new Du(this.deviceManager,this.audioSinkManager),this.audioSinkManager.setListener(this.listener),this.eventBus.autoplayError.subscribe(this.handleAutoplayError),this.localTrackManager=new Rr(this.store,this.observer,this.deviceManager,this.eventBus,this.analyticsTimer),this.analyticsEventsService=new Pu(this.store),this.transport=new bd(this.observer,this.deviceManager,this.store,this.eventBus,this.analyticsEventsService,this.analyticsTimer),this.eventBus.analytics.subscribe(this.sendAnalyticsEvent),this.eventBus.deviceChange.subscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.subscribe(this.handleAudioPluginError)}validateJoined(e){if(!this.localPeer)throw B.GenericErrors.NotConnected(F.VALIDATION,`Not connected - ${e}`)}refreshDevices(){return g(this,null,function*(){this.validateJoined("refreshDevices"),yield this.deviceManager.init(!0)})}getWebrtcInternals(){var e;return(e=this.transport)==null?void 0:e.getWebrtcInternals()}getPlaylistManager(){return this.playlistManager}getRecordingState(){var e;return(e=this.store.getRoom())==null?void 0:e.recording}getRTMPState(){var e;return(e=this.store.getRoom())==null?void 0:e.rtmp}getHLSState(){var e;return(e=this.store.getRoom())==null?void 0:e.hls}get localPeer(){var e;return(e=this.store)==null?void 0:e.getLocalPeer()}preview(e,t){return g(this,null,function*(){if(Ys(),Qs(),this.sdkState.isPreviewInProgress)return Promise.reject(B.GenericErrors.PreviewAlreadyInProgress(F.PREVIEW,"Preview already called"));this.analyticsTimer.start(Ee.PREVIEW),this.setUpPreview(e,t),e.alwaysRequestPermissions&&this.localTrackManager.requestPermissions().then(()=>g(this,null,function*(){yield this.initDeviceManagers()}));let i=!1,r=!1,n=setTimeout(()=>{var s,a;(!i||!r)&&((a=(s=this.listener)==null?void 0:s.onNetworkQuality)==null||a.call(s,-1))},3e3);return new Promise((s,a)=>{let o=()=>g(this,null,function*(){var l;let c=yield this.localTrackManager.getTracksToPublish(e.settings||ea);c.forEach(u=>this.setLocalPeerTrack(u)),(l=this.localPeer)!=null&&l.audioTrack&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),this.sdkState.isPreviewInProgress=!1,this.analyticsTimer.end(Ee.PREVIEW),t.onPreview(this.store.getRoom(),c),this.sendPreviewAnalyticsEvent(),s()});this.eventBus.policyChange.subscribeOnce(o),this.transport.preview(e.authToken,e.initEndpoint,this.localPeer.peerId,{name:e.userName,metaData:e.metaData||""},e.autoVideoSubscribe).then(l=>{var c;i=!0,clearTimeout(n),l&&e.captureNetworkQualityInPreview&&this.networkTestManager.start((c=l.config)==null?void 0:c.networkHealth).then(()=>{r=!0})}).catch(l=>{var c;this.analyticsTimer.end(Ee.PREVIEW),(c=this.errorListener)==null||c.onError(l),this.sendPreviewAnalyticsEvent(l),this.sdkState.isPreviewInProgress=!1,a(l)})})})}join(e,t){return g(this,null,function*(){var i,r,n,s;if(Ys(),Qs(),this.sdkState.isPreviewInProgress)throw B.GenericErrors.NotReady(F.JOIN,"Preview is in progress, can't join");this.analyticsTimer.start(Ee.JOIN);let a=this.transportState===be.Preview,{roomId:o,userId:l,role:c}=Xs(e.authToken);(i=this.networkTestManager)==null||i.stop(),(n=(r=this.localPeer)==null?void 0:r.audioTrack)==null||n.destroyAudioLevelMonitor(),this.listener=t,this.commonSetup(e,o,t),this.removeDevicesFromConfig(e),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.localPeer?(this.localPeer.name=e.userName,this.localPeer.role=this.store.getPolicyForRole(c),this.localPeer.customerUserId=l,this.localPeer.metadata=e.metaData):this.createAndAddLocalPeerToStore(e,c,l),this.roleChangeManager=new _u(this.store,this.transport,this.publish.bind(this),this.removeTrack.bind(this),this.listener),this.eventBus.localRoleUpdate.subscribe(this.handleLocalRoleUpdate),m.d(this.TAG,"SDK Store",this.store),m.d(this.TAG,`\u23F3 Joining room ${o}`),m.time(`join-room-${o}`);try{yield this.transport.join(e.authToken,this.localPeer.peerId,{name:e.userName,metaData:e.metaData},e.initEndpoint,e.autoVideoSubscribe),m.d(this.TAG,`\u2705 Joined room ${o}`),Fo.resumeContext(),yield this.notifyJoin(),this.sendJoinAnalyticsEvent(a),[this.store.getPublishParams(),!this.sdkState.published,!Vn].every(u=>!!u)&&this.publish(e.settings||ea).catch(u=>{var d;m.e(this.TAG,"Error in publish",u),(d=this.listener)==null||d.onError(u)})}catch(u){throw this.analyticsTimer.end(Ee.JOIN),(s=this.listener)==null||s.onError(u),this.sendJoinAnalyticsEvent(a,u),m.e(this.TAG,"Unable to join room",u),u}m.timeEnd(`join-room-${o}`)})}stringifyMetadata(e){e.metaData&&typeof e.metaData!="string"?e.metaData=JSON.stringify(e.metaData):e.metaData||(e.metaData="")}cleanUp(){var e,t;this.cleanDeviceManagers(),this.eventBus.analytics.unsubscribe(this.sendAnalyticsEvent),this.analyticsTimer.cleanUp(),zt.cleanup(),this.playlistManager.cleanup(),m.cleanUp(),this.sdkState=se({},ta),this.localPeer&&((e=this.localPeer.audioTrack)==null||e.cleanup(),this.localPeer.audioTrack=void 0,(t=this.localPeer.videoTrack)==null||t.cleanup(),this.localPeer.videoTrack=void 0),this.store.cleanUp(),this.listener=void 0,this.roleChangeManager&&this.eventBus.localRoleUpdate.unsubscribe(this.roleChangeManager.handleLocalPeerRoleUpdate)}leave(){return this.internalLeave()}internalLeave(e=!0){return g(this,null,function*(){var t,i;let r=this.store.getRoom();if(r){let n=r.id;(t=this.networkTestManager)==null||t.stop(),m.d(this.TAG,`\u23F3 Leaving room ${n}`),yield(i=this.transport)==null?void 0:i.leave(e),this.cleanUp(),m.d(this.TAG,`\u2705 Left room ${n}`)}})}getLocalPeer(){return this.store.getLocalPeer()}getPeers(){let e=this.store.getPeers();return e.length<50&&m.d(this.TAG,`Got peers(${e.length})`,e.toString()),e}getAudioOutput(){return this.audioOutput}sendMessage(e,t){this.sendMessageInternal({message:t,type:e})}sendBroadcastMessage(e,t){return g(this,null,function*(){return yield this.sendMessageInternal({message:e,type:t})})}sendGroupMessage(e,t,i){return g(this,null,function*(){let r=this.store.getKnownRoles();if((t.filter(n=>r[n.name])||[]).length===0)throw B.GenericErrors.ValidationFailed("No valid role is present",t);return yield this.sendMessageInternal({message:e,recipientRoles:t,type:i})})}sendDirectMessage(e,t,i){return g(this,null,function*(){var r;if(!this.store.getPeerById(t.peerId))throw B.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);if(((r=this.localPeer)==null?void 0:r.peerId)===t.peerId)throw B.GenericErrors.ValidationFailed("Cannot send message to self");return yield this.sendMessageInternal({message:e,recipientPeer:t,type:i})})}sendMessageInternal(e){return g(this,arguments,function*({recipientRoles:t,recipientPeer:i,type:r="chat",message:n}){if(n.replace(/\u200b/g," ").trim()==="")throw m.w(this.TAG,"sendMessage","Ignoring empty message send"),B.GenericErrors.ValidationFailed("Empty message not allowed");let s=new Oo({sender:this.localPeer,type:r,message:n,recipientPeer:i,recipientRoles:t,time:new Date});m.d(this.TAG,"Sending Message: ",s);let a=yield this.transport.sendMessage(s);return s.time=new Date(a.timestamp),s})}startScreenShare(e,t){return g(this,null,function*(){var i,r,n;let s=this.store.getPublishParams();if(!s)return;let{allowed:a}=s;if(!(a&&a.includes("screen"))){m.e(this.TAG,`Role ${(i=this.localPeer)==null?void 0:i.role} cannot share screen`);return}if((n=(r=this.localPeer)==null?void 0:r.auxiliaryTracks)!=null&&n.find(l=>l.source==="screen"))throw Error("Cannot share multiple screens");let o=yield this.getScreenshareTracks(e,t);if(!this.localPeer){m.d(this.TAG,"Screenshared when not connected"),o.forEach(l=>{l.cleanup()});return}yield this.transport.publish(o),o.forEach(l=>{var c,u,d;l.peerId=(c=this.localPeer)==null?void 0:c.peerId,(u=this.localPeer)==null||u.auxiliaryTracks.push(l),(d=this.listener)==null||d.onTrackUpdate(ke.TRACK_ADDED,l,this.localPeer)})})}stopEndedScreenshare(e){return g(this,null,function*(){m.d(this.TAG,"\u2705 Screenshare ended natively"),yield this.stopScreenShare(),e()})}stopScreenShare(){return g(this,null,function*(){var e;m.d(this.TAG,"\u2705 Screenshare ended from app");let t=(e=this.localPeer)==null?void 0:e.auxiliaryTracks.filter(i=>i.source==="screen");if(t)for(let i of t)yield this.removeTrack(i.trackId)})}addTrack(e,t="regular"){return g(this,null,function*(){var i,r,n,s;if(!e){m.w(this.TAG,"Please pass a valid MediaStreamTrack");return}if(!this.localPeer)throw B.GenericErrors.NotConnected(F.VALIDATION,"No local peer present, cannot addTrack");if(this.localPeer.auxiliaryTracks.find(d=>d.trackId===e.id))return;let a=e.kind,o=new MediaStream([e]),l=new Cr(o),c=a==="audio"?Vi:ni,u=new c(l,e,t,this.eventBus);this.setPlaylistSettings({track:e,hmsTrack:u,source:t}),yield(i=this.transport)==null?void 0:i.publish([u]),u.peerId=(r=this.localPeer)==null?void 0:r.peerId,(n=this.localPeer)==null||n.auxiliaryTracks.push(u),(s=this.listener)==null||s.onTrackUpdate(ke.TRACK_ADDED,u,this.localPeer)})}removeTrack(e){return g(this,null,function*(){var t;if(!this.localPeer)throw B.GenericErrors.NotConnected(F.VALIDATION,"No local peer present, cannot removeTrack");let i=this.localPeer.auxiliaryTracks.findIndex(r=>r.trackId===e);if(i>-1){let r=this.localPeer.auxiliaryTracks[i];yield this.transport.unpublish([r]),r.source==="audioplaylist"?this.playlistManager.stop(de.audio):r.source==="videoplaylist"&&this.playlistManager.stop(de.video),this.localPeer.auxiliaryTracks.splice(i,1),(t=this.listener)==null||t.onTrackUpdate(ke.TRACK_REMOVED,r,this.localPeer)}else m.w(this.TAG,`No track found for ${e}`)})}setAnalyticsLevel(e){this.analyticsEventsService.level=e}setLogLevel(e){m.level=e}addAudioListener(e){this.audioListener=e,this.notificationManager.setAudioListener(e)}addConnectionQualityListener(e){this.notificationManager.setConnectionQualityListener(e)}changeRole(e,t,i=!1){return g(this,null,function*(){var r;!e.role||e.role.name===t||(yield(r=this.transport)==null?void 0:r.changeRole(e,t,i))})}acceptChangeRole(e){return g(this,null,function*(){var t;yield(t=this.transport)==null?void 0:t.acceptRoleChange(e)})}endRoom(e,t){return g(this,null,function*(){var i;if(!this.localPeer)throw B.GenericErrors.NotConnected(F.VALIDATION,"No local peer present, cannot end room");yield(i=this.transport)==null?void 0:i.endRoom(e,t),yield this.leave()})}removePeer(e,t){return g(this,null,function*(){var i;if(!this.localPeer)throw B.GenericErrors.NotConnected(F.VALIDATION,"No local peer present, cannot remove peer");if(!this.store.getPeerById(e.peerId))throw B.GenericErrors.ValidationFailed("Invalid peer, given peer not present in room",e);yield(i=this.transport)==null?void 0:i.removePeer(e.peerId,t)})}startRTMPOrRecording(e){return g(this,null,function*(){var t;if(!this.localPeer)throw B.GenericErrors.NotConnected(F.VALIDATION,"No local peer present, cannot start streaming or recording");yield(t=this.transport)==null?void 0:t.startRTMPOrRecording(e)})}stopRTMPAndRecording(){return g(this,null,function*(){var e;if(!this.localPeer)throw B.GenericErrors.NotConnected(F.VALIDATION,"No local peer present, cannot stop streaming or recording");yield(e=this.transport)==null?void 0:e.stopRTMPOrRecording()})}startHLSStreaming(e){return g(this,null,function*(){var t;if(!this.localPeer)throw B.GenericErrors.NotConnected(F.VALIDATION,"No local peer present, cannot start HLS streaming");yield(t=this.transport)==null?void 0:t.startHLSStreaming(e)})}stopHLSStreaming(e){return g(this,null,function*(){var t;if(!this.localPeer)throw B.GenericErrors.NotConnected(F.VALIDATION,"No local peer present, cannot stop HLS streaming");yield(t=this.transport)==null?void 0:t.stopHLSStreaming(e)})}sendHLSTimedMetadata(e){return g(this,null,function*(){var t;this.validateJoined("sendHLSTimedMetadata"),yield(t=this.transport)==null?void 0:t.sendHLSTimedMetadata(e)})}changeName(e){return g(this,null,function*(){var t;this.validateJoined("changeName"),yield(t=this.transport)==null?void 0:t.changeName(e),this.notificationManager.updateLocalPeer({name:e})})}changeMetadata(e){return g(this,null,function*(){var t;this.validateJoined("changeMetadata"),yield(t=this.transport)==null?void 0:t.changeMetadata(e),this.notificationManager.updateLocalPeer({metadata:e})})}setSessionMetadata(e){return g(this,null,function*(){yield this.transport.setSessionMetadata(e)})}getSessionMetadata(){return g(this,null,function*(){return(yield this.transport.getSessionMetadata()).data})}getRoles(){return Object.values(this.store.getKnownRoles())}changeTrackState(e,t){return g(this,null,function*(){var i;if(e.type===xe.VIDEO&&e.source!=="regular"){m.w(this.TAG,"Muting non-regular video tracks is currently not supported");return}if(e.enabled===t){m.w(this.TAG,`Aborting change track state, track already has enabled - ${t}`,e);return}if(!this.store.getTrackById(e.trackId))throw B.GenericErrors.ValidationFailed("No track found for change track state",e);let r=this.store.getPeerByTrackId(e.trackId);if(!r)throw B.GenericErrors.ValidationFailed("No peer found for change track state",e);yield(i=this.transport)==null?void 0:i.changeTrackState({requested_for:r.peerId,track_id:e.trackId,stream_id:e.stream.id,mute:!t})})}changeMultiTrackState(e){return g(this,null,function*(){var t;if(typeof e.enabled!="boolean")throw B.GenericErrors.ValidationFailed("Pass a boolean for enabled");let{enabled:i,roles:r,type:n,source:s}=e;yield(t=this.transport)==null?void 0:t.changeMultiTrackState({value:!i,type:n,source:s,roles:r==null?void 0:r.map(a=>a==null?void 0:a.name)})})}setFrameworkInfo(e){this.frameworkInfo=e}publish(e){return g(this,null,function*(){let t=yield this.localTrackManager.getTracksToPublish(e);yield this.setAndPublishTracks(t),this.sdkState.published=!0})}setAndPublishTracks(e){return g(this,null,function*(){var t;for(let i of e)yield this.transport.publish([i]),this.setLocalPeerTrack(i),(t=this.listener)==null||t.onTrackUpdate(ke.TRACK_ADDED,i,this.localPeer);yield this.initDeviceManagers()})}setLocalPeerTrack(e){var t;switch(e.peerId=(t=this.localPeer)==null?void 0:t.peerId,e.type){case xe.AUDIO:this.localPeer.audioTrack=e;break;case xe.VIDEO:this.localPeer.videoTrack=e;break}}initDeviceManagers(){return g(this,null,function*(){var e,t,i,r,n;this.sdkState.deviceManagersInitialised||(this.sdkState.deviceManagersInitialised=!0,yield this.deviceManager.init(),(yield this.deviceManager.updateOutputDevice((t=(e=this.store.getConfig())==null?void 0:e.settings)==null?void 0:t.audioOutputDeviceId))||(yield this.deviceManager.updateOutputDevice((r=(i=zt.getSelection())==null?void 0:i.audioOutput)==null?void 0:r.deviceId)),this.audioSinkManager.init((n=this.store.getConfig())==null?void 0:n.audioSinkElementId))})}cleanDeviceManagers(){this.eventBus.deviceChange.unsubscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.unsubscribe(this.handleAudioPluginError),this.eventBus.autoplayError.unsubscribe(this.handleAutoplayError),this.deviceManager.cleanUp(),this.audioSinkManager.cleanUp()}initPreviewTrackAudioLevelMonitor(){var e;let t=(e=this.localPeer)==null?void 0:e.audioTrack;t==null||t.initAudioLevelMonitor(),this.eventBus.trackAudioLevelUpdate.subscribe(i=>{var r;let n=i&&i.track.trackId===(t==null?void 0:t.trackId)?[{audioLevel:i.audioLevel,peer:this.localPeer,track:t}]:[];this.store.updateSpeakers(n),(r=this.audioListener)==null||r.onAudioLevelUpdate(n)}),this.eventBus.localAudioSilence.subscribe(this.sendAudioPresenceFailed)}notifyJoin(){var e;let t=this.store.getLocalPeer(),i=this.store.getRoom();if(i.joinedAt=new Date,t&&(t.joinedAt=i.joinedAt),t==null?void 0:t.role){this.analyticsTimer.end(Ee.JOIN),(e=this.listener)==null||e.onJoin(i);return}return new Promise(r=>{this.eventBus.policyChange.subscribeOnce(()=>{var n;this.analyticsTimer.end(Ee.JOIN),(n=this.listener)==null||n.onJoin(i),r()})})}setUpPreview(e,t){this.listener=t,this.sdkState.isPreviewInProgress=!0;let{roomId:i,userId:r,role:n}=Xs(e.authToken);this.commonSetup(e,i,t),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.createAndAddLocalPeerToStore(e,n,r),m.d(this.TAG,"SDK Store",this.store)}setPlaylistSettings(e){return g(this,arguments,function*({track:t,hmsTrack:i,source:r}){if(r==="videoplaylist"){let n={};if(t.kind==="audio")n.maxBitrate=64;else{n.maxBitrate=1e3;let{width:s,height:a}=t.getSettings();n.width=s,n.height=a}yield i.setSettings(n)}else r==="audioplaylist"&&(yield i.setSettings({maxBitrate:64}))})}createAndAddLocalPeerToStore(e,t,i){let r=this.store.getPolicyForRole(t),n=new qc({name:e.userName||"",customerUserId:i,metadata:e.metaData||"",role:r});this.store.addPeer(n)}commonSetup(e,t,i){this.stringifyMetadata(e),e.initEndpoint||(e.initEndpoint="https://prod-init.100ms.live"),this.errorListener=i,this.deviceChangeListener=i,this.initStoreAndManagers(),this.store.setErrorListener(this.errorListener),this.store.getRoom()||this.store.setRoom(new jc(t,this.store))}removeDevicesFromConfig(e){this.store.getConfig()&&e.settings&&(delete e.settings.audioOutputDeviceId,delete e.settings.videoDeviceId,delete e.settings.audioInputDeviceId)}getScreenshareTracks(e,t){return g(this,null,function*(){let[i,r]=yield this.localTrackManager.getLocalScreen(t),n=()=>{this.stopEndedScreenshare(e)},s=[];if(t!=null&&t.audioOnly){if(i.nativeTrack.stop(),!r)throw B.TracksErrors.NothingToReturn(F.TRACK,"Select share audio when sharing screen","No audio found");s.push(r),r.nativeTrack.onended=n}else s.push(i),i.nativeTrack.onended=n,r&&s.push(r);return s})}};m.i("adapter",`${Tr.browserDetails.browser} v${Tr.browserDetails.version}`);function kd(e,t){return e===t}function _d(e,t,i){if(t===null||i===null||t.length!==i.length)return!1;for(var r=t.length,n=0;n<r;n++)if(!e(t[n],i[n]))return!1;return!0}function Ed(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:kd,i=null,r=null;return function(){return _d(t,i,arguments)||(r=e.apply(null,arguments)),i=arguments,r}}function Cd(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every(function(r){return typeof r=="function"})){var i=t.map(function(r){return typeof r}).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, "+("instead received the following types: ["+i+"]"))}return t}function Rd(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return function(){for(var n=arguments.length,s=Array(n),a=0;a<n;a++)s[a]=arguments[a];var o=0,l=s.pop(),c=Cd(s),u=e.apply(void 0,[function(){return o++,l.apply(null,arguments)}].concat(i)),d=e(function(){for(var h=[],f=c.length,v=0;v<f;v++)h.push(c[v].apply(null,arguments));return u.apply(null,h)});return d.resultFunc=l,d.dependencies=c,d.recomputations=function(){return o},d.resetRecomputations=function(){return o=0},d}}var $=Rd(Ed),Pd=Object.defineProperty,Ad=Object.defineProperties,Id=Object.getOwnPropertyDescriptors,ia=Object.getOwnPropertySymbols,Dd=Object.prototype.hasOwnProperty,wd=Object.prototype.propertyIsEnumerable,ra=(e,t,i)=>t in e?Pd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ii=(e,t)=>{for(var i in t||(t={}))Dd.call(t,i)&&ra(e,i,t[i]);if(ia)for(var i of ia(t))wd.call(t,i)&&ra(e,i,t[i]);return e},Yn=(e,t)=>Ad(e,Id(t)),Od=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Y=(e,t,i)=>new Promise((r,n)=>{var s=l=>{try{o(i.next(l))}catch(c){n(c)}},a=l=>{try{o(i.throw(l))}catch(c){n(c)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,a);o((i=i.apply(e,t)).next())}),Md=Od((e,t)=>{t.exports={version:"0.7.1",license:"MIT",main:"dist/index.cjs.js",module:"dist/index.js",typings:"dist/index.d.ts",files:["dist","src"],engines:{node:">=12"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",format:"prettier --write src/**/*.ts",test:"jest --maxWorkers=1","test:watch":"jest --watch","test:coverage":"jest --coverage",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",docs:"rm -rf ./docs && typedoc && rm -f ./docs/README.md && mkdir ./docs/home &&mv ./docs/modules.md ./docs/home/content.md && node ../../scripts/docs-store && npx prettier --write './docs/**/*'"},name:"@100mslive/hms-video-store",author:"100ms",sideEffects:!1,dependencies:{"@100mslive/hms-video":"0.6.1",eventemitter2:"^6.4.7",immer:"^9.0.6",reselect:"4.0.0",zustand:"3.5.7"},devDependencies:{"ts-node":"^10.4.0",tslib:"^2.2.0"},description:"This is an addon to the core sdk provided by 100ms. It abstracts away the intricacies of data management and provides a flux based reactive data store where data flows in only one direction.",repository:{type:"git",url:"git+https://github.com/100mslive/hms-video-store.git"},keywords:["video","webrtc","conferencing","100ms"],bugs:{url:"https://github.com/100mslive/hms-video-store/issues"},homepage:"https://github.com/100mslive/hms-video-store#readme",gitHead:"b4d98c849c3e4ae4e583b2e2c8f9813193cf1d7c"}}),Ue;(function(e){e.Disconnected="Disconnected",e.Preview="Preview",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed"})(Ue||(Ue={}));var Ho=()=>({room:{id:"",isConnected:!1,name:"",peers:[],localPeer:"",roomState:Ue.Disconnected,recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[]}),Ko=()=>({peerStats:{},trackStats:{},localPeer:{id:""}}),na;(function(e){e.CHAT="chat"})(na||(na={}));var rt;(function(e){e.INFO="info",e.ERROR="error"})(rt||(rt={}));var Se;(function(e){e.PEER_JOINED="PEER_JOINED",e.PEER_LEFT="PEER_LEFT",e.PEER_LIST="PEER_LIST",e.NEW_MESSAGE="NEW_MESSAGE",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED",e.TRACK_ADDED="TRACK_ADDED",e.TRACK_REMOVED="TRACK_REMOVED",e.TRACK_MUTED="TRACK_MUTED",e.TRACK_UNMUTED="TRACK_UNMUTED",e.TRACK_DEGRADED="TRACK_DEGRADED",e.TRACK_RESTORED="TRACK_RESTORED",e.TRACK_DESCRIPTION_CHANGED="TRACK_DESCRIPTION_CHANGED",e.ROLE_UPDATED="ROLE_UPDATED",e.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",e.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",e.ROOM_ENDED="ROOM_ENDED",e.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",e.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",e.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",e.NAME_UPDATED="NAME_UPDATED",e.METADATA_UPDATED="METADATA_UPDATED"})(Se||(Se={}));var Ie;(function(e){e.audio="audio",e.video="video"})(Ie||(Ie={}));var Wo={[Qe.PEER_JOINED]:Se.PEER_JOINED,[Qe.PEER_LEFT]:Se.PEER_LEFT,[Qe.ROLE_UPDATED]:Se.ROLE_UPDATED,[Qe.NAME_UPDATED]:Se.NAME_UPDATED,[Qe.METADATA_UPDATED]:Se.METADATA_UPDATED},zo={[ke.TRACK_ADDED]:Se.TRACK_ADDED,[ke.TRACK_REMOVED]:Se.TRACK_REMOVED,[ke.TRACK_MUTED]:Se.TRACK_MUTED,[ke.TRACK_UNMUTED]:Se.TRACK_UNMUTED,[ke.TRACK_DEGRADED]:Se.TRACK_DEGRADED,[ke.TRACK_RESTORED]:Se.TRACK_RESTORED,[ke.TRACK_DESCRIPTION_CHANGED]:Se.TRACK_DESCRIPTION_CHANGED};function qi(e,t){let i,r;if(t)for(let n of t.auxiliaryTracks){let s=e[n];Ld(s)&&(r=Zn(s)?s:r,i=Xn(s)?s:i)}return{video:i,audio:r}}function Zn(e){return e&&e.type==="audio"}function Xn(e){return e&&e.type==="video"}function Ld(e){return e&&e.source==="screen"}function Jo(e){return e&&e.source==="audioplaylist"}function es(e){return e&&e.source==="videoplaylist"}function Nd(e){return e?Boolean(e==null?void 0:e.degraded):!1}function ts(e,t){return t&&e.tracks[t]?e.tracks[t].enabled:!1}function $d(e,t){return t&&e.tracks[t]?e.tracks[t].displayEnabled:!1}var ft=e=>e.room;$(ft,e=>e.id);var _t=e=>e.peers,Qo=e=>e.messages.byID,Yo=e=>e.messages.allIDs,qe=e=>e.tracks,Zo=e=>e.settings,xd=e=>e.appData,Ud=e=>e.devices,Xo=e=>e.speakers,el=$([ft],e=>e&&e.isConnected);$([el,ft],(e,t)=>e?t.peerCount!==void 0?t.peerCount||1:t.peers.length:Math.max(t.peerCount!==void 0?t.peerCount:t.peers.length-1,0));var tl=$([ft,_t],(e,t)=>e.peers.map(i=>t[i])),Fd=$(qe,e=>Object.values(e)),vt=$(ft,_t,(e,t)=>t[e.localPeer]),xi=$(ft,e=>e.localPeer);$(vt,e=>e==null?void 0:e.name);$(vt,e=>e==null?void 0:e.roleName);var Lt=$(vt,e=>e==null?void 0:e.audioTrack),Nt=$(vt,e=>e==null?void 0:e.videoTrack),Gd=$(vt,e=>e==null?void 0:e.auxiliaryTracks),Bd=$([Lt,Nt,Gd],(e,t,i)=>{let r=[...i];return e&&r.unshift(e),t&&r.unshift(t),r});$(tl,e=>e.filter(t=>!t.isLocal));$(_t,Xo,(e,t)=>{let i=Object.entries(t).sort((r,n)=>{var s,a;let o=((s=r[1])==null?void 0:s.audioLevel)||0;return(((a=n[1])==null?void 0:a.audioLevel)||0)>o?1:-1});if(i.length>0&&i[0][1].audioLevel&&i[0][1].audioLevel>0){let r=i[0][1].peerID;if(r in e)return e[r]}return null});var Vd=e=>{let t=vt(e);return ts(e,t==null?void 0:t.audioTrack)},bn=e=>{let t=vt(e);return ts(e,t==null?void 0:t.videoTrack)},jd=e=>{let t=vt(e);return $d(e,t==null?void 0:t.videoTrack)},Sn=$(vt,qe,(e,t)=>{let{video:i,audio:r}=qi(t,e);return!!(i||r)}),il=$(_t,qe,(e,t)=>{let i;for(let r in e){let n=e[r],{video:s,audio:a}=qi(t,n);if(s)return n;a&&!i&&(i=n)}return i}),qd=$(il,e=>!!e);$(_t,qe,(e,t)=>{for(let i in e){let r=e[i],{audio:n,video:s}=qi(t,r);if(!s&&!!n)return r}});$(_t,qe,(e,t)=>{let i=[],r=[];for(let n in e){let s=e[n],{video:a,audio:o}=qi(t,s);a?i.push(s):o&&r.push(s)}return i.concat(r)});$(_t,qe,(e,t)=>{for(let i in t){let r=t[i];if(es(r)&&Xn(r)&&r.peerId)return e[r.peerId]}});$(_t,qe,(e,t)=>{for(let i in t){let r=t[i];if(Jo(r)&&r.peerId)return e[r.peerId]}});$(Fd,e=>e.filter(Nd));var Hd=$(Yo,e=>e.length);$(Qo,e=>Object.values(e).filter(t=>!t.read).length);var Nr=$(Yo,Qo,(e,t)=>{let i=[];return e.forEach(r=>{i.push(t[r])}),i}),Ct=$([ft],e=>e&&e.roomState);$(Ct,e=>e===Ue.Preview);var Kd=$(ft,e=>e.roomState!==Ue.Disconnected),ji=e=>e.roles;$([ji],e=>Object.keys(e));var is=$([vt,ji],(e,t)=>e!=null&&e.roleName?t[e.roleName]:null);$([is],e=>{var t;return(t=e==null?void 0:e.subscribeParams)!=null&&t.subscribeToRoles?e.subscribeParams.subscribeToRoles.length>0:!1});var Wd=$(is,e=>e==null?void 0:e.permissions);$(ft,e=>e.recording);$(ft,e=>e.rtmp);$(ft,e=>e.hls);$(ft,e=>e.sessionId);$(ft,e=>e.startedAt);var rl=(e=Ie.audio)=>t=>t.playlist[e].list,rs=(e=Ie.audio)=>t=>t.playlist[e].selection,nl=(e=Ie.audio)=>t=>t.playlist[e].progress,sl=(e=Ie.audio)=>t=>t.playlist[e].currentTime,al=(e=Ie.audio)=>t=>t.playlist[e].playbackRate,ol=(e=Ie.audio)=>t=>t.playlist[e].volume,ll=(e=Ie.audio)=>$(rl(e),t=>Object.values(t)),cl=(e=Ie.audio)=>$(rl(e),rs(e),(t,i)=>{if(i.id)return t[i.id]}),zd={selection:rs(Ie.audio),progress:nl(Ie.audio),currentTime:sl(Ie.audio),playbackRate:al(Ie.audio),volume:ol(Ie.audio),list:ll(Ie.audio),selectedItem:cl(Ie.audio)},Jd={selection:rs(Ie.video),progress:nl(Ie.video),currentTime:sl(Ie.video),playbackRate:al(Ie.video),volume:ol(Ie.video),list:ll(Ie.video),selectedItem:cl(Ie.video)};function Ke(e){return t=>i=>e(i,t)}var wi="HMS-Store:",Ce=class{static v(e,...t){this.log(ze.VERBOSE,e,...t)}static d(...e){this.log(ze.DEBUG,...e)}static i(...e){this.log(ze.INFO,...e)}static w(...e){this.log(ze.WARN,...e)}static e(...e){this.log(ze.ERROR,...e)}static time(e){this.log(ze.TIME,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(ze.TIMEEND,"[HMSPerformanceTiming]",e,e)}static cleanUp(){performance.clearMarks(),performance.clearMeasures()}static log(e,...t){if(!(this.level.valueOf()>e.valueOf()))switch(e){case ze.VERBOSE:{console.log(wi,...t);break}case ze.DEBUG:{console.debug(wi,...t);break}case ze.INFO:{console.info(wi,...t);break}case ze.WARN:{console.warn(wi,...t);break}case ze.ERROR:{console.error(wi,...t);break}case ze.TIME:{performance.mark(t[1]);break}case ze.TIMEEND:{let i=t[0],r=t[1];try{let n=performance.measure(r,r);this.log(ze.DEBUG,i,r,n==null?void 0:n.duration),performance.clearMarks(r),performance.clearMeasures(r)}catch(n){this.log(ze.DEBUG,i,r,n)}break}}}};Ce.level=ze.VERBOSE;var ns=(e,t)=>t,Hi=(e,t)=>t,ul=(e,t)=>t,Qd=(e,t)=>t,xt=$([_t,ns],(e,t)=>t?e[t]:null),Yd=$([qe,Hi],(e,t)=>t?e[t]:null),Zd=$([qe,Hi],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="video"?i:null});$([qe,Hi],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="audio"?i:null});$([qe,Hi],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="audio"&&(i==null?void 0:i.source)==="screen"?i:null});$([qe,Hi],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="video"&&(i==null?void 0:i.source)==="screen"?i:null});var ei=Ke(xt);Ke($([xd,Qd],(e,t)=>{if(e)return t?e[t]:e}));Ke($(xt,e=>e==null?void 0:e.name));var dl=Ke(Yd),hl=Ke(Zd),Xd=Ke((e,t)=>{let i=xt(e,t);if(i&&i.videoTrack&&i.videoTrack!=="")return e.tracks[i.videoTrack]}),eh=Ke((e,t)=>{let i=xt(e,t);if(i&&i.audioTrack&&i.audioTrack!=="")return e.tracks[i.audioTrack]}),pl=Xd,fl=(e,t)=>t?e.speakers[t]:null;Ke($(fl,e=>(e==null?void 0:e.audioLevel)||0));var th=(e,t)=>{let i=eh(t)(e);return fl(e,i==null?void 0:i.id)},ih=Ke($(th,e=>(e==null?void 0:e.audioLevel)||0)),rh=Ke((e,t)=>{if(t)return e.connectionQualities[t]});Ke($(qe,xt,(e,t)=>{let i=t==null?void 0:t.auxiliaryTracks.find(r=>{let n=e[r];return es(n)&&Xn(n)});return i?e[i]:void 0}));Ke($(qe,xt,(e,t)=>{let i=t==null?void 0:t.auxiliaryTracks.find(r=>{let n=e[r];return es(n)&&Zn(n)});return i?e[i]:void 0}));Ke($(qe,xt,(e,t)=>{let i=t==null?void 0:t.auxiliaryTracks.find(r=>{let n=e[r];return Jo(n)&&Zn(n)});return i?e[i]:void 0}));var nh=Ke($(qe,xt,(e,t)=>qi(e,t))),sh=e=>$(nh(e),t=>t.video),ah=Ke((e,t)=>{let i=xt(e,t);return ts(e,i==null?void 0:i.audioTrack)}),oh=$([Nr,xi,ns],(e,t,i)=>{if(i)return e.filter(r=>{var n;return!r.recipientPeer&&!((n=r.recipientRoles)!=null&&n.length)||r.sender&&![t,i].includes(r.sender)?!1:[t,i].includes(r.recipientPeer)})}),lh=$([Nr,ul],(e,t)=>{if(t)return e.filter(i=>{var r,n;return(r=i.recipientRoles)!=null&&r.length?(n=i.recipientRoles)==null?void 0:n.includes(t):!1})}),ch=$(Nr,e=>e.filter(t=>{var i;return!t.recipientPeer&&!((i=t.recipientRoles)!=null&&i.length)}));$([lh,ul],e=>e?e.filter(t=>!t.read).length:0);$([oh,ns],e=>e?e.filter(t=>!t.read).length:0);$(ch,e=>e.filter(t=>!t.read).length);$([_t,qe],(e,t)=>Object.values(e).map(i=>{var r;return{peer:i,isAudioEnabled:i.audioTrack?(r=t[i.audioTrack])==null?void 0:r.enabled:!1}}));var uh=e=>e.roleChangeRequests[0]||null;$([uh,_t,ji],(e,t,i)=>e?{requestedBy:e.requestedBy?t[e.requestedBy]:void 0,role:i[e.roleName],token:e.token}:null);$([is],e=>{var t;let i=!1,r=!1,n=!1;return(t=e==null?void 0:e.publishParams)!=null&&t.allowed&&(i=e.publishParams.allowed.includes("video"),r=e.publishParams.allowed.includes("audio"),n=e.publishParams.allowed.includes("screen")),{video:i,audio:r,screen:n}});$([Nt,qe],(e,t)=>{let i=null;return e&&(i=t[e]),(i==null?void 0:i.plugins)||[]});$([Lt,qe],(e,t)=>{let i=null;return e&&(i=t[e]),(i==null?void 0:i.plugins)||[]});var zr="hmsNotification",dh=class{constructor(e){this.id=0,this.onNotification=(t,i)=>{let r=n=>{if(i){let s;if(Array.isArray(i)?s=i.includes(n.type):s=i===n.type,!s)return}t(n)};return this.eventEmitter.addListener(zr,r),()=>{this.eventEmitter.removeListener(zr,r)}},this.store=e,this.eventEmitter=new Mr.exports.EventEmitter2({maxListeners:Object.keys(Se).length})}sendPlaylistTrackEnded(e){let t=this.createNotification(Se.PLAYLIST_TRACK_ENDED,e,rt.INFO);this.emitEvent(t)}sendDeviceChange(e){var t;let i=this.createNotification(Se.DEVICE_CHANGE_UPDATE,e,e.error?rt.ERROR:rt.INFO,`Selected ${e.type} device - ${(t=e.selection)==null?void 0:t.label}`);this.emitEvent(i)}sendLeaveRoom(e){var t;let i=(t=e.requestedBy)==null?void 0:t.name,r=this.createNotification(e.roomEnded||!i?Se.ROOM_ENDED:Se.REMOVED_FROM_ROOM,e,rt.INFO,`${e.roomEnded?"Room ended":"Removed from room"} ${i?`by ${i}`:""}`);this.emitEvent(r)}sendPeerList(e){let t=this.createNotification(Se.PEER_LIST,e,rt.INFO);this.emitEvent(t)}sendPeerUpdate(e,t){let i=this.store.getState(ei(t==null?void 0:t.id))||t,r=Wo[e];if(r){let n=this.createNotification(r,i,rt.INFO);this.emitEvent(n)}}sendTrackUpdate(e,t){let i=this.store.getState(dl(t)),r=zo[e];if(r){let n=this.createNotification(r,i,rt.INFO);this.emitEvent(n)}}sendMessageReceived(e){let t=this.createNotification(Se.NEW_MESSAGE,e,rt.INFO);this.emitEvent(t)}sendError(e){let t=this.createNotification(Se.ERROR,e,rt.ERROR);this.emitEvent(t)}sendReconnecting(e){let t=this.createNotification(Se.RECONNECTING,e,rt.ERROR);this.emitEvent(t)}sendReconnected(){let e=this.createNotification(Se.RECONNECTED,null,rt.INFO);this.emitEvent(e)}sendChangeTrackStateRequest(e){let t=this.createNotification(Se.CHANGE_TRACK_STATE_REQUEST,e,rt.INFO);this.emitEvent(t)}sendChangeMultiTrackStateRequest(e){let t=this.createNotification(Se.CHANGE_MULTI_TRACK_STATE_REQUEST,e,rt.INFO);this.emitEvent(t)}emitEvent(e){this.eventEmitter.emit(zr,e)}createNotification(e,t,i,r=""){return this.id++,{id:this.id,type:e,message:r,data:t,severity:i}}};function hh(e){return e instanceof Jn||e instanceof ai}var ph=(e,t)=>{let i=ls(Object.keys(e),Object.keys(t));for(let r of i){let n=e[r],s=t[r];ss(n,s)?(Kt(n.auxiliaryTracks,s.auxiliaryTracks)&&(s.auxiliaryTracks=n.auxiliaryTracks),Object.assign(n,s)):as(n,s)?delete e[r]:os(n,s)&&(e[r]=s)}},fh=(e,t)=>{let i=ls(Object.keys(e),Object.keys(t));for(let r of i){let n=e[r],s=t[r];ss(n,s)?(mh(n,s),Object.assign(n,s)):as(n,s)?delete e[r]:os(n,s)&&(e[r]=s)}},sa=(e,t)=>{let i=ls(Object.keys(e),Object.keys(t));for(let r of i){let n=e[r],s=t[r];ss(n,s)?Object.assign(n,s):as(n,s)?delete e[r]:os(n,s)&&(e[r]=s)}},mh=(e,t)=>{e.plugins&&Kt(e.plugins,t.plugins)&&(t.plugins=e.plugins),e.type==="video"&&e.layerDefinitions&&Kt(e.layerDefinitions,t.layerDefinitions)&&(t.layerDefinitions=e.layerDefinitions)},ss=(e,t)=>e&&t,as=(e,t)=>e&&!t,os=(e,t)=>!e&&t,Kt=(e,t)=>{if(e===t||e.length===0&&(t==null?void 0:t.length)===0)return!0;if(!e||!t||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},ls=(e,t)=>{let i=new Set;for(let r of e)i.add(r);for(let r of t)i.add(r);return Array.from(i)},$e=class{static convertPeer(e){var t,i,r;return{id:e.peerId,name:e.name,roleName:(t=e.role)==null?void 0:t.name,isLocal:e.isLocal,videoTrack:(i=e.videoTrack)==null?void 0:i.trackId,audioTrack:(r=e.audioTrack)==null?void 0:r.trackId,auxiliaryTracks:e.auxiliaryTracks.map(n=>n.trackId),customerUserId:e.customerUserId,metadata:e.metadata,joinedAt:e.joinedAt}}static convertTrack(e,t){let i={id:e.trackId,source:e.source,type:e.type,enabled:e.enabled,displayEnabled:e.enabled,peerId:e.peerId||t};return this.enrichTrack(i,e),i}static enrichTrack(e,t){let i=t.getMediaTrackSettings();t instanceof Jn&&(e.volume=t.getVolume()||0),$e.updateDeviceID(e,t),e.type==="video"&&(e.source==="screen"?(e.displaySurface=i.displaySurface,$e.enrichScreenTrack(e,t)):e.source==="regular"&&(e.facingMode=i.facingMode),e.height=i.height,e.width=i.width,$e.enrichVideoTrack(e,t)),$e.enrichPluginsDetails(e,t)}static updateDeviceID(e,t){var i;t instanceof ni||t instanceof Vi?e.deviceID=t.settings.deviceId:e.deviceID=(i=t.getMediaTrackSettings())==null?void 0:i.deviceId}static enrichVideoTrack(e,t){t instanceof ai&&(e.layer=t.getSimulcastLayer(),e.degraded=t.degraded,Kt(t.getSimulcastDefinitions(),e.layerDefinitions)||(e.layerDefinitions=t.getSimulcastDefinitions()))}static enrichScreenTrack(e,t){var i,r;if(t instanceof ni){let n=(i=t.getCaptureHandle)==null?void 0:i.call(t);(n==null?void 0:n.handle)!==((r=e.captureHandle)==null?void 0:r.handle)&&(e.captureHandle=n),t.isCurrentTab&&(e.displaySurface="selfBrowser")}}static enrichPluginsDetails(e,t){(t instanceof ni||t instanceof Vi)&&(Kt(t.getPlugins(),e.plugins)||(e.plugins=t.getPlugins()))}static convertRoom(e){var t,i;let{recording:r,rtmp:n,hls:s}=$e.convertRecordingStreamingState(e==null?void 0:e.recording,e==null?void 0:e.rtmp,e==null?void 0:e.hls);return{id:e.id,name:e.name,localPeer:(i=(t=e.localPeer)==null?void 0:t.peerId)!=null?i:"",recording:r,rtmp:n,hls:s,sessionId:e.sessionId,startedAt:e.startedAt,joinedAt:e.joinedAt,peerCount:e.peerCount}}static convertMessage(e){var t,i,r,n,s,a,o;return{sender:(t=e.sender)==null?void 0:t.peerId,senderName:(i=e.sender)==null?void 0:i.name,senderRole:(n=(r=e.sender)==null?void 0:r.role)==null?void 0:n.name,senderUserId:(s=e.sender)==null?void 0:s.customerUserId,recipientPeer:(a=e.recipientPeer)==null?void 0:a.peerId,recipientRoles:(o=e.recipientRoles)==null?void 0:o.map(l=>l.name),time:e.time,type:e.type,message:e.message}}static convertRoles(e){let t={};return e&&e.forEach(i=>{t[i.name]=i}),t}static convertRoleChangeRequest(e){var t;return{requestedBy:(t=e.requestedBy)==null?void 0:t.peerId,roleName:e.role.name,token:e.token}}static convertException(e){return{code:e.code,action:e.action,name:e.name,message:e.message,description:e.description,isTerminal:e.isTerminal,nativeError:e.nativeError,timestamp:new Date}}static convertDeviceChangeUpdate(e){let t={devices:e.devices,selection:e.selection,type:e.type};return e.error&&(t.error=this.convertException(e.error)),t}static convertPlaylist(e){let t=this.getConvertedPlaylistType(e,Ie.audio),i=this.getConvertedPlaylistType(e,Ie.video);return{audio:t,video:i}}static convertPlaylistItem(e,t){let i=t.type,r=e.getCurrentSelection(i),n=e.isPlaying(i),s=t.url===(r==null?void 0:r.url);return Yn(ii({},t),{type:t.type,selected:s,playing:s&&n})}static getConvertedPlaylistType(e,t){let i={},r=e.getCurrentSelection(t),n=e.getCurrentProgress(t),s=e.getVolume(t),a=e.getList(t),o=e.getCurrentIndex(t);return e.getList(t).forEach(l=>{i[l.id]=$e.convertPlaylistItem(e,l)}),{list:i,selection:{id:r==null?void 0:r.id,hasPrevious:o>0,hasNext:o<a.length-1},progress:n,volume:s,currentTime:e.getCurrentTime(t),playbackRate:e.getPlaybackRate(t)}}static convertRecordingStreamingState(e,t,i){var r;return{recording:{browser:ii({running:!1},e==null?void 0:e.browser),server:ii({running:!1},e==null?void 0:e.server),hls:ii({running:!1},e==null?void 0:e.hls)},rtmp:ii({running:!1},t),hls:{variants:((r=i==null?void 0:i.variants)==null?void 0:r.map(n=>n))||[],running:!!(i!=null&&i.running),error:i==null?void 0:i.error}}}},aa=class{constructor(e,t,i,r){this.playlistManager=e,this.syncPlaylistState=i,this.store=r,this.type=t}play(e){return Y(this,null,function*(){if(!e){Ce.w("Please pass id to play");return}yield this.playlistManager.setEnabled(!0,{id:e,type:this.type})})}pause(){return Y(this,null,function*(){let e=this.type===Ie.audio?zd:Jd,t=this.store.getState(e.selection);if(!t.id){Ce.w("No item is currently playing to pause");return}yield this.playlistManager.setEnabled(!1,{id:t.id,type:this.type})})}playNext(){return Y(this,null,function*(){yield this.playlistManager.playNext(this.type)})}playPrevious(){return Y(this,null,function*(){yield this.playlistManager.playPrevious(this.type)})}seek(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState(`seekOn${this.type}Playlist`)}seekTo(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState(`seekToOn${this.type}Playlist`)}setVolume(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState(`setVolumeOn${this.type}Playlist`)}setList(e){this.playlistManager.setList(e),this.syncPlaylistState(`setListOn${this.type}Playlist`)}stop(){return Y(this,null,function*(){yield this.playlistManager.stop(this.type),this.syncPlaylistState(`stop${this.type}Playlist`)})}setIsAutoplayOn(e){this.playlistManager.setIsAutoplayOn(this.type,e)}setPlaybackRate(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState(`set${this.type}PlaybackRate`)}removeItem(e){return Y(this,null,function*(){let t=yield this.playlistManager.removeItem(e,this.type);return t&&this.syncPlaylistState(`remove${this.type}PlaylistItem`),t})}clearList(){return Y(this,null,function*(){yield this.playlistManager.clearList(this.type),this.syncPlaylistState(`clear${this.type}Playlist`)})}},gh=class{constructor(e,t,i){this.hmsSDKTracks={},this.hmsSDKPeers={},this.isRoomJoinCalled=!1,this.ignoredMessageTypes=[],this.setProgress=({type:r,progress:n})=>{this.setState(s=>{s.playlist[r].progress=n,s.playlist[r].currentTime=this.sdk.getPlaylistManager().getCurrentTime(r)},"playlistProgress")},this.syncPlaylistState=r=>{this.setState(n=>{Object.assign(n.playlist,$e.convertPlaylist(this.sdk.getPlaylistManager()))},r)},this.sendPeerUpdateNotification=(r,n)=>{let s=this.store.getState(ei(n.peerId)),a=Wo[r]||"peerUpdate";this.syncRoomState(a),s||(s=this.store.getState(ei(n.peerId))),this.hmsNotifications.sendPeerUpdate(r,s)},this.setState=(r,n)=>this.store.namedSetState(r,n),this.store=e,this.sdk=t,this.hmsNotifications=i}refreshDevices(){return Y(this,null,function*(){yield this.sdk.refreshDevices()})}unblockAudio(){return Y(this,null,function*(){yield this.sdk.getAudioOutput().unblockAutoplay()})}setVolume(e,t){t?this.setTrackVolume(e,t):(this.sdk.getAudioOutput().setVolume(e),this.syncRoomState("setOutputVolume"))}setAudioOutputDevice(e){return Y(this,null,function*(){(yield this.sdk.getAudioOutput().setDevice(e))&&this.setState(t=>{t.settings.audioOutputDeviceId=e},"setAudioOutputDevice")})}setPreferredLayer(e,t){let i=this.hmsSDKTracks[e];i?i instanceof ai?(i.preferLayer(t),this.updateVideoLayer(e,"setPreferredLayer")):Ce.w(`track ${e} is not an video track`):this.logPossibleInconsistency(`track ${e} not present, unable to set preffer layer`)}preview(e){return Y(this,null,function*(){if(this.isRoomJoinCalled){this.logPossibleInconsistency("attempting to call preview after join was called");return}let t=this.store.getState(Ct);if(t===Ue.Preview||t===Ue.Connecting){this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting");return}try{this.setState(i=>{i.room.roomState=Ue.Connecting},"connecting"),yield this.sdkPreviewWithListeners(e)}catch(i){throw Ce.e("Cannot show preview. Failed to connect to room - ",i),i}})}join(e){return Y(this,null,function*(){if(this.isRoomJoinCalled){this.logPossibleInconsistency("room join is called again");return}try{this.isRoomJoinCalled=!0,this.setState(t=>{t.room.roomState=Ue.Connecting},"join"),yield this.sdkJoinWithListeners(e)}catch(t){throw this.isRoomJoinCalled=!1,Ce.e("Failed to connect to room - ",t),t}})}leave(){return Y(this,null,function*(){if(!this.store.getState(Kd)){this.logPossibleInconsistency("room leave is called when no room is connected");return}let e=this.store.getState(Ct);return this.setState(t=>{t.room.roomState=Ue.Disconnecting},"leaving"),this.sdk.leave().then(()=>{this.resetState("leave"),Ce.i("left room")}).catch(t=>{Ce.e("error in leaving room - ",t),this.setState(i=>{i.room.roomState=e},"revertLeave")})})}setScreenShareEnabled(e,t){return Y(this,null,function*(){typeof t=="boolean"&&(t={audioOnly:t});try{e?yield this.startScreenShare(t):yield this.stopScreenShare()}catch(i){throw this.hmsNotifications.sendError($e.convertException(i)),i}})}addTrack(e,t="regular"){return Y(this,null,function*(){yield this.sdk.addTrack(e,t),this.syncRoomState("addTrack")})}removeTrack(e){return Y(this,null,function*(){yield this.sdk.removeTrack(e),this.syncRoomState("removeTrack")})}setLocalAudioEnabled(e){return Y(this,null,function*(){let t=this.store.getState(Lt);t&&(yield this.setEnabledTrack(t,e))})}setLocalVideoEnabled(e){return Y(this,null,function*(){let t=this.store.getState(Nt);t&&(yield this.setEnabledTrack(t,e))})}setEnabledTrack(e,t){return Y(this,null,function*(){var i;if(((i=this.store.getState().tracks[e])==null?void 0:i.enabled)===t){this.logPossibleInconsistency(`local track[${e}] enabled state - ${t}`);return}this.setState(n=>{n.tracks[e]?n.tracks[e].displayEnabled=t:this.logPossibleInconsistency("track id not found for setEnabled")},"displayEnabled");try{yield this.setEnabledSDKTrack(e,t),this.syncRoomState("setEnabled")}catch(n){throw this.setState(s=>{s.tracks[e].displayEnabled=!t},"rollbackDisplayEnabled"),this.hmsNotifications.sendError($e.convertException(n)),n}let r=t?ke.TRACK_UNMUTED:ke.TRACK_MUTED;this.hmsNotifications.sendTrackUpdate(r,e)})}setAudioSettings(e){return Y(this,null,function*(){let t=this.store.getState(Lt);t&&(yield this.setSDKLocalAudioTrackSettings(t,e),this.syncRoomState("setAudioSettings"))})}setVideoSettings(e){return Y(this,null,function*(){let t=this.store.getState(Nt);t&&(yield this.setSDKLocalVideoTrackSettings(t,e),this.syncRoomState("setVideoSettings"))})}sendMessage(e){this.sendBroadcastMessage(e)}sendBroadcastMessage(e,t){return Y(this,null,function*(){let i=yield this.sdk.sendBroadcastMessage(e,t);this.updateMessageInStore(i,{message:e,type:t})})}sendGroupMessage(e,t,i){return Y(this,null,function*(){let r=this.store.getState(ji),n=t.map(a=>r[a]),s=yield this.sdk.sendGroupMessage(e,n,i);this.updateMessageInStore(s,{message:e,recipientRoles:t,type:i})})}sendDirectMessage(e,t,i){return Y(this,null,function*(){let r=this.hmsSDKPeers[t],n=yield this.sdk.sendDirectMessage(e,r,i);this.updateMessageInStore(n,{message:e,recipientPeer:r.peerId,type:i})})}updateMessageInStore(e,t){if(!e)throw Ce.w("sendMessage","Failed to send message",t),Error(`sendMessage Failed - ${JSON.stringify(t)}`);let i=$e.convertMessage(e);return i.read=!0,i.senderName="You",i.ignored=this.ignoredMessageTypes.includes(i.type),this.putMessageInStore(i),i}setMessageRead(e,t){this.setState(i=>{t?i.messages.byID[t]?i.messages.byID[t].read=e:this.logPossibleInconsistency("no message with id is found"):i.messages.allIDs.forEach(r=>{i.messages.byID[r].read=e})},"setMessageRead")}attachVideo(e,t){return Y(this,null,function*(){if(this.localAndVideoUnmuting(e))return new Promise(i=>{let r=this.store.subscribe(n=>Y(this,null,function*(){n&&(yield this.attachVideoInternal(e,t),r(),i())}),bn)});yield this.attachVideoInternal(e,t)})}detachVideo(e,t){return Y(this,null,function*(){let i=this.hmsSDKTracks[e];(i==null?void 0:i.type)==="video"?(i.removeSink(t),this.updateVideoLayer(e,"detachVideo")):(t&&(t.srcObject=null),this.logPossibleInconsistency("no video track found to remove sink"))})}addPluginToVideoTrack(e,t){return Y(this,null,function*(){return this.addRemoveVideoPlugin(e,"add",t)})}addPluginToAudioTrack(e){return Y(this,null,function*(){return this.addRemoveAudioPlugin(e,"add")})}validateVideoPluginSupport(e){let t={};if(t.isSupported=!1,!e)return Ce.w("no plugin passed in for checking support"),t.errMsg="no plugin passed in for checking support",t;let i=this.store.getState(Nt);if(!i)return Ce.w("video Track not added to local peer yet"),t.errMsg="call this function only after local peer has video track",t;let r=this.hmsSDKTracks[i];return r?t=r.validatePlugin(e):(Ce.w(`track ${i} not present, unable to validate plugin`),t.errMsg=`track ${i} not present, unable to validate plugin`),t}validateAudioPluginSupport(e){let t={};if(t.isSupported=!1,!e)return Ce.w('no plugin passed in for checking support"'),t.errMsg='no plugin passed in for checking support"',t;let i=this.store.getState(Lt);if(!i)return Ce.w("audio track not added to local peer yet"),t.errMsg="call this function only after local peer has audio track",t;let r=this.hmsSDKTracks[i];return r?t=r.validatePlugin(e):(Ce.w(`track ${i} not present, unable to validate plugin`),t.errMsg=`track ${i} not present, unable to validate plugin`),t}removePluginFromVideoTrack(e){return Y(this,null,function*(){return this.addRemoveVideoPlugin(e,"remove")})}removePluginFromAudioTrack(e){return Y(this,null,function*(){return this.addRemoveAudioPlugin(e,"remove")})}changeRole(e,t,i=!1){return Y(this,null,function*(){let r=this.hmsSDKPeers[e];if(!r){this.logPossibleInconsistency(`Unknown peer ID given ${e} for changerole`);return}yield this.sdk.changeRole(r,t,i)})}acceptChangeRole(e){return Y(this,null,function*(){let t=e.requestedBy?this.hmsSDKPeers[e.requestedBy.id]:void 0;t||Ce.w(`peer for which role change is requested no longer available - ${e.requestedBy}`);let i={requestedBy:t,role:e.role,token:e.token};yield this.sdk.acceptChangeRole(i),this.removeRoleChangeRequest(e)})}initAppData(e){this.setState(t=>{t.appData=e},"initAppData")}setAppData(e,t,i){let r=(t==null?void 0:t.constructor.name)==="Object";this.setState(n=>{if(n.appData)i&&r?Object.assign(n.appData[e],t):n.appData[e]=t;else{let s={[e]:t};n.appData=s}},`setAppData-${e}`)}rejectChangeRole(e){this.removeRoleChangeRequest(e)}endRoom(e,t){return Y(this,null,function*(){let i=this.store.getState(Wd);if(!(i!=null&&i.endRoom)){Ce.w("You are not allowed to perform this action - endRoom");return}let r=this.store.getState(Ct);this.setState(n=>{n.room.roomState=Ue.Disconnecting},"endingRoom");try{yield this.sdk.endRoom(e,t),this.resetState("endRoom")}catch(n){Ce.e("error in ending room - ",n),this.setState(s=>{s.room.roomState=r},"revertEndRoom")}})}removePeer(e,t){return Y(this,null,function*(){let i=this.hmsSDKPeers[e];if(i&&!i.isLocal)yield this.sdk.removePeer(i,t);else{this.logPossibleInconsistency(`No remote peer found for peerID - ${e}`);return}})}startRTMPOrRecording(e){return Y(this,null,function*(){yield this.sdk.startRTMPOrRecording(e)})}stopRTMPAndRecording(){return Y(this,null,function*(){yield this.sdk.stopRTMPAndRecording()})}startHLSStreaming(e){return Y(this,null,function*(){yield this.sdk.startHLSStreaming(e)})}stopHLSStreaming(e){return Y(this,null,function*(){yield this.sdk.stopHLSStreaming(e)})}sendHLSTimedMetadata(e){return Y(this,null,function*(){yield this.sdk.sendHLSTimedMetadata(e)})}changeName(e){return Y(this,null,function*(){yield this.sdk.changeName(e)})}changeMetadata(e){return Y(this,null,function*(){typeof e!="string"&&(e=JSON.stringify(e)),yield this.sdk.changeMetadata(e)})}setSessionMetadata(e){return Y(this,null,function*(){yield this.sdk.setSessionMetadata(e),this.setState(t=>{t.sessionMetadata=e},"setSessionMetadata")})}populateSessionMetadata(){return Y(this,null,function*(){let e=yield this.sdk.getSessionMetadata();this.setState(t=>{t.sessionMetadata=e},"populateSessionMetadata")})}setRemoteTrackEnabled(e,t){return Y(this,null,function*(){if(typeof e=="string"){let i=this.hmsSDKTracks[e];i&&hh(i)?yield this.sdk.changeTrackState(i,t):this.logPossibleInconsistency(`No remote track with ID ${e} found for change track state`)}else Array.isArray(e)&&e.forEach(i=>this.setRemoteTrackEnabled(i,t))})}setRemoteTracksEnabled(e){return Y(this,null,function*(){let t={enabled:e.enabled,type:e.type,source:e.source};if(e.roles){let i=this.store.getState(ji);t.roles=e.roles.map(r=>i[r])}yield this.sdk.changeMultiTrackState(t)})}setLogLevel(e){Ce.level=e,this.sdk.setLogLevel(e)}setFrameworkInfo(e){this.sdk.setFrameworkInfo(e)}ignoreMessageTypes(e,t=!1){if(t)this.ignoredMessageTypes=e;else for(let i of e)this.ignoredMessageTypes.includes(i)||this.ignoredMessageTypes.push(i)}resetState(e="resetState"){this.isRoomJoinCalled=!1,this.hmsSDKTracks={},Ce.cleanUp(),this.setState(t=>{Object.assign(t,Ho())},e)}sdkJoinWithListeners(e){return Y(this,null,function*(){yield this.sdk.join(e,{onJoin:this.onJoin.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)})})}onRemovedFromRoom(e){var t;let i=this.store.getState(ei((t=e.requestedBy)==null?void 0:t.peerId));this.hmsNotifications.sendLeaveRoom(Yn(ii({},e),{requestedBy:i||void 0}));let r=e.roomEnded||!i?"roomEnded":"removedFromRoom";Ce.i(`resetting state after peer removed ${r}`,e),this.resetState(r)}onDeviceChange(e){let t=e.devices;if(!t)return;let i=this.store.getState(vt);if(this.setState(r=>{Kt(r.devices.audioInput,t.audioInput)||(r.devices.audioInput=t.audioInput),Kt(r.devices.videoInput,t.videoInput)||(r.devices.videoInput=t.videoInput),Kt(r.devices.audioOutput,t.audioOutput)||(r.devices.audioOutput=t.audioOutput),this.hmsSDKPeers[i==null?void 0:i.id]&&Object.assign(r.settings,this.getMediaSettings(this.hmsSDKPeers[i==null?void 0:i.id]))},"deviceChange"),e.selection){let r=$e.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(r)}}sdkPreviewWithListeners(e){return Y(this,null,function*(){yield this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})})}onNetworkQuality(e){this.setState(t=>{var i;let r=t.room.localPeer||((i=this.sdk.getLocalPeer())==null?void 0:i.peerId);r&&(t.connectionQualities[r]={peerID:r,downlinkQuality:e})},"ConnectionQuality")}startScreenShare(e){return Y(this,null,function*(){this.store.getState(Sn)?this.logPossibleInconsistency("start screenshare is called while it's on"):(yield this.sdk.startScreenShare(()=>this.syncRoomState("screenshareStopped"),e),this.syncRoomState("startScreenShare"))})}stopScreenShare(){return Y(this,null,function*(){this.store.getState(Sn)?(yield this.sdk.stopScreenShare(),this.syncRoomState("stopScreenShare")):this.logPossibleInconsistency("stop screenshare is called while it's not on")})}attachVideoInternal(e,t){return Y(this,null,function*(){let i=this.hmsSDKTracks[e];i&&i.type==="video"?(i.addSink(t),this.updateVideoLayer(e,"attachVideo")):this.logPossibleInconsistency("no video track found to add sink")})}syncRoomState(e){e=`${e}_fullSync`,Ce.time(`store-sync-${e}`);let t={},i=[],r={},n={},s={},a=this.sdk.getPeers();for(let u of a){let d=$e.convertPeer(u);t[d.id]=d,i.push(d.id),this.hmsSDKPeers[d.id]=u;let h=[u.audioTrack,u.videoTrack,...u.auxiliaryTracks];for(let f of h){if(!f)continue;let v=$e.convertTrack(f);r[v.id]=v,n[f.trackId]=f}d.isLocal&&Object.assign(s,this.getMediaSettings(u))}let o=this.sdk.getRecordingState(),l=this.sdk.getRTMPState(),c=this.sdk.getHLSState();this.setState(u=>{u.room.peers=i;let d=u.peers,h=u.tracks;ph(d,t),fh(h,r),Object.assign(u.settings,s),this.hmsSDKTracks=n,Object.assign(u.roles,$e.convertRoles(this.sdk.getRoles())),Object.assign(u.playlist,$e.convertPlaylist(this.sdk.getPlaylistManager())),Object.assign(u.room,$e.convertRecordingStreamingState(o,l,c))},e),Ce.timeEnd(`store-sync-${e}`)}onPreview(e){this.setState(t=>{Object.assign(t.room,$e.convertRoom(e)),t.room.roomState=Ue.Preview},"previewStart"),this.syncRoomState("previewSync")}onJoin(e){let t=this.sdk.getPlaylistManager();this.audioPlaylist=new aa(t,Ie.audio,this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new aa(t,Ie.video,this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState(i=>{Object.assign(i.room,$e.convertRoom(e)),i.room.isConnected=!0,i.room.roomState=Ue.Connected},"joined"),t.onProgress(this.setProgress),t.onNewTrackStart(i=>{this.syncPlaylistState(`${i.type}PlaylistUpdate`)}),t.onPlaylistEnded(i=>{this.syncPlaylistState(`${i}PlaylistEnded`)}),t.onCurrentTrackEnded(i=>{this.hmsNotifications.sendPlaylistTrackEnded($e.convertPlaylistItem(t,i)),this.syncPlaylistState(`${i.type}PlaylistItemEnded`)})}onRoomUpdate(e,t){this.setState(i=>{Object.assign(i.room,$e.convertRoom(t))},e)}onPeerUpdate(e,t){if(![Qe.BECAME_DOMINANT_SPEAKER,Qe.RESIGNED_DOMINANT_SPEAKER].includes(e)){if(Array.isArray(t)){this.syncRoomState("peersJoined");let i=[];for(let r of t){let n=this.store.getState(ei(r.peerId));n&&i.push(n)}this.hmsNotifications.sendPeerList(i);return}this.sendPeerUpdateNotification(e,t)}}onTrackUpdate(e,t,i){if(e===ke.TRACK_REMOVED)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,i);else{let r=zo[e]||"trackUpdate";this.syncRoomState(r),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}onMessageReceived(e){let t=$e.convertMessage(e);t.read=!1,t.ignored=this.ignoredMessageTypes.includes(t.type),this.putMessageInStore(t),this.hmsNotifications.sendMessageReceived(t)}putMessageInStore(e){e.ignored||this.setState(t=>{e.id=String(this.store.getState(Hd)+1),t.messages.byID[e.id]=e,t.messages.allIDs.push(e.id)},"newMessage")}onAudioLevelUpdate(e){this.setState(t=>{let i={};e.forEach(n=>{if(!n.track||!n.peer)return;let s=n.track.trackId;i[s]=n.audioLevel,t.speakers[s]||(t.speakers[s]={audioLevel:n.audioLevel,peerID:n.peer.peerId,trackID:s})});let r=Object.entries(t.speakers);for(let[n,s]of r)s.audioLevel=i[n]||0,s.audioLevel===0&&delete t.speakers[n]},"audioLevel")}onConnectionQualityUpdate(e){this.setState(t=>{let i=new Set;e.forEach(n=>{let s=n.peerID;!s||(i.add(s),t.connectionQualities[s]?Object.assign(t.connectionQualities[s],n):t.connectionQualities[s]=n)});let r=Object.keys(t.connectionQualities);for(let n of r)i.has(n)||delete t.connectionQualities[n]},"connectionQuality")}onChangeTrackStateRequest(e){var t;let i=this.store.getState(ei((t=e.requestedBy)==null?void 0:t.peerId)),r=this.getStoreLocalTrackIDfromSDKTrack(e.track),n=this.store.getState(dl(r));if(!n)return this.logPossibleInconsistency(`Not found track for which track state change was requested, ${e.track}`);e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:i||void 0,track:n,enabled:e.enabled})}onChangeMultiTrackStateRequest(e){var t;let i=this.store.getState(ei((t=e.requestedBy)==null?void 0:t.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");let r=[],n=this.store.getState(qe);for(let s of e.tracks){let a=this.getStoreLocalTrackIDfromSDKTrack(s);a&&n[a]&&r.push(n[a])}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:i||void 0,tracks:r,enabled:e.enabled,type:e.type,source:e.source})}onReconnected(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState(e=>{e.room.roomState=e.room.isConnected?Ue.Connected:Ue.Preview},"reconnected")}onReconnecting(e){let t=$e.convertException(e);Ce.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState(i=>{i.room.roomState=Ue.Reconnecting,i.errors.push(t)},"reconnecting")}onError(e){let t=$e.convertException(e);t.isTerminal?(this.leave().then(()=>Ce.e("error from SDK, left room.")),this.setState(i=>{i.room.roomState=Ue.Failed,i.errors.push(t)},"errorTerminal")):this.store.getState().errors.length<50&&this.setState(i=>{i.errors.push(t)},"error"),this.syncRoomState("errorSync"),this.hmsNotifications.sendError(t),Ce.e("received error from sdk",t instanceof Q?`${t}`:t)}updateVideoLayer(e,t){let i=this.hmsSDKTracks[e];if(i&&i instanceof ai){let r=this.store.getState(hl(e));((r==null?void 0:r.layer)!==i.getSimulcastLayer()||(r==null?void 0:r.degraded)!==i.degraded)&&this.setState(n=>{let s=n.tracks[e];s.layer=i.getSimulcastLayer(),s.degraded=i.degraded},t)}}handleTrackRemove(e,t){this.setState(i=>{let r=i.peers[t.peerId],n=i.tracks,s=e.trackId;if(this.isSameStoreSDKTrack(s,r==null?void 0:r.audioTrack))r==null||delete r.audioTrack;else if(this.isSameStoreSDKTrack(s,r==null?void 0:r.videoTrack))r==null||delete r.videoTrack;else{let a=r==null?void 0:r.auxiliaryTracks.indexOf(s);a>-1&&this.isSameStoreSDKTrack(s,r==null?void 0:r.auxiliaryTracks[a])&&(r==null||r.auxiliaryTracks.splice(a,1))}delete n[s],delete this.hmsSDKTracks[s]},"trackRemoved")}setEnabledSDKTrack(e,t){return Y(this,null,function*(){let i=this.hmsSDKTracks[e];i?yield i.setEnabled(t):this.logPossibleInconsistency(`track ${e} not present, unable to enabled/disable`)})}setSDKLocalVideoTrackSettings(e,t){return Y(this,null,function*(){let i=this.hmsSDKTracks[e];i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}setSDKLocalAudioTrackSettings(e,t){return Y(this,null,function*(){let i=this.hmsSDKTracks[e];i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}getMediaSettings(e){var t;let i=this.store.getState(Zo),r=e.audioTrack,n=e.videoTrack;return{audioInputDeviceId:(r==null?void 0:r.settings.deviceId)||i.audioInputDeviceId,videoInputDeviceId:(n==null?void 0:n.settings.deviceId)||i.videoInputDeviceId,audioOutputDeviceId:(t=this.sdk.getAudioOutput().getDevice())==null?void 0:t.deviceId}}setTrackVolume(e,t){let i=this.hmsSDKTracks[t];i?i instanceof Wn?(i.setVolume(e),this.setState(r=>{let n=r.tracks[t];n&&n.type==="audio"&&(n.volume=e)},"trackVolume")):Ce.w(`track ${t} is not an audio track`):this.logPossibleInconsistency(`track ${t} not present, unable to set volume`)}localAndVideoUnmuting(e){if(this.store.getState(vt).videoTrack!==e)return!1;let t=this.store.getState(jd),i=this.store.getState(bn);return t&&!i}logPossibleInconsistency(e){Ce.w("possible inconsistency detected - ",e)}addRemoveVideoPlugin(e,t,i){return Y(this,null,function*(){if(!e){Ce.w("Invalid plugin received in store");return}let r=this.store.getState(Nt);if(r){let n=this.hmsSDKTracks[r];n?(t==="add"?yield n.addPlugin(e,i):t==="remove"&&(yield n.removePlugin(e)),this.syncRoomState(`${t}VideoPlugin`)):this.logPossibleInconsistency(`track ${r} not present, unable to remove plugin`)}})}addRemoveAudioPlugin(e,t){return Y(this,null,function*(){if(!e){Ce.w("Invalid plugin received in store");return}let i=this.store.getState(Lt);if(i){let r=this.hmsSDKTracks[i];r?(t==="add"?yield r.addPlugin(e):t==="remove"&&(yield r.removePlugin(e)),this.syncRoomState(`${t}AudioPlugin`)):this.logPossibleInconsistency(`track ${i} not present, unable to remove plugin`)}})}isSameStoreSDKTrack(e,t){var i;return t?((i=this.hmsSDKTracks[t])==null?void 0:i.trackId)===e:!1}onRoleChangeRequest(e){this.setState(t=>{t.roleChangeRequests.length===0&&t.roleChangeRequests.push($e.convertRoleChangeRequest(e))},"roleChangeRequest")}removeRoleChangeRequest(e){this.setState(t=>{let i=t.roleChangeRequests.findIndex(r=>r.token===e.token);i!==-1&&t.roleChangeRequests.splice(i,1)},"removeRoleChangeRequest")}onRoleUpdate(){this.syncRoomState("roleUpdate")}getStoreLocalTrackIDfromSDKTrack(e){return this.store.getState(Bd).find(t=>this.hmsSDKTracks[t].trackId===e.trackId)}},ml=e=>_i?`${e} ${document.title}`:e,vh=(e,t,i)=>{let r;i.getState(Ct)===Ue.Connected&&(r=oa(e,t,i)),i.subscribe(n=>{[Ue.Connected,Ue.Reconnecting].includes(n)?r||(r=oa(e,t,i)):[Ue.Disconnected,Ue.Failed].includes(n)&&r&&(bh(t,n),r(),r=void 0)},Ct)},oa=(e,t,i)=>{var r,n;let s=yh(i,t);(r=e.getWebrtcInternals())==null||r.start();let a=(n=e.getWebrtcInternals())==null?void 0:n.onStatsChange(o=>Th(t,o,i));return()=>{s(),a&&a()}},yh=(e,t)=>{let i,r,n;return e.getState(xi)?t.namedSetState(s=>{s.localPeer.id=e.getState(xi)},"localpeer-id"):i=e.subscribe(s=>{s&&t.namedSetState(a=>{a.localPeer.id=s},"localpeer-id")},xi),e.getState(Nt)?t.namedSetState(s=>{s.localPeer.videoTrack=e.getState(Nt)},"localpeer-videotrack-id"):r=e.subscribe(s=>{s&&t.namedSetState(a=>{a.localPeer.videoTrack=s},"localpeer-videotrack-id")},Nt),e.getState(Lt)?t.namedSetState(s=>{s.localPeer.videoTrack=e.getState(Lt)},"localpeer-audiotrack-id"):n=e.subscribe(s=>{s&&t.namedSetState(a=>{a.localPeer.videoTrack=s},"localpeer-audiotrack-id")},Lt),()=>{i==null||i(),r==null||r(),n==null||n()}},Th=(e,t,i)=>{let r=i.getState(qe);e.namedSetState(n=>{let s={},a=Object.keys(r);for(let l of a){let c=t.getTrackStats(l);c&&(s[l]=c)}sa(n.trackStats,s);let o={[i.getState(xi)]:t.getLocalPeerStats()};sa(n.peerStats,o)},"webrtc-stats")},bh=(e,t="resetState")=>{e.namedSetState(i=>{Object.assign(i,Ko())},t)},Sh=class{constructor(e,t){this.hmsStore=e,this.sdk=t,this.store=Vt.createNewHMSStore(ml("HMSStatsStore"),Ko),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=()=>new Promise(i=>{var r,n;this.hmsStore.getState(Ct)==="Connected"?i((n=(r=this.sdk)==null?void 0:r.getWebrtcInternals())==null?void 0:n.getPublishPeerConnection()):this.hmsStore.subscribe(s=>{var a,o;s==="Connected"&&i((o=(a=this.sdk)==null?void 0:a.getWebrtcInternals())==null?void 0:o.getPublishPeerConnection())},Ct)}),this.getSubscribePeerConnection=()=>new Promise(i=>{var r,n;this.hmsStore.getState(Ct)==="Connected"?i((n=(r=this.sdk)==null?void 0:r.getWebrtcInternals())==null?void 0:n.getSubscribePeerConnection()):this.hmsStore.subscribe(s=>{var a,o;s==="Connected"&&i((o=(a=this.sdk)==null?void 0:a.getWebrtcInternals())==null?void 0:o.getSubscribePeerConnection())},Ct)}),this.sdk&&vh(this.sdk,this.store,this.hmsStore)}},kh=e=>e.localPeer.id,_h=e=>e.localPeer.audioTrack,Eh=e=>e.localPeer.videoTrack,Ch=(e,t)=>t,Rh=(e,t)=>t,cs=e=>e.trackStats,gl=e=>e.peerStats,Qt=$([gl,kh],(e,t)=>e[t]);$(Qt,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.packetsLost});$(Qt,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.jitter});$(Qt,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.bitrate});$(Qt,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.bitrate});$(Qt,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.availableOutgoingBitrate});$(Qt,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.availableIncomingBitrate});$(Qt,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.bytesSent});$(Qt,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.bytesReceived});$([gl,Ch],(e,t)=>t?e[t]:void 0);var Ki=$([cs,Rh],(e,t)=>t?e[t]:void 0);Ke($(Ki,e=>e==null?void 0:e.bitrate));Ke($(Ki,e=>e==null?void 0:e.bytesReceived));Ke($(Ki,e=>e==null?void 0:e.framesPerSecond));Ke($(Ki,e=>e==null?void 0:e.jitter));Ke($(Ki,e=>e==null?void 0:e.packetsLost));var vl=$([cs,_h],(e,t)=>t?e[t]:void 0),$r=$([cs,Eh],(e,t)=>t?e[t]:void 0);$(vl,e=>e==null?void 0:e.bitrate);$($r,e=>e==null?void 0:e.bitrate);$(vl,e=>e==null?void 0:e.bytesSent);$($r,e=>e==null?void 0:e.bytesSent);$($r,e=>e==null?void 0:e.framesPerSecond);$($r,e=>e==null?void 0:e.qualityLimitationReason);var Vt=class{constructor(e,t,i){this.getStats=()=>(this.stats||(this.stats=new Sh(this.store,this.sdk)),this.stats),e?this.store=e:this.store=Vt.createNewHMSStore(ml("HMSStore"),Ho),i?this.notifications=i:this.notifications=new dh(this.store),t?this.actions=t:(this.sdk=new Sd,this.actions=new gh(this.store,this.sdk,this.notifications)),this.actions.setFrameworkInfo({type:"js",sdkVersion:Md().version}),this.initialTriggerOnSubscribe=!1,_i&&(window.__hms=this)}triggerOnSubscribe(){this.initialTriggerOnSubscribe||(Vt.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}getStore(){return this.store}getHMSActions(){return this.actions}getActions(){return this.actions}getNotifications(){return{onNotification:this.notifications.onNotification}}static createNewHMSStore(e,t){let i=uc(()=>t()),r=i.setState;i.setState=a=>{let o=typeof a=="function"?lc(a):a;r(o)};let n=i.getState;i.getState=a=>a?a(n()):n(),Vt.compareWithShallowCheckInSubscribe(i);let s=Vt.setUpDevtools(i,e);return Yn(ii({},i),{namedSetState:s})}static makeStoreTriggerOnSubscribe(e){let t=e.subscribe;e.subscribe=(i,r,n)=>(i(e.getState(r),void 0),t(i,r,n))}static compareWithShallowCheckInSubscribe(e){let t=e.subscribe;e.subscribe=(i,r,n)=>(r||(r=s=>s),n=n||cc,t(i,r,n))}static setUpDevtools(e,t){let i;try{i=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!i)return s=>{e.setState(s)};let r=i.connect(Vt.devtoolsOptions(t));r.prefix=t?`${t} > `:"";let n=e.setState;return e.setState=s=>{n(s),r.send(`${r.prefix}setState`,e.getState())},r.subscribe(Vt.devtoolsSubscribe(r,e,n)),r.send("setUpStore",e.getState()),(s,a)=>{n(s);let o=a||`${r.prefix}action`;r.send(o,e.getState())}}static devtoolsOptions(e){return{name:e,actionsBlacklist:["audioLevel","playlistProgress","connectionQuality"]}}static devtoolsSubscribe(e,t,i){return r=>{var n,s,a,o;if(r.type==="DISPATCH"&&r.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(r.payload.type)?i(JSON.parse(r.state)):t.setState(JSON.parse(r.state));else if(r.type==="DISPATCH"&&((n=r.payload)==null?void 0:n.type)==="COMMIT")e.init(t.getState());else if(r.type==="DISPATCH"&&((s=r.payload)==null?void 0:s.type)==="IMPORT_STATE"){let l=(a=r.payload.nextLiftedState)==null?void 0:a.actionsById;(((o=r.payload.nextLiftedState)==null?void 0:o.computedStates)||[]).forEach(({state:c},u)=>{let d=l[u]||`${e.prefix}setState`;u===0?e.init(c):(i(c),e.send(d,t.getState()))})}}}};const xr=new Vt;xr.triggerOnSubscribe();const st=xr.getActions(),At=xr.getStore(),yl=xr.getNotifications();function la(e){let t,i,r;var n=e[4];function s(a){return{}}return n&&(i=vs(n,s())),{c(){t=w("div"),i&&K(i.$$.fragment),y(t,"class","Icon svelte-1r8bims")},m(a,o){V(a,t,o),i&&j(i,t,null),r=!0},p(a,o){if(n!==(n=a[4])){if(i){Ve();const l=i;O(l.$$.fragment,1,0,()=>{q(l,1)}),je()}n?(i=vs(n,s()),K(i.$$.fragment),A(i.$$.fragment,1),j(i,t,null)):i=null}},i(a){r||(i&&A(i.$$.fragment,a),r=!0)},o(a){i&&O(i.$$.fragment,a),r=!1},d(a){a&&G(t),i&&q(i)}}}function Ph(e){let t,i,r,n,s,a,o,l,c,u=e[4]!==null&&la(e);return{c(){t=w("span"),i=w("input"),r=re(),u&&u.c(),n=re(),s=w("div"),a=He(e[1]),i.value=e[0],y(i,"type",e[2]),y(i,"name",e[3]),y(i,"class","svelte-1r8bims"),Re(i,"IconedInput",e[4]!==null),y(s,"class","Placeholder svelte-1r8bims"),Re(s,"Iconed",e[4]!==null),Re(s,"Lifted",e[5]||e[6]),Re(s,"Focused",e[5]),y(t,"class","svelte-1r8bims")},m(d,h){V(d,t,h),E(t,i),E(t,r),u&&u.m(t,null),E(t,n),E(t,s),E(s,a),o=!0,l||(c=[Le(i,"input",e[7]),Le(i,"focus",e[8]),Le(i,"blur",e[9])],l=!0)},p(d,[h]){(!o||h&1&&i.value!==d[0])&&(i.value=d[0]),(!o||h&4)&&y(i,"type",d[2]),(!o||h&8)&&y(i,"name",d[3]),(!o||h&16)&&Re(i,"IconedInput",d[4]!==null),d[4]!==null?u?(u.p(d,h),h&16&&A(u,1)):(u=la(d),u.c(),A(u,1),u.m(t,n)):u&&(Ve(),O(u,1,1,()=>{u=null}),je()),(!o||h&2)&&ut(a,d[1]),(!o||h&16)&&Re(s,"Iconed",d[4]!==null),(!o||h&96)&&Re(s,"Lifted",d[5]||d[6]),(!o||h&32)&&Re(s,"Focused",d[5])},i(d){o||(A(u),o=!0)},o(d){O(u),o=!1},d(d){d&&G(t),u&&u.d(),l=!1,pt(c)}}}function Ah(e,t,i){let r,{value:n=""}=t;console.log(n);let s=!1,{placeholder:a="Placeholder"}=t,{type:o="text"}=t,{name:l=""}=t,{icon:c=null}=t;function u(f){i(0,n=f.target.value)}kt(()=>{i(0,n="")});const d=()=>i(5,s=!0),h=()=>i(5,s=!1);return e.$$set=f=>{"value"in f&&i(0,n=f.value),"placeholder"in f&&i(1,a=f.placeholder),"type"in f&&i(2,o=f.type),"name"in f&&i(3,l=f.name),"icon"in f&&i(4,c=f.icon)},e.$$.update=()=>{e.$$.dirty&1&&i(6,r=n!=="")},[n,a,o,l,c,s,r,u,d,h]}class ca extends te{constructor(t){super(),ee(this,t,Ah,Ph,Z,{value:0,placeholder:1,type:2,name:3,icon:4})}}function Ih(e){let t,i,r,n,s,a,o,l;const c=e[7].default,u=_n(c,e,e[6],null);return{c(){t=w("button"),i=w("div"),n=re(),u&&u.c(),y(i,"class","Ripple svelte-1u8sht2"),y(i,"style",r=`left:${e[2]}px;top:${e[3]}px;`),Re(i,"RippleActive",e[4]),y(t,"class",s=gi(e[1])+" svelte-1u8sht2"),y(t,"type",e[0])},m(d,h){V(d,t,h),E(t,i),E(t,n),u&&u.m(t,null),a=!0,o||(l=[Le(t,"click",e[5]),Le(t,"click",e[8])],o=!0)},p(d,[h]){(!a||h&12&&r!==(r=`left:${d[2]}px;top:${d[3]}px;`))&&y(i,"style",r),(!a||h&16)&&Re(i,"RippleActive",d[4]),u&&u.p&&(!a||h&64)&&Cn(u,c,d,d[6],a?En(c,d[6],h,null):Rn(d[6]),null),(!a||h&2&&s!==(s=gi(d[1])+" svelte-1u8sht2"))&&y(t,"class",s),(!a||h&1)&&y(t,"type",d[0])},i(d){a||(A(u,d),a=!0)},o(d){O(u,d),a=!1},d(d){d&&G(t),u&&u.d(d),o=!1,pt(l)}}}function Dh(e,t,i){let{$$slots:r={},$$scope:n}=t,s=0,a=0,o=!1;function l(h){console.log(h.offsetX,h.offsetY),i(2,s=h.offsetX),i(3,a=h.offsetY),i(4,o=!0),setTimeout(()=>i(4,o=!1),500)}let{type:c="button"}=t,{classes:u="RippleButton"}=t;function d(h){jl.call(this,e,h)}return e.$$set=h=>{"type"in h&&i(0,c=h.type),"classes"in h&&i(1,u=h.classes),"$$scope"in h&&i(6,n=h.$$scope)},[c,u,s,a,o,l,n,r,d]}class Yt extends te{constructor(t){super(),ee(this,t,Dh,Ih,Z,{type:0,classes:1})}}const hi=[];function wh(e,t){return{subscribe:Ut(e,t).subscribe}}function Ut(e,t=L){let i;const r=new Set;function n(o){if(Z(e,o)&&(e=o,i)){const l=!hi.length;for(const c of r)c[1](),hi.push(c,e);if(l){for(let c=0;c<hi.length;c+=2)hi[c][0](hi[c+1]);hi.length=0}}}function s(o){n(o(e))}function a(o,l=L){const c=[o,l];return r.add(c),r.size===1&&(i=t(n)||L),o(e),()=>{r.delete(c),r.size===0&&(i(),i=null)}}return{set:n,update:s,subscribe:a}}function Oh(e,t){t.subscribe(r=>{if(r==="")return;let n=new URL(window.location.href).hash;const s=new RegExp(`(&${e}=)([^&]+)`,"i");if(n.match(s)===null){if(r==="")return;n===""&&(n="#"),history.pushState({},null,n+`&${e}=`+r);return}console.log("trying to replace",s,r,n),n=n.replace(s,"$1"+r),history.pushState({},null,n)});function i(){console.log("!!!traceURL!!!");const r=new URL(window.location.href).hash,n=/&(.+)=(.+)/,s=r.match(n);if(console.log("!!!traceURL!!!",r),s===null){t.set("");return}const a=s[1],o=s[2];console.log("!!!traceURL!!!",e,o),e===a&&t.set(o)}window.addEventListener("popstate",i),window.addEventListener("hashchange",i),i()}const Ar=Ut("");Oh("token",Ar);const us=Ut(!1),St=Ut({type:"info",message:"Welcome!"});function Mh(e){let t,i,r,n,s,a,o;return{c(){t=ae("svg"),i=ae("path"),r=ae("animateTransform"),n=ae("path"),s=ae("animateTransform"),a=ae("path"),o=ae("animateTransform"),y(r,"attributeName","transform"),y(r,"attributeType","XML"),y(r,"type","rotate"),y(r,"dur","2s"),y(r,"from","0 50 50"),y(r,"to","360 50 50"),y(r,"repeatCount","indefinite"),y(i,"fill","#fff"),y(i,"d",`M31.6,3.5C5.9,13.6-6.6,42.7,3.5,68.4c10.1,25.7,39.2,38.3,64.9,28.1l-3.1-7.9c-21.3,8.4-45.4-2-53.8-23.3\r
  c-8.4-21.3,2-45.4,23.3-53.8L31.6,3.5z`),y(s,"attributeName","transform"),y(s,"attributeType","XML"),y(s,"type","rotate"),y(s,"dur","1s"),y(s,"from","0 50 50"),y(s,"to","-360 50 50"),y(s,"repeatCount","indefinite"),y(n,"fill","#fff"),y(n,"d",`M42.3,39.6c5.7-4.3,13.9-3.1,18.1,2.7c4.3,5.7,3.1,13.9-2.7,18.1l4.1,5.5c8.8-6.5,10.6-19,4.1-27.7\r
  c-6.5-8.8-19-10.6-27.7-4.1L42.3,39.6z`),y(o,"attributeName","transform"),y(o,"attributeType","XML"),y(o,"type","rotate"),y(o,"dur","2s"),y(o,"from","0 50 50"),y(o,"to","360 50 50"),y(o,"repeatCount","indefinite"),y(a,"fill","#fff"),y(a,"d",`M82,35.7C74.1,18,53.4,10.1,35.7,18S10.1,46.6,18,64.3l7.6-3.4c-6-13.5,0-29.3,13.5-35.3s29.3,0,35.3,13.5\r
  L82,35.7z`),y(t,"version","1.1"),y(t,"id","L7"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),y(t,"x","0px"),y(t,"y","0px"),y(t,"viewBox","0 0 100 100"),y(t,"enable-background","new 0 0 100 100"),y(t,"xml:space","preserve")},m(l,c){V(l,t,c),E(t,i),E(i,r),E(t,n),E(n,s),E(t,a),E(a,o)},p:L,i:L,o:L,d(l){l&&G(t)}}}class Tl extends te{constructor(t){super(),ee(this,t,null,Mh,Z,{})}}function Lh(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","M6 42v-3h4.6V6h19.5v2.25h7.35V39H42v3h-7.55V11.25H30.1V42Zm7.6-33v30Zm8.95 17q.85 0 1.425-.575.575-.575.575-1.425 0-.85-.575-1.425Q23.4 22 22.55 22q-.85 0-1.425.575-.575.575-.575 1.425 0 .85.575 1.425Q21.7 26 22.55 26ZM13.6 39h13.5V9H13.6Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class Nh extends te{constructor(t){super(),ee(this,t,null,Lh,Z,{})}}function $h(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","M7 44q-1.2 0-2.1-.9Q4 42.2 4 41V17q0-1.2.9-2.1.9-.9 2.1-.9h11.85V7q0-1.2.9-2.1.9-.9 2.1-.9h4.35q1.2 0 2.1.9.9.9.9 2.1v7H41q1.2 0 2.1.9.9.9.9 2.1v24q0 1.2-.9 2.1-.9.9-2.1.9Zm0-3h34V17H29.2q0 1.4-.925 2.2-.925.8-2.325.8h-3.9q-1.35 0-2.275-.8-.925-.8-.925-2.2H7v24Zm4.6-5.35h11.95v-.7q0-.9-.45-1.6-.45-.7-1.15-.95-1.6-.55-2.5-.725-.9-.175-1.75-.175-.95 0-2.025.225t-2.425.675q-.75.25-1.2.95-.45.7-.45 1.6Zm16.8-3.35h8.5v-2.5h-8.5Zm-10.7-2.5q1.15 0 1.925-.8.775-.8.775-1.9 0-1.15-.775-1.925-.775-.775-1.925-.775-1.1 0-1.9.775-.8.775-.8 1.925 0 1.1.8 1.9.8.8 1.9.8Zm10.7-3.15h8.5v-2.5h-8.5ZM21.85 17h4.35V7h-4.35ZM24 29Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class xh extends te{constructor(t){super(),ee(this,t,null,$h,Z,{})}}function Uh(e){let t;return{c(){t=He("Join")},m(i,r){V(i,t,r)},i:L,o:L,d(i){i&&G(t)}}}function Fh(e){let t,i;return t=new Tl({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Gh(e){let t,i,r,n;const s=[Fh,Uh],a=[];function o(l,c){return l[2]?0:1}return t=o(e),i=a[t]=s[t](e),{c(){i.c(),r=Jt()},m(l,c){a[t].m(l,c),V(l,r,c),n=!0},p(l,c){let u=t;t=o(l),t!==u&&(Ve(),O(a[u],1,1,()=>{a[u]=null}),je(),i=a[t],i||(i=a[t]=s[t](l),i.c()),A(i,1),i.m(r.parentNode,r))},i(l){n||(A(i),n=!0)},o(l){O(i),n=!1},d(l){a[t].d(l),l&&G(r)}}}function Bh(e){let t,i,r,n,s,a,o,l,c,u,d,h,f,v;function T(I){e[4](I)}let C={name:"name",placeholder:"What's your name?",icon:xh};e[0]!==void 0&&(C.value=e[0]),r=new ca({props:C}),Wt.push(()=>Ts(r,"value",T));function z(I){e[5](I)}let x={name:"token",placeholder:"What is the token for your room?",icon:Nh};return e[1]!==void 0&&(x.value=e[1]),o=new ca({props:x}),Wt.push(()=>Ts(o,"value",z)),d=new Yt({props:{type:"submit",classes:e[0]===""||e[1]===""||e[2]?"btn-disabled":"btn-primary",$$slots:{default:[Gh]},$$scope:{ctx:e}}}),{c(){t=w("form"),i=w("span"),K(r.$$.fragment),s=re(),a=w("span"),K(o.$$.fragment),c=re(),u=w("span"),K(d.$$.fragment),y(i,"class","Name svelte-2gakxs"),y(a,"class","Token svelte-2gakxs"),y(u,"class","Submit svelte-2gakxs"),y(t,"class","card card-shadow svelte-2gakxs")},m(I,U){V(I,t,U),E(t,i),j(r,i,null),E(t,s),E(t,a),j(o,a,null),E(t,c),E(t,u),j(d,u,null),h=!0,f||(v=Le(t,"submit",Fa(e[3])),f=!0)},p(I,[U]){const W={};!n&&U&1&&(n=!0,W.value=I[0],ys(()=>n=!1)),r.$set(W);const H={};!l&&U&2&&(l=!0,H.value=I[1],ys(()=>l=!1)),o.$set(H);const le={};U&7&&(le.classes=I[0]===""||I[1]===""||I[2]?"btn-disabled":"btn-primary"),U&132&&(le.$$scope={dirty:U,ctx:I}),d.$set(le)},i(I){h||(A(r.$$.fragment,I),A(o.$$.fragment,I),A(d.$$.fragment,I),h=!0)},o(I){O(r.$$.fragment,I),O(o.$$.fragment,I),O(d.$$.fragment,I),h=!1},d(I){I&&G(t),q(r),q(o),q(d),f=!1,v()}}}const ua="name",da="token";function Vh(e,t,i){let r=localStorage.getItem(ua)||"",n="";const s=Ar.subscribe(u=>i(1,n=u||localStorage.getItem(da)));let a=!1;async function o(){localStorage.setItem(ua,r),localStorage.setItem(da,n);try{i(2,a=!0),Ar.set(n),await st.join({userName:r,authToken:n,rememberDeviceSelection:!0}),St.set({type:"good",message:"Succeefully joined the room. "})}catch(u){St.set({type:"error",message:u.message})}finally{i(2,a=!1)}}kt(s);function l(u){r=u,i(0,r)}function c(u){n=u,i(1,n)}return[r,n,a,o,l,c]}class jh extends te{constructor(t){super(),ee(this,t,Vh,Bh,Z,{})}}function It(e){return wh(At.getState(e),t=>At.subscribe(t,e))}const qh=It(el),bl=It(tl),Hh=It(Vd),Kh=It(bn),Wh=It(Ud),zh=It(Zo),Sl=It(Nr),Jh=It(Sn),Qh=It(qd),Yh=It(il);class Zh extends te{constructor(t){super(),ee(this,t,null,null,Z,{})}}function Xh(e){let t;return{c(){t=w("section"),t.innerHTML=`<h1 class="normal-text svelte-1yzu3rp">Simon made a video meeting app with 100ms.</h1> 
    <p class="sub-text svelte-1yzu3rp">The frontend took most of the time and maybe I over engineered a little bit.</p>`,y(t,"class","svelte-1yzu3rp")},m(i,r){V(i,t,r)},p:L,i:L,o:L,d(i){i&&G(t)}}}class ep extends te{constructor(t){super(),ee(this,t,null,Xh,Z,{})}}function tp(e){let t,i,r,n,s,a,o;return r=new ep({}),a=new jh({}),{c(){t=w("section"),i=w("div"),K(r.$$.fragment),n=re(),s=w("div"),K(a.$$.fragment),y(i,"class","OpeningWords svelte-124iq5m"),y(s,"class","JoinRoomForm"),y(t,"class","svelte-124iq5m")},m(l,c){V(l,t,c),E(t,i),j(r,i,null),E(t,n),E(t,s),j(a,s,null),o=!0},p:L,i(l){o||(A(r.$$.fragment,l),A(a.$$.fragment,l),o=!0)},o(l){O(r.$$.fragment,l),O(a.$$.fragment,l),o=!1},d(l){l&&G(t),q(r),q(a)}}}class ip extends te{constructor(t){super(),ee(this,t,null,tp,Z,{})}}function rp(e){let t,i,r,n,s,a,o;return r=new ip({}),a=new Zh({}),{c(){t=w("section"),i=w("div"),K(r.$$.fragment),n=re(),s=w("div"),K(a.$$.fragment),y(i,"class","ToDo svelte-13xym6b"),y(s,"class","FeatureIntro svelte-13xym6b"),y(t,"class","svelte-13xym6b")},m(l,c){V(l,t,c),E(t,i),j(r,i,null),E(t,n),E(t,s),j(a,s,null),o=!0},p:L,i(l){o||(A(r.$$.fragment,l),A(a.$$.fragment,l),o=!0)},o(l){O(r.$$.fragment,l),O(a.$$.fragment,l),o=!1},d(l){l&&G(t),q(r),q(a)}}}class np extends te{constructor(t){super(),ee(this,t,null,rp,Z,{})}}function sp(e){let t;return{c(){t=w("video"),y(t,"class","peer-video svelte-nb3mex"),t.autoplay=!0,t.muted=!0,t.playsInline=!0,Re(t,"local",e[0])},m(i,r){V(i,t,r),e[3](t)},p(i,[r]){r&1&&Re(t,"local",i[0])},i:L,o:L,d(i){i&&G(t),e[3](null)}}}function ap(e,t,i){let{isLocal:r}=t,{peerId:n}=t,s;wn(()=>At.subscribe(o=>{!o||!s||(o!=null&&o.enabled?st.attachVideo(o.id,s):st.detachVideo(o.id,s))},pl(n)));function a(o){Wt[o?"unshift":"push"](()=>{s=o,i(1,s)})}return e.$$set=o=>{"isLocal"in o&&i(0,r=o.isLocal),"peerId"in o&&i(2,n=o.peerId)},[r,s,n,a]}class op extends te{constructor(t){super(),ee(this,t,ap,sp,Z,{isLocal:0,peerId:2})}}function lp(e){let t,i;return{c(){t=w("div"),i=He(e[0]),Jr(t,"background",e[1]),y(t,"class","avatar svelte-9v2kxo")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}function cp(e){const t=e.split(/\s+/);return t.length===0?"":t.length===1?t[0].substring(0,2):t[0].charAt(0)+t[1].charAt(0)}function up(e,t,i){let{name:r}=t;const n=cp(r).toUpperCase(),s=["#616161","#3F51B5","#4CAF50","#FFA000","#795548","#E91E63","#2F80FF","#8BC34A","#F57C00","#673AB7","#009688","#FBC02D"],a=((n==null?void 0:n.codePointAt(0))||0)%s.length,o=s[a];return e.$$set=l=>{"name"in l&&i(2,r=l.name)},[n,o,r]}class dp extends te{constructor(t){super(),ee(this,t,up,lp,Z,{name:2})}}function hp(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","M3.046 3.046a.75.75 0 000 1.06l16.847 16.848a.75.75 0 101.06-1.06L4.108 3.045a.75.75 0 00-1.06 0zm.256 6.303a13.888 13.888 0 012.175-1.432l1.356 1.356c-.847.401-1.65.902-2.391 1.497a.91.91 0 01-1.14-1.42zm2.066 3.625A9.79 9.79 0 018.57 11.01l1.451 1.451a7.969 7.969 0 00-3.42 1.854.91.91 0 11-1.233-1.34zm7.503-2.543l2.563 2.563a7.968 7.968 0 011.927 1.297.91.91 0 101.227-1.346 9.79 9.79 0 00-5.717-2.514zm2.391 7.271L12.05 14.49h-.057a5.698 5.698 0 00-1.752.277c-.852.276-1.63.75-2.267 1.386a.91.91 0 101.286 1.29 3.878 3.878 0 013.66-1.019c.683.17 1.308.521 1.807 1.019.15.15.34.236.535.259zM9.048 6.608l1.582 1.583a12.07 12.07 0 018.928 2.584.91.91 0 001.14-1.42 13.89 13.89 0 00-11.65-2.747z"),y(i,"fill","red"),y(t,"viewBox","0 0 24 24"),y(t,"fill","none"),y(t,"xmlns","http://www.w3.org/2000/svg")},m(r,n){V(r,t,n),E(t,i)},p:L,d(r){r&&G(t)}}}function pp(e){let t,i,r,n,s,a,o,l,c;return{c(){t=ae("svg"),i=ae("path"),n=ae("path"),a=ae("path"),l=ae("path"),y(i,"d","M6.875 0c2.549.035 4.679.902 6.445 2.648.366.362.45.796.216 1.096-.239.306-.714.34-1.142.072a2.28 2.28 0 0 1-.341-.271C9.24.862 4.924.775 1.992 3.346c-.284.249-.594.419-.983.393-.272-.019-.49-.135-.613-.388-.125-.261-.05-.498.114-.713.073-.092.156-.177.245-.254C2.516.804 4.591.039 6.875 0Z"),y(i,"fill",r=Bt(4,e[0])),y(i,"transform","translate(-.333)"),y(n,"d","M7.056 2.964c1.756.035 3.208.7 4.499 1.763.162.134.277.315.354.512.098.251.114.503-.075.72-.193.222-.452.259-.725.198-.293-.066-.518-.247-.738-.443a4.859 4.859 0 0 0-6.198-.26c-.166.127-.318.271-.475.409-.242.211-.513.343-.843.317-.43-.034-.679-.397-.561-.81.062-.211.181-.4.345-.546 1.265-1.162 2.733-1.836 4.417-1.86Z"),y(n,"fill",s=Bt(3,e[0])),y(n,"transform","translate(-.333)"),y(a,"d","M7.384,6.052C8.293,6.068 9.157,6.449 9.783,7.108C10.005,7.339 10.157,7.6 10.07,7.942C9.959,8.377 9.435,8.581 9.071,8.243C7.935,7.191 6.356,7.183 5.152,8.183C4.816,8.462 4.6,8.485 4.332,8.27C4.063,8.055 3.998,7.691 4.177,7.358C4.273,7.179 4.414,7.038 4.57,6.911C5.26,6.349 6.149,6.05 7.384,6.052L7.384,6.052Z"),y(a,"fill",o=Bt(2,e[0])),y(l,"d","M8.214,9.941C8.214,10.234 8.097,10.515 7.888,10.721C7.68,10.928 7.398,11.042 7.104,11.039C6.471,11.036 5.982,10.541 5.993,9.912C6.004,9.259 6.499,8.766 7.133,8.779C7.744,8.791 8.22,9.301 8.214,9.941Z"),y(l,"fill",c=Bt(1,e[0])),y(t,"viewBox","0 0 14 12"),y(t,"xmlns","http://www.w3.org/2000/svg")},m(u,d){V(u,t,d),E(t,i),E(t,n),E(t,a),E(t,l)},p(u,d){d&1&&r!==(r=Bt(4,u[0]))&&y(i,"fill",r),d&1&&s!==(s=Bt(3,u[0]))&&y(n,"fill",s),d&1&&o!==(o=Bt(2,u[0]))&&y(a,"fill",o),d&1&&c!==(c=Bt(1,u[0]))&&y(l,"fill",c)},d(u){u&&G(t)}}}function fp(e){let t;function i(s,a){if(s[0]!==void 0&&s[0]>0)return pp;if(s[0]===0)return hp}let r=i(e),n=r&&r(e);return{c(){t=w("section"),n&&n.c(),y(t,"class","svelte-kyc0hb")},m(s,a){V(s,t,a),n&&n.m(t,null)},p(s,[a]){r===(r=i(s))&&n?n.p(s,a):(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(t,null)))},i:L,o:L,d(s){s&&G(t),n&&n.d()}}}const mp=(e,t)=>At.subscribe(i=>{t(i==null?void 0:i.downlinkQuality)},rh(e)),Bt=(e,t)=>{const i="#303740";return e<=t?t>=4?"#37F28D":t>=3?"#FAC919":"#ED4C5A":i};function gp(e,t,i){let{peerId:r}=t,n;const s=mp(r,a=>i(0,n=a));return kt(s),e.$$set=a=>{"peerId"in a&&i(1,r=a.peerId)},[n,r]}class vp extends te{constructor(t){super(),ee(this,t,gp,fp,Z,{peerId:1})}}function yp(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","m34.3 29.95-2.15-2.15q1.05-1.3 1.55-2.925.5-1.625.5-3.325h3q0 2.3-.75 4.45-.75 2.15-2.15 3.95ZM23.05 18.7Zm4.85 4.85-2.65-2.6V9.05q0-.85-.6-1.45T23.2 7q-.85 0-1.45.6t-.6 1.45v7.75l-3-3V9.05q0-2.1 1.475-3.575T23.2 4q2.1 0 3.575 1.475T28.25 9.05v12.5q0 .4-.075 1t-.275 1ZM21.7 42v-6.8q-5.3-.55-8.9-4.45-3.6-3.9-3.6-9.2h3q0 4.55 3.225 7.65 3.225 3.1 7.775 3.1 1.9 0 3.65-.625t3.2-1.725l2.15 2.15q-1.55 1.3-3.45 2.075-1.9.775-4.05 1.025V42Zm19.85 3.25L1.8 5.5l1.9-1.9 39.75 39.75Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class kl extends te{constructor(t){super(),ee(this,t,null,yp,Z,{})}}function Tp(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","M24 26.85q-2.15 0-3.6-1.55-1.45-1.55-1.45-3.75V9q0-2.1 1.475-3.55Q21.9 4 24 4t3.575 1.45Q29.05 6.9 29.05 9v12.55q0 2.2-1.45 3.75-1.45 1.55-3.6 1.55Zm0-11.4ZM22.5 42v-6.8q-5.3-.55-8.9-4.45-3.6-3.9-3.6-9.2h3q0 4.55 3.225 7.65Q19.45 32.3 24 32.3q4.55 0 7.775-3.1Q35 26.1 35 21.55h3q0 5.3-3.6 9.2-3.6 3.9-8.9 4.45V42ZM24 23.85q.9 0 1.475-.675.575-.675.575-1.625V9q0-.85-.6-1.425Q24.85 7 24 7t-1.45.575q-.6.575-.6 1.425v12.55q0 .95.575 1.625T24 23.85Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class _l extends te{constructor(t){super(),ee(this,t,null,Tp,Z,{})}}function bp(e){let t,i;return t=new op({props:{isLocal:e[0].isLocal,peerId:e[0].id}}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},p(r,n){const s={};n&1&&(s.isLocal=r[0].isLocal),n&1&&(s.peerId=r[0].id),t.$set(s)},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Sp(e){let t,i,r;return i=new dp({props:{name:e[0].name}}),{c(){t=w("div"),K(i.$$.fragment),y(t,"class","avatar-container svelte-6muxnv")},m(n,s){V(n,t,s),j(i,t,null),r=!0},p(n,s){const a={};s&1&&(a.name=n[0].name),i.$set(a)},i(n){r||(A(i.$$.fragment,n),r=!0)},o(n){O(i.$$.fragment,n),r=!1},d(n){n&&G(t),q(i)}}}function kp(e){let t,i;return t=new _l({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function _p(e){let t,i;return t=new kl({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Ep(e){let t,i,r,n,s,a,o,l,c,u,d,h,f,v=e[0].name+"",T,C,z,x=e[0].isLocal?" (You)":"",I,U,W;const H=[Sp,bp],le=[];function ce(he,Ne){var Ge,ie;return!((Ge=he[1])!=null&&Ge.enabled)||((ie=he[1])==null?void 0:ie.degraded)?0:1}i=ce(e),r=le[i]=H[i](e),a=new vp({props:{peerId:e[0].id}});const J=[_p,kp],ue=[];function ye(he,Ne){return he[2]?1:0}return c=ye(e),u=ue[c]=J[c](e),{c(){t=w("div"),r.c(),n=re(),s=w("div"),K(a.$$.fragment),o=re(),l=w("div"),u.c(),d=re(),h=w("div"),f=w("span"),T=He(v),C=re(),z=w("div"),I=He(x),y(s,"class","ConnectionQuality svelte-6muxnv"),y(l,"class","MicState svelte-6muxnv"),y(f,"class","svelte-6muxnv"),y(h,"class","peer-name normal-text svelte-6muxnv"),y(t,"class","video-container svelte-6muxnv"),y(t,"style",U=e[3]+"transition: all 0.5s ease-in-out;"),Re(t,"PeerHovering",e[0].id===e[4])},m(he,Ne){V(he,t,Ne),le[i].m(t,null),E(t,n),E(t,s),j(a,s,null),E(t,o),E(t,l),ue[c].m(l,null),E(t,d),E(t,h),E(h,f),E(f,T),E(h,C),E(h,z),E(z,I),W=!0},p(he,[Ne]){let Ge=i;i=ce(he),i===Ge?le[i].p(he,Ne):(Ve(),O(le[Ge],1,1,()=>{le[Ge]=null}),je(),r=le[i],r?r.p(he,Ne):(r=le[i]=H[i](he),r.c()),A(r,1),r.m(t,n));const ie={};Ne&1&&(ie.peerId=he[0].id),a.$set(ie);let at=c;c=ye(he),c!==at&&(Ve(),O(ue[at],1,1,()=>{ue[at]=null}),je(),u=ue[c],u||(u=ue[c]=J[c](he),u.c()),A(u,1),u.m(l,null)),(!W||Ne&1)&&v!==(v=he[0].name+"")&&ut(T,v),(!W||Ne&1)&&x!==(x=he[0].isLocal?" (You)":"")&&ut(I,x),(!W||Ne&8&&U!==(U=he[3]+"transition: all 0.5s ease-in-out;"))&&y(t,"style",U),(!W||Ne&17)&&Re(t,"PeerHovering",he[0].id===he[4])},i(he){W||(A(r),A(a.$$.fragment,he),A(u),W=!0)},o(he){O(r),O(a.$$.fragment,he),O(u),W=!1},d(he){he&&G(t),le[i].d(),q(a),ue[c].d()}}}const Cp=(e,t)=>At.subscribe(i=>t(i),ih(e));console.log("all speakers",At.getState(Xo));const Rp=(e,t)=>At.subscribe(i=>{t(i)},pl(e)),Pp=(e,t)=>At.subscribe(i=>{t(i)},ah(e)),Wi=Ut("");Wi.subscribe(e=>console.error(e));function qt(e){return()=>{Wi.set(e)}}function El(){Wi.set("")}function Ap(e,t,i){let r,n,s=L;Fe(e,Wi,f=>i(4,n=f)),e.$$.on_destroy.push(()=>s());let{peer:a}=t,o,l=0,c=!1;const u=Rp(a.id,f=>i(1,o=f)),d=Cp(a.id,f=>i(5,l=f)),h=Pp(a.id,f=>i(2,c=f));return kt(()=>{u(),d(),h()}),e.$$set=f=>{"peer"in f&&i(0,a=f.peer)},e.$$.update=()=>{e.$$.dirty&32&&i(3,r=(f=>{const v=C=>1/(1+Math.exp(-C)),T="lightgreen";return`box-shadow: ${f?`0px 0px ${24*v(f)}px ${T}, 0px 0px ${16*v(f)}px ${T}`:""};`})(l))},[a,o,c,r,n,l]}class Ip extends te{constructor(t){super(),ee(this,t,Ap,Ep,Z,{peer:0})}}function ha(e,t,i){const r=e.slice();return r[4]=t[i],r}function pa(e,t){let i,r,n,s;return r=new Ip({props:{peer:t[4]}}),{key:e,first:null,c(){i=w("div"),K(r.$$.fragment),n=re(),y(i,"class","tile svelte-1pa7gn"),this.first=i},m(a,o){V(a,i,o),j(r,i,null),E(i,n),s=!0},p(a,o){t=a;const l={};o&2&&(l.peer=t[4]),r.$set(l)},i(a){s||(A(r.$$.fragment,a),s=!0)},o(a){O(r.$$.fragment,a),s=!1},d(a){a&&G(i),q(r)}}}function Dp(e){let t,i,r=[],n=new Map,s,a=e[1];const o=l=>l[4].id;for(let l=0;l<a.length;l+=1){let c=ha(e,a,l),u=o(c);n.set(u,r[l]=pa(u,c))}return{c(){t=w("div"),i=w("div");for(let l=0;l<r.length;l+=1)r[l].c();y(i,"class","gallery svelte-1pa7gn"),y(t,"class","gallery-container svelte-1pa7gn")},m(l,c){V(l,t,c),E(t,i);for(let u=0;u<r.length;u+=1)r[u].m(i,null);e[2](t),s=!0},p(l,[c]){c&2&&(a=l[1],Ve(),r=fi(r,c,o,1,l,a,n,i,Ka,pa,null,ha),je())},i(l){if(!s){for(let c=0;c<a.length;c+=1)A(r[c]);s=!0}},o(l){for(let c=0;c<r.length;c+=1)O(r[c]);s=!1},d(l){l&&G(t);for(let c=0;c<r.length;c+=1)r[c].d();e[2](null)}}}function wp({containerHeight:e,containerWidth:t,numTiles:i,aspectRatio:r=1}){let n={rows:0,cols:0,height:0,width:0};if(i<=0||t<=0||e<=0)return n;let s=0;for(let a=1;a<=i;a++){const o=Math.ceil(i/a);let l=Math.floor(t/a),c=Math.floor(l/r);const u=Math.floor(e/o);c>u&&(c=u,l=Math.floor(u*r));const d=l*c;d>s&&(s=d,n={rows:o,cols:a,height:c,width:l})}return n}function Op(e,t,i){let r;Fe(e,bl,o=>i(1,r=o));let n;const s=(o,l)=>{if(!n)return;const c=o.getBoundingClientRect().width,u=o.getBoundingClientRect().height,d=l.length;let h=wp({containerHeight:u,containerWidth:c,numTiles:d});n.style.setProperty("--width",`${h.width}px`),n.style.setProperty("--height",`${h.height}px`),n.style.setProperty("--cols",`${h.cols}`)};wn(()=>{const o=new ResizeObserver(()=>s(n,r));return o.observe(n),()=>o.unobserve(n)});function a(o){Wt[o?"unshift":"push"](()=>{n=o,i(0,n)})}return e.$$.update=()=>{e.$$.dirty&3&&s(n,r)},[n,r,a]}class Cl extends te{constructor(t){super(),ee(this,t,Op,Dp,Z,{})}}function Mp(e){let t;return{c(){t=w("video"),y(t,"class","peer-video svelte-16bvc5t"),Jr(t,"--objectFit",e[1]),t.autoplay=!0,t.muted=!0,t.playsInline=!0,Re(t,"mirror",e[0])},m(i,r){V(i,t,r),e[4](t)},p(i,[r]){r&2&&Jr(t,"--objectFit",i[1]),r&1&&Re(t,"mirror",i[0])},i:L,o:L,d(i){i&&G(t),e[4](null)}}}function Lp(e,t,i){let{mirror:r}=t,{trackId:n}=t,{objectFit:s="cover"}=t,a,o;function l(u,d){a&&a(),!(!u||!d)&&(a=At.subscribe(h=>{!h||(h!=null&&h.enabled?st.attachVideo(h.id,d):st.detachVideo(h.id,d))},hl(u)))}kt(()=>a==null?void 0:a());function c(u){Wt[u?"unshift":"push"](()=>{o=u,i(2,o)})}return e.$$set=u=>{"mirror"in u&&i(0,r=u.mirror),"trackId"in u&&i(3,n=u.trackId),"objectFit"in u&&i(1,s=u.objectFit)},e.$$.update=()=>{e.$$.dirty&12&&l(n,o)},[r,s,o,n,c]}class Np extends te{constructor(t){super(),ee(this,t,Lp,Mp,Z,{mirror:0,trackId:3,objectFit:1})}}function $p(e){var n;let t,i,r;return i=new Np({props:{mirror:!1,trackId:(n=e[0])==null?void 0:n.id,objectFit:"contain"}}),{c(){t=w("div"),K(i.$$.fragment),y(t,"class","screenshare-container svelte-1djfyo")},m(s,a){V(s,t,a),j(i,t,null),r=!0},p(s,[a]){var l;const o={};a&1&&(o.trackId=(l=s[0])==null?void 0:l.id),i.$set(o)},i(s){r||(A(i.$$.fragment,s),r=!0)},o(s){O(i.$$.fragment,s),r=!1},d(s){s&&G(t),q(i)}}}function xp(e,t,i){let r;Fe(e,Yh,o=>i(1,r=o));let n,s;const a=o=>{n&&n(),o&&(n=At.subscribe(l=>{i(0,s=l)},sh(o)))};return kt(()=>n==null?void 0:n()),e.$$.update=()=>{e.$$.dirty&2&&a(r==null?void 0:r.id)},[s,r]}class Up extends te{constructor(t){super(),ee(this,t,xp,$p,Z,{})}}function Fp(e){let t;return{c(){t=He("Allow Audio")},m(i,r){V(i,t,r)},i:L,o:L,d(i){i&&G(t)}}}function Gp(e){let t,i;return t=new Tl({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Bp(e){let t,i,r,n;const s=[Gp,Fp],a=[];function o(l,c){return l[0]?0:1}return t=o(e),i=a[t]=s[t](e),{c(){i.c(),r=Jt()},m(l,c){a[t].m(l,c),V(l,r,c),n=!0},p(l,c){let u=t;t=o(l),t!==u&&(Ve(),O(a[u],1,1,()=>{a[u]=null}),je(),i=a[t],i||(i=a[t]=s[t](l),i.c()),A(i,1),i.m(r.parentNode,r))},i(l){n||(A(i),n=!0)},o(l){O(i),n=!1},d(l){a[t].d(l),l&&G(r)}}}function Vp(e){let t,i,r,n,s,a,o,l;return o=new Yt({props:{classes:"btn-primary",$$slots:{default:[Bp]},$$scope:{ctx:e}}}),o.$on("click",e[1]),{c(){t=w("section"),i=w("h2"),i.textContent="Couldn't Play Audio :(",r=re(),n=w("p"),n.innerHTML=`The browser wants us to get a confirmation for playing the Audio.
        <br/>
		Please allow audio to proceed.`,s=re(),a=w("span"),K(o.$$.fragment),y(i,"class","normal-text svelte-4kp3uc"),y(n,"class","normal-text"),y(a,"class","svelte-4kp3uc"),y(t,"class","card card-dropin")},m(c,u){V(c,t,u),E(t,i),E(t,r),E(t,n),E(t,s),E(t,a),j(o,a,null),l=!0},p(c,[u]){const d={};u&9&&(d.$$scope={dirty:u,ctx:c}),o.$set(d)},i(c){l||(A(o.$$.fragment,c),l=!0)},o(c){O(o.$$.fragment,c),l=!1},d(c){c&&G(t),q(o)}}}const ds=Ut(!0),jp=()=>yl.onNotification(e=>{if(e.type===Se.ERROR){const t=e.data;(t==null?void 0:t.code)===3008&&ds.set(!0)}});function qp(e,t,i){let r=!1;const n=async()=>{i(0,r=!0),await st.unblockAudio(),ds.set(!1),i(0,r=!1)},s=jp();return kt(s),[r,n]}class Hp extends te{constructor(t){super(),ee(this,t,qp,Vp,Z,{})}}function Kp(e){let t,i,r;const n=e[1].default,s=_n(n,e,e[0],null);return{c(){t=w("section"),i=w("div"),s&&s.c(),y(i,"class","WindowContainer svelte-bnrwrx"),y(t,"class","svelte-bnrwrx")},m(a,o){V(a,t,o),E(t,i),s&&s.m(i,null),r=!0},p(a,[o]){s&&s.p&&(!r||o&1)&&Cn(s,n,a,a[0],r?En(n,a[0],o,null):Rn(a[0]),null)},i(a){r||(A(s,a),r=!0)},o(a){O(s,a),r=!1},d(a){a&&G(t),s&&s.d(a)}}}function Wp(e,t,i){let{$$slots:r={},$$scope:n}=t;return e.$$set=s=>{"$$scope"in s&&i(0,n=s.$$scope)},[n,r]}class hs extends te{constructor(t){super(),ee(this,t,Wp,Kp,Z,{})}}function fa(e){let t,i;return t=new hs({props:{$$slots:{default:[zp]},$$scope:{ctx:e}}}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function zp(e){let t,i;return t=new Hp({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Jp(e){let t,i,r=e[0]&&fa(e);return{c(){r&&r.c(),t=Jt()},m(n,s){r&&r.m(n,s),V(n,t,s),i=!0},p(n,[s]){n[0]?r?s&1&&A(r,1):(r=fa(n),r.c(),A(r,1),r.m(t.parentNode,t)):r&&(Ve(),O(r,1,1,()=>{r=null}),je())},i(n){i||(A(r),i=!0)},o(n){O(r),i=!1},d(n){r&&r.d(n),n&&G(t)}}}function Qp(e,t,i){let r;return Fe(e,ds,n=>i(0,r=n)),[r]}class Yp extends te{constructor(t){super(),ee(this,t,Qp,Jp,Z,{})}}function Zp(e){let t,i,r;return{c(){t=ae("svg"),i=ae("path"),r=ae("path"),y(i,"fill","#E04F5F"),y(i,"d","M504.1,256C504.1,119,393,7.9,256,7.9C119,7.9,7.9,119,7.9,256C7.9,393,119,504.1,256,504.1C393,504.1,504.1,393,504.1,256z"),y(r,"fill","#FFF"),y(r,"d","M285,256l72.5-84.2c7.9-9.2,6.9-23-2.3-31c-9.2-7.9-23-6.9-30.9,2.3L256,222.4l-68.2-79.2c-7.9-9.2-21.8-10.2-31-2.3c-9.2,7.9-10.2,21.8-2.3,31L227,256l-72.5,84.2c-7.9,9.2-6.9,23,2.3,31c4.1,3.6,9.2,5.3,14.3,5.3c6.2,0,12.3-2.6,16.6-7.6l68.2-79.2l68.2,79.2c4.3,5,10.5,7.6,16.6,7.6c5.1,0,10.2-1.7,14.3-5.3c9.2-7.9,10.2-21.8,2.3-31L285,256z"),y(t,"viewBox","0 0 512 512"),y(t,"width","64px"),y(t,"height","64px")},m(n,s){V(n,t,s),E(t,i),E(t,r)},p:L,i:L,o:L,d(n){n&&G(t)}}}class Xp extends te{constructor(t){super(),ee(this,t,null,Zp,Z,{})}}function ma(e,t,i){const r=e.slice();return r[6]=t[i],r}function ga(e,t,i){const r=e.slice();return r[6]=t[i],r}function va(e,t,i){const r=e.slice();return r[6]=t[i],r}function ya(e,t){let i,r=t[6].label+"",n,s;return{key:e,first:null,c(){i=w("option"),n=He(r),i.__value=s=t[6].deviceId,i.value=i.__value,this.first=i},m(a,o){V(a,i,o),E(i,n)},p(a,o){t=a,o&2&&r!==(r=t[6].label+"")&&ut(n,r),o&2&&s!==(s=t[6].deviceId)&&(i.__value=s,i.value=i.__value)},d(a){a&&G(i)}}}function Ta(e,t){let i,r=t[6].label+"",n,s;return{key:e,first:null,c(){i=w("option"),n=He(r),i.__value=s=t[6].deviceId,i.value=i.__value,this.first=i},m(a,o){V(a,i,o),E(i,n)},p(a,o){t=a,o&2&&r!==(r=t[6].label+"")&&ut(n,r),o&2&&s!==(s=t[6].deviceId)&&(i.__value=s,i.value=i.__value)},d(a){a&&G(i)}}}function ba(e,t){let i,r=t[6].label+"",n,s;return{key:e,first:null,c(){i=w("option"),n=He(r),i.__value=s=t[6].deviceId,i.value=i.__value,this.first=i},m(a,o){V(a,i,o),E(i,n)},p(a,o){t=a,o&2&&r!==(r=t[6].label+"")&&ut(n,r),o&2&&s!==(s=t[6].deviceId)&&(i.__value=s,i.value=i.__value)},d(a){a&&G(i)}}}function ef(e){let t,i,r,n,s,a,o,l,c,u,d=[],h=new Map,f,v,T,C,z,x,I=[],U=new Map,W,H,le,ce,J,ue,ye=[],he=new Map,Ne,Ge,ie,at;r=new Xp({});let ot=e[1].videoInput;const p=S=>S[6].deviceId;for(let S=0;S<ot.length;S+=1){let P=va(e,ot,S),D=p(P);h.set(D,d[S]=ya(D,P))}let b=e[1].audioInput;const k=S=>S[6].deviceId;for(let S=0;S<b.length;S+=1){let P=ga(e,b,S),D=k(P);U.set(D,I[S]=Ta(D,P))}let _=e[1].audioOutput;const R=S=>S[6].deviceId;for(let S=0;S<_.length;S+=1){let P=ma(e,_,S),D=R(P);he.set(D,ye[S]=ba(D,P))}return{c(){t=w("section"),i=w("button"),K(r.$$.fragment),n=re(),s=w("h1"),s.textContent="Device Settings",a=re(),o=w("div"),l=w("label"),l.textContent="Video",c=re(),u=w("select");for(let S=0;S<d.length;S+=1)d[S].c();v=re(),T=w("div"),C=w("label"),C.textContent="Audio",z=re(),x=w("select");for(let S=0;S<I.length;S+=1)I[S].c();H=re(),le=w("div"),ce=w("label"),ce.textContent="Speaker",J=re(),ue=w("select");for(let S=0;S<ye.length;S+=1)ye[S].c();y(i,"class","CloseButton svelte-1e8aimq"),y(s,"class","normal-text svelte-1e8aimq"),y(l,"class","sub-text svelte-1e8aimq"),y(l,"for","video"),y(u,"id","video"),y(u,"class","svelte-1e8aimq"),y(o,"class","selection svelte-1e8aimq"),y(C,"class","sub-text svelte-1e8aimq"),y(C,"for","audio"),y(x,"id","audio"),y(x,"class","svelte-1e8aimq"),y(T,"class","selection svelte-1e8aimq"),y(ce,"class","sub-text svelte-1e8aimq"),y(ce,"for","speaker"),y(ue,"id","speaker"),y(ue,"class","svelte-1e8aimq"),y(le,"class","selection svelte-1e8aimq"),y(t,"class","card card-shadow card-dropin")},m(S,P){V(S,t,P),E(t,i),j(r,i,null),E(t,n),E(t,s),E(t,a),E(t,o),E(o,l),E(o,c),E(o,u);for(let D=0;D<d.length;D+=1)d[D].m(u,null);di(u,e[0].videoInputDeviceId),E(t,v),E(t,T),E(T,C),E(T,z),E(T,x);for(let D=0;D<I.length;D+=1)I[D].m(x,null);di(x,e[0].audioInputDeviceId),E(t,H),E(t,le),E(le,ce),E(le,J),E(le,ue);for(let D=0;D<ye.length;D+=1)ye[D].m(ue,null);di(ue,e[0].audioOutputDeviceId),Ge=!0,ie||(at=[Le(i,"click",e[5]),Le(u,"change",e[2]),Le(x,"change",e[3]),Le(ue,"change",e[4])],ie=!0)},p(S,[P]){P&2&&(ot=S[1].videoInput,d=fi(d,P,p,1,S,ot,h,u,rr,ya,null,va)),(!Ge||P&3&&f!==(f=S[0].videoInputDeviceId))&&di(u,S[0].videoInputDeviceId),P&2&&(b=S[1].audioInput,I=fi(I,P,k,1,S,b,U,x,rr,Ta,null,ga)),(!Ge||P&3&&W!==(W=S[0].audioInputDeviceId))&&di(x,S[0].audioInputDeviceId),P&2&&(_=S[1].audioOutput,ye=fi(ye,P,R,1,S,_,he,ue,rr,ba,null,ma)),(!Ge||P&3&&Ne!==(Ne=S[0].audioOutputDeviceId))&&di(ue,S[0].audioOutputDeviceId)},i(S){Ge||(A(r.$$.fragment,S),Ge=!0)},o(S){O(r.$$.fragment,S),Ge=!1},d(S){S&&G(t),q(r);for(let P=0;P<d.length;P+=1)d[P].d();for(let P=0;P<I.length;P+=1)I[P].d();for(let P=0;P<ye.length;P+=1)ye[P].d();ie=!1,pt(at)}}}function tf(e,t,i){let r,n;Fe(e,zh,c=>i(0,r=c)),Fe(e,Wh,c=>i(1,n=c));const s=c=>st.setVideoSettings({deviceId:c.target.value}),a=c=>st.setAudioSettings({deviceId:c.target.value}),o=c=>st.setAudioOutputDevice(c.target.value);function l(){us.set(!1)}return[r,n,s,a,o,l]}class rf extends te{constructor(t){super(),ee(this,t,tf,ef,Z,{})}}function Sa(e){let t,i;return t=new hs({props:{$$slots:{default:[nf]},$$scope:{ctx:e}}}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function nf(e){let t,i;return t=new rf({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function sf(e){let t,i,r=e[0]&&Sa(e);return{c(){r&&r.c(),t=Jt()},m(n,s){r&&r.m(n,s),V(n,t,s),i=!0},p(n,[s]){n[0]?r?s&1&&A(r,1):(r=Sa(n),r.c(),A(r,1),r.m(t.parentNode,t)):r&&(Ve(),O(r,1,1,()=>{r=null}),je())},i(n){i||(A(r),i=!0)},o(n){O(r),i=!1},d(n){r&&r.d(n),n&&G(t)}}}function af(e,t,i){let r;return Fe(e,us,n=>i(0,r=n)),[r]}class of extends te{constructor(t){super(),ee(this,t,af,sf,Z,{})}}function lf(e){let t;return{c(){t=He("Leave Room")},m(i,r){V(i,t,r)},d(i){i&&G(t)}}}function cf(e){let t,i,r;return i=new Yt({props:{classes:"btn-danger",$$slots:{default:[lf]},$$scope:{ctx:e}}}),i.$on("click",uf),{c(){t=w("span"),K(i.$$.fragment),y(t,"title","Leave Room")},m(n,s){V(n,t,s),j(i,t,null),r=!0},p(n,[s]){const a={};s&1&&(a.$$scope={dirty:s,ctx:n}),i.$set(a)},i(n){r||(A(i.$$.fragment,n),r=!0)},o(n){O(i.$$.fragment,n),r=!1},d(n){n&&G(t),q(i)}}}const Ir=Ut(!1);function uf(){Ir.set(!0)}class df extends te{constructor(t){super(),ee(this,t,null,cf,Z,{})}}function hf(e){let t,i,r,n,s,a,o,l,c,u,d;return{c(){t=w("section"),i=w("h1"),i.textContent="Leave Room",r=re(),n=w("p"),n.textContent="Are you sure you want to leave the room?",s=re(),a=w("div"),o=w("button"),o.textContent="Yes",l=re(),c=w("button"),c.textContent="no",y(i,"class","normal-text svelte-19qorri"),y(o,"class","btn-danger svelte-19qorri"),y(c,"class","btn-lite svelte-19qorri"),y(a,"class","svelte-19qorri"),y(t,"class","card card-shadow card-dropin")},m(h,f){V(h,t,f),E(t,i),E(t,r),E(t,n),E(t,s),E(t,a),E(a,o),E(a,l),E(a,c),u||(d=[Le(o,"click",e[0]),Le(c,"click",e[1])],u=!0)},p:L,i:L,o:L,d(h){h&&G(t),u=!1,pt(d)}}}function pf(e){function t(){Ir.set(!1),st.leave(),St.set({type:"info",message:"You left the room."})}function i(){Ir.set(!1)}return[t,i]}class ff extends te{constructor(t){super(),ee(this,t,pf,hf,Z,{})}}function ka(e){let t,i;return t=new hs({props:{$$slots:{default:[mf]},$$scope:{ctx:e}}}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function mf(e){let t,i;return t=new ff({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function gf(e){let t,i,r=e[0]&&ka(e);return{c(){r&&r.c(),t=Jt()},m(n,s){r&&r.m(n,s),V(n,t,s),i=!0},p(n,[s]){n[0]?r?s&1&&A(r,1):(r=ka(n),r.c(),A(r,1),r.m(t.parentNode,t)):r&&(Ve(),O(r,1,1,()=>{r=null}),je())},i(n){i||(A(r),i=!0)},o(n){O(r),i=!1},d(n){r&&r.d(n),n&&G(t)}}}function vf(e,t,i){let r;return Fe(e,Ir,n=>i(0,r=n)),[r]}class yf extends te{constructor(t){super(),ee(this,t,vf,gf,Z,{})}}function Tf(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","m12.45 37.65-2.1-2.1L21.9 24 10.35 12.45l2.1-2.1L24 21.9l11.55-11.55 2.1 2.1L26.1 24l11.55 11.55-2.1 2.1L24 26.1Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class Rl extends te{constructor(t){super(),ee(this,t,null,Tf,Z,{})}}function bf(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","M24 33.3q3.9 0 6.6-2.7 2.7-2.7 2.7-6.6 0-3.9-2.7-6.6-2.7-2.7-6.6-2.7-3.9 0-6.6 2.7-2.7 2.7-2.7 6.6 0 3.9 2.7 6.6 2.7 2.7 6.6 2.7ZM24 44q-4.1 0-7.75-1.575-3.65-1.575-6.375-4.3-2.725-2.725-4.3-6.375Q4 28.1 4 24q0-4.15 1.575-7.8 1.575-3.65 4.3-6.35 2.725-2.7 6.375-4.275Q19.9 4 24 4q4.15 0 7.8 1.575 3.65 1.575 6.35 4.275 2.7 2.7 4.275 6.35Q44 19.85 44 24q0 4.1-1.575 7.75-1.575 3.65-4.275 6.375t-6.35 4.3Q28.15 44 24 44Zm0-3q7.1 0 12.05-4.975Q41 31.05 41 24q0-7.1-4.95-12.05Q31.1 7 24 7q-7.05 0-12.025 4.95Q7 16.9 7 24q0 7.05 4.975 12.025Q16.95 41 24 41Zm0-17Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class Sf extends te{constructor(t){super(),ee(this,t,null,bf,Z,{})}}function kf(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","m24 30.75-12-12 2.15-2.15L24 26.5l9.85-9.85L36 18.8Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class _f extends te{constructor(t){super(),ee(this,t,null,kf,Z,{})}}function Ef(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","M24 44q-4.1 0-7.75-1.575-3.65-1.575-6.375-4.3-2.725-2.725-4.3-6.375Q4 28.1 4 24q0-4.15 1.575-7.8 1.575-3.65 4.3-6.35 2.725-2.7 6.375-4.275Q19.9 4 24 4q4.15 0 7.8 1.575 3.65 1.575 6.35 4.275 2.7 2.7 4.275 6.35Q44 19.85 44 24q0 4.1-1.575 7.75-1.575 3.65-4.275 6.375t-6.35 4.3Q28.15 44 24 44Zm0-3q7.1 0 12.05-4.975Q41 31.05 41 24q0-7.1-4.95-12.05Q31.1 7 24 7q-7.05 0-12.025 4.95Q7 16.9 7 24q0 7.05 4.975 12.025Q16.95 41 24 41Zm0-17Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class Cf extends te{constructor(t){super(),ee(this,t,null,Ef,Z,{})}}function Pl(e){const t=e-1;return t*t*t+1}function Al(e,{from:t,to:i},r={}){const n=getComputedStyle(e),s=n.transform==="none"?"":n.transform,[a,o]=n.transformOrigin.split(" ").map(parseFloat),l=t.left+t.width*a/i.width-(i.left+a),c=t.top+t.height*o/i.height-(i.top+o),{delay:u=0,duration:d=f=>Math.sqrt(f)*120,easing:h=Pl}=r;return{delay:u,duration:Rt(d)?d(Math.sqrt(l*l+c*c)):d,easing:h,css:(f,v)=>{const T=v*l,C=v*c,z=f+v*t.width/i.width,x=f+v*t.height/i.height;return`transform: ${s} translate(${T}px, ${C}px) scale(${z}, ${x});`}}}function bi(e,{delay:t=0,duration:i=400,easing:r=Pl,x:n=0,y:s=0,opacity:a=0}={}){const o=getComputedStyle(e),l=+o.opacity,c=o.transform==="none"?"":o.transform,u=l*(1-a);return{delay:t,duration:i,easing:r,css:(d,h)=>`
			transform: ${c} translate(${(1-d)*n}px, ${(1-d)*s}px);
			opacity: ${l-u*h}`}}function _a(e,t,i){const r=e.slice();return r[7]=t[i],r}function Ea(e){let t,i=[],r=new Map,n,s,a,o=e[3];const l=c=>c[7];for(let c=0;c<o.length;c+=1){let u=_a(e,o,c),d=l(u);r.set(d,i[c]=Ca(d,u))}return{c(){t=w("div");for(let c=0;c<i.length;c+=1)i[c].c();y(t,"class","Filter card card-shadow svelte-1ahefp6")},m(c,u){V(c,t,u);for(let d=0;d<i.length;d+=1)i[d].m(t,null);a=!0},p(c,u){if(u&25){o=c[3],Ve();for(let d=0;d<i.length;d+=1)i[d].r();i=fi(i,u,l,1,c,o,r,t,zl,Ca,null,_a);for(let d=0;d<i.length;d+=1)i[d].a();je()}},i(c){if(!a){for(let u=0;u<o.length;u+=1)A(i[u]);$t(()=>{s&&s.end(1),n=Or(t,bi,{y:-20,duration:200}),n.start()}),a=!0}},o(c){for(let u=0;u<i.length;u+=1)O(i[u]);n&&n.invalidate(),s=Ha(t,bi,{y:-10,duration:200}),a=!1},d(c){c&&G(t);for(let u=0;u<i.length;u+=1)i[u].d();c&&s&&s.end()}}}function Rf(e){let t,i;return t=new Cf({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Pf(e){let t,i;return t=new Sf({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Ca(e,t){let i,r,n,s,a,o,l=t[0][t[7]].name+"",c,u,d,h,f=L,v,T,C;const z=[Pf,Rf],x=[];function I(U,W){return U[0][U[7]].isSelected?0:1}return n=I(t),s=x[n]=z[n](t),{key:e,first:null,c(){i=w("button"),r=w("div"),s.c(),a=re(),o=w("div"),c=He(l),u=re(),y(r,"class","Checkbox svelte-1ahefp6"),y(o,"class","Name svelte-1ahefp6"),y(i,"class",d=gi(t[0][t[7]].isSelected?"btn-selected":"btn-lite")+" svelte-1ahefp6"),this.first=i},m(U,W){V(U,i,W),E(i,r),x[n].m(r,null),E(i,a),E(i,o),E(o,c),E(i,u),v=!0,T||(C=[Le(i,"click",function(){Rt(t[4](t[7]))&&t[4](t[7]).apply(this,arguments)}),Le(i,"mouseover",function(){Rt(qt(t[7]))&&qt(t[7]).apply(this,arguments)}),Le(i,"focus",function(){Rt(qt(t[7]))&&qt(t[7]).apply(this,arguments)}),Le(i,"mouseleave",El)],T=!0)},p(U,W){t=U;let H=n;n=I(t),n!==H&&(Ve(),O(x[H],1,1,()=>{x[H]=null}),je(),s=x[n],s||(s=x[n]=z[n](t),s.c()),A(s,1),s.m(r,null)),(!v||W&9)&&l!==(l=t[0][t[7]].name+"")&&ut(c,l),(!v||W&9&&d!==(d=gi(t[0][t[7]].isSelected?"btn-selected":"btn-lite")+" svelte-1ahefp6"))&&y(i,"class",d)},r(){h=i.getBoundingClientRect()},f(){Ba(i),f()},a(){f(),f=Ga(i,h,Al,{duration:200})},i(U){v||(A(s),v=!0)},o(U){O(s),v=!1},d(U){U&&G(i),x[n].d(),T=!1,pt(C)}}}function Af(e){let t,i,r,n,s,a,o=e[2]?"Filtering":"Everyone",l,c,u,d,h;n=new _f({});let f=e[1]&&Ea(e);return{c(){t=w("section"),i=w("button"),r=w("div"),K(n.$$.fragment),s=re(),a=w("div"),l=He(o),c=re(),f&&f.c(),y(r,"class","Expand svelte-1ahefp6"),Re(r,"Retract",e[1]),y(a,"class","IsFiltering svelte-1ahefp6"),y(i,"class","Activate btn-lite svelte-1ahefp6"),Re(i,"Filtering",e[2]),y(t,"class","svelte-1ahefp6")},m(v,T){V(v,t,T),E(t,i),E(i,r),j(n,r,null),E(i,s),E(i,a),E(a,l),E(t,c),f&&f.m(t,null),u=!0,d||(h=Le(i,"click",e[5]),d=!0)},p(v,[T]){(!u||T&2)&&Re(r,"Retract",v[1]),(!u||T&4)&&o!==(o=v[2]?"Filtering":"Everyone")&&ut(l,o),(!u||T&4)&&Re(i,"Filtering",v[2]),v[1]?f?(f.p(v,T),T&2&&A(f,1)):(f=Ea(v),f.c(),A(f,1),f.m(t,null)):f&&(Ve(),O(f,1,1,()=>{f=null}),je())},i(v){u||(A(n.$$.fragment,v),A(f),u=!0)},o(v){O(n.$$.fragment,v),O(f),u=!1},d(v){v&&G(t),q(n),f&&f.d(),d=!1,h()}}}const dr=Ut({});function If(e,t,i){let r,n,s=L;Fe(e,dr,d=>i(0,n=d)),e.$$.on_destroy.push(()=>s());let a=!1,o=!1;const l=bl.subscribe(d=>{const h=n;d.map(({id:f,name:v})=>{n[f]!==void 0?h[f]=n[f]:h[f]={name:v,isSelected:!0}}),dr.set(h)});kt(l);function c(d){return()=>{dr.update(h=>(h[d].isSelected=!h[d].isSelected,i(2,o=!Object.values(h).reduce((f,v)=>f&&v.isSelected,!0)),h))}}const u=()=>i(1,a=!a);return e.$$.update=()=>{e.$$.dirty&1&&i(3,r=Object.keys(n))},[n,a,o,r,c,u]}class Df extends te{constructor(t){super(),ee(this,t,If,Af,Z,{})}}function wf(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","M4 34V6.1q0-.7.65-1.4T6 4h25.95q.75 0 1.4.675Q34 5.35 34 6.1v17.8q0 .7-.65 1.4t-1.4.7H12Zm10.05 2q-.7 0-1.375-.7T12 33.9V29h25V12h5q.7 0 1.35.7.65.7.65 1.45v29.8L36.05 36ZM31 7H7v19.75L10.75 23H31ZM7 7v19.75Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class Of extends te{constructor(t){super(),ee(this,t,null,wf,Z,{})}}function Ra(e){let t,i,r;return{c(){t=w("div"),i=He(e[0]),y(t,"class","UnreadMessagesNumber svelte-1ohj85h"),Re(t,"None",e[0]===0)},m(n,s){V(n,t,s),E(t,i)},p(n,s){s&1&&ut(i,n[0]),s&1&&Re(t,"None",n[0]===0)},i(n){r||$t(()=>{r=Or(t,bi,{y:20,duration:200}),r.start()})},o:L,d(n){n&&G(t)}}}function Mf(e){let t,i,r,n=e[0],s,a,o;i=new Of({});let l=Ra(e);return{c(){t=w("button"),K(i.$$.fragment),r=re(),l.c(),y(t,"class","btn-control")},m(c,u){V(c,t,u),j(i,t,null),E(t,r),l.m(t,null),s=!0,a||(o=Le(t,"click",e[1]),a=!0)},p(c,[u]){u&1&&Z(n,n=c[0])?(Ve(),O(l,1,1,L),je(),l=Ra(c),l.c(),A(l,1),l.m(t,null)):l.p(c,u)},i(c){s||(A(i.$$.fragment,c),A(l),s=!0)},o(c){O(i.$$.fragment,c),O(l),s=!1},d(c){c&&G(t),q(i),l.d(c),a=!1,o()}}}const Dr=Ut(!1);function Lf(e,t,i){let r,n=L;Fe(e,Dr,l=>i(2,r=l)),e.$$.on_destroy.push(()=>n());let s=0;const a=Sl.subscribe(l=>{l.length!==0&&(r||i(0,s+=1))});function o(){Dr.update(l=>!l),i(0,s=0)}return kt(a),[s,o]}class Nf extends te{constructor(t){super(),ee(this,t,Lf,Mf,Z,{})}}function Pa(e,t,i){const r=e.slice();return r[12]=t[i],r}function Aa(e){let t,i,r=e[12].message+"",n,s,a,o,l=e[12].senderName+"",c,u,d=e[6](e[12].time)+"",h,f,v,T;return{c(){t=w("div"),i=w("p"),n=He(r),s=re(),a=w("span"),o=w("b"),c=He(l),u=He(", "),h=He(d),y(i,"class","chat-message-message svelte-ttxho1"),y(o,"class","svelte-ttxho1"),y(a,"class","chat-message-info svelte-ttxho1"),y(t,"class","chat-message svelte-ttxho1"),Re(t,"YourMsg",e[12].senderName==="You"),Re(t,"HoveringChatSender",e[4]===e[12].sender)},m(C,z){V(C,t,z),E(t,i),E(i,n),E(t,s),E(t,a),E(a,o),E(o,c),E(a,u),E(a,h),v||(T=[Le(t,"mouseover",function(){Rt(qt(e[12].sender))&&qt(e[12].sender).apply(this,arguments)}),Le(t,"focus",function(){Rt(qt(e[12].sender))&&qt(e[12].sender).apply(this,arguments)}),Le(t,"mouseleave",El)],v=!0)},p(C,z){e=C,z&4&&r!==(r=e[12].message+"")&&ut(n,r),z&4&&l!==(l=e[12].senderName+"")&&ut(c,l),z&4&&d!==(d=e[6](e[12].time)+"")&&ut(h,d),z&4&&Re(t,"YourMsg",e[12].senderName==="You"),z&20&&Re(t,"HoveringChatSender",e[4]===e[12].sender)},i(C){f||$t(()=>{f=Or(t,bi,{y:20,duration:200}),f.start()})},o:L,d(C){C&&G(t),v=!1,pt(T)}}}function Ia(e,t){var a;let i,r,n=L,s=((a=t[3][t[12].sender])==null?void 0:a.isSelected)&&Aa(t);return{key:e,first:null,c(){i=w("div"),s&&s.c(),y(i,"class","ChatContainer svelte-ttxho1"),this.first=i},m(o,l){V(o,i,l),s&&s.m(i,null)},p(o,l){var c;t=o,(c=t[3][t[12].sender])!=null&&c.isSelected?s?(s.p(t,l),l&12&&A(s,1)):(s=Aa(t),s.c(),A(s,1),s.m(i,null)):s&&(s.d(1),s=null)},r(){r=i.getBoundingClientRect()},f(){Ba(i),n()},a(){n(),n=Ga(i,r,Al,{duration:200})},i(o){A(s)},o:L,d(o){o&&G(i),s&&s.d()}}}function Da(e){let t;return{c(){t=w("div"),t.innerHTML="<p>There are no messages here</p>",y(t,"class","chat-no-messages svelte-ttxho1")},m(i,r){V(i,t,r)},d(i){i&&G(t)}}}function $f(e){let t,i,r,n,s,a,o,l,c,u,d=[],h=new Map,f,v,T,C,z,x,I,U,W;s=new Df({}),l=new Rl({});let H=e[2];const le=J=>J[12].id;for(let J=0;J<H.length;J+=1){let ue=Pa(e,H,J),ye=le(ue);h.set(ye,d[J]=Ia(ye,ue))}let ce=e[2].length===0&&Da();return{c(){t=w("section"),i=w("div"),r=w("span"),r.textContent="Chat",n=re(),K(s.$$.fragment),a=re(),o=w("button"),K(l.$$.fragment),c=re(),u=w("div");for(let J=0;J<d.length;J+=1)d[J].c();f=re(),ce&&ce.c(),v=re(),T=w("form"),C=w("input"),z=re(),x=w("div"),y(o,"class","Close svelte-ttxho1"),y(i,"class","Header normal-text svelte-ttxho1"),y(u,"class","chat-messages svelte-ttxho1"),y(C,"placeholder","Send a message..."),y(C,"autocomplete","off"),y(C,"aria-autocomplete","none"),y(C,"class","chat-input svelte-ttxho1"),y(T,"class","flex-center chat-input-container svelte-ttxho1"),y(x,"class","SmallSpike svelte-ttxho1"),y(t,"class","card card-shadow svelte-ttxho1")},m(J,ue){V(J,t,ue),E(t,i),E(i,r),E(i,n),j(s,i,null),E(i,a),E(i,o),j(l,o,null),E(t,c),E(t,u);for(let ye=0;ye<d.length;ye+=1)d[ye].m(u,null);E(u,f),ce&&ce.m(u,null),e[8](u),E(t,v),E(t,T),E(T,C),gs(C,e[1]),E(t,z),E(t,x),I=!0,U||(W=[Le(o,"click",e[7]),Le(C,"input",e[9]),Le(T,"submit",Fa(e[5]))],U=!0)},p(J,[ue]){if(ue&92){H=J[2];for(let ye=0;ye<d.length;ye+=1)d[ye].r();d=fi(d,ue,le,1,J,H,h,u,Wl,Ia,f,Pa);for(let ye=0;ye<d.length;ye+=1)d[ye].a()}J[2].length===0?ce||(ce=Da(),ce.c(),ce.m(u,null)):ce&&(ce.d(1),ce=null),ue&2&&C.value!==J[1]&&gs(C,J[1])},i(J){if(!I){A(s.$$.fragment,J),A(l.$$.fragment,J);for(let ue=0;ue<H.length;ue+=1)A(d[ue]);I=!0}},o(J){O(s.$$.fragment,J),O(l.$$.fragment,J),I=!1},d(J){J&&G(t),q(s),q(l);for(let ue=0;ue<d.length;ue+=1)d[ue].d();ce&&ce.d(),e[8](null),U=!1,pt(W)}}}function xf(e,t,i){let r,n,s;Fe(e,Sl,T=>i(2,r=T)),Fe(e,dr,T=>i(3,n=T)),Fe(e,Wi,T=>i(4,s=T));let a;const o=(T=!1)=>{a&&a.scrollTo({top:a.scrollHeight,behavior:T?"auto":"smooth"})};let l="";const c=async()=>{if(l&&l.trim().length>0)try{await st.sendBroadcastMessage(l),i(1,l="")}catch(T){St.set({type:"error",message:`Failed to send message - ${T.message}`})}},u=T=>T.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0});let d;Bl(()=>{d=a&&a.offsetHeight+a.scrollTop>a.scrollHeight-20}),Vl(()=>{d&&o()}),wn(()=>o(!0));const h=()=>{Dr.set(!1)};function f(T){Wt[T?"unshift":"push"](()=>{a=T,i(0,a)})}function v(){l=this.value,i(1,l)}return[a,l,r,n,s,c,u,h,f,v]}class Uf extends te{constructor(t){super(),ee(this,t,xf,$f,Z,{})}}function Ff(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","m19.4 44-1-6.3q-.95-.35-2-.95t-1.85-1.25l-5.9 2.7L4 30l5.4-3.95q-.1-.45-.125-1.025Q9.25 24.45 9.25 24q0-.45.025-1.025T9.4 21.95L4 18l4.65-8.2 5.9 2.7q.8-.65 1.85-1.25t2-.9l1-6.35h9.2l1 6.3q.95.35 2.025.925Q32.7 11.8 33.45 12.5l5.9-2.7L44 18l-5.4 3.85q.1.5.125 1.075.025.575.025 1.075t-.025 1.05q-.025.55-.125 1.05L44 30l-4.65 8.2-5.9-2.7q-.8.65-1.825 1.275-1.025.625-2.025.925l-1 6.3ZM24 30.5q2.7 0 4.6-1.9 1.9-1.9 1.9-4.6 0-2.7-1.9-4.6-1.9-1.9-4.6-1.9-2.7 0-4.6 1.9-1.9 1.9-1.9 4.6 0 2.7 1.9 4.6 1.9 1.9 4.6 1.9Zm0-3q-1.45 0-2.475-1.025Q20.5 25.45 20.5 24q0-1.45 1.025-2.475Q22.55 20.5 24 20.5q1.45 0 2.475 1.025Q27.5 22.55 27.5 24q0 1.45-1.025 2.475Q25.45 27.5 24 27.5Zm0-3.5Zm-2.2 17h4.4l.7-5.6q1.65-.4 3.125-1.25T32.7 32.1l5.3 2.3 2-3.6-4.7-3.45q.2-.85.325-1.675.125-.825.125-1.675 0-.85-.1-1.675-.1-.825-.35-1.675L40 17.2l-2-3.6-5.3 2.3q-1.15-1.3-2.6-2.175-1.45-.875-3.2-1.125L26.2 7h-4.4l-.7 5.6q-1.7.35-3.175 1.2-1.475.85-2.625 2.1L10 13.6l-2 3.6 4.7 3.45q-.2.85-.325 1.675-.125.825-.125 1.675 0 .85.125 1.675.125.825.325 1.675L8 30.8l2 3.6 5.3-2.3q1.2 1.2 2.675 2.05Q19.45 35 21.1 35.4Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class Gf extends te{constructor(t){super(),ee(this,t,null,Ff,Z,{})}}function Bf(e){let t,i;return t=new Gf({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Vf(e){let t,i;return t=new Yt({props:{classes:"btn-setting",$$slots:{default:[Bf]},$$scope:{ctx:e}}}),t.$on("click",e[0]),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},p(r,[n]){const s={};n&2&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function jf(e){function t(){us.set(!0)}return[t]}class qf extends te{constructor(t){super(),ee(this,t,jf,Vf,Z,{})}}function Hf(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","M 23 3 A 4 4 0 0 0 19 7 A 4 4 0 0 0 19.09375 7.8359375 L 10.011719 12.376953 A 4 4 0 0 0 7 11 A 4 4 0 0 0 3 15 A 4 4 0 0 0 7 19 A 4 4 0 0 0 10.013672 17.625 L 19.089844 22.164062 A 4 4 0 0 0 19 23 A 4 4 0 0 0 23 27 A 4 4 0 0 0 27 23 A 4 4 0 0 0 23 19 A 4 4 0 0 0 19.986328 20.375 L 10.910156 15.835938 A 4 4 0 0 0 11 15 A 4 4 0 0 0 10.90625 14.166016 L 19.988281 9.625 A 4 4 0 0 0 23 11 A 4 4 0 0 0 27 7 A 4 4 0 0 0 23 3 z"),y(t,"fill","#000000"),y(t,"viewBox","0 0 30 30"),y(t,"width","30px"),y(t,"height","30px")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class Kf extends te{constructor(t){super(),ee(this,t,null,Hf,Z,{})}}function Wf(e){let t,i;return t=new Kf({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function zf(e){let t,i;return t=new Yt({props:{classes:"btn-control",$$slots:{default:[Wf]},$$scope:{ctx:e}}}),t.$on("click",e[0]),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},p(r,[n]){const s={};n&4&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Jf(e,t,i){let r;Fe(e,Ar,s=>i(1,r=s));function n(){const s=`${window.location.origin}${window.location.pathname}#&token=${r}`;navigator.clipboard.writeText(s).then(function(){St.set({type:"good",message:"Copied link to clip board "})},function(a){St.set({type:"error",message:"failed ot copy link to clip board "+a.message})})}return[n]}class Qf extends te{constructor(t){super(),ee(this,t,Jf,zf,Z,{})}}function Yf(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","M21.2 8a2.75 2.75 0 00-2.75-2.75H5.55A2.75 2.75 0 002.8 8v7.64a2.75 2.75 0 002.75 2.75h3.075a.75.75 0 000-1.5H5.55c-.69 0-1.25-.56-1.25-1.25V8c0-.69.56-1.25 1.25-1.25h12.9c.69 0 1.25.56 1.25 1.25v7.64c0 .69-.56 1.25-1.25 1.25h-2.7a.75.75 0 000 1.5h2.7a2.75 2.75 0 002.75-2.75V8zM8.008 13.307a.925.925 0 101.309 1.308l1.89-1.89v6.839a.925.925 0 001.85 0v-6.839l1.89 1.89a.925.925 0 101.309-1.308l-3.47-3.47a.926.926 0 00-1.308 0l-3.47 3.47z"),y(i,"fill","currentColor"),y(t,"width","24px"),y(t,"height","24px"),y(t,"viewBox","0 0 24 24"),y(t,"fill","none"),y(t,"xmlns","http://www.w3.org/2000/svg")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class Zf extends te{constructor(t){super(),ee(this,t,null,Yf,Z,{})}}function Xf(e){let t,i;return t=new Zf({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function em(e){let t,i,r;return i=new Yt({props:{classes:"btn-control",$$slots:{default:[Xf]},$$scope:{ctx:e}}}),i.$on("click",e[1]),{c(){t=w("span"),K(i.$$.fragment),y(t,"class","svelte-1s6nypy"),Re(t,"Sharing",e[0])},m(n,s){V(n,t,s),j(i,t,null),r=!0},p(n,[s]){const a={};s&4&&(a.$$scope={dirty:s,ctx:n}),i.$set(a),(!r||s&1)&&Re(t,"Sharing",n[0])},i(n){r||(A(i.$$.fragment,n),r=!0)},o(n){O(i.$$.fragment,n),r=!1},d(n){n&&G(t),q(i)}}}function tm(e,t,i){let r;Fe(e,Jh,s=>i(0,r=s));function n(){st.setScreenShareEnabled(!r)}return[r,n]}class im extends te{constructor(t){super(),ee(this,t,tm,em,Z,{})}}function rm(e){let t,i,r;return i=new kl({}),{c(){t=w("span"),K(i.$$.fragment),y(t,"title","Turn on audio")},m(n,s){V(n,t,s),j(i,t,null),r=!0},i(n){r||(A(i.$$.fragment,n),r=!0)},o(n){O(i.$$.fragment,n),r=!1},d(n){n&&G(t),q(i)}}}function nm(e){let t,i,r;return i=new _l({}),{c(){t=w("span"),K(i.$$.fragment),y(t,"title","Turn off audio")},m(n,s){V(n,t,s),j(i,t,null),r=!0},i(n){r||(A(i.$$.fragment,n),r=!0)},o(n){O(i.$$.fragment,n),r=!1},d(n){n&&G(t),q(i)}}}function sm(e){let t,i,r,n;const s=[nm,rm],a=[];function o(l,c){return l[0]?0:1}return t=o(e),i=a[t]=s[t](e),{c(){i.c(),r=Jt()},m(l,c){a[t].m(l,c),V(l,r,c),n=!0},p(l,c){let u=t;t=o(l),t!==u&&(Ve(),O(a[u],1,1,()=>{a[u]=null}),je(),i=a[t],i||(i=a[t]=s[t](l),i.c()),A(i,1),i.m(r.parentNode,r))},i(l){n||(A(i),n=!0)},o(l){O(i),n=!1},d(l){a[t].d(l),l&&G(r)}}}function am(e){let t,i;return t=new Yt({props:{classes:"btn-control",$$slots:{default:[sm]},$$scope:{ctx:e}}}),t.$on("click",e[1]),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},p(r,[n]){const s={};n&5&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function om(e,t,i){let r;Fe(e,Hh,s=>i(0,r=s));function n(){st.setLocalAudioEnabled(!r)}return[r,n]}class lm extends te{constructor(t){super(),ee(this,t,om,am,Z,{})}}function cm(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","M7 40q-1.2 0-2.1-.9Q4 38.2 4 37V11q0-1.2.9-2.1Q5.8 8 7 8h26q1.2 0 2.1.9.9.9.9 2.1v10.75l8-8v20.5l-8-8V37q0 1.2-.9 2.1-.9.9-2.1.9Zm0-3h26V11H7v26Zm0 0V11v26Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class um extends te{constructor(t){super(),ee(this,t,null,cm,Z,{})}}function dm(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),y(i,"d","m44 34.25-8-8v5.55l-3-3V11H15.2l-3-3H33q1.2 0 2.1.9.9.9.9 2.1v10.75l8-8Zm-1.6 12.4L1.95 6.2l2.1-2.1L44.5 44.55ZM24.2 20Zm-4.35 4.1ZM7.95 8l3 3H7v26h26v-3.95l3 3V37q0 1.2-.9 2.1-.9.9-2.1.9H7q-1.2 0-2.1-.9Q4 38.2 4 37V11q0-1.2.9-2.1Q5.8 8 7 8Z"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"viewBox","0 0 48 48")},m(r,n){V(r,t,n),E(t,i)},p:L,i:L,o:L,d(r){r&&G(t)}}}class hm extends te{constructor(t){super(),ee(this,t,null,dm,Z,{})}}function pm(e){let t,i;return t=new hm({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function fm(e){let t,i;return t=new um({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function mm(e){let t,i,r,n;const s=[fm,pm],a=[];function o(l,c){return l[0]?0:1}return t=o(e),i=a[t]=s[t](e),{c(){i.c(),r=Jt()},m(l,c){a[t].m(l,c),V(l,r,c),n=!0},p(l,c){let u=t;t=o(l),t!==u&&(Ve(),O(a[u],1,1,()=>{a[u]=null}),je(),i=a[t],i||(i=a[t]=s[t](l),i.c()),A(i,1),i.m(r.parentNode,r))},i(l){n||(A(i),n=!0)},o(l){O(i),n=!1},d(l){a[t].d(l),l&&G(r)}}}function gm(e){let t,i;return t=new Yt({props:{classes:"btn-control",$$slots:{default:[mm]},$$scope:{ctx:e}}}),t.$on("click",e[1]),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},p(r,[n]){const s={};n&5&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function vm(e,t,i){let r;Fe(e,Kh,s=>i(0,r=s));function n(){st.setLocalVideoEnabled(!r)}return[r,n]}class ym extends te{constructor(t){super(),ee(this,t,vm,gm,Z,{})}}function wa(e){let t,i,r,n,s;return i=new Uf({}),{c(){t=w("div"),K(i.$$.fragment),y(t,"class","ChatRoom svelte-15ziops")},m(a,o){V(a,t,o),j(i,t,null),s=!0},i(a){s||(A(i.$$.fragment,a),$t(()=>{n&&n.end(1),r=Or(t,bi,{y:20,duration:200}),r.start()}),s=!0)},o(a){O(i.$$.fragment,a),r&&r.invalidate(),n=Ha(t,bi,{y:20,duration:200}),s=!1},d(a){a&&G(t),q(i),a&&n&&n.end()}}}function Tm(e){let t,i,r,n,s,a,o,l,c,u,d,h,f,v,T,C,z,x,I,U;r=new im({}),a=new lm({}),l=new ym({}),u=new qf({}),h=new df({}),C=new Nf({});let W=e[0]&&wa();return I=new Qf({}),{c(){t=w("section"),i=w("div"),K(r.$$.fragment),n=re(),s=w("div"),K(a.$$.fragment),o=re(),K(l.$$.fragment),c=re(),K(u.$$.fragment),d=re(),K(h.$$.fragment),f=re(),v=w("div"),T=w("div"),K(C.$$.fragment),z=re(),W&&W.c(),x=re(),K(I.$$.fragment),y(i,"class","Divider svelte-15ziops"),y(s,"class","Divider svelte-15ziops"),y(T,"class","ChatContainer svelte-15ziops"),y(v,"class","Divider svelte-15ziops"),y(t,"class","svelte-15ziops")},m(H,le){V(H,t,le),E(t,i),j(r,i,null),E(t,n),E(t,s),j(a,s,null),E(s,o),j(l,s,null),E(s,c),j(u,s,null),E(s,d),j(h,s,null),E(t,f),E(t,v),E(v,T),j(C,T,null),E(T,z),W&&W.m(T,null),E(v,x),j(I,v,null),U=!0},p(H,[le]){H[0]?W?le&1&&A(W,1):(W=wa(),W.c(),A(W,1),W.m(T,null)):W&&(Ve(),O(W,1,1,()=>{W=null}),je())},i(H){U||(A(r.$$.fragment,H),A(a.$$.fragment,H),A(l.$$.fragment,H),A(u.$$.fragment,H),A(h.$$.fragment,H),A(C.$$.fragment,H),A(W),A(I.$$.fragment,H),U=!0)},o(H){O(r.$$.fragment,H),O(a.$$.fragment,H),O(l.$$.fragment,H),O(u.$$.fragment,H),O(h.$$.fragment,H),O(C.$$.fragment,H),O(W),O(I.$$.fragment,H),U=!1},d(H){H&&G(t),q(r),q(a),q(l),q(u),q(h),q(C),W&&W.d(),q(I)}}}function bm(e,t,i){let r;return Fe(e,Dr,n=>i(0,r=n)),[r]}class Sm extends te{constructor(t){super(),ee(this,t,bm,Tm,Z,{})}}function km(e){let t,i,r,n,s,a,o;return r=new Up({}),a=new Cl({}),{c(){t=w("div"),i=w("div"),K(r.$$.fragment),n=re(),s=w("div"),K(a.$$.fragment),y(i,"class","screenshare svelte-afmkxg"),y(s,"class","gallery svelte-afmkxg"),y(t,"class","screenshare-view svelte-afmkxg")},m(l,c){V(l,t,c),E(t,i),j(r,i,null),E(t,n),E(t,s),j(a,s,null),o=!0},i(l){o||(A(r.$$.fragment,l),A(a.$$.fragment,l),o=!0)},o(l){O(r.$$.fragment,l),O(a.$$.fragment,l),o=!1},d(l){l&&G(t),q(r),q(a)}}}function _m(e){let t,i;return t=new Cl({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Em(e){let t,i,r,n,s,a,o,l,c,u,d,h,f,v;const T=[_m,km],C=[];function z(x,I){return x[0]?1:0}return r=z(e),n=C[r]=T[r](e),o=new Sm({}),c=new of({}),d=new yf({}),f=new Yp({}),{c(){t=w("section"),i=w("div"),n.c(),s=re(),a=w("div"),K(o.$$.fragment),l=re(),K(c.$$.fragment),u=re(),K(d.$$.fragment),h=re(),K(f.$$.fragment),y(i,"class","conference-section svelte-afmkxg"),y(a,"class","BottomBar svelte-afmkxg"),y(t,"class","svelte-afmkxg")},m(x,I){V(x,t,I),E(t,i),C[r].m(i,null),E(t,s),E(t,a),j(o,a,null),V(x,l,I),j(c,x,I),V(x,u,I),j(d,x,I),V(x,h,I),j(f,x,I),v=!0},p(x,[I]){let U=r;r=z(x),r!==U&&(Ve(),O(C[U],1,1,()=>{C[U]=null}),je(),n=C[r],n||(n=C[r]=T[r](x),n.c()),A(n,1),n.m(i,null))},i(x){v||(A(n),A(o.$$.fragment,x),A(c.$$.fragment,x),A(d.$$.fragment,x),A(f.$$.fragment,x),v=!0)},o(x){O(n),O(o.$$.fragment,x),O(c.$$.fragment,x),O(d.$$.fragment,x),O(f.$$.fragment,x),v=!1},d(x){x&&G(t),C[r].d(),q(o),x&&G(l),q(c,x),x&&G(u),q(d,x),x&&G(h),q(f,x)}}}function Cm(e,t,i){let r;return Fe(e,Qh,n=>i(0,r=n)),[r]}class Rm extends te{constructor(t){super(),ee(this,t,Cm,Em,Z,{})}}function Pm(e){let t,i;return t=new np({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Am(e){let t,i;return t=new Rm({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Im(e){let t,i,r,n;const s=[Am,Pm],a=[];function o(l,c){return l[0]?0:1}return i=o(e),r=a[i]=s[i](e),{c(){t=w("section"),r.c(),y(t,"class","svelte-1evr0tg")},m(l,c){V(l,t,c),a[i].m(t,null),n=!0},p(l,[c]){let u=i;i=o(l),i!==u&&(Ve(),O(a[u],1,1,()=>{a[u]=null}),je(),r=a[i],r||(r=a[i]=s[i](l),r.c()),A(r,1),r.m(t,null))},i(l){n||(A(r),n=!0)},o(l){O(r),n=!1},d(l){l&&G(t),a[i].d()}}}function Dm(e,t,i){let r;return Fe(e,qh,n=>i(0,r=n)),[r]}class wm extends te{constructor(t){super(),ee(this,t,Dm,Im,Z,{})}}function Om(e){let t,i;const r=e[1].default,n=_n(r,e,e[0],null);return{c(){t=w("span"),n&&n.c(),y(t,"class","svelte-1ko21tx")},m(s,a){V(s,t,a),n&&n.m(t,null),i=!0},p(s,[a]){n&&n.p&&(!i||a&1)&&Cn(n,r,s,s[0],i?En(r,s[0],a,null):Rn(s[0]),null)},i(s){i||(A(n,s),i=!0)},o(s){O(n,s),i=!1},d(s){s&&G(t),n&&n.d(s)}}}function Mm(e,t,i){let{$$slots:r={},$$scope:n}=t;return e.$$set=s=>{"$$scope"in s&&i(0,n=s.$$scope)},[n,r]}class Lm extends te{constructor(t){super(),ee(this,t,Mm,Om,Z,{})}}function Nm(e){let t,i,r,n;return r=new wm({}),{c(){t=w("section"),i=w("span"),K(r.$$.fragment),y(i,"class","Content svelte-yzbfju"),y(t,"class","svelte-yzbfju")},m(s,a){V(s,t,a),E(t,i),j(r,i,null),n=!0},p:L,i(s){n||(A(r.$$.fragment,s),n=!0)},o(s){O(r.$$.fragment,s),n=!1},d(s){s&&G(t),q(r)}}}function $m(e){let t,i;return t=new Lm({props:{$$slots:{default:[Nm]},$$scope:{ctx:e}}}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},p(r,[n]){const s={};n&1&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}class xm extends te{constructor(t){super(),ee(this,t,null,$m,Z,{})}}function Oa(e){let t,i,r,n=e[1].message+"",s,a,o,l,c,u,d,h,f;return c=new Rl({}),{c(){t=w("section"),i=w("div"),r=w("div"),s=He(n),a=re(),o=w("div"),l=w("button"),K(c.$$.fragment),y(r,"class","Message svelte-1fzq9ye"),y(l,"class","Close svelte-1fzq9ye"),y(o,"class","CloseContainer svelte-1fzq9ye"),y(i,"class",u=gi("MessageContainer "+e[1].type)+" svelte-1fzq9ye"),Re(i,"Disappear",e[0]),y(t,"class","svelte-1fzq9ye")},m(v,T){V(v,t,T),E(t,i),E(i,r),E(r,s),E(i,a),E(i,o),E(o,l),j(c,l,null),d=!0,h||(f=Le(l,"click",e[2]),h=!0)},p(v,T){(!d||T&2)&&n!==(n=v[1].message+"")&&ut(s,n),(!d||T&2&&u!==(u=gi("MessageContainer "+v[1].type)+" svelte-1fzq9ye"))&&y(i,"class",u),(!d||T&3)&&Re(i,"Disappear",v[0])},i(v){d||(A(c.$$.fragment,v),d=!0)},o(v){O(c.$$.fragment,v),d=!1},d(v){v&&G(t),q(c),h=!1,f()}}}function Um(e){let t,i,r=e[1].type!=="none"&&Oa(e);return{c(){r&&r.c(),t=Jt()},m(n,s){r&&r.m(n,s),V(n,t,s),i=!0},p(n,[s]){n[1].type!=="none"?r?(r.p(n,s),s&2&&A(r,1)):(r=Oa(n),r.c(),A(r,1),r.m(t.parentNode,t)):r&&(Ve(),O(r,1,1,()=>{r=null}),je())},i(n){i||(A(r),i=!0)},o(n){O(r),i=!1},d(n){r&&r.d(n),n&&G(t)}}}const Fm=e=>yl.onNotification(t=>{switch(t.type){case Se.PEER_JOINED:e("info",`${t.data.name} joined the room`);break;case Se.PEER_LEFT:e("info",`${t.data.name} left the room`);break;case Se.DEVICE_CHANGE_UPDATE:e("info",t.message);break;case Se.ERROR:const i=t.data,r=i==null?void 0:i.code;if(console.log("error received ",i),i.isTerminal)e("error",`Error, you're disconnected: ${i.message}: ${i.description}`);else if([3001,3011].includes(r)){const s=r===3011?"Please enable permissions from system settings":"Please enable permissions from the address bar or browser settings";e("error",`${i.message} => ${s}`)}else e("error",`Error: ${i.message}: ${i.description}`);break;case Se.RECONNECTING:e("warn","You are offline for now. While we try to reconnect, please check your internet connection.");break;case Se.RECONNECTED:e("good","You are now connected");break}});function Gm(e,t,i){let r;Fe(e,St,l=>i(1,r=l));let n=!1;function s(){i(0,n=!0)}const a=St.subscribe(l=>{i(0,n=!1),!(l.type==="none"||l.type==="error"||l.type==="warn")&&setTimeout(()=>{i(0,n=!0)},5e3)}),o=Fm((l,c)=>St.set({type:l,message:c}));return kt(a),kt(o),e.$$.update=()=>{e.$$.dirty&1&&n&&setTimeout(()=>{St.set({type:"none",message:""})},500)},[n,r,s]}class Bm extends te{constructor(t){super(),ee(this,t,Gm,Um,Z,{})}}function Ma(e){let t,i;return t=new Bm({}),{c(){K(t.$$.fragment)},m(r,n){j(t,r,n),i=!0},p:L,i(r){i||(A(t.$$.fragment,r),i=!0)},o(r){O(t.$$.fragment,r),i=!1},d(r){q(t,r)}}}function Vm(e){let t,i,r,n=e[0].type+e[0].message,s;i=new xm({});let a=Ma();return{c(){t=w("main"),K(i.$$.fragment),r=re(),a.c()},m(o,l){V(o,t,l),j(i,t,null),E(t,r),a.m(t,null),s=!0},p(o,[l]){l&1&&Z(n,n=o[0].type+o[0].message)?(Ve(),O(a,1,1,L),je(),a=Ma(),a.c(),A(a,1),a.m(t,null)):a.p(o,l)},i(o){s||(A(i.$$.fragment,o),A(a),s=!0)},o(o){O(i.$$.fragment,o),O(a),s=!1},d(o){o&&G(t),q(i),a.d(o)}}}function jm(e,t,i){let r;return Fe(e,St,n=>i(0,r=n)),[r]}class qm extends te{constructor(t){super(),ee(this,t,jm,Vm,Z,{})}}new qm({target:document.getElementById("app")});
