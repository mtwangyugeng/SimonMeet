function Zl(e,t){for(var i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();function M(){}const Un=e=>e;function Xl(e,t){for(const i in t)e[i]=t[i];return e}function Za(e){return e()}function Is(){return Object.create(null)}function lt(e){e.forEach(Za)}function kt(e){return typeof e=="function"}function Z(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function ec(e){return Object.keys(e).length===0}function Xa(e,...t){if(e==null)return M;const i=e.subscribe(...t);return i.unsubscribe?()=>i.unsubscribe():i}function tc(e){let t;return Xa(e,i=>t=i)(),t}function Le(e,t,i){e.$$.on_destroy.push(Xa(t,i))}function Ur(e,t,i,r){if(e){const n=eo(e,t,i,r);return e[0](n)}}function eo(e,t,i,r){return e[1]&&r?Xl(i.ctx.slice(),e[1](r(t))):i.ctx}function Fr(e,t,i,r){if(e[2]&&r){const n=e[2](r(i));if(t.dirty===void 0)return n;if(typeof n=="object"){const s=[],a=Math.max(t.dirty.length,n.length);for(let o=0;o<a;o+=1)s[o]=t.dirty[o]|n[o];return s}return t.dirty|n}return t.dirty}function Br(e,t,i,r,n,s){if(n){const a=eo(t,i,r,s);e.p(a,n)}}function Gr(e){if(e.ctx.length>32){const t=[],i=e.ctx.length/32;for(let r=0;r<i;r++)t[r]=-1;return t}return-1}function bi(e){return e==null?"":e}const to=typeof window<"u";let Fn=to?()=>window.performance.now():()=>Date.now(),Bn=to?e=>requestAnimationFrame(e):M;const yi=new Set;function io(e){yi.forEach(t=>{t.c(e)||(yi.delete(t),t.f())}),yi.size!==0&&Bn(io)}function Gn(e){let t;return yi.size===0&&Bn(io),{promise:new Promise(i=>{yi.add(t={c:e,f:i})}),abort(){yi.delete(t)}}}function _(e,t){e.appendChild(t)}function ro(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function ic(e){const t=I("style");return rc(ro(e),t),t.sheet}function rc(e,t){return _(e.head||e,t),t.sheet}function N(e,t,i){e.insertBefore(t,i||null)}function L(e){e.parentNode&&e.parentNode.removeChild(e)}function I(e){return document.createElement(e)}function ae(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function be(e){return document.createTextNode(e)}function W(){return be(" ")}function ht(){return be("")}function _e(e,t,i,r){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i,r)}function Vr(e){return function(t){return t.preventDefault(),e.call(this,t)}}function f(e,t,i){i==null?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function nc(e){return Array.from(e.childNodes)}function Ze(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function ws(e,t){e.value=t==null?"":t}function cn(e,t,i,r){i===null?e.style.removeProperty(t):e.style.setProperty(t,i,r?"important":"")}function gi(e,t){for(let i=0;i<e.options.length;i+=1){const r=e.options[i];if(r.__value===t){r.selected=!0;return}}e.selectedIndex=-1}function fe(e,t,i){e.classList[i?"add":"remove"](t)}function sc(e,t,{bubbles:i=!1,cancelable:r=!1}={}){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,i,r,t),n}function $s(e,t){return new e(t)}const Tr=new Map;let br=0;function ac(e){let t=5381,i=e.length;for(;i--;)t=(t<<5)-t^e.charCodeAt(i);return t>>>0}function oc(e,t){const i={stylesheet:ic(t),rules:{}};return Tr.set(e,i),i}function Vn(e,t,i,r,n,s,a,o=0){const l=16.666/r;let c=`{
`;for(let S=0;S<=1;S+=l){const G=t+(i-t)*s(S);c+=S*100+`%{${a(G,1-G)}}
`}const u=c+`100% {${a(i,1-i)}}
}`,d=`__svelte_${ac(u)}_${o}`,h=ro(e),{stylesheet:p,rules:g}=Tr.get(h)||oc(h,e);g[d]||(g[d]=!0,p.insertRule(`@keyframes ${d} ${u}`,p.cssRules.length));const v=e.style.animation||"";return e.style.animation=`${v?`${v}, `:""}${d} ${r}ms linear ${n}ms 1 both`,br+=1,d}function _r(e,t){const i=(e.style.animation||"").split(", "),r=i.filter(t?s=>s.indexOf(t)<0:s=>s.indexOf("__svelte")===-1),n=i.length-r.length;n&&(e.style.animation=r.join(", "),br-=n,br||lc())}function lc(){Bn(()=>{br||(Tr.forEach(e=>{const{ownerNode:t}=e.stylesheet;t&&L(t)}),Tr.clear())})}function no(e,t,i,r){if(!t)return M;const n=e.getBoundingClientRect();if(t.left===n.left&&t.right===n.right&&t.top===n.top&&t.bottom===n.bottom)return M;const{delay:s=0,duration:a=300,easing:o=Un,start:l=Fn()+s,end:c=l+a,tick:u=M,css:d}=i(e,{from:t,to:n},r);let h=!0,p=!1,g;function v(){d&&(g=Vn(e,0,1,a,s,o,d)),s||(p=!0)}function S(){d&&_r(e,g),h=!1}return Gn(G=>{if(!p&&G>=l&&(p=!0),p&&G>=c&&(u(1,0),S()),!h)return!1;if(p){const w=G-l,D=0+1*o(w/a);u(D,1-D)}return!0}),v(),u(0,1),S}function so(e){const t=getComputedStyle(e);if(t.position!=="absolute"&&t.position!=="fixed"){const{width:i,height:r}=t,n=e.getBoundingClientRect();e.style.position="absolute",e.style.width=i,e.style.height=r,cc(e,n)}}function cc(e,t){const i=e.getBoundingClientRect();if(t.left!==i.left||t.top!==i.top){const r=getComputedStyle(e),n=r.transform==="none"?"":r.transform;e.style.transform=`${n} translate(${t.left-i.left}px, ${t.top-i.top}px)`}}let qi;function Fi(e){qi=e}function jr(){if(!qi)throw new Error("Function called outside component initialization");return qi}function uc(e){jr().$$.before_update.push(e)}function jn(e){jr().$$.on_mount.push(e)}function dc(e){jr().$$.after_update.push(e)}function Pt(e){jr().$$.on_destroy.push(e)}function ao(e,t){const i=e.$$.callbacks[t.type];i&&i.slice().forEach(r=>r.call(this,t))}const xi=[],ut=[],cr=[],un=[],hc=Promise.resolve();let dn=!1;function pc(){dn||(dn=!0,hc.then(oo))}function Dt(e){cr.push(e)}function zt(e){un.push(e)}const Yr=new Set;let nr=0;function oo(){const e=qi;do{for(;nr<xi.length;){const t=xi[nr];nr++,Fi(t),fc(t.$$)}for(Fi(null),xi.length=0,nr=0;ut.length;)ut.pop()();for(let t=0;t<cr.length;t+=1){const i=cr[t];Yr.has(i)||(Yr.add(i),i())}cr.length=0}while(xi.length);for(;un.length;)un.pop()();dn=!1,Yr.clear(),Fi(e)}function fc(e){if(e.fragment!==null){e.update(),lt(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Dt)}}let $i;function lo(){return $i||($i=Promise.resolve(),$i.then(()=>{$i=null})),$i}function kr(e,t,i){e.dispatchEvent(sc(`${t?"intro":"outro"}${i}`))}const ur=new Set;let Kt;function Ne(){Kt={r:0,c:[],p:Kt}}function xe(){Kt.r||lt(Kt.c),Kt=Kt.p}function C(e,t){e&&e.i&&(ur.delete(e),e.i(t))}function P(e,t,i,r){if(e&&e.o){if(ur.has(e))return;ur.add(e),Kt.c.push(()=>{ur.delete(e),r&&(i&&e.d(1),r())}),e.o(t)}else r&&r()}const co={duration:0};function Qi(e,t,i){let r=t(e,i),n=!1,s,a,o=0;function l(){s&&_r(e,s)}function c(){const{delay:d=0,duration:h=300,easing:p=Un,tick:g=M,css:v}=r||co;v&&(s=Vn(e,0,1,h,d,p,v,o++)),g(0,1);const S=Fn()+d,G=S+h;a&&a.abort(),n=!0,Dt(()=>kr(e,!0,"start")),a=Gn(w=>{if(n){if(w>=G)return g(1,0),kr(e,!0,"end"),l(),n=!1;if(w>=S){const D=p((w-S)/h);g(D,1-D)}}return n})}let u=!1;return{start(){u||(u=!0,_r(e),kt(r)?(r=r(),lo().then(c)):c())},invalidate(){u=!1},end(){n&&(l(),n=!1)}}}function qn(e,t,i){let r=t(e,i),n=!0,s;const a=Kt;a.r+=1;function o(){const{delay:l=0,duration:c=300,easing:u=Un,tick:d=M,css:h}=r||co;h&&(s=Vn(e,1,0,c,l,u,h));const p=Fn()+l,g=p+c;Dt(()=>kr(e,!1,"start")),Gn(v=>{if(n){if(v>=g)return d(0,1),kr(e,!1,"end"),--a.r||lt(a.c),!1;if(v>=p){const S=u((v-p)/c);d(1-S,S)}}return n})}return kt(r)?lo().then(()=>{r=r(),o()}):o(),{end(l){l&&r.tick&&r.tick(1,0),n&&(s&&_r(e,s),n=!1)}}}function Bi(e,t){e.d(1),t.delete(e.key)}function uo(e,t){P(e,1,1,()=>{t.delete(e.key)})}function mc(e,t){e.f(),Bi(e,t)}function gc(e,t){e.f(),uo(e,t)}function oi(e,t,i,r,n,s,a,o,l,c,u,d){let h=e.length,p=s.length,g=h;const v={};for(;g--;)v[e[g].key]=g;const S=[],G=new Map,w=new Map;for(g=p;g--;){const J=d(n,s,g),oe=i(J);let ue=a.get(oe);ue?r&&ue.p(J,t):(ue=c(oe,J),ue.c()),G.set(oe,S[g]=ue),oe in v&&w.set(oe,Math.abs(g-v[oe]))}const D=new Set,V=new Set;function z(J){C(J,1),J.m(o,u),a.set(J.key,J),u=J.first,p--}for(;h&&p;){const J=S[p-1],oe=e[h-1],ue=J.key,Q=oe.key;J===oe?(u=J.first,h--,p--):G.has(Q)?!a.has(ue)||D.has(ue)?z(J):V.has(Q)?h--:w.get(ue)>w.get(Q)?(V.add(ue),z(J)):(D.add(Q),h--):(l(oe,a),h--)}for(;h--;){const J=e[h];G.has(J.key)||l(J,a)}for(;p;)z(S[p-1]);return S}function Jt(e,t,i){const r=e.$$.props[t];r!==void 0&&(e.$$.bound[r]=i,i(e.$$.ctx[r]))}function F(e){e&&e.c()}function x(e,t,i,r){const{fragment:n,after_update:s}=e.$$;n&&n.m(t,i),r||Dt(()=>{const a=e.$$.on_mount.map(Za).filter(kt);e.$$.on_destroy?e.$$.on_destroy.push(...a):lt(a),e.$$.on_mount=[]}),s.forEach(Dt)}function U(e,t){const i=e.$$;i.fragment!==null&&(lt(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function vc(e,t){e.$$.dirty[0]===-1&&(xi.push(e),pc(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function X(e,t,i,r,n,s,a,o=[-1]){const l=qi;Fi(e);const c=e.$$={fragment:null,ctx:[],props:s,update:M,not_equal:n,bound:Is(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Is(),dirty:o,skip_bound:!1,root:t.target||l.$$.root};a&&a(c.root);let u=!1;if(c.ctx=i?i(e,t.props||{},(d,h,...p)=>{const g=p.length?p[0]:h;return c.ctx&&n(c.ctx[d],c.ctx[d]=g)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](g),u&&vc(e,d)),h}):[],c.update(),u=!0,lt(c.before_update),c.fragment=r?r(c.ctx):!1,t.target){if(t.hydrate){const d=nc(t.target);c.fragment&&c.fragment.l(d),d.forEach(L)}else c.fragment&&c.fragment.c();t.intro&&C(e.$$.fragment),x(e,t.target,t.anchor,t.customElement),oo()}Fi(l)}class ee{$destroy(){U(this,1),this.$destroy=M}$on(t,i){if(!kt(i))return M;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(i),()=>{const n=r.indexOf(i);n!==-1&&r.splice(n,1)}}$set(t){this.$$set&&!ec(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Rt(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+e+(i.length?" "+i.map(function(n){return"'"+n+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function _i(e){return!!e&&!!e[gt]}function ui(e){var t;return!!e&&(function(i){if(!i||typeof i!="object")return!1;var r=Object.getPrototypeOf(i);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return n===Object||typeof n=="function"&&Function.toString.call(n)===Cc}(e)||Array.isArray(e)||!!e[Fs]||!!(!((t=e.constructor)===null||t===void 0)&&t[Fs])||Hn(e)||Kn(e))}function Hi(e,t,i){i===void 0&&(i=!1),Ei(e)===0?(i?Object.keys:Yn)(e).forEach(function(r){i&&typeof r=="symbol"||t(r,e[r],e)}):e.forEach(function(r,n){return t(n,r,e)})}function Ei(e){var t=e[gt];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:Hn(e)?2:Kn(e)?3:0}function hn(e,t){return Ei(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function yc(e,t){return Ei(e)===2?e.get(t):e[t]}function ho(e,t,i){var r=Ei(e);r===2?e.set(t,i):r===3?(e.delete(t),e.add(i)):e[t]=i}function Tc(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function Hn(e){return Sc&&e instanceof Map}function Kn(e){return Ec&&e instanceof Set}function ii(e){return e.o||e.t}function Wn(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=Rc(e);delete t[gt];for(var i=Yn(t),r=0;r<i.length;r++){var n=i[r],s=t[n];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[n]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[n]})}return Object.create(Object.getPrototypeOf(e),t)}function zn(e,t){return t===void 0&&(t=!1),Jn(e)||_i(e)||!ui(e)||(Ei(e)>1&&(e.set=e.add=e.clear=e.delete=bc),Object.freeze(e),t&&Hi(e,function(i,r){return zn(r,!0)},!0)),e}function bc(){Rt(2)}function Jn(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function $t(e){var t=Pc[e];return t||Rt(18,e),t}function Ds(){return Ki}function Zr(e,t){t&&($t("Patches"),e.u=[],e.s=[],e.v=t)}function Sr(e){pn(e),e.p.forEach(_c),e.p=null}function pn(e){e===Ki&&(Ki=e.l)}function Os(e){return Ki={p:[],l:Ki,h:e,m:!0,_:0}}function _c(e){var t=e[gt];t.i===0||t.i===1?t.j():t.O=!0}function Xr(e,t){t._=t.p.length;var i=t.p[0],r=e!==void 0&&e!==i;return t.h.g||$t("ES5").S(t,e,r),r?(i[gt].P&&(Sr(t),Rt(4)),ui(e)&&(e=Er(t,e),t.l||Cr(t,e)),t.u&&$t("Patches").M(i[gt].t,e,t.u,t.s)):e=Er(t,i,[]),Sr(t),t.u&&t.v(t.u,t.s),e!==po?e:void 0}function Er(e,t,i){if(Jn(t))return t;var r=t[gt];if(!r)return Hi(t,function(s,a){return Ms(e,r,t,s,a,i)},!0),t;if(r.A!==e)return t;if(!r.P)return Cr(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var n=r.i===4||r.i===5?r.o=Wn(r.k):r.o;Hi(r.i===3?new Set(n):n,function(s,a){return Ms(e,r,n,s,a,i)}),Cr(e,n,!1),i&&e.u&&$t("Patches").R(r,i,e.u,e.s)}return r.o}function Ms(e,t,i,r,n,s){if(_i(n)){var a=Er(e,n,s&&t&&t.i!==3&&!hn(t.D,r)?s.concat(r):void 0);if(ho(i,r,a),!_i(a))return;e.m=!1}if(ui(n)&&!Jn(n)){if(!e.h.F&&e._<1)return;Er(e,n),t&&t.A.l||Cr(e,n)}}function Cr(e,t,i){i===void 0&&(i=!1),e.h.F&&e.m&&zn(t,i)}function en(e,t){var i=e[gt];return(i?ii(i):e)[t]}function Ls(e,t){if(t in e)for(var i=Object.getPrototypeOf(e);i;){var r=Object.getOwnPropertyDescriptor(i,t);if(r)return r;i=Object.getPrototypeOf(i)}}function fn(e){e.P||(e.P=!0,e.l&&fn(e.l))}function tn(e){e.o||(e.o=Wn(e.t))}function mn(e,t,i){var r=Hn(t)?$t("MapSet").N(t,i):Kn(t)?$t("MapSet").T(t,i):e.g?function(n,s){var a=Array.isArray(n),o={i:a?1:0,A:s?s.A:Ds(),P:!1,I:!1,D:{},l:s,t:n,k:null,o:null,j:null,C:!1},l=o,c=gn;a&&(l=[o],c=Ui);var u=Proxy.revocable(l,c),d=u.revoke,h=u.proxy;return o.k=h,o.j=d,h}(t,i):$t("ES5").J(t,i);return(i?i.A:Ds()).p.push(r),r}function kc(e){return _i(e)||Rt(22,e),function t(i){if(!ui(i))return i;var r,n=i[gt],s=Ei(i);if(n){if(!n.P&&(n.i<4||!$t("ES5").K(n)))return n.t;n.I=!0,r=Ns(i,s),n.I=!1}else r=Ns(i,s);return Hi(r,function(a,o){n&&yc(n.t,a)===o||ho(r,a,t(o))}),s===3?new Set(r):r}(e)}function Ns(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return Wn(e)}var xs,Ki,Qn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Sc=typeof Map<"u",Ec=typeof Set<"u",Us=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",po=Qn?Symbol.for("immer-nothing"):((xs={})["immer-nothing"]=!0,xs),Fs=Qn?Symbol.for("immer-draftable"):"__$immer_draftable",gt=Qn?Symbol.for("immer-state"):"__$immer_state",Cc=""+Object.prototype.constructor,Yn=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Rc=Object.getOwnPropertyDescriptors||function(e){var t={};return Yn(e).forEach(function(i){t[i]=Object.getOwnPropertyDescriptor(e,i)}),t},Pc={},gn={get:function(e,t){if(t===gt)return e;var i=ii(e);if(!hn(i,t))return function(n,s,a){var o,l=Ls(s,a);return l?"value"in l?l.value:(o=l.get)===null||o===void 0?void 0:o.call(n.k):void 0}(e,i,t);var r=i[t];return e.I||!ui(r)?r:r===en(e.t,t)?(tn(e),e.o[t]=mn(e.A.h,r,e)):r},has:function(e,t){return t in ii(e)},ownKeys:function(e){return Reflect.ownKeys(ii(e))},set:function(e,t,i){var r=Ls(ii(e),t);if(r!=null&&r.set)return r.set.call(e.k,i),!0;if(!e.P){var n=en(ii(e),t),s=n==null?void 0:n[gt];if(s&&s.t===i)return e.o[t]=i,e.D[t]=!1,!0;if(Tc(i,n)&&(i!==void 0||hn(e.t,t)))return!0;tn(e),fn(e)}return e.o[t]===i&&typeof i!="number"&&(i!==void 0||t in e.o)||(e.o[t]=i,e.D[t]=!0,!0)},deleteProperty:function(e,t){return en(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,tn(e),fn(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var i=ii(e),r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:r.enumerable,value:i[t]}},defineProperty:function(){Rt(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Rt(12)}},Ui={};Hi(gn,function(e,t){Ui[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Ui.deleteProperty=function(e,t){return Ui.set.call(this,e,t,void 0)},Ui.set=function(e,t,i){return gn.set.call(this,e[0],t,i,e[0])};var Ac=function(){function e(i){var r=this;this.g=Us,this.F=!0,this.produce=function(n,s,a){if(typeof n=="function"&&typeof s!="function"){var o=s;s=n;var l=r;return function(v){var S=this;v===void 0&&(v=o);for(var G=arguments.length,w=Array(G>1?G-1:0),D=1;D<G;D++)w[D-1]=arguments[D];return l.produce(v,function(V){var z;return(z=s).call.apply(z,[S,V].concat(w))})}}var c;if(typeof s!="function"&&Rt(6),a!==void 0&&typeof a!="function"&&Rt(7),ui(n)){var u=Os(r),d=mn(r,n,void 0),h=!0;try{c=s(d),h=!1}finally{h?Sr(u):pn(u)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(v){return Zr(u,a),Xr(v,u)},function(v){throw Sr(u),v}):(Zr(u,a),Xr(c,u))}if(!n||typeof n!="object"){if((c=s(n))===void 0&&(c=n),c===po&&(c=void 0),r.F&&zn(c,!0),a){var p=[],g=[];$t("Patches").M(n,c,p,g),a(p,g)}return c}Rt(21,n)},this.produceWithPatches=function(n,s){if(typeof n=="function")return function(c){for(var u=arguments.length,d=Array(u>1?u-1:0),h=1;h<u;h++)d[h-1]=arguments[h];return r.produceWithPatches(c,function(p){return n.apply(void 0,[p].concat(d))})};var a,o,l=r.produce(n,s,function(c,u){a=c,o=u});return typeof Promise<"u"&&l instanceof Promise?l.then(function(c){return[c,a,o]}):[l,a,o]},typeof(i==null?void 0:i.useProxies)=="boolean"&&this.setUseProxies(i.useProxies),typeof(i==null?void 0:i.autoFreeze)=="boolean"&&this.setAutoFreeze(i.autoFreeze)}var t=e.prototype;return t.createDraft=function(i){ui(i)||Rt(8),_i(i)&&(i=kc(i));var r=Os(this),n=mn(this,i,void 0);return n[gt].C=!0,pn(r),n},t.finishDraft=function(i,r){var n=i&&i[gt],s=n.A;return Zr(s,r),Xr(void 0,s)},t.setAutoFreeze=function(i){this.F=i},t.setUseProxies=function(i){i&&!Us&&Rt(20),this.g=i},t.applyPatches=function(i,r){var n;for(n=r.length-1;n>=0;n--){var s=r[n];if(s.path.length===0&&s.op==="replace"){i=s.value;break}}n>-1&&(r=r.slice(n+1));var a=$t("Patches").$;return _i(i)?a(i,r):this.produce(i,function(o){return a(o,r)})},e}(),vt=new Ac,Ic=vt.produce;vt.produceWithPatches.bind(vt);vt.setAutoFreeze.bind(vt);vt.setUseProxies.bind(vt);vt.applyPatches.bind(vt);vt.createDraft.bind(vt);vt.finishDraft.bind(vt);const wc=Ic;function $c(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(let r=0;r<i.length;r++)if(!Object.prototype.hasOwnProperty.call(t,i[r])||!Object.is(e[i[r]],t[i[r]]))return!1;return!0}function Dc(e){let t;const i=new Set,r=(c,u)=>{const d=typeof c=="function"?c(t):c;if(d!==t){const h=t;t=u?d:Object.assign({},t,d),i.forEach(p=>p(t,h))}},n=()=>t,s=(c,u=n,d=Object.is)=>{let h=u(t);function p(){const g=u(t);if(!d(h,g)){const v=h;c(h=g,v)}}return i.add(p),()=>i.delete(p)},l={setState:r,getState:n,subscribe:(c,u,d)=>u||d?s(c,u,d):(i.add(c),()=>i.delete(c)),destroy:()=>i.clear()};return t=e(r,n,l),l}let fo=!0,mo=!0;function dr(e,t,i){const r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function pi(e,t,i){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,n=r.addEventListener;r.addEventListener=function(a,o){if(a!==t)return n.apply(this,arguments);const l=c=>{const u=i(c);u&&(o.handleEvent?o.handleEvent(u):o(u))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(o,l),n.apply(this,[a,l])};const s=r.removeEventListener;r.removeEventListener=function(a,o){if(a!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(o))return s.apply(this,arguments);const l=this._eventMap[t].get(o);return this._eventMap[t].delete(o),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[a,l])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function Oc(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(fo=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Mc(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(mo=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function go(){if(typeof window=="object"){if(fo)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Zn(e,t){!mo||console.warn(e+" is deprecated, please use "+t+" instead.")}function Lc(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator)return t.browser="Not a browser.",t;const{navigator:i}=e;if(i.mozGetUserMedia)t.browser="firefox",t.version=dr(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=dr(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=dr(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function Bs(e){return Object.prototype.toString.call(e)==="[object Object]"}function vo(e){return Bs(e)?Object.keys(e).reduce(function(t,i){const r=Bs(e[i]),n=r?vo(e[i]):e[i],s=r&&!Object.keys(n).length;return n===void 0||s?t:Object.assign(t,{[i]:n})},{}):e}function vn(e,t,i){!t||i.has(t.id)||(i.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?vn(e,e.get(t[r]),i):r.endsWith("Ids")&&t[r].forEach(n=>{vn(e,e.get(n),i)})}))}function Gs(e,t,i){const r=i?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;const s=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&s.push(a)}),s.forEach(a=>{e.forEach(o=>{o.type===r&&o.trackId===a.id&&vn(e,o,n)})}),n}const Vs=go;function yo(e,t){const i=e&&e.navigator;if(!i.mediaDevices)return;const r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const l={};return Object.keys(o).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof o[c]=="object"?o[c]:{ideal:o[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,p){return h?h+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){l.optional=l.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",c)]=u.ideal,l.optional.push(h),h={},h[d("max",c)]=u.ideal,l.optional.push(h)):(h[d("",c)]=u.ideal,l.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(h,c)]=u[h])})}),o.advanced&&(l.optional=(l.optional||[]).concat(o.advanced)),l},n=function(o,l){if(t.version>=61)return l(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const c=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};o=JSON.parse(JSON.stringify(o)),c(o.audio,"autoGainControl","googAutoGainControl"),c(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let c=o.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=t.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete o.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return i.mediaDevices.enumerateDevices().then(h=>{h=h.filter(g=>g.kind==="videoinput");let p=h.find(g=>d.some(v=>g.label.toLowerCase().includes(v)));return!p&&h.length&&d.includes("back")&&(p=h[h.length-1]),p&&(o.video.deviceId=c.exact?{exact:p.deviceId}:{ideal:p.deviceId}),o.video=r(o.video),Vs("chrome: "+JSON.stringify(o)),l(o)})}o.video=r(o.video)}return Vs("chrome: "+JSON.stringify(o)),l(o)},s=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(o,l,c){n(o,u=>{i.webkitGetUserMedia(u,l,d=>{c&&c(s(d))})})};if(i.getUserMedia=a.bind(i),i.mediaDevices.getUserMedia){const o=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(l){return n(l,c=>o(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function Nc(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&!!e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(n=>{const s=r.video&&r.video.width,a=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:o||3}},s&&(r.video.mandatory.maxWidth=s),a&&(r.video.mandatory.maxHeight=a),e.navigator.mediaDevices.getUserMedia(r)})}}}function To(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function bo(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",n=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===n.track.id):s={track:n.track};const a=new Event("track");a.track=n.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[r.stream],this.dispatchEvent(a)}),r.stream.getTracks().forEach(n=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===n.id):s={track:n};const a=new Event("track");a.track=n,a.receiver=s,a.transceiver={receiver:s},a.streams=[r.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else pi(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function _o(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(n,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=n.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:n}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,l){let c=n.apply(this,arguments);return c||(c=t(this,o),this._senders.push(c)),c};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const l=this._senders.indexOf(o);l!==-1&&this._senders.splice(l,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(a=>{const o=this._senders.find(l=>l.track===a);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ko(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,n,s]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const a=function(l){const c={};return l.result().forEach(d=>{const h={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(p=>{h[p]=d.stat(p)}),c[h.id]=h}),c},o=function(l){return new Map(Object.keys(l).map(c=>[c,l[c]]))};if(arguments.length>=2){const l=function(c){n(o(a(c)))};return t.apply(this,[l,r])}return new Promise((l,c)=>{t.apply(this,[function(u){l(o(a(u)))},c])}).then(n,s)}}function So(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=i.apply(this,[]);return s.forEach(a=>a._pc=this),s});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>Gs(a,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=i.apply(this,[]);return n.forEach(s=>s._pc=this),n}),pi(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(s=>Gs(s,n.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let n,s,a;return this.getSenders().forEach(o=>{o.track===r&&(n?a=!0:n=o)}),this.getReceivers().forEach(o=>(o.track===r&&(s?a=!0:s=o),o.track===r)),a||n&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Eo(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(l)===-1&&this._shimmedLocalStreams[o.id].push(l):this._shimmedLocalStreams[o.id]=[o,l],l};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();i.apply(this,arguments);const l=this.getSenders().filter(c=>o.indexOf(c)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const l=this._shimmedLocalStreams[o].indexOf(a);l!==-1&&this._shimmedLocalStreams[o].splice(l,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),n.apply(this,arguments)}}function Co(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Eo(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const u=i.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new e.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}r.apply(this,[u])};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},e.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(v=>v===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[d.id];if(g)g.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new e.MediaStream([u]);this._streams[d.id]=v,this._reverseStreams[v.id]=d,this.addStream(v)}return this.getSenders().find(v=>v.track===u)};function s(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const p=c._reverseStreams[h],g=c._streams[p.id];d=d.replace(new RegExp(g.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function a(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const p=c._reverseStreams[h],g=c._streams[p.id];d=d.replace(new RegExp(p.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],d={[c](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[g=>{const v=s(this,g);h[0].apply(null,[v])},g=>{h[1]&&h[1].apply(null,g)},arguments[2]]):u.apply(this,arguments).then(g=>s(this,g))}};e.RTCPeerConnection.prototype[c]=d[c]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=a(this,arguments[0]),o.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:s(this,c)}}),e.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(v=>u.track===v)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function yn(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!!e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const r=e.RTCPeerConnection.prototype[i],n={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=n[i]})}function Ro(e,t){pi(e,"negotiationneeded",i=>{const r=i.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return i})}const js=Object.freeze(Object.defineProperty({__proto__:null,shimMediaStream:To,shimOnTrack:bo,shimGetSendersWithDtmf:_o,shimGetStats:ko,shimSenderReceiverGetStats:So,shimAddTrackRemoveTrackWithNative:Eo,shimAddTrackRemoveTrack:Co,shimPeerConnection:yn,fixNegotiationNeeded:Ro,shimGetUserMedia:yo,shimGetDisplayMedia:Nc},Symbol.toStringTag,{value:"Module"}));function Po(e,t){const i=e&&e.navigator,r=e&&e.MediaStreamTrack;if(i.getUserMedia=function(n,s,a){Zn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(n).then(s,a)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const n=function(a,o,l){o in a&&!(l in a)&&(a[l]=a[o],delete a[o])},s=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a.audio,"autoGainControl","mozAutoGainControl"),n(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},r&&r.prototype.getSettings){const a=r.prototype.getSettings;r.prototype.getSettings=function(){const o=a.apply(this,arguments);return n(o,"mozAutoGainControl","autoGainControl"),n(o,"mozNoiseSuppression","noiseSuppression"),o}}if(r&&r.prototype.applyConstraints){const a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),n(o,"autoGainControl","mozAutoGainControl"),n(o,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[o])}}}}function xc(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function Ao(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Tn(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const s=e.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=a[n]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,a,o]=arguments;return r.apply(this,[s||null]).then(l=>{if(t.version<53&&!a)try{l.forEach(c=>{c.type=i[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:i[u.type]||u.type}))})}return l}).then(a,o)}}function Io(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(s=>s._pc=this),n});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const n=i.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function wo(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r}),pi(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function $o(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(i){Zn("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&i.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Do(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Oo(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const n=r.length>0;n&&r.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(n){const{sender:a}=s,o=a.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=r,a.sendEncodings=r,this.setParametersPromises.push(a.setParameters(o).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function Mo(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Lo(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function No(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const qs=Object.freeze(Object.defineProperty({__proto__:null,shimOnTrack:Ao,shimPeerConnection:Tn,shimSenderGetStats:Io,shimReceiverGetStats:wo,shimRemoveStream:$o,shimRTCDataChannel:Do,shimAddTransceiver:Oo,shimGetParameters:Mo,shimCreateOffer:Lo,shimCreateAnswer:No,shimGetUserMedia:Po,shimGetDisplayMedia:xc},Symbol.toStringTag,{value:"Module"}));function xo(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(n=>t.call(this,n,r)),r.getVideoTracks().forEach(n=>t.call(this,n,r))},e.RTCPeerConnection.prototype.addTrack=function(r,...n){return n&&n.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(i);if(r===-1)return;this._localStreams.splice(r,1);const n=i.getTracks();this.getSenders().forEach(s=>{n.includes(s.track)&&this.removeTrack(s)})})}}function Uo(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const s=new Event("addstream");s.stream=n,this.dispatchEvent(s)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,r.dispatchEvent(a)})}),t.apply(r,arguments)}}}function Fo(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h},t.createAnswer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=r.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h};let o=function(l,c,u){const d=n.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d};t.setLocalDescription=o,o=function(l,c,u){const d=s.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},t.setRemoteDescription=o,o=function(l,c,u){const d=a.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},t.addIceCandidate=o}function Bo(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const i=t.mediaDevices,r=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=n=>r(Go(n))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(r,n,s){t.mediaDevices.getUserMedia(r).then(n,s)}.bind(t))}function Go(e){return e&&e.video!==void 0?Object.assign({},e,{video:vo(e.video)}):e}function Vo(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,n){if(r&&r.iceServers){const s=[];for(let a=0;a<r.iceServers.length;a++){let o=r.iceServers[a];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(Zn("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,s.push(o)):s.push(r.iceServers[a])}r.iceServers=s}return new t(r,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function jo(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qo(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const n=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):r.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Ho(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const Hs=Object.freeze(Object.defineProperty({__proto__:null,shimLocalStreamsAPI:xo,shimRemoteStreamsAPI:Uo,shimCallbacksAPI:Fo,shimGetUserMedia:Bo,shimConstraints:Go,shimRTCIceServerUrls:Vo,shimTrackEventTransceiver:jo,shimCreateOfferLegacy:qo,shimAudioContext:Ho},Symbol.toStringTag,{value:"Module"}));var Uc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Xn={exports:{}};(function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(i){return i.split(`
m=`).map((n,s)=>(s>0?"m="+n:n).trim()+`\r
`)},t.getDescription=function(i){const r=t.splitSections(i);return r&&r[0]},t.getMediaSections=function(i){const r=t.splitSections(i);return r.shift(),r},t.matchPrefix=function(i,r){return t.splitLines(i).filter(n=>n.indexOf(r)===0)},t.parseCandidate=function(i){let r;i.indexOf("a=candidate:")===0?r=i.substring(12).split(" "):r=i.substring(10).split(" ");const n={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":n.relatedAddress=r[s+1];break;case"rport":n.relatedPort=parseInt(r[s+1],10);break;case"tcptype":n.tcpType=r[s+1];break;case"ufrag":n.ufrag=r[s+1],n.usernameFragment=r[s+1];break;default:n[r[s]]===void 0&&(n[r[s]]=r[s+1]);break}return n},t.writeCandidate=function(i){const r=[];r.push(i.foundation);const n=i.component;n==="rtp"?r.push(1):n==="rtcp"?r.push(2):r.push(n),r.push(i.protocol.toUpperCase()),r.push(i.priority),r.push(i.address||i.ip),r.push(i.port);const s=i.type;return r.push("typ"),r.push(s),s!=="host"&&i.relatedAddress&&i.relatedPort&&(r.push("raddr"),r.push(i.relatedAddress),r.push("rport"),r.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(r.push("ufrag"),r.push(i.usernameFragment||i.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(i){return i.substr(14).split(" ")},t.parseRtpMap=function(i){let r=i.substr(9).split(" ");const n={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),n.name=r[0],n.clockRate=parseInt(r[1],10),n.channels=r.length===3?parseInt(r[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(i){let r=i.payloadType;i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType);const n=i.channels||i.numChannels||1;return"a=rtpmap:"+r+" "+i.name+"/"+i.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(i){const r=i.substr(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+`\r
`},t.parseFmtp=function(i){const r={};let n;const s=i.substr(i.indexOf(" ")+1).split(";");for(let a=0;a<s.length;a++)n=s[a].trim().split("="),r[n[0].trim()]=n[1];return r},t.writeFmtp=function(i){let r="",n=i.payloadType;if(i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const s=[];Object.keys(i.parameters).forEach(a=>{i.parameters[a]!==void 0?s.push(a+"="+i.parameters[a]):s.push(a)}),r+="a=fmtp:"+n+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(i){const r=i.substr(i.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(i){let r="",n=i.payloadType;return i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+n+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(i){const r=i.indexOf(" "),n={ssrc:parseInt(i.substr(7,r-7),10)},s=i.indexOf(":",r);return s>-1?(n.attribute=i.substr(r+1,s-r-1),n.value=i.substr(s+1)):n.attribute=i.substr(r+1),n},t.parseSsrcGroup=function(i){const r=i.substr(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(n=>parseInt(n,10))}},t.getMid=function(i){const r=t.matchPrefix(i,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(i){const r=i.substr(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(i,r){return{role:"auto",fingerprints:t.matchPrefix(i+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,r){let n="a=setup:"+r+`\r
`;return i.fingerprints.forEach(s=>{n+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),n},t.parseCryptoLine=function(i){const r=i.substr(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const r=i.substr(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,r){return t.matchPrefix(i+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,r){const n=t.matchPrefix(i+r,"a=ice-ufrag:")[0],s=t.matchPrefix(i+r,"a=ice-pwd:")[0];return n&&s?{usernameFragment:n.substr(12),password:s.substr(10)}:null},t.writeIceParameters=function(i){let r="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(i){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(i)[0].split(" ");for(let a=3;a<s.length;a++){const o=s[a],l=t.matchPrefix(i,"a=rtpmap:"+o+" ")[0];if(l){const c=t.parseRtpMap(l),u=t.matchPrefix(i,"a=fmtp:"+o+" ");switch(c.parameters=u.length?t.parseFmtp(u[0]):{},c.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),r.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(c.name.toUpperCase());break}}}return t.matchPrefix(i,"a=extmap:").forEach(a=>{r.headerExtensions.push(t.parseExtmap(a))}),r},t.writeRtpDescription=function(i,r){let n="";n+="m="+i+" ",n+=r.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=r.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(a=>{n+=t.writeRtpMap(a),n+=t.writeFmtp(a),n+=t.writeRtcpFb(a)});let s=0;return r.codecs.forEach(a=>{a.maxptime>s&&(s=a.maxptime)}),s>0&&(n+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(a=>{n+=t.writeExtmap(a)}),n},t.parseRtpEncodingParameters=function(i){const r=[],n=t.parseRtpParameters(i),s=n.fecMechanisms.indexOf("RED")!==-1,a=n.fecMechanisms.indexOf("ULPFEC")!==-1,o=t.matchPrefix(i,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),l=o.length>0&&o[0].ssrc;let c;const u=t.matchPrefix(i,"a=ssrc-group:FID").map(h=>h.substr(17).split(" ").map(g=>parseInt(g,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),n.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let p={ssrc:l,codecPayloadType:parseInt(h.parameters.apt,10)};l&&c&&(p.rtx={ssrc:c}),r.push(p),s&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},r.push(p))}}),r.length===0&&l&&r.push({ssrc:l});let d=t.matchPrefix(i,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substr(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substr(5),10)*1e3*.95-50*40*8:d=void 0,r.forEach(h=>{h.maxBitrate=d})),r},t.parseRtcpParameters=function(i){const r={},n=t.matchPrefix(i,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const s=t.matchPrefix(i,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const a=t.matchPrefix(i,"a=rtcp-mux");return r.mux=a.length>0,r},t.writeRtcpParameters=function(i){let r="";return i.reducedSize&&(r+=`a=rtcp-rsize\r
`),i.mux&&(r+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(r+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),r},t.parseMsid=function(i){let r;const n=t.matchPrefix(i,"a=msid:");if(n.length===1)return r=n[0].substr(7).split(" "),{stream:r[0],track:r[1]};const s=t.matchPrefix(i,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},t.parseSctpDescription=function(i){const r=t.parseMLine(i),n=t.matchPrefix(i,"a=max-message-size:");let s;n.length>0&&(s=parseInt(n[0].substr(19),10)),isNaN(s)&&(s=65536);const a=t.matchPrefix(i,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:r.fmt,maxMessageSize:s};const o=t.matchPrefix(i,"a=sctpmap:");if(o.length>0){const l=o[0].substr(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},t.writeSctpDescription=function(i,r){let n=[];return i.protocol!=="DTLS/SCTP"?n=["m="+i.kind+" 9 "+i.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:n=["m="+i.kind+" 9 "+i.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&n.push("a=max-message-size:"+r.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(i,r,n){let s;const a=r!==void 0?r:2;return i?s=i:s=t.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+s+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,r){const n=t.splitLines(i);for(let s=0;s<n.length;s++)switch(n[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[s].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substr(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){const n=t.splitLines(i)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(i){const n=t.matchPrefix(i,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const r=t.splitLines(i);for(let n=0;n<r.length;n++)if(r[n].length<2||r[n].charAt(1)!=="=")return!1;return!0},e.exports=t})(Xn);const Ti=Xn.exports,Fc=Zl({__proto__:null,default:Ti},[Xn.exports]);function hr(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const n=new t(r),s=Ti.parseCandidate(r.candidate),a=Object.assign(n,s);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,pi(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function bn(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||pi(e,"icecandidate",t=>{if(t.candidate){const i=Ti.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function pr(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(o){if(!o||!o.sdp)return!1;const l=Ti.splitSections(o.sdp);return l.shift(),l.some(c=>{const u=Ti.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(o){const l=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},n=function(o){let l=65536;return t.browser==="firefox"&&(t.version<57?o===-1?l=16384:l=2147483637:t.version<60?l=t.version===57?65535:65536:l=2147483637),l},s=function(o,l){let c=65536;t.browser==="firefox"&&t.version===57&&(c=65535);const u=Ti.matchPrefix(o.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(c=2147483637),c},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const l=r(arguments[0]),c=n(l),u=s(arguments[0],l);let d;c===0&&u===0?d=Number.POSITIVE_INFINITY:c===0||u===0?d=Math.max(c,u):d=Math.min(c,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return a.apply(this,arguments)}}function fr(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,n){const s=r.send;r.send=function(){const o=arguments[0],l=o.length||o.size||o.byteLength;if(r.readyState==="open"&&n.sctp&&l>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const n=i.apply(this,arguments);return t(n,this),n},pi(e,"datachannel",r=>(t(r.channel,r.target),r))}function _n(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const r=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const s=n.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",n);s.dispatchEvent(a)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function kn(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=n.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&n instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:n.type,sdp:s}):n.sdp=s}return i.apply(this,arguments)}}function mr(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const i=e.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function gr(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const i=e.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return i.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?i.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>i.apply(this,[a]))})}const Bc=Object.freeze(Object.defineProperty({__proto__:null,shimRTCIceCandidate:hr,shimRTCIceCandidateRelayProtocol:bn,shimMaxMessageSize:pr,shimSendThrowTypeError:fr,shimConnectionState:_n,removeExtmapAllowMixed:kn,shimAddIceCandidateNullOrEmpty:mr,shimParameterlessSetLocalDescription:gr},Symbol.toStringTag,{value:"Module"}));function Gc({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=go,r=Lc(e),n={browserDetails:r,commonShim:Bc,extractVersion:dr,disableLog:Oc,disableWarnings:Mc,sdp:Fc};switch(r.browser){case"chrome":if(!js||!yn||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),n;if(r.version===null)return i("Chrome shim can not determine version, not shimming."),n;i("adapter.js shimming chrome."),n.browserShim=js,mr(e,r),gr(e),yo(e,r),To(e),yn(e,r),bo(e),Co(e,r),_o(e),ko(e),So(e),Ro(e,r),hr(e),bn(e),_n(e),pr(e,r),fr(e),kn(e,r);break;case"firefox":if(!qs||!Tn||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),n;i("adapter.js shimming firefox."),n.browserShim=qs,mr(e,r),gr(e),Po(e,r),Tn(e,r),Ao(e),$o(e),Io(e),wo(e),Do(e),Oo(e),Mo(e),Lo(e),No(e),hr(e),_n(e),pr(e,r),fr(e);break;case"safari":if(!Hs||!t.shimSafari)return i("Safari shim is not included in this adapter release."),n;i("adapter.js shimming safari."),n.browserShim=Hs,mr(e,r),gr(e),Vo(e),qo(e),Fo(e),xo(e),Uo(e),jo(e),Bo(e),Ho(e),hr(e),bn(e),pr(e,r),fr(e),kn(e,r);break;default:i("Unsupported browser!");break}return n}const Rr=Gc({window:typeof window>"u"?void 0:window});var Sn={exports:{}};(function(e,t){(function(i,r){var n="1.0.32",s="",a="?",o="function",l="undefined",c="object",u="string",d="major",h="model",p="name",g="type",v="vendor",S="version",G="architecture",w="console",D="mobile",V="tablet",z="smarttv",J="wearable",oe="embedded",ue=350,Q="Amazon",Y="Apple",se="ASUS",de="BlackBerry",Ae="Browser",Ue="Chrome",ie="Edge",rt="Firefox",at="Google",m="Huawei",b="LG",R="Microsoft",k="Motorola",A="Opera",E="Samsung",$="Sharp",O="Sony",B="Xiaomi",j="Zebra",ne="Facebook",We=function(me,we){var ge={};for(var qe in me)we[qe]&&we[qe].length%2===0?ge[qe]=we[qe].concat(me[qe]):ge[qe]=me[qe];return ge},ve=function(me){for(var we={},ge=0;ge<me.length;ge++)we[me[ge].toUpperCase()]=me[ge];return we},Re=function(me,we){return typeof me===u?Oe(we).indexOf(Oe(me))!==-1:!1},Oe=function(me){return me.toLowerCase()},et=function(me){return typeof me===u?me.replace(/[^\d\.]/g,s).split(".")[0]:r},ti=function(me,we){if(typeof me===u)return me=me.replace(/^\s\s*/,s).replace(/\s\s*$/,s),typeof we===l?me:me.substring(0,ue)},Lt=function(me,we){for(var ge=0,qe,ye,rr,Be,wi,It;ge<we.length&&!wi;){var Ps=we[ge],As=we[ge+1];for(qe=ye=0;qe<Ps.length&&!wi;)if(wi=Ps[qe++].exec(me),wi)for(rr=0;rr<As.length;rr++)It=wi[++ye],Be=As[rr],typeof Be===c&&Be.length>0?Be.length===2?typeof Be[1]==o?this[Be[0]]=Be[1].call(this,It):this[Be[0]]=Be[1]:Be.length===3?typeof Be[1]===o&&!(Be[1].exec&&Be[1].test)?this[Be[0]]=It?Be[1].call(this,It,Be[2]):r:this[Be[0]]=It?It.replace(Be[1],Be[2]):r:Be.length===4&&(this[Be[0]]=It?Be[3].call(this,It.replace(Be[1],Be[2])):r):this[Be]=It||r;ge+=2}},Nt=function(me,we){for(var ge in we)if(typeof we[ge]===c&&we[ge].length>0){for(var qe=0;qe<we[ge].length;qe++)if(Re(we[ge][qe],me))return ge===a?r:ge}else if(Re(we[ge],me))return ge===a?r:ge;return me},Ii={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},bt={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},tt={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,S],[/opios[\/ ]+([\w\.]+)/i],[S,[p,A+" Mini"]],[/\bopr\/([\w\.]+)/i],[S,[p,A]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,S],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[p,"UC"+Ae]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[S,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[S,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[S,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+Ae],S],[/\bfocus\/([\w\.]+)/i],[S,[p,rt+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[p,A+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[p,A+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[p,"MIUI "+Ae]],[/fxios\/([-\w\.]+)/i],[S,[p,rt]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+Ae]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+Ae],S],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,S],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,ne],S],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[p,Ue+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,Ue+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[p,"Android "+Ae]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[S,Nt,Ii]],[/(webkit|khtml)\/([\w\.]+)/i],[p,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[p,rt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[p,S]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,Oe]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,s,Oe]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,Oe]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[v,E],[g,V]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[v,E],[g,D]],[/\((ip(?:hone|od)[\w ]*);/i],[h,[v,Y],[g,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[v,Y],[g,V]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[v,m],[g,V]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[v,m],[g,D]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[v,B],[g,D]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[v,B],[g,V]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[v,"OPPO"],[g,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[v,"Vivo"],[g,D]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[h,[v,"Realme"],[g,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[v,k],[g,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[v,k],[g,V]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[v,b],[g,V]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[v,b],[g,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[v,"Lenovo"],[g,V]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[v,"Nokia"],[g,D]],[/(pixel c)\b/i],[h,[v,at],[g,V]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[v,at],[g,D]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[v,O],[g,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[v,O],[g,V]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[v,"OnePlus"],[g,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[v,Q],[g,V]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[v,Q],[g,D]],[/(playbook);[-\w\),; ]+(rim)/i],[h,v,[g,V]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[v,de],[g,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[v,se],[g,V]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[v,se],[g,D]],[/(nexus 9)/i],[h,[v,"HTC"],[g,V]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[h,/_/g," "],[g,D]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[v,"Acer"],[g,V]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[v,"Meizu"],[g,D]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[v,$],[g,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,h,[g,D]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,h,[g,V]],[/(surface duo)/i],[h,[v,R],[g,V]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[v,"Fairphone"],[g,D]],[/(u304aa)/i],[h,[v,"AT&T"],[g,D]],[/\bsie-(\w*)/i],[h,[v,"Siemens"],[g,D]],[/\b(rct\w+) b/i],[h,[v,"RCA"],[g,V]],[/\b(venue[\d ]{2,7}) b/i],[h,[v,"Dell"],[g,V]],[/\b(q(?:mv|ta)\w+) b/i],[h,[v,"Verizon"],[g,V]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[v,"Barnes & Noble"],[g,V]],[/\b(tm\d{3}\w+) b/i],[h,[v,"NuVision"],[g,V]],[/\b(k88) b/i],[h,[v,"ZTE"],[g,V]],[/\b(nx\d{3}j) b/i],[h,[v,"ZTE"],[g,D]],[/\b(gen\d{3}) b.+49h/i],[h,[v,"Swiss"],[g,D]],[/\b(zur\d{3}) b/i],[h,[v,"Swiss"],[g,V]],[/\b((zeki)?tb.*\b) b/i],[h,[v,"Zeki"],[g,V]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],h,[g,V]],[/\b(ns-?\w{0,9}) b/i],[h,[v,"Insignia"],[g,V]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[v,"NextBook"],[g,V]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],h,[g,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],h,[g,D]],[/\b(ph-1) /i],[h,[v,"Essential"],[g,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[v,"Envizen"],[g,V]],[/\b(trio[-\w\. ]+) b/i],[h,[v,"MachSpeed"],[g,V]],[/\btu_(1491) b/i],[h,[v,"Rotor"],[g,V]],[/(shield[\w ]+) b/i],[h,[v,"Nvidia"],[g,V]],[/(sprint) (\w+)/i],[v,h,[g,D]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[v,R],[g,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[v,j],[g,V]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[v,j],[g,D]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,h,[g,w]],[/droid.+; (shield) bui/i],[h,[v,"Nvidia"],[g,w]],[/(playstation [345portablevi]+)/i],[h,[v,O],[g,w]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[v,R],[g,w]],[/smart-tv.+(samsung)/i],[v,[g,z]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[v,E],[g,z]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,b],[g,z]],[/(apple) ?tv/i],[v,[h,Y+" TV"],[g,z]],[/crkey/i],[[h,Ue+"cast"],[v,at],[g,z]],[/droid.+aft(\w)( bui|\))/i],[h,[v,Q],[g,z]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[v,$],[g,z]],[/(bravia[\w ]+)( bui|\))/i],[h,[v,O],[g,z]],[/(mitv-\w{5}) bui/i],[h,[v,B],[g,z]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[v,ti],[h,ti],[g,z]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,z]],[/((pebble))app/i],[v,h,[g,J]],[/droid.+; (glass) \d/i],[h,[v,at],[g,J]],[/droid.+; (wt63?0{2,3})\)/i],[h,[v,j],[g,J]],[/(quest( 2)?)/i],[h,[v,ne],[g,J]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[g,oe]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[h,[g,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[g,V]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,V]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,D]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[p,ie+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,S],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,S],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[S,Nt,bt]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[S,Nt,bt]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,"Mac OS"],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,S],[/\(bb(10);/i],[S,[p,de]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[S,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[p,rt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[p,"webOS"]],[/crkey\/([\d\.]+)/i],[S,[p,Ue+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[p,"Chromium OS"],S],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,S],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,S]]},Et=function(me,we){if(typeof me===c&&(we=me,me=r),!(this instanceof Et))return new Et(me,we).getResult();var ge=me||(typeof i!==l&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:s),qe=we?We(tt,we):tt;return this.getBrowser=function(){var ye={};return ye[p]=r,ye[S]=r,Lt.call(ye,ge,qe.browser),ye.major=et(ye.version),ye},this.getCPU=function(){var ye={};return ye[G]=r,Lt.call(ye,ge,qe.cpu),ye},this.getDevice=function(){var ye={};return ye[v]=r,ye[h]=r,ye[g]=r,Lt.call(ye,ge,qe.device),ye},this.getEngine=function(){var ye={};return ye[p]=r,ye[S]=r,Lt.call(ye,ge,qe.engine),ye},this.getOS=function(){var ye={};return ye[p]=r,ye[S]=r,Lt.call(ye,ge,qe.os),ye},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ge},this.setUA=function(ye){return ge=typeof ye===u&&ye.length>ue?ti(ye,ue):ye,this},this.setUA(ge),this};Et.VERSION=n,Et.BROWSER=ve([p,S,d]),Et.CPU=ve([G]),Et.DEVICE=ve([h,v,g,w,D,z,V,J,oe]),Et.ENGINE=Et.OS=ve([p,S]),e.exports&&(t=e.exports=Et),t.UAParser=Et;var mi=typeof i!==l&&(i.jQuery||i.Zepto);if(mi&&!mi.ua){var ir=new Et;mi.ua=ir.getResult(),mi.ua.get=function(){return ir.getUA()},mi.ua.set=function(me){ir.setUA(me);var we=ir.getResult();for(var ge in we)mi.ua[ge]=we[ge]}}})(typeof window=="object"?window:Uc)})(Sn,Sn.exports);var sr,Vc=new Uint8Array(16);function jc(){if(!sr&&(sr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!sr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return sr(Vc)}const qc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Hc(e){return typeof e=="string"&&qc.test(e)}var it=[];for(var rn=0;rn<256;++rn)it.push((rn+256).toString(16).substr(1));function Kc(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=(it[e[t+0]]+it[e[t+1]]+it[e[t+2]]+it[e[t+3]]+"-"+it[e[t+4]]+it[e[t+5]]+"-"+it[e[t+6]]+it[e[t+7]]+"-"+it[e[t+8]]+it[e[t+9]]+"-"+it[e[t+10]]+it[e[t+11]]+it[e[t+12]]+it[e[t+13]]+it[e[t+14]]+it[e[t+15]]).toLowerCase();if(!Hc(i))throw TypeError("Stringified UUID is invalid");return i}function Ci(e,t,i){e=e||{};var r=e.random||(e.rng||jc)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){i=i||0;for(var n=0;n<16;++n)t[i+n]=r[n];return t}return Kc(r)}var qr={exports:{}};/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */(function(e,t){(function(i){var r=Object.hasOwnProperty,n=Array.isArray?Array.isArray:function(b){return Object.prototype.toString.call(b)==="[object Array]"},s=10,a=typeof process=="object"&&typeof process.nextTick=="function",o=typeof Symbol=="function",l=typeof Reflect=="object",c=typeof setImmediate=="function",u=c?setImmediate:setTimeout,d=o?l&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(m){var b=Object.getOwnPropertyNames(m);return b.push.apply(b,Object.getOwnPropertySymbols(m)),b}:Object.keys;function h(){this._events={},this._conf&&p.call(this,this._conf)}function p(m){m&&(this._conf=m,m.delimiter&&(this.delimiter=m.delimiter),m.maxListeners!==i&&(this._maxListeners=m.maxListeners),m.wildcard&&(this.wildcard=m.wildcard),m.newListener&&(this._newListener=m.newListener),m.removeListener&&(this._removeListener=m.removeListener),m.verboseMemoryLeak&&(this.verboseMemoryLeak=m.verboseMemoryLeak),m.ignoreErrors&&(this.ignoreErrors=m.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function g(m,b){var R="(node) warning: possible EventEmitter memory leak detected. "+m+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(R+=" Event name: "+b+"."),typeof process<"u"&&process.emitWarning){var k=new Error(R);k.name="MaxListenersExceededWarning",k.emitter=this,k.count=m,process.emitWarning(k)}else console.error(R),console.trace&&console.trace()}var v=function(m,b,R){var k=arguments.length;switch(k){case 0:return[];case 1:return[m];case 2:return[m,b];case 3:return[m,b,R];default:for(var A=new Array(k);k--;)A[k]=arguments[k];return A}};function S(m,b){for(var R={},k,A=m.length,E=b?b.length:0,$=0;$<A;$++)k=m[$],R[k]=$<E?b[$]:i;return R}function G(m,b,R){this._emitter=m,this._target=b,this._listeners={},this._listenersCount=0;var k,A;if((R.on||R.off)&&(k=R.on,A=R.off),b.addEventListener?(k=b.addEventListener,A=b.removeEventListener):b.addListener?(k=b.addListener,A=b.removeListener):b.on&&(k=b.on,A=b.off),!k&&!A)throw Error("target does not implement any known event API");if(typeof k!="function")throw TypeError("on method must be a function");if(typeof A!="function")throw TypeError("off method must be a function");this._on=k,this._off=A;var E=m._observers;E?E.push(this):m._observers=[this]}Object.assign(G.prototype,{subscribe:function(m,b,R){var k=this,A=this._target,E=this._emitter,$=this._listeners,O=function(){var B=v.apply(null,arguments),j={data:B,name:b,original:m};if(R){var ne=R.call(A,j);ne!==!1&&E.emit.apply(E,[j.name].concat(B));return}E.emit.apply(E,[b].concat(B))};if($[m])throw Error("Event '"+m+"' is already listening");this._listenersCount++,E._newListener&&E._removeListener&&!k._onNewListener?(this._onNewListener=function(B){B===b&&$[m]===null&&($[m]=O,k._on.call(A,m,O))},E.on("newListener",this._onNewListener),this._onRemoveListener=function(B){B===b&&!E.hasListeners(B)&&$[m]&&($[m]=null,k._off.call(A,m,O))},$[m]=null,E.on("removeListener",this._onRemoveListener)):($[m]=O,k._on.call(A,m,O))},unsubscribe:function(m){var b=this,R=this._listeners,k=this._emitter,A,E,$=this._off,O=this._target,B;if(m&&typeof m!="string")throw TypeError("event must be a string");function j(){b._onNewListener&&(k.off("newListener",b._onNewListener),k.off("removeListener",b._onRemoveListener),b._onNewListener=null,b._onRemoveListener=null);var ne=ue.call(k,b);k._observers.splice(ne,1)}if(m){if(A=R[m],!A)return;$.call(O,m,A),delete R[m],--this._listenersCount||j()}else{for(E=d(R),B=E.length;B-- >0;)m=E[B],$.call(O,m,R[m]);this._listeners={},this._listenersCount=0,j()}}});function w(m,b,R,k){var A=Object.assign({},b);if(!m)return A;if(typeof m!="object")throw TypeError("options must be an object");var E=Object.keys(m),$=E.length,O,B,j;function ne(ve){throw Error('Invalid "'+O+'" option value'+(ve?". Reason: "+ve:""))}for(var We=0;We<$;We++){if(O=E[We],!k&&!r.call(b,O))throw Error('Unknown "'+O+'" option');B=m[O],B!==i&&(j=R[O],A[O]=j?j(B,ne):B)}return A}function D(m,b){return(typeof m!="function"||!m.hasOwnProperty("prototype"))&&b("value must be a constructor"),m}function V(m){var b="value must be type of "+m.join("|"),R=m.length,k=m[0],A=m[1];return R===1?function(E,$){if(typeof E===k)return E;$(b)}:R===2?function(E,$){var O=typeof E;if(O===k||O===A)return E;$(b)}:function(E,$){for(var O=typeof E,B=R;B-- >0;)if(O===m[B])return E;$(b)}}var z=V(["function"]),J=V(["object","function"]);function oe(m,b,R){var k,A,E=0,$,O=new m(function(B,j,ne){R=w(R,{timeout:0,overload:!1},{timeout:function(Oe,et){return Oe*=1,(typeof Oe!="number"||Oe<0||!Number.isFinite(Oe))&&et("timeout must be a positive number"),Oe}}),k=!R.overload&&typeof m.prototype.cancel=="function"&&typeof ne=="function";function We(){A&&(A=null),E&&(clearTimeout(E),E=0)}var ve=function(Oe){We(),B(Oe)},Re=function(Oe){We(),j(Oe)};k?b(ve,Re,ne):(A=[function(Oe){Re(Oe||Error("canceled"))}],b(ve,Re,function(Oe){if($)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof Oe!="function")throw TypeError("onCancel callback must be a function");A.push(Oe)}),$=!0),R.timeout>0&&(E=setTimeout(function(){var Oe=Error("timeout");Oe.code="ETIMEDOUT",E=0,O.cancel(Oe),j(Oe)},R.timeout))});return k||(O.cancel=function(B){if(!!A){for(var j=A.length,ne=1;ne<j;ne++)A[ne](B);A[0](B),A=null}}),O}function ue(m){var b=this._observers;if(!b)return-1;for(var R=b.length,k=0;k<R;k++)if(b[k]._target===m)return k;return-1}function Q(m,b,R,k,A){if(!R)return null;if(k===0){var E=typeof b;if(E==="string"){var $,O,B=0,j=0,ne=this.delimiter,We=ne.length;if((O=b.indexOf(ne))!==-1){$=new Array(5);do $[B++]=b.slice(j,O),j=O+We;while((O=b.indexOf(ne,j))!==-1);$[B++]=b.slice(j),b=$,A=B}else b=[b],A=1}else E==="object"?A=b.length:(b=[b],A=1)}var ve=null,Re,Oe,et,ti,Lt,Nt=b[k],Ii=b[k+1],bt,tt;if(k===A)R._listeners&&(typeof R._listeners=="function"?(m&&m.push(R._listeners),ve=[R]):(m&&m.push.apply(m,R._listeners),ve=[R]));else if(Nt==="*"){for(bt=d(R),O=bt.length;O-- >0;)Re=bt[O],Re!=="_listeners"&&(tt=Q(m,b,R[Re],k+1,A),tt&&(ve?ve.push.apply(ve,tt):ve=tt));return ve}else if(Nt==="**"){for(Lt=k+1===A||k+2===A&&Ii==="*",Lt&&R._listeners&&(ve=Q(m,b,R,A,A)),bt=d(R),O=bt.length;O-- >0;)Re=bt[O],Re!=="_listeners"&&(Re==="*"||Re==="**"?(R[Re]._listeners&&!Lt&&(tt=Q(m,b,R[Re],A,A),tt&&(ve?ve.push.apply(ve,tt):ve=tt)),tt=Q(m,b,R[Re],k,A)):Re===Ii?tt=Q(m,b,R[Re],k+2,A):tt=Q(m,b,R[Re],k,A),tt&&(ve?ve.push.apply(ve,tt):ve=tt));return ve}else R[Nt]&&(ve=Q(m,b,R[Nt],k+1,A));if(Oe=R["*"],Oe&&Q(m,b,Oe,k+1,A),et=R["**"],et)if(k<A)for(et._listeners&&Q(m,b,et,A,A),bt=d(et),O=bt.length;O-- >0;)Re=bt[O],Re!=="_listeners"&&(Re===Ii?Q(m,b,et[Re],k+2,A):Re===Nt?Q(m,b,et[Re],k+1,A):(ti={},ti[Re]=et[Re],Q(m,b,{"**":ti},k+1,A)));else et._listeners?Q(m,b,et,A,A):et["*"]&&et["*"]._listeners&&Q(m,b,et["*"],A,A);return ve}function Y(m,b,R){var k=0,A=0,E,$=this.delimiter,O=$.length,B;if(typeof m=="string")if((E=m.indexOf($))!==-1){B=new Array(5);do B[k++]=m.slice(A,E),A=E+O;while((E=m.indexOf($,A))!==-1);B[k++]=m.slice(A)}else B=[m],k=1;else B=m,k=m.length;if(k>1){for(E=0;E+1<k;E++)if(B[E]==="**"&&B[E+1]==="**")return}var j=this.listenerTree,ne;for(E=0;E<k;E++)if(ne=B[E],j=j[ne]||(j[ne]={}),E===k-1)return j._listeners?(typeof j._listeners=="function"&&(j._listeners=[j._listeners]),R?j._listeners.unshift(b):j._listeners.push(b),!j._listeners.warned&&this._maxListeners>0&&j._listeners.length>this._maxListeners&&(j._listeners.warned=!0,g.call(this,j._listeners.length,ne))):j._listeners=b,!0;return!0}function se(m,b,R,k){for(var A=d(m),E=A.length,$,O,B,j=m._listeners,ne;E-- >0;)O=A[E],$=m[O],O==="_listeners"?B=R:B=R?R.concat(O):[O],ne=k||typeof O=="symbol",j&&b.push(ne?B:B.join(this.delimiter)),typeof $=="object"&&se.call(this,$,b,B,ne);return b}function de(m){for(var b=d(m),R=b.length,k,A,E;R-- >0;)A=b[R],k=m[A],k&&(E=!0,A!=="_listeners"&&!de(k)&&delete m[A]);return E}function Ae(m,b,R){this.emitter=m,this.event=b,this.listener=R}Ae.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function Ue(m,b,R){if(R===!0)A=!0;else if(R===!1)k=!0;else{if(!R||typeof R!="object")throw TypeError("options should be an object or true");var k=R.async,A=R.promisify,E=R.nextTick,$=R.objectify}if(k||E||A){var O=b,B=b._origin||b;if(E&&!a)throw Error("process.nextTick is not supported");A===i&&(A=b.constructor.name==="AsyncFunction"),b=function(){var j=arguments,ne=this,We=this.event;return A?E?Promise.resolve():new Promise(function(ve){u(ve)}).then(function(){return ne.event=We,O.apply(ne,j)}):(E?process.nextTick:u)(function(){ne.event=We,O.apply(ne,j)})},b._async=!0,b._origin=B}return[b,$?new Ae(this,m,b):this]}function ie(m){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,p.call(this,m)}ie.EventEmitter2=ie,ie.prototype.listenTo=function(m,b,R){if(typeof m!="object")throw TypeError("target musts be an object");var k=this;R=w(R,{on:i,off:i,reducers:i},{on:z,off:z,reducers:J});function A(E){if(typeof E!="object")throw TypeError("events must be an object");var $=R.reducers,O=ue.call(k,m),B;O===-1?B=new G(k,m,R):B=k._observers[O];for(var j=d(E),ne=j.length,We,ve=typeof $=="function",Re=0;Re<ne;Re++)We=j[Re],B.subscribe(We,E[We]||We,ve?$:$&&$[We])}return n(b)?A(S(b)):A(typeof b=="string"?S(b.split(/\s+/)):b),this},ie.prototype.stopListeningTo=function(m,b){var R=this._observers;if(!R)return!1;var k=R.length,A,E=!1;if(m&&typeof m!="object")throw TypeError("target should be an object");for(;k-- >0;)A=R[k],(!m||A._target===m)&&(A.unsubscribe(b),E=!0);return E},ie.prototype.delimiter=".",ie.prototype.setMaxListeners=function(m){m!==i&&(this._maxListeners=m,this._conf||(this._conf={}),this._conf.maxListeners=m)},ie.prototype.getMaxListeners=function(){return this._maxListeners},ie.prototype.event="",ie.prototype.once=function(m,b,R){return this._once(m,b,!1,R)},ie.prototype.prependOnceListener=function(m,b,R){return this._once(m,b,!0,R)},ie.prototype._once=function(m,b,R,k){return this._many(m,1,b,R,k)},ie.prototype.many=function(m,b,R,k){return this._many(m,b,R,!1,k)},ie.prototype.prependMany=function(m,b,R,k){return this._many(m,b,R,!0,k)},ie.prototype._many=function(m,b,R,k,A){var E=this;if(typeof R!="function")throw new Error("many only accepts instances of Function");function $(){return--b===0&&E.off(m,$),R.apply(this,arguments)}return $._origin=R,this._on(m,$,k,A)},ie.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var m=arguments[0],b,R=this.wildcard,k,A,E,$,O;if(m==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(R&&(b=m,m!=="newListener"&&m!=="removeListener"&&typeof m=="object")){if(A=m.length,o){for(E=0;E<A;E++)if(typeof m[E]=="symbol"){O=!0;break}}O||(m=m.join(this.delimiter))}var B=arguments.length,j;if(this._all&&this._all.length)for(j=this._all.slice(),E=0,A=j.length;E<A;E++)switch(this.event=m,B){case 1:j[E].call(this,m);break;case 2:j[E].call(this,m,arguments[1]);break;case 3:j[E].call(this,m,arguments[1],arguments[2]);break;default:j[E].apply(this,arguments)}if(R)j=[],Q.call(this,j,b,this.listenerTree,0,A);else if(j=this._events[m],typeof j=="function"){switch(this.event=m,B){case 1:j.call(this);break;case 2:j.call(this,arguments[1]);break;case 3:j.call(this,arguments[1],arguments[2]);break;default:for(k=new Array(B-1),$=1;$<B;$++)k[$-1]=arguments[$];j.apply(this,k)}return!0}else j&&(j=j.slice());if(j&&j.length){if(B>3)for(k=new Array(B-1),$=1;$<B;$++)k[$-1]=arguments[$];for(E=0,A=j.length;E<A;E++)switch(this.event=m,B){case 1:j[E].call(this);break;case 2:j[E].call(this,arguments[1]);break;case 3:j[E].call(this,arguments[1],arguments[2]);break;default:j[E].apply(this,k)}return!0}else if(!this.ignoreErrors&&!this._all&&m==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},ie.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var m=arguments[0],b=this.wildcard,R,k,A,E,$,O;if(m==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(b&&(R=m,m!=="newListener"&&m!=="removeListener"&&typeof m=="object")){if(E=m.length,o){for($=0;$<E;$++)if(typeof m[$]=="symbol"){k=!0;break}}k||(m=m.join(this.delimiter))}var B=[],j=arguments.length,ne;if(this._all)for($=0,E=this._all.length;$<E;$++)switch(this.event=m,j){case 1:B.push(this._all[$].call(this,m));break;case 2:B.push(this._all[$].call(this,m,arguments[1]));break;case 3:B.push(this._all[$].call(this,m,arguments[1],arguments[2]));break;default:B.push(this._all[$].apply(this,arguments))}if(b?(ne=[],Q.call(this,ne,R,this.listenerTree,0)):ne=this._events[m],typeof ne=="function")switch(this.event=m,j){case 1:B.push(ne.call(this));break;case 2:B.push(ne.call(this,arguments[1]));break;case 3:B.push(ne.call(this,arguments[1],arguments[2]));break;default:for(A=new Array(j-1),O=1;O<j;O++)A[O-1]=arguments[O];B.push(ne.apply(this,A))}else if(ne&&ne.length){if(ne=ne.slice(),j>3)for(A=new Array(j-1),O=1;O<j;O++)A[O-1]=arguments[O];for($=0,E=ne.length;$<E;$++)switch(this.event=m,j){case 1:B.push(ne[$].call(this));break;case 2:B.push(ne[$].call(this,arguments[1]));break;case 3:B.push(ne[$].call(this,arguments[1],arguments[2]));break;default:B.push(ne[$].apply(this,A))}}else if(!this.ignoreErrors&&!this._all&&m==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(B)},ie.prototype.on=function(m,b,R){return this._on(m,b,!1,R)},ie.prototype.prependListener=function(m,b,R){return this._on(m,b,!0,R)},ie.prototype.onAny=function(m){return this._onAny(m,!1)},ie.prototype.prependAny=function(m){return this._onAny(m,!0)},ie.prototype.addListener=ie.prototype.on,ie.prototype._onAny=function(m,b){if(typeof m!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),b?this._all.unshift(m):this._all.push(m),this},ie.prototype._on=function(m,b,R,k){if(typeof m=="function")return this._onAny(m,b),this;if(typeof b!="function")throw new Error("on only accepts instances of Function");this._events||h.call(this);var A=this,E;return k!==i&&(E=Ue.call(this,m,b,k),b=E[0],A=E[1]),this._newListener&&this.emit("newListener",m,b),this.wildcard?(Y.call(this,m,b,R),A):(this._events[m]?(typeof this._events[m]=="function"&&(this._events[m]=[this._events[m]]),R?this._events[m].unshift(b):this._events[m].push(b),!this._events[m].warned&&this._maxListeners>0&&this._events[m].length>this._maxListeners&&(this._events[m].warned=!0,g.call(this,this._events[m].length,m))):this._events[m]=b,A)},ie.prototype.off=function(m,b){if(typeof b!="function")throw new Error("removeListener only takes instances of Function");var R,k=[];if(this.wildcard){var A=typeof m=="string"?m.split(this.delimiter):m.slice();if(k=Q.call(this,null,A,this.listenerTree,0),!k)return this}else{if(!this._events[m])return this;R=this._events[m],k.push({_listeners:R})}for(var E=0;E<k.length;E++){var $=k[E];if(R=$._listeners,n(R)){for(var O=-1,B=0,j=R.length;B<j;B++)if(R[B]===b||R[B].listener&&R[B].listener===b||R[B]._origin&&R[B]._origin===b){O=B;break}if(O<0)continue;return this.wildcard?$._listeners.splice(O,1):this._events[m].splice(O,1),R.length===0&&(this.wildcard?delete $._listeners:delete this._events[m]),this._removeListener&&this.emit("removeListener",m,b),this}else(R===b||R.listener&&R.listener===b||R._origin&&R._origin===b)&&(this.wildcard?delete $._listeners:delete this._events[m],this._removeListener&&this.emit("removeListener",m,b))}return this.listenerTree&&de(this.listenerTree),this},ie.prototype.offAny=function(m){var b=0,R=0,k;if(m&&this._all&&this._all.length>0){for(k=this._all,b=0,R=k.length;b<R;b++)if(m===k[b])return k.splice(b,1),this._removeListener&&this.emit("removeListenerAny",m),this}else{if(k=this._all,this._removeListener)for(b=0,R=k.length;b<R;b++)this.emit("removeListenerAny",k[b]);this._all=[]}return this},ie.prototype.removeListener=ie.prototype.off,ie.prototype.removeAllListeners=function(m){if(m===i)return!this._events||h.call(this),this;if(this.wildcard){var b=Q.call(this,null,m,this.listenerTree,0),R,k;if(!b)return this;for(k=0;k<b.length;k++)R=b[k],R._listeners=null;this.listenerTree&&de(this.listenerTree)}else this._events&&(this._events[m]=null);return this},ie.prototype.listeners=function(m){var b=this._events,R,k,A,E,$;if(m===i){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!b)return[];for(R=d(b),E=R.length,A=[];E-- >0;)k=b[R[E]],typeof k=="function"?A.push(k):A.push.apply(A,k);return A}else{if(this.wildcard){if($=this.listenerTree,!$)return[];var O=[],B=typeof m=="string"?m.split(this.delimiter):m.slice();return Q.call(this,O,B,$,0),O}return b?(k=b[m],k?typeof k=="function"?[k]:k:[]):[]}},ie.prototype.eventNames=function(m){var b=this._events;return this.wildcard?se.call(this,this.listenerTree,[],null,m):b?d(b):[]},ie.prototype.listenerCount=function(m){return this.listeners(m).length},ie.prototype.hasListeners=function(m){if(this.wildcard){var b=[],R=typeof m=="string"?m.split(this.delimiter):m.slice();return Q.call(this,b,R,this.listenerTree,0),b.length>0}var k=this._events,A=this._all;return!!(A&&A.length||k&&(m===i?d(k).length:k[m]))},ie.prototype.listenersAny=function(){return this._all?this._all:[]},ie.prototype.waitFor=function(m,b){var R=this,k=typeof b;return k==="number"?b={timeout:b}:k==="function"&&(b={filter:b}),b=w(b,{timeout:0,filter:i,handleError:!1,Promise,overload:!1},{filter:z,Promise:D}),oe(b.Promise,function(A,E,$){function O(){var B=b.filter;if(!(B&&!B.apply(R,arguments)))if(R.off(m,O),b.handleError){var j=arguments[0];j?E(j):A(v.apply(null,arguments).slice(1))}else A(v.apply(null,arguments))}$(function(){R.off(m,O)}),R._on(m,O,!1)},{timeout:b.timeout,overload:b.overload})};function rt(m,b,R){R=w(R,{Promise,timeout:0,overload:!1},{Promise:D});var k=R.Promise;return oe(k,function(A,E,$){var O;if(typeof m.addEventListener=="function"){O=function(){A(v.apply(null,arguments))},$(function(){m.removeEventListener(b,O)}),m.addEventListener(b,O,{once:!0});return}var B=function(){j&&m.removeListener("error",j),A(v.apply(null,arguments))},j;b!=="error"&&(j=function(ne){m.removeListener(b,B),E(ne)},m.once("error",j)),$(function(){j&&m.removeListener("error",j),m.removeListener(b,B)}),m.once(b,B)},{timeout:R.timeout,overload:R.overload})}var at=ie.prototype;Object.defineProperties(ie,{defaultMaxListeners:{get:function(){return at._maxListeners},set:function(m){if(typeof m!="number"||m<0||Number.isNaN(m))throw TypeError("n must be a non-negative number");at._maxListeners=m},enumerable:!0},once:{value:rt,writable:!0,configurable:!0}}),Object.defineProperties(at,{_maxListeners:{value:s,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),typeof i=="function"&&i.amd?i(function(){return ie}):e.exports=ie})()})(qr);var Ko={},es={exports:{}},Ks=es.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Ks).forEach(function(e){var t=Ks[e];t.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})});(function(e){var t=function(o){return String(Number(o))===o?Number(o):o},i=function(o,l,c,u){if(u&&!c)l[u]=t(o[1]);else for(var d=0;d<c.length;d+=1)o[d+1]!=null&&(l[c[d]]=t(o[d+1]))},r=function(o,l,c){var u=o.name&&o.names;o.push&&!l[o.push]?l[o.push]=[]:u&&!l[o.name]&&(l[o.name]={});var d=o.push?{}:u?l[o.name]:l;i(c.match(o.reg),d,o.names,o.name),o.push&&l[o.push].push(d)},n=es.exports,s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(o){var l={},c=[],u=l;return o.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],p=d.slice(2);h==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var g=0;g<(n[h]||[]).length;g+=1){var v=n[h][g];if(v.reg.test(p))return r(v,u,p)}}),l.media=c,l};var a=function(o,l){var c=l.split(/=(.+)/,2);return c.length===2?o[c[0]]=t(c[1]):c.length===1&&l.length>1&&(o[c[0]]=void 0),o};e.parseParams=function(o){return o.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(o){return o.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(o){for(var l=[],c=o.split(" ").map(t),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},e.parseImageAttributes=function(o){return o.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(a,{})})},e.parseSimulcastStreamList=function(o){return o.split(";").map(function(l){return l.split(",").map(function(c){var u,d=!1;return c[0]!=="~"?u=t(c):(u=t(c.substring(1,c.length)),d=!0),{scid:u,paused:d}})})}})(Ko);var nn=es.exports,Wc=/%[sdv%]/g,zc=function(e){var t=1,i=arguments,r=i.length;return e.replace(Wc,function(n){if(t>=r)return n;var s=i[t];switch(t+=1,n){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},Di=function(e,t,i){var r=t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format,n=[e+"="+r];if(t.names)for(var s=0;s<t.names.length;s+=1){var a=t.names[s];t.name?n.push(i[t.name][a]):n.push(i[t.names[s]])}else n.push(i[t.name]);return zc.apply(null,n)},Jc=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Qc=["i","c","b","a"],Yc=function(e,t){t=t||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var i=t.outerOrder||Jc,r=t.innerOrder||Qc,n=[];return i.forEach(function(s){nn[s].forEach(function(a){a.name in e&&e[a.name]!=null?n.push(Di(s,a,e)):a.push in e&&e[a.push]!=null&&e[a.push].forEach(function(o){n.push(Di(s,a,o))})})}),e.media.forEach(function(s){n.push(Di("m",nn.m[0],s)),r.forEach(function(a){nn[a].forEach(function(o){o.name in s&&s[o.name]!=null?n.push(Di(a,o,s)):o.push in s&&s[o.push]!=null&&s[o.push].forEach(function(l){n.push(Di(a,o,l))})})})}),n.join(`\r
`)+`\r
`},fi=Ko,Zc=Yc,Xc=Zc,Wo=fi.parse;fi.parseParams;fi.parseFmtpConfig;fi.parsePayloads;fi.parseRemoteCandidates;fi.parseImageAttributes;fi.parseSimulcastStreamList;var eu=Object.defineProperty,tu=Object.defineProperties,iu=Object.getOwnPropertyDescriptors,Pr=Object.getOwnPropertySymbols,zo=Object.prototype.hasOwnProperty,Jo=Object.prototype.propertyIsEnumerable,Ws=(e,t,i)=>t in e?eu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ce=(e,t)=>{for(var i in t||(t={}))zo.call(t,i)&&Ws(e,i,t[i]);if(Pr)for(var i of Pr(t))Jo.call(t,i)&&Ws(e,i,t[i]);return e},Xe=(e,t)=>tu(e,iu(t)),zs=(e,t)=>{var i={};for(var r in e)zo.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&Pr)for(var r of Pr(e))t.indexOf(r)<0&&Jo.call(e,r)&&(i[r]=e[r]);return i},ru=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),T=(e,t,i)=>new Promise((r,n)=>{var s=l=>{try{o(i.next(l))}catch(c){n(c)}},a=l=>{try{o(i.throw(l))}catch(c){n(c)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,a);o((i=i.apply(e,t)).next())}),nu=ru((e,t)=>{t.exports={name:"@100mslive/hms-video",version:"0.6.1",license:"MIT",main:"dist/index.cjs.js",typings:"dist/index.d.ts",module:"dist/index.js",files:["dist","src"],engines:{node:">=10"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",test:"jest --maxWorkers=1",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",format:"prettier --write src/**/*.ts"},author:"100ms <tech-common@100ms.live>",devDependencies:{"@types/sdp-transform":"^2.4.4","@types/ua-parser-js":"^0.7.36","@types/uuid":"^8.3.0","jest-canvas-mock":"^2.3.1",tslib:"^2.2.0"},dependencies:{eventemitter2:"^6.4.7","sdp-transform":"^2.14.1","ua-parser-js":"^1.0.1",uuid:"^8.3.2","webrtc-adapter":"^8.0.0"},gitHead:"b4d98c849c3e4ae4e583b2e2c8f9813193cf1d7c"}}),Hr=class{constructor(e){this.key=e,this.storage=null}getStorage(){return Ri&&!this.storage&&(cu(),this.storage=window.localStorage),this.storage}get(){var e;let t=(e=this.getStorage())==null?void 0:e.getItem(this.key);return t?JSON.parse(t):void 0}set(e){var t;let i=JSON.stringify(e);(t=this.getStorage())==null||t.setItem(this.key,i)}clear(){var e;(e=this.getStorage())==null||e.removeItem(this.key)}},Gi=new Sn.exports.UAParser,Js,ts=typeof window>"u"&&!((Js=Gi.getBrowser().name)!=null&&Js.toLowerCase().includes("electron")),Ri=typeof window<"u",ft;(function(e){e.PROD="prod",e.QA="qa",e.DEV="dev"})(ft||(ft={}));var su=()=>Gi.getDevice().type==="mobile",au=()=>{let e,t=new Hr("hms-analytics-deviceId"),i=t.get();return i?e=i:(e=Ci(),t.set(e)),e},ou=()=>typeof document<"u"&&document.hidden,lu=class{constructor(){this.valuesMap=new Map}getItem(e){return this.valuesMap.has(e)?String(this.valuesMap.get(e)):null}setItem(e,t){this.valuesMap.set(e,t)}removeItem(e){this.valuesMap.delete(e)}clear(){this.valuesMap.clear()}key(e){if(arguments.length===0)throw new TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");return Array.from(this.valuesMap.keys())[e]}get length(){return this.valuesMap.size}},cu=()=>{Ri&&!localStorage&&(window.localStorage=new lu)},ze;(function(e){e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.TIME=4]="TIME",e[e.TIMEEND=5]="TIMEEND",e[e.ERROR=6]="ERROR",e[e.NONE=7]="NONE"})(ze||(ze={}));var uu=typeof window<"u"&&typeof window.expect<"u",y=class{static v(e,...t){this.log(0,e,...t)}static d(e,...t){this.log(1,e,...t)}static i(e,...t){this.log(2,e,...t)}static w(e,...t){this.log(3,e,...t)}static e(e,...t){this.log(6,e,...t)}static time(e){this.log(4,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(5,"[HMSPerformanceTiming]",e,e)}static cleanUp(){performance.clearMarks(),performance.clearMeasures()}static log(e,t,...i){if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:{console.log(t,...i);break}case 1:{console.debug(t,...i);break}case 2:{console.info(t,...i);break}case 3:{console.warn(t,...i);break}case 6:{console.error(t,...i);break}case 4:{performance.mark(i[0]);break}case 5:{let r=i[0];try{let n=performance.measure(r,r);this.log(1,t,r,n==null?void 0:n.duration),performance.clearMarks(r),performance.clearMeasures(r)}catch(n){this.log(1,t,r,n)}break}}}};y.level=uu?7:0;var Qo=class{constructor({sender:e,message:t,type:i="chat",recipientPeer:r,recipientRoles:n,time:s}){this.sender=e,this.message=t,this.type=i,this.recipientPeer=r,this.recipientRoles=n,this.time=s}toSignalParams(){var e,t;let i=(e=this.recipientRoles)==null?void 0:e.map(s=>s.name),r=(t=this.recipientPeer)==null?void 0:t.peerId,n={info:{message:this.message,type:this.type}};return i!=null&&i.length&&(n.roles=i),r&&(n.peer_id=r),n}toString(){var e;return`{
      sender: ${this.sender};
      recipientPeer: ${this.recipientPeer};
      recipientRoles: ${(e=this.recipientRoles)==null?void 0:e.map(t=>t.name)};
      message: ${this.message};
      time: ${this.time};
      type: ${this.type};
    }`}},du=class{constructor(e,t){this.id=e,this.store=t,this.recording={server:{running:!1},browser:{running:!1},hls:{running:!1}},this.rtmp={running:!1},this.hls={running:!1,variants:[]}}get localPeer(){return this.store.getLocalPeer()}get peers(){return this.store.getPeers()}},is=class{constructor({peerId:e,name:t,isLocal:i,customerUserId:r,metadata:n,role:s,joinedAt:a}){this.customerUserId="",this.metadata="",this.auxiliaryTracks=[],this.name=t,this.peerId=e,this.isLocal=i,this.customerUserId=r,this.metadata=n,this.joinedAt=a,s&&(this.role=s)}updateRole(e){this.role=e}updateName(e){this.name=e}updateMetadata(e){this.metadata=e}toString(){var e;return`{
      name: ${this.name};
      role: ${(e=this.role)==null?void 0:e.name};
      peerId: ${this.peerId};
      customerUserId: ${this.customerUserId};
    }`}},Yo=class{};Yo.makePeerId=()=>Ci();var hu=class extends is{constructor(e){super(Xe(ce({},e),{peerId:Yo.makePeerId(),isLocal:!0})),this.isLocal=!0,this.auxiliaryTracks=[]}},pu=class extends is{constructor(e){super(Xe(ce({},e),{isLocal:!1})),this.isLocal=!1,this.auxiliaryTracks=[],this.fromRoomState=!1,this.fromRoomState=!!e.fromRoomState}},ai;(function(e){e.CUSTOM="CUSTOM",e.LOCAL="LOCAL",e.HMS="HMS"})(ai||(ai={}));function fu(){if(Ri&&window){let e=window.location.hostname;return e==="localhost"||e==="127.0.0.1"?ai.LOCAL:e.includes("app.100ms.live")?ai.HMS:ai.CUSTOM}return ai.CUSTOM}var vr=fu(),Qs=nu().version;function En(e=ft.PROD,t){let i="web",r=vr!==ai.LOCAL&&e===ft.PROD?"prod":"debug";if(ts)return Ys({os:"web_nodejs",os_version:process.version,sdk:i,sdk_version:Qs,env:r,domain:vr,framework:"node",framework_version:process.version,framework_sdk_version:t==null?void 0:t.sdkVersion});let n=Gi.getOS(),s=Gi.getDevice(),a=Gi.getBrowser(),o=sn(`web_${n.name}`),l=n.version||"",c=sn(`${a.name}_${a.version}`),u=c;return s.type&&(u=`${sn(`${s.vendor}_${s.type}`)}/${c}`),Ys({os:o,os_version:l,sdk:i,sdk_version:Qs,device_model:u,env:r,domain:vr,framework:t==null?void 0:t.type,framework_version:t==null?void 0:t.version,framework_sdk_version:t==null?void 0:t.sdkVersion})}function sn(e){return e.replace(/ /g,"_")}var Ys=(e,t=",")=>Object.keys(e).filter(i=>!!e[i]).map(i=>`${i}:${e[i]}`).join(t),Je=class{constructor({name:e,level:t,properties:i,includesPII:r,timestamp:n}){this.metadata={peer:{},userAgent:En()},this.name=e,this.level=t,this.includesPII=r||!1,this.properties=i||{},this.timestamp=n||new Date().getTime(),this.event_id=Ci(),this.device_id=au()}toSignalParams(){return{name:this.name,info:Xe(ce({},this.properties),{timestamp:this.timestamp,domain:vr}),timestamp:new Date().getTime()}}},Cn;(function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"})(Cn||(Cn={}));var Fe;(function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"})(Fe||(Fe={}));var te=class extends Error{constructor(e,t,i,r,n,s=!1){super(r),this.code=e,this.name=t,this.message=r,this.description=n,this.isTerminal=s,Object.setPrototypeOf(this,te.prototype),this.action=i.toString()}toAnalyticsProperties(){return{error_name:this.name,error_code:this.code,error_message:this.message,error_description:this.description,action:this.action,is_terminal:this.isTerminal}}addNativeError(e){this.nativeError=e}toString(){var e;return`{
      code: ${this.code};
      name: ${this.name};
      action: ${this.action};
      message: ${this.message};
      description: ${this.description};
      isTerminal: ${this.isTerminal};
      nativeError: ${(e=this.nativeError)==null?void 0:e.message};
    }`}},$e=class{static connect(e,t,i=new Date,r=new Date,n){let s=this.eventNameFor("connect",e===void 0),a=e?Fe.ERROR:Fe.INFO,o=this.getPropertiesWithError(Xe(ce({},t),{[this.KEY_REQUESTED_AT]:i==null?void 0:i.getTime(),[this.KEY_RESPONDED_AT]:r==null?void 0:r.getTime(),endpoint:n}),e);return new Je({name:s,level:a,properties:o})}static disconnect(e,t){let i="disconnected",r=e?Fe.ERROR:Fe.INFO,n=this.getPropertiesWithError(t,e);return new Je({name:i,level:r,properties:n})}static preview(e){var t=e,{error:i}=t,r=zs(t,["error"]);let n=this.eventNameFor("preview",i===void 0),s=i?Fe.ERROR:Fe.INFO,a=this.getPropertiesWithError(r,i);return new Je({name:n,level:s,properties:a})}static join(e){var t=e,{error:i}=t,r=zs(t,["error"]);let n=this.eventNameFor("join",i===void 0),s=i?Fe.ERROR:Fe.INFO,a=this.getPropertiesWithError(Xe(ce({},r),{is_preview_called:!!r.is_preview_called}),i);return new Je({name:n,level:s,properties:a})}static publish({devices:e,settings:t,error:i}){let r=this.eventNameFor("publish",i===void 0),n=i?Fe.ERROR:Fe.INFO,s=this.getPropertiesWithError({devices:e,audio:t==null?void 0:t.audio,video:t==null?void 0:t.video},i);return new Je({name:r,level:n,properties:s})}static subscribeFail(e){let t=this.eventNameFor("subscribe",!1),i=Fe.ERROR,r=this.getErrorProperties(e);return new Je({name:t,level:i,properties:r})}static leave(){return new Je({name:"leave",level:Fe.INFO})}static autoplayError(){return new Je({name:"autoplayError",level:Fe.ERROR})}static deviceChange({selection:e,type:t,devices:i,error:r}){let n=this.eventNameFor(r?"publish":`device.${t}`,r===void 0),s=r?Fe.ERROR:Fe.INFO,a=this.getPropertiesWithError({selection:e,devices:i},r);return new Je({name:n,level:s,properties:a})}static performance(e){let t="perf.stats",i=Fe.INFO,r=e.toAnalyticsProperties();return new Je({name:t,level:i,properties:r})}static rtcStats(e){let t="rtc.stats",i=Fe.INFO,r=e.toAnalyticsProperties();return new Je({name:t,level:i,properties:r})}static degradationStats(e,t){let i="video.degradation.stats",r=Fe.INFO,n={degradedAt:e.degradedAt,trackId:e.trackId};if(!t&&e.degradedAt instanceof Date){let s=new Date,a=s.valueOf()-e.degradedAt.valueOf();n=Xe(ce({},n),{duration:a,restoredAt:s})}return new Je({name:i,level:r,properties:n})}static audioDetectionFail(e,t){let i=this.getPropertiesWithError({device:t},e),r=Fe.ERROR,n="audiopresence.failed";return new Je({name:n,level:r,properties:i})}static previewNetworkQuality(e){return new Je({name:"perf.networkquality.preview",level:e.error?Fe.ERROR:Fe.INFO,properties:e})}static eventNameFor(e,t){return`${e}.${t?"success":"failed"}`}static getPropertiesWithError(e,t){let i=this.getErrorProperties(t);return e=ce(ce({},i),e),e}static getErrorProperties(e){return e?e instanceof te?e.toAnalyticsProperties():{error_name:e.name,error_message:e.message,error_description:e.cause}:{}}};$e.KEY_REQUESTED_AT="requested_at",$e.KEY_RESPONDED_AT="responded_at";var Pe;(function(e){e.INIT="init_response_time",e.WEBSOCKET_CONNECT="ws_connect_time",e.ON_POLICY_CHANGE="on_policy_change_time",e.LOCAL_TRACKS="local_tracks_time",e.JOIN="join_time",e.PREVIEW="preview_time"})(Pe||(Pe={}));var mu=class{constructor(){this.eventPerformanceMeasures={}}start(e){performance.mark(e)}end(e){var t;try{this.eventPerformanceMeasures[e]=performance.measure(e,e),y.d("[HMSPerformanceTiming]",e,(t=this.eventPerformanceMeasures[e])==null?void 0:t.duration)}catch(i){y.w("[AnalyticsTimer]",`Error in measuring performance for event ${e}`,{error:i})}}getTimeTaken(e){var t;return(t=this.eventPerformanceMeasures[e])==null?void 0:t.duration}getTimes(...e){return e.reduce((t,i)=>Xe(ce({},t),{[i]:this.getTimeTaken(i)}),{})}cleanUp(){this.eventPerformanceMeasures={}}},le={WebSocketConnectionErrors:{FAILED_TO_CONNECT:1e3,WEBSOCKET_CONNECTION_LOST:1003,ABNORMAL_CLOSE:1006},InitAPIErrors:{SERVER_ERRORS:2e3,INIT_CONFIG_NOT_AVAILABLE:2002,ENDPOINT_UNREACHABLE:2003,INVALID_TOKEN_FORMAT:2004},TracksErrors:{GENERIC_TRACK:3e3,CANT_ACCESS_CAPTURE_DEVICE:3001,DEVICE_NOT_AVAILABLE:3002,DEVICE_IN_USE:3003,DEVICE_LOST_MIDWAY:3008,NOTHING_TO_RETURN:3005,INVALID_VIDEO_SETTINGS:3006,CODEC_CHANGE_NOT_PERMITTED:3007,AUTOPLAY_ERROR:3008,OVER_CONSTRAINED:3009,NO_AUDIO_DETECTED:3010,SYSTEM_DENIED_PERMISSION:3011,CURRENT_TAB_NOT_SHARED:3012},WebrtcErrors:{CREATE_OFFER_FAILED:4001,CREATE_ANSWER_FAILED:4002,SET_LOCAL_DESCRIPTION_FAILED:4003,SET_REMOTE_DESCRIPTION_FAILED:4004,ICE_FAILURE:4005},WebsocketMethodErrors:{SERVER_ERRORS:5e3,ALREADY_JOINED:5001,CANNOT_JOIN_PREVIEW_IN_PROGRESS:5002},GenericErrors:{NOT_CONNECTED:6e3,SIGNALLING:6001,UNKNOWN:6002,NOT_READY:6003,JSON_PARSING_FAILED:6004,TRACK_METADATA_MISSING:6005,RTC_TRACK_MISSING:6006,PEER_METADATA_MISSING:6007,INVALID_ROLE:6008,PREVIEW_IN_PROGRESS:6009,MISSING_MEDIADEVICES:6010,MISSING_RTCPEERCONNECTION:6011},PlaylistErrors:{NO_ENTRY_TO_PLAY:8001,NO_ENTRY_IS_PLAYING:8002}},H;(function(e){e.NONE="NONE",e.TRACK="TRACK",e.INIT="INIT",e.PUBLISH="PUBLISH",e.UNPUBLISH="UNPUBLISH",e.JOIN="JOIN",e.SUBSCRIBE="SUBSCRIBE",e.DATA_CHANNEL_SEND="DATA_CHANNEL_SEND",e.RESTART_ICE="RESTART_ICE",e.VIDEO_PLUGINS="VIDEO_PLUGINS",e.AUDIO_PLUGINS="AUDIO_PLUGINS",e.AUTOPLAY="AUTOPLAY",e.RECONNECT_SIGNAL="RECONNECT_SIGNAL",e.VALIDATION="VALIDATION",e.PLAYLIST="PLAYLIST",e.PREVIEW="PREVIEW"})(H||(H={}));var K={WebSocketConnectionErrors:{FailedToConnect(e,t=""){return new te(le.WebSocketConnectionErrors.FAILED_TO_CONNECT,"WebsocketFailedToConnect",e,`[WS]: ${t}`,`[WS]: ${t}`)},WebSocketConnectionLost(e,t=""){return new te(le.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,"WebSocketConnectionLost",e,"Network connection lost ",t)},AbnormalClose(e,t=""){return new te(le.WebSocketConnectionErrors.ABNORMAL_CLOSE,"WebSocketAbnormalClose",e,"Websocket closed abnormally",t)}},InitAPIErrors:{ServerErrors(e,t,i=""){return new te(e,"ServerErrors",t,`[INIT]: Server error ${i}`,i,!0)},EndpointUnreachable(e,t=""){return new te(le.InitAPIErrors.ENDPOINT_UNREACHABLE,"EndpointUnreachable",e,`Endpoint is not reachable - ${t}`,t)},InvalidTokenFormat(e,t=""){return new te(le.InitAPIErrors.INVALID_TOKEN_FORMAT,"InvalidTokenFormat",e,`Token is not in proper JWT format - ${t}`,t,!0)},InitConfigNotAvailable(e,t=""){return new te(le.InitAPIErrors.INIT_CONFIG_NOT_AVAILABLE,"InitError",e,`[INIT]: ${t}`,`[INIT]: ${t}`)}},TracksErrors:{GenericTrack(e,t=""){return new te(le.TracksErrors.GENERIC_TRACK,"GenericTrack",e,`[TRACK]: ${t}`,`[TRACK]: ${t}`)},CantAccessCaptureDevice(e,t,i=""){return new te(le.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,"CantAccessCaptureDevice",e,`User denied permission to access capture device - ${t}`,i)},DeviceNotAvailable(e,t,i=""){return new te(le.TracksErrors.DEVICE_NOT_AVAILABLE,"DeviceNotAvailable",e,`[TRACK]: Capture device is no longer available - ${t}`,i)},DeviceInUse(e,t,i=""){return new te(le.TracksErrors.DEVICE_IN_USE,"DeviceInUse",e,`[TRACK]: Capture device is in use by another application - ${t}`,i)},DeviceLostMidway(e,t,i=""){return new te(le.TracksErrors.DEVICE_LOST_MIDWAY,"DeviceLostMidway",e,`Lost access to capture device midway - ${t}`,i)},NothingToReturn(e,t="",i="There is no media to return. Please select either video or audio or both."){return new te(le.TracksErrors.NOTHING_TO_RETURN,"NothingToReturn",e,i,t)},InvalidVideoSettings(e,t=""){return new te(le.TracksErrors.INVALID_VIDEO_SETTINGS,"InvalidVideoSettings",e,"Cannot enable simulcast when no video settings are provided",t)},AutoplayBlocked(e,t=""){return new te(le.TracksErrors.AUTOPLAY_ERROR,"AutoplayBlocked",e,"Autoplay blocked because the user didn't interact with the document first",t)},CodecChangeNotPermitted(e,t=""){return new te(le.TracksErrors.CODEC_CHANGE_NOT_PERMITTED,"CodecChangeNotPermitted",e,"Codec can't be changed mid call.",t)},OverConstrained(e,t,i=""){return new te(le.TracksErrors.OVER_CONSTRAINED,"OverConstrained",e,`[TRACK]: Requested constraints cannot be satisfied with the device hardware - ${t}`,i)},NoAudioDetected(e,t="Please check the mic or use another audio input"){return new te(le.TracksErrors.NO_AUDIO_DETECTED,"NoAudioDetected",e,"No audio input detected from microphone",t)},SystemDeniedPermission(e,t,i=""){return new te(le.TracksErrors.SYSTEM_DENIED_PERMISSION,"SystemDeniedPermission",e,`Operating System denied permission to access capture device - ${t}`,i)},CurrentTabNotShared(){return new te(le.TracksErrors.CURRENT_TAB_NOT_SHARED,"CurrentTabNotShared",H.TRACK,"The app requires you to share the current tab","You must screen share the current tab in order to proceed")}},WebrtcErrors:{CreateOfferFailed(e,t=""){return new te(le.WebrtcErrors.CREATE_OFFER_FAILED,"CreateOfferFailed",e,`[${e.toString()}]: Failed to create offer. `,t)},CreateAnswerFailed(e,t=""){return new te(le.WebrtcErrors.CREATE_ANSWER_FAILED,"CreateAnswerFailed",e,`[${e.toString()}]: Failed to create answer. `,t)},SetLocalDescriptionFailed(e,t=""){return new te(le.WebrtcErrors.SET_LOCAL_DESCRIPTION_FAILED,"SetLocalDescriptionFailed",e,`[${e.toString()}]: Failed to set offer. `,t)},SetRemoteDescriptionFailed(e,t=""){return new te(le.WebrtcErrors.SET_REMOTE_DESCRIPTION_FAILED,"SetRemoteDescriptionFailed",e,`[${e.toString()}]: Failed to set answer. `,t)},ICEFailure(e,t=""){return new te(le.WebrtcErrors.ICE_FAILURE,"ICEFailure",e,`[${e.toString()}]: Ice connection state FAILED`,t)}},WebsocketMethodErrors:{ServerErrors(e,t,i){return new te(e,"ServerErrors",t,i,i,!0)},AlreadyJoined(e,t=""){return new te(le.WebsocketMethodErrors.ALREADY_JOINED,"AlreadyJoined",e,"[JOIN]: You have already joined this room.",t)},CannotJoinPreviewInProgress(e,t=""){return new te(le.WebsocketMethodErrors.CANNOT_JOIN_PREVIEW_IN_PROGRESS,"CannotJoinPreviewInProgress",e,"[JOIN]: Cannot join if preview is in progress",t)}},GenericErrors:{NotConnected(e,t=""){return new te(le.GenericErrors.NOT_CONNECTED,"NotConnected",e,"Client is not connected",t)},Signalling(e,t){return new te(le.GenericErrors.SIGNALLING,"Signalling",e,`Unknown signalling error: ${e.toString()} ${t} `,t)},Unknown(e,t){return new te(le.GenericErrors.UNKNOWN,"Unknown",e,`Unknown exception: ${t}`,t)},NotReady(e,t=""){return new te(le.GenericErrors.NOT_READY,"NotReady",e,t,t)},JsonParsingFailed(e,t,i=""){return new te(le.GenericErrors.JSON_PARSING_FAILED,"JsonParsingFailed",e,`Failed to parse JSON message - ${t}`,i)},TrackMetadataMissing(e,t=""){return new te(le.GenericErrors.TRACK_METADATA_MISSING,"TrackMetadataMissing",e,"Track Metadata Missing",t)},RTCTrackMissing(e,t=""){return new te(le.GenericErrors.RTC_TRACK_MISSING,"RTCTrackMissing",e,"RTC Track missing",t)},PeerMetadataMissing(e,t=""){return new te(le.GenericErrors.PEER_METADATA_MISSING,"PeerMetadataMissing",e,"Peer Metadata Missing",t)},ValidationFailed(e,t){return new te(le.GenericErrors.INVALID_ROLE,"ValidationFailed",H.VALIDATION,e,t?JSON.stringify(t):"")},InvalidRole(e,t){return new te(le.GenericErrors.INVALID_ROLE,"InvalidRole",e,"Invalid role. Join with valid role",t,!0)},PreviewAlreadyInProgress(e,t=""){return new te(le.GenericErrors.PREVIEW_IN_PROGRESS,"PreviewAlreadyInProgress",e,"[Preview]: Cannot join if preview is in progress",t)},MissingMediaDevices(){return new te(le.GenericErrors.MISSING_MEDIADEVICES,"MissingMediaDevices",H.JOIN,"navigator.mediaDevices is undefined. 100ms SDK won't work on this website as WebRTC is not supported on HTTP endpoints(missing navigator.mediaDevices). Please ensure you're using the SDK either on localhost or a valid HTTPS endpoint.","",!0)},MissingRTCPeerConnection(){return new te(le.GenericErrors.MISSING_RTCPEERCONNECTION,"MissingRTCPeerConnection",H.JOIN,"RTCPeerConnection which is a core requirement for WebRTC call was not found, this could be due to an unsupported browser or browser extensions blocking WebRTC","",!0)}},MediaPluginErrors:{PlatformNotSupported(e,t=""){return new te(7001,"PlatformNotSupported",e,"Check HMS Docs to see the list of supported platforms",t)},InitFailed(e,t=""){return new te(7002,"InitFailed",e,"Plugin init failed",t)},ProcessingFailed(e,t=""){return new te(7003,"ProcessingFailed",e,"Plugin processing failed",t)},AddAlreadyInProgress(e,t=""){return new te(7004,"AddAlreadyInProgress",e,"Plugin add already in progress",t)},DeviceNotSupported(e,t=""){return new te(7005,"DeviceNotSupported",e,"Check HMS Docs to see the list of supported devices",t)}},PlaylistErrors:{NoEntryToPlay(e,t){return new te(le.PlaylistErrors.NO_ENTRY_TO_PLAY,"NoEntryToPlay",e,"Reached end of playlist",t)},NoEntryPlaying(e,t){return new te(le.PlaylistErrors.NO_ENTRY_IS_PLAYING,"NoEntryIsPlaying",e,"No entry is playing at this time",t)}}},Ut;(function(e){e.UNKNOWN="unknown(video or audio)",e.AUDIO="audio",e.VIDEO="video",e.AV="audio, video",e.SCREEN="screen"})(Ut||(Ut={}));function gu(e,t){let i=e.toLowerCase();return i.includes("device not found")?K.TracksErrors.DeviceNotAvailable(H.TRACK,t,e):i.includes("permission denied")?K.TracksErrors.CantAccessCaptureDevice(H.TRACK,t,e):K.TracksErrors.GenericTrack(H.TRACK,e)}function vu(e,t=""){if(Rr.browserDetails.browser==="chrome"&&e.name==="NotAllowedError"&&e.message.includes("denied by system"))return K.TracksErrors.SystemDeniedPermission(H.TRACK,t,e.message);if(Rr.browserDetails.browser==="firefox"&&e.name==="NotFoundError"){let i=K.TracksErrors.SystemDeniedPermission(H.TRACK,t,e.message);return i.description=`Capture device is either blocked at Operating System level or not available - ${t}`,i}switch(e.name){case"OverconstrainedError":return K.TracksErrors.OverConstrained(H.TRACK,t,e.constraint);case"NotAllowedError":return K.TracksErrors.CantAccessCaptureDevice(H.TRACK,t,e.message);case"NotFoundError":return K.TracksErrors.DeviceNotAvailable(H.TRACK,t,e.message);case"NotReadableError":return K.TracksErrors.DeviceInUse(H.TRACK,t,e.message);case"TypeError":return K.TracksErrors.NothingToReturn(H.TRACK,e.message);default:return gu(e.message,t)}}function Ar(e,t){let i=vu(e,t);return i.addNativeError(e),i}var ni;(function(e){e.RECORDING_STATE_UPDATED="RECORDING_STATE_UPDATED",e.BROWSER_RECORDING_STATE_UPDATED="BROWSER_RECORDING_STATE_UPDATED",e.SERVER_RECORDING_STATE_UPDATED="SERVER_RECORDING_STATE_UPDATED",e.RTMP_STREAMING_STATE_UPDATED="RTMP_STREAMING_STATE_UPDATED",e.HLS_STREAMING_STATE_UPDATED="HLS_STREAMING_STATE_UPDATED"})(ni||(ni={}));var Qe;(function(e){e[e.PEER_JOINED=0]="PEER_JOINED",e[e.PEER_LEFT=1]="PEER_LEFT",e[e.AUDIO_TOGGLED=2]="AUDIO_TOGGLED",e[e.VIDEO_TOGGLED=3]="VIDEO_TOGGLED",e[e.BECAME_DOMINANT_SPEAKER=4]="BECAME_DOMINANT_SPEAKER",e[e.RESIGNED_DOMINANT_SPEAKER=5]="RESIGNED_DOMINANT_SPEAKER",e[e.STARTED_SPEAKING=6]="STARTED_SPEAKING",e[e.STOPPED_SPEAKING=7]="STOPPED_SPEAKING",e[e.ROLE_UPDATED=8]="ROLE_UPDATED",e[e.PEER_LIST=9]="PEER_LIST",e[e.NAME_UPDATED=10]="NAME_UPDATED",e[e.METADATA_UPDATED=11]="METADATA_UPDATED"})(Qe||(Qe={}));var Ce;(function(e){e[e.TRACK_ADDED=0]="TRACK_ADDED",e[e.TRACK_REMOVED=1]="TRACK_REMOVED",e[e.TRACK_MUTED=2]="TRACK_MUTED",e[e.TRACK_UNMUTED=3]="TRACK_UNMUTED",e[e.TRACK_DESCRIPTION_CHANGED=4]="TRACK_DESCRIPTION_CHANGED",e[e.TRACK_DEGRADED=5]="TRACK_DEGRADED",e[e.TRACK_RESTORED=6]="TRACK_RESTORED"})(Ce||(Ce={}));var mt;(function(e){e.NONE="none",e.LOW="low",e.MEDIUM="medium",e.HIGH="high"})(mt||(mt={}));var yu={f:mt.HIGH,h:mt.MEDIUM,q:mt.LOW},Rn;(function(e){e.VP8="vp8",e.VP9="vp9",e.H264="h264"})(Rn||(Rn={}));var Pn;(function(e){e.OPUS="opus"})(Pn||(Pn={}));var pe;(function(e){e.audio="audio",e.video="video"})(pe||(pe={}));var Wi=class{constructor(){this._volume=1,this._codec=Pn.OPUS,this._maxBitrate=32,this._deviceId="default",this._advanced=[{googEchoCancellation:{exact:!0}},{googExperimentalEchoCancellation:{exact:!0}},{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}},{googHighpassFilter:{exact:!0}},{googAudioMirroring:{exact:!0}}]}volume(e){if(!(0<=e&&e<=1))throw Error("volume can only be in range [0.0, 1.0]");return this._volume=e,this}codec(e){return this._codec=e,this}maxBitrate(e){if(e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}build(){return new rs(this._volume,this._codec,this._maxBitrate,this._deviceId,this._advanced)}},rs=class{constructor(e,t,i,r,n){this.volume=e,this.codec=t,this.maxBitrate=i,this.deviceId=r,this.advanced=n}toConstraints(){return{deviceId:this.deviceId,advanced:this.advanced}}toAnalyticsProperties(){return{audio_bitrate:this.maxBitrate,audio_codec:this.codec}}},ki=class{constructor(){this._width=320,this._height=180,this._codec=Rn.VP8,this._maxFramerate=30,this._maxBitrate=150,this._advanced=[]}setWidth(e){return this._width=e,this}setHeight(e){return this._height=e,this}codec(e){return this._codec=e,this}maxFramerate(e){if(e&&e<=0)throw Error("maxFramerate should be >= 1");return this._maxFramerate=e,this}maxBitrate(e,t=!0){if(typeof e=="number"&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,!this._maxBitrate&&t&&(this._maxBitrate=15e4),this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}build(){return new ns(this._width,this._height,this._codec,this._maxFramerate,this._deviceId,this._advanced,this._maxBitrate)}},ns=class{constructor(e,t,i,r,n,s,a){this.width=e,this.height=t,this.codec=i,this.maxFramerate=r,this.maxBitrate=a,this.deviceId=n,this.advanced=s}toConstraints(e){let t="ideal";return e&&(t="max"),{width:{[t]:this.width},height:{[t]:this.height},frameRate:this.maxFramerate,deviceId:this.deviceId}}toAnalyticsProperties(){return{width:this.width,height:this.height,video_bitrate:this.maxBitrate,framerate:this.maxFramerate,video_codec:this.codec}}},Zs=class{constructor(){this._video=new ki().build(),this._audio=new Wi().build(),this._screen=new ki().build(),this._simulcast=!1}video(e){return this._video=e,this}audio(e){return this._audio=e,this}screen(e){return this._screen=e,this}simulcast(e){return this._simulcast=e,this}build(){if(this._audio===null&&this._video===null)throw K.TracksErrors.NothingToReturn(H.TRACK);if(this._video===null&&this._simulcast)throw K.TracksErrors.InvalidVideoSettings(H.TRACK,"Cannot enable simulcast when no video settings are provided");return new An(this._video,this._audio,this._simulcast,this._screen||void 0)}},An=class{constructor(e,t,i,r=null){this.video=e,this.audio=t,this.simulcast=i,this.screen=r}toAnalyticsProperties(){let e={audio_enabled:this.audio!==null,video_enabled:this.video!==null};return this.audio&&(e=ce(ce({},this.audio.toAnalyticsProperties()),e)),this.video&&(e=ce(ce({},this.video.toAnalyticsProperties()),e)),e}},Zo=class{constructor(e){this.tracks=new Array,this.nativeStream=e,this.id=e.id}},Ir=e=>e?`{
    trackId: ${e.id};
    kind: ${e.kind};
    enabled: ${e.enabled};
    muted: ${e.muted};
    readyState: ${e.readyState};
  }`:"",ss=class{constructor(e,t,i){this.logIdentifier="",this.stream=e,this.nativeTrack=t,this.source=i}get enabled(){return this.nativeTrack.enabled}get trackId(){return this.firstTrackId||this.sdpTrackId||this.nativeTrack.id}getMediaTrackSettings(){return this.nativeTrack.getSettings()}setEnabled(e){return T(this,null,function*(){this.nativeTrack.enabled=e})}setSdpTrackId(e){this.sdpTrackId=e}setFirstTrackId(e){this.firstTrackId=e}cleanup(){var e;(e=this.nativeTrack)==null||e.stop()}toString(){return`{
      streamId: ${this.stream.id};
      peerId: ${this.peerId};
      trackId: ${this.trackId};
      logIdentifier: ${this.logIdentifier};
      source: ${this.source};
      enabled: ${this.enabled};
      nativeTrack: ${Ir(this.nativeTrack)};
    }`}},Ve;(function(e){e.AUDIO="audio",e.VIDEO="video"})(Ve||(Ve={}));var Xo=class extends Zo{constructor(e,t){super(e),this.audio=!0,this.video=mt.NONE,this.connection=t}setAudio(e){this.audio!==e&&(this.audio=e,this.syncWithApiChannel(!1))}setVideoLayerLocally(e,t){this.video=e,y.d(`[Remote stream] ${t} - ${this.id}`,`Setting layer field to - ${e}`)}setVideoLayer(e,t){this.setVideoLayerLocally(e,t),y.d(`[Remote stream] ${t} - ${this.id}`,`Switching to ${e} layer`),this.syncWithApiChannel()}getSimulcastLayer(){return this.video}isAudioSubscribed(){return this.audio}syncWithApiChannel(e=!0){let t={streamId:this.id,audio:this.audio};e&&(t.video=this.video,t.framerate=this.video),this.connection.sendOverApiDataChannel(JSON.stringify(t))}},as=class extends ss{constructor(e,t,i){if(super(e,t,i),this.type=Ve.AUDIO,this.audioElement=null,t.kind!=="audio")throw new Error("Expected 'track' kind = 'audio'")}getVolume(){return this.audioElement?this.audioElement.volume*100:null}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.subscribeToAudio(e===0?!1:this.enabled),this.audioElement&&(this.audioElement.volume=e/100)}setAudioElement(e){this.audioElement=e}getAudioElement(){return this.audioElement}getOutputDevice(){return this.outputDevice}cleanup(){super.cleanup(),this.audioElement&&(this.audioElement.srcObject=null,this.audioElement.remove(),this.audioElement=null)}setOutputDevice(e){return T(this,null,function*(){var t;if(!this.audioElement){y.d("audio-track","no audio element to set output");return}try{typeof this.audioElement.setSinkId=="function"&&(yield(t=this.audioElement)==null?void 0:t.setSinkId(e.deviceId),this.outputDevice=e)}catch(i){y.d("audio-track",i)}})}removeSink(){var e;this.audioElement&&((e=window.HMS)==null?void 0:e.AUDIO_SINK)&&(this.audioElement.srcObject=null,this.subscribeToAudio(!1))}addSink(){var e,t;if(!this.nativeTrack||!this.audioElement||!((e=window.HMS)!=null&&e.AUDIO_SINK))return;let i=this.audioElement.srcObject;i instanceof MediaStream&&((t=i.getAudioTracks()[0])==null?void 0:t.id)===this.nativeTrack.id||(this.audioElement.srcObject=new MediaStream([this.nativeTrack]),this.subscribeToAudio(!0))}subscribeToAudio(e){this.stream instanceof Xo&&this.stream.setAudio(e)}},Tu=class{constructor(){this.storage=new Hr("hms-device-selection"),this.remember=!1,this.TAG="HMSDeviceStorage"}setDevices(e){this.devices=e}rememberDevices(e){this.remember=e}updateSelection(e,{deviceId:t,groupId:i}){if(!this.devices||!this.remember)return;let r=this.devices[e].find(s=>this.isSame({deviceId:t,groupId:i},s));if(!r){y.w(this.TAG,`Could not find device with deviceId: ${t}, groupId: ${i}`);return}let n=this.storage.get()||{};n[e]=r,this.storage.set(n)}getSelection(){if(this.remember)return this.storage.get()}cleanup(){this.remember=!1,this.devices=void 0}isSame(e,t){return e.deviceId===t.deviceId&&(e.groupId===t.groupId||!e.groupId)}},Zt=new Tu,Xs;(function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"})(Xs||(Xs={}));var Si;(function(e){e.PLATFORM_NOT_SUPPORTED="PLATFORM_NOT_SUPPORTED",e.DEVICE_NOT_SUPPORTED="DEVICE_NOT_SUPPORTED"})(Si||(Si={}));var wr=class{static failure(e,t){let i="mediaPlugin.failed",r=Fe.ERROR,n=ce({plugin_name:e},t.toAnalyticsProperties());return new Je({name:i,level:r,properties:n})}static audioPluginFailure(e,t,i){let r="mediaPlugin.failed",n=Fe.ERROR,s=ce({plugin_name:e,sampleRate:t},i.toAnalyticsProperties());return new Je({name:r,level:n,properties:s})}static audioPluginStats({pluginName:e,duration:t,loadTime:i,sampleRate:r}){let n="mediaPlugin.stats",s=Fe.INFO,a={plugin_name:e,duration:t,load_time:i,sampleRate:r};return new Je({name:n,level:s,properties:a})}static stats({pluginName:e,duration:t,loadTime:i,avgPreProcessingTime:r,avgProcessingTime:n,inputFrameRate:s,pluginFrameRate:a}){let o="mediaPlugin.stats",l=Fe.INFO,c={plugin_name:e,duration:t,load_time:i,avg_preprocessing_time:r,avg_processing_time:n,input_frame_rate:s,plugin_frame_rate:a};return new Je({name:o,level:l,properties:c})}},an="AudioPluginsAnalytics",bu=class{constructor(e){this.eventBus=e,this.initTime={},this.addedTimestamps={},this.pluginAdded={},this.pluginSampleRate={}}added(e,t){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.pluginSampleRate[e]=t}removed(e){if(this.pluginAdded[e]){let t={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],sampleRate:this.pluginSampleRate[e]};this.eventBus.analytics.publish(wr.audioPluginStats(t)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(wr.audioPluginFailure(e,this.pluginSampleRate[e],t)),this.clean(e))}initWithTime(e,t){return T(this,null,function*(){if(this.initTime[e]){y.i(an,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);return}let i;try{i=yield this.timeInMs(t),y.i(an,`Time taken for Plugin ${e} initialization : ${i}`)}catch(r){let n=K.MediaPluginErrors.InitFailed(H.AUDIO_PLUGINS,`failed during initialization of plugin${r.message||r}`);throw y.e(an,n),this.failure(e,n),n}i&&(this.initTime[e]=i)})}timeInMs(e){return T(this,null,function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)})}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.pluginAdded[e],delete this.pluginSampleRate[e]}},xt="AudioPluginsManager",_u=48e3,ku=()=>navigator.userAgent.indexOf("Firefox")!==-1,Su=class{constructor(e,t){this.pluginAddInProgress=!1,this.hmsTrack=e,this.pluginsMap=new Map,this.analytics=new bu(t),this.createAudioContext()}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e){return T(this,null,function*(){var t;let i=(t=e.getName)==null?void 0:t.call(e);if(!i){y.w("no name provided by the plugin");return}if(this.pluginAddInProgress){let r=K.MediaPluginErrors.AddAlreadyInProgress(H.AUDIO_PLUGINS,"Add Plugin is already in Progress");throw this.analytics.added(i,this.audioContext.sampleRate),this.analytics.failure(i,r),y.w("can't add another plugin when previous add is in progress"),r}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e)}finally{this.pluginAddInProgress=!1}})}addPluginInternal(e){return T(this,null,function*(){var t;let i=(t=e.getName)==null?void 0:t.call(e);if(this.pluginsMap.get(i)){y.w(xt,`plugin - ${i} already added.`);return}yield this.validateAndThrow(i,e);try{this.pluginsMap.size===0?yield this.initAudioNodes():this.prevAudioNode&&this.prevAudioNode.disconnect(),this.analytics.added(i,this.audioContext.sampleRate),yield this.analytics.initWithTime(i,()=>T(this,null,function*(){return e.init()})),this.pluginsMap.set(i,e),yield this.processPlugin(e),yield this.connectToDestination()}catch(r){throw y.e(xt,"failed to add plugin",r),r}})}validatePlugin(e){return e.checkSupport(this.audioContext)}validateAndThrow(e,t){return T(this,null,function*(){let i=this.validatePlugin(t);if(i.isSupported)y.i(xt,`plugin is supported,- ${t.getName()}`);else if(this.analytics.added(e,this.audioContext.sampleRate),i.errType===Si.PLATFORM_NOT_SUPPORTED){let r=K.MediaPluginErrors.PlatformNotSupported(H.AUDIO_PLUGINS,"platform not supported, see docs");throw this.analytics.failure(e,r),yield this.cleanup(),r}else if(i.errType===Si.DEVICE_NOT_SUPPORTED){let r=K.MediaPluginErrors.DeviceNotSupported(H.AUDIO_PLUGINS,"audio device not supported, see docs");throw this.analytics.failure(e,r),yield this.cleanup(),r}})}removePlugin(e){return T(this,null,function*(){yield this.removePluginInternal(e),this.pluginsMap.size===0?(yield this.cleanup(),y.i(xt,"No plugins left, stopping plugins loop"),yield this.hmsTrack.setProcessedTrack(void 0)):yield this.reprocessPlugins()})}cleanup(){return T(this,null,function*(){var e,t,i;for(let r of this.pluginsMap.values())yield this.removePluginInternal(r);yield this.hmsTrack.setProcessedTrack(void 0),(e=this.sourceNode)==null||e.disconnect(),(t=this.prevAudioNode)==null||t.disconnect(),(i=this.outputTrack)==null||i.stop(),this.sourceNode=void 0,this.destinationNode=void 0,this.prevAudioNode=void 0,this.outputTrack=void 0})}closeContext(){return T(this,null,function*(){var e;(e=this.audioContext)==null||e.close(),this.audioContext=void 0})}reprocessPlugins(){return T(this,null,function*(){if(this.pluginsMap.size===0||!this.sourceNode)return;let e=Array.from(this.pluginsMap.values());yield this.cleanup(),yield this.initAudioNodes();for(let t of e)yield this.addPlugin(t)})}initAudioNodes(){return T(this,null,function*(){if(this.audioContext){if(!this.sourceNode){let e=new MediaStream([this.hmsTrack.nativeTrack]);this.sourceNode=this.audioContext.createMediaStreamSource(e)}if(!this.destinationNode){this.destinationNode=this.audioContext.createMediaStreamDestination(),this.outputTrack=this.destinationNode.stream.getAudioTracks()[0];try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(e){throw y.e(xt,"error in setting processed track",e),e}}}})}processPlugin(e){return T(this,null,function*(){try{let t=yield e.processAudioTrack(this.audioContext,this.prevAudioNode||this.sourceNode);this.prevAudioNode&&this.prevAudioNode.connect(t),this.prevAudioNode=t}catch(t){let i=e.getName();y.e(xt,`error in processing plugin ${i}`,t),yield this.removePluginInternal(e)}})}connectToDestination(){return T(this,null,function*(){try{this.prevAudioNode&&this.destinationNode&&this.prevAudioNode.context===this.destinationNode.context&&this.prevAudioNode.connect(this.destinationNode)}catch(e){y.e(xt,"error in connecting to destination node",e)}})}removePluginInternal(e){return T(this,null,function*(){var t;let i=(t=e.getName)==null?void 0:t.call(e);if(!this.pluginsMap.get(i)){y.w(xt,`plugin - ${i} not found to remove.`);return}y.i(xt,`removing plugin ${i}`),this.pluginsMap.delete(i),e.stop(),this.analytics.removed(i)})}createAudioContext(){this.audioContext||(ku()?this.audioContext=new AudioContext:this.audioContext=new AudioContext({sampleRate:_u}))}};function Eu(e){return T(this,null,function*(){try{return(yield navigator.mediaDevices.getUserMedia({audio:e?e.toConstraints():!1})).getAudioTracks()[0]}catch(t){throw Ar(t,Ut.AUDIO)}})}function Cu(e){return T(this,null,function*(){try{return(yield navigator.mediaDevices.getUserMedia({video:e?e.toConstraints():!1})).getVideoTracks()[0]}catch(t){throw Ar(t,Ut.VIDEO)}})}function on(e){return"canvas"in e||e.label==="MediaStreamAudioDestinationNode"||e.label===""}var os=class{constructor(e=1/0){this.capacity=e,this.storage=[]}size(){return this.storage.length}toList(){return this.storage.slice(0)}enqueue(e){this.size()===this.capacity&&this.dequeue(),this.storage.push(e)}dequeue(){return this.storage.shift()}aggregate(e){return e(this.storage)}};function Qt(e){if(e<0)throw Error("`ms` should be a positive integer");return new Promise(t=>setTimeout(t,e))}var Ru=35,Pu=5,Au=class{constructor(e,t,i){this.track=e,this.audioLevelEvent=t,this.silenceEvent=i,this.TAG="[TrackAudioLevelMonitor]",this.audioLevel=0,this.isMonitored=!1,this.interval=100,this.historyInterval=700,this.history=new os(this.historyInterval/this.interval),this.detectSilence=()=>T(this,null,function*(){let r=30,n=10,s=0;for(;this.isMonitored;){if(this.track.enabled)if(this.isSilentThisInstant()){if(s++,s>n){this.silenceEvent.publish({track:this.track});break}}else break;yield Qt(r)}});try{let r=new MediaStream([this.track.nativeTrack]);this.analyserNode=this.createAnalyserNodeForStream(r)}catch(r){y.w(this.TAG,"Unable to initialize AudioContext",r)}}start(){this.stop(),this.isMonitored=!0,y.d(this.TAG,"Starting track Monitor",`${this.track}`),this.loop().then(()=>y.d(this.TAG,"Stopping track Monitor",`${this.track}`))}stop(){if(!this.analyserNode){y.d(this.TAG,"AudioContext not initialized");return}this.sendAudioLevel(0),this.isMonitored=!1}loop(){return T(this,null,function*(){for(;this.isMonitored;)this.sendAudioLevel(this.getMaxAudioLevelOverPeriod()),yield Qt(this.interval)})}sendAudioLevel(e=0){if(e=e>Ru?e:0,Math.abs(this.audioLevel-e)>Pu){this.audioLevel=e;let t={track:this.track,audioLevel:this.audioLevel};this.audioLevelEvent.publish(t)}}getMaxAudioLevelOverPeriod(){if(!this.analyserNode){y.d(this.TAG,"AudioContext not initialized");return}let e=this.calculateAudioLevel();return e!==void 0&&this.history.enqueue(e),this.history.aggregate(t=>Math.max(...t))}calculateAudioLevel(){if(!this.analyserNode){y.d(this.TAG,"AudioContext not initialized");return}let e=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(e);let t=.009,i=t;for(let n of e)i=Math.max(i,(n-128)/128);let r=(Math.log(t)-Math.log(i))/Math.log(t);return Math.ceil(Math.min(Math.max(r*100,0),100))}isSilentThisInstant(){if(!this.analyserNode){y.d(this.TAG,"AudioContext not initialized");return}let e=new Uint8Array(this.analyserNode.fftSize);return this.analyserNode.getByteTimeDomainData(e),!e.some(t=>t!==128&&t!==0)}createAnalyserNodeForStream(e){let t=new AudioContext,i=t.createAnalyser();return t.createMediaStreamSource(e).connect(i),i}};function ea(e,t){return function(i){return i in e&&e[i]!==t[i]}}var Iu="HMSLocalAudioTrack",zi=class extends as{constructor(e,t,i,r,n=new Wi().build()){super(e,t,i),this.eventBus=r,this.handleSettingsChange=s=>T(this,null,function*(){let a=this.stream,o=ea(s,this.settings);o("maxBitrate")&&s.maxBitrate&&(yield a.setMaxBitrate(s.maxBitrate,this)),o("advanced")&&(yield this.nativeTrack.applyConstraints(s.toConstraints()))}),this.handleDeviceChange=(s,a=!1)=>T(this,null,function*(){ea(s,this.settings)("deviceId")&&(yield this.replaceTrackWith(s),a||Zt.updateSelection("audioInput",{deviceId:s.deviceId,groupId:this.nativeTrack.getSettings().groupId}))}),e.tracks.push(this),this.settings=n,n.deviceId==="default"&&!on(t)&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new Su(this,r),this.setFirstTrackId(t.id)}replaceTrackWith(e){return T(this,null,function*(){let t=this.nativeTrack,i=this.enabled,r=Boolean(this.audioLevelMonitor);t==null||t.stop();let n=yield Eu(e);n.enabled=i;let s=this.stream;yield s.replaceSenderTrack(t,this.processedTrack||n),yield s.replaceStreamTrack(t,n),this.nativeTrack=n,r&&this.initAudioLevelMonitor();try{yield this.pluginsManager.reprocessPlugins()}catch(a){this.eventBus.audioPluginFailed.publish(a)}})}setEnabled(e){var t=i=>super[i];return T(this,null,function*(){e!==this.enabled&&(e&&on(this.nativeTrack)&&(yield this.replaceTrackWith(this.settings)),yield t("setEnabled").call(this,e),e&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),this.eventBus.localAudioEnabled.publish({enabled:e,track:this}),this.stream.trackUpdate(this))})}isPublishedTrackId(e){return this.publishedTrackId===e}setSettings(e,t=!1){return T(this,null,function*(){let i=this.buildNewSettings(e);if(yield this.handleDeviceChange(i,t),on(this.nativeTrack)){this.settings=i;return}yield this.handleSettingsChange(i),this.settings=i})}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(e){return T(this,null,function*(){return this.pluginsManager.addPlugin(e)})}removePlugin(e){return T(this,null,function*(){return this.pluginsManager.removePlugin(e)})}validatePlugin(e){return this.pluginsManager.validatePlugin(e)}setProcessedTrack(e){return T(this,null,function*(){if(!e){this.processedTrack&&(yield this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack)),this.processedTrack=void 0;return}e!==this.processedTrack&&(this.processedTrack?yield this.stream.replaceSenderTrack(this.processedTrack,e):yield this.stream.replaceSenderTrack(this.nativeTrack,e),this.processedTrack=e)})}initAudioLevelMonitor(){this.audioLevelMonitor&&this.destroyAudioLevelMonitor(),y.d(Iu,"Monitor Audio Level for",this,this.getMediaTrackSettings().deviceId),this.audioLevelMonitor=new Au(this,this.eventBus.trackAudioLevelUpdate,this.eventBus.localAudioSilence),this.audioLevelMonitor.start(),this.audioLevelMonitor.detectSilence()}destroyAudioLevelMonitor(){var e;(e=this.audioLevelMonitor)==null||e.stop(),this.audioLevelMonitor=void 0}cleanup(){var e=t=>super[t];return T(this,null,function*(){var t;e("cleanup").call(this),yield this.pluginsManager.cleanup(),yield this.pluginsManager.closeContext(),(t=this.processedTrack)==null||t.stop(),this.destroyAudioLevelMonitor()})}getTrackIDBeingSent(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}getTrackBeingSent(){return this.processedTrack||this.nativeTrack}buildNewSettings(e){let{volume:t,codec:i,maxBitrate:r,deviceId:n,advanced:s}=ce(ce({},this.settings),e);return new rs(t,i,r,n,s)}},ls=class extends as{setEnabled(e){var t=i=>super[i];return T(this,null,function*(){e!==this.enabled&&(yield t("setEnabled").call(this,e),this.subscribeToAudio(e))})}},el=class extends ss{constructor(e,t,i){if(super(e,t,i),this.type=Ve.VIDEO,this.sinkCount=0,t.kind!=="video")throw new Error("Expected 'track' kind = 'video'")}hasSinks(){return this.sinkCount>0}addSink(e){this.addSinkInternal(e,this.nativeTrack)}removeSink(e){e.srcObject!==null&&(e.srcObject=null,this.sinkCount>0&&this.sinkCount--)}addSinkInternal(e,t){var i;let r=e.srcObject;r!==null&&r instanceof MediaStream&&((i=r.getVideoTracks()[0])==null?void 0:i.id)===t.id||(e.srcObject=new MediaStream([t]),this.sinkCount++)}},$r;(function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"})($r||($r={}));var In;(function(e){e["2D"]="2d",e.WEBGL="webgl",e.WEBGL2="webgl2"})(In||(In={}));var ta=class{constructor(){this.total=0,this.count=0}add(e){this.count++,this.total+=e}getAvg(){return Math.floor(this.total/this.count)}reset(){this.total=0,this.count=0}},ar="VideoPluginsAnalytics",wu=class{constructor(e){this.eventBus=e,this.initTime={},this.preProcessingAvgs=new ta,this.addedTimestamps={},this.processingAvgs={},this.pluginAdded={},this.pluginInputFrameRate={},this.pluginFrameRate={}}added(e,t,i){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.processingAvgs[e]=new ta,this.pluginInputFrameRate[e]=t,this.pluginFrameRate[e]=i||t}removed(e){var t;if(this.pluginAdded[e]){let i={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],avgPreProcessingTime:this.preProcessingAvgs.getAvg(),avgProcessingTime:(t=this.processingAvgs[e])==null?void 0:t.getAvg(),inputFrameRate:this.pluginInputFrameRate[e],pluginFrameRate:this.pluginFrameRate[e]};this.eventBus.analytics.publish(wr.stats(i)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(wr.failure(e,t)),this.clean(e))}initWithTime(e,t){return T(this,null,function*(){if(this.initTime[e]){y.i(ar,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);return}let i;try{i=yield this.timeInMs(t),y.i(ar,`Time taken for Plugin ${e} initialization : ${i}`)}catch(r){let n=K.MediaPluginErrors.InitFailed(H.VIDEO_PLUGINS,`failed during initialization of plugin${r.message||r}`);throw y.e(ar,n),this.failure(e,n),n}i&&(this.initTime[e]=i)})}preProcessWithTime(e){return T(this,null,function*(){let t=yield this.timeInMs(e);this.preProcessingAvgs.add(t)})}processWithTime(e,t){return T(this,null,function*(){var i;let r;try{r=yield this.timeInMs(t)}catch(n){let s=K.MediaPluginErrors.ProcessingFailed(H.VIDEO_PLUGINS,`Failed during processing of plugin${n.message||n}`);throw y.e(ar,s),this.failure(e,s),s}r&&((i=this.processingAvgs[e])==null||i.add(r))})}timeInMs(e){return T(this,null,function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)})}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.processingAvgs[e],delete this.pluginAdded[e],delete this.pluginInputFrameRate[e],delete this.pluginFrameRate[e]}},ia=24,$u=320,Du=240,ct="VideoPluginsManager",Ou=class{constructor(e,t){this.pluginsLoopRunning=!1,this.pluginsLoopState="paused",this.pluginAddInProgress=!1,this.hmsTrack=e,this.pluginsMap=new Map,this.pluginNumFramesToSkip={},this.pluginNumFramesSkipped={},this.analytics=new wu(t),this.canvases=new Array}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e,t){return T(this,null,function*(){var i;if(this.pluginAddInProgress){let r=(i=e.getName)==null?void 0:i.call(e);if(!r||r===""){y.w("no name provided by the plugin");return}let n=K.MediaPluginErrors.AddAlreadyInProgress(H.VIDEO_PLUGINS,"Add Plugin is already in Progress");throw this.analytics.failure(r,n),y.w("can't add another plugin when previous add is in progress"),n}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e,t)}finally{this.pluginAddInProgress=!1}})}addPluginInternal(e,t){return T(this,null,function*(){var i,r;let n=(i=e.getName)==null?void 0:i.call(e);if(!n||n===""){y.w("no name provided by the plugin");return}if(this.pluginsMap.has(n)){y.w(ct,`plugin - ${e.getName()} already added.`);return}let s=this.hmsTrack.getMediaTrackSettings().frameRate||ia,a=0;t&&t>0?(y.i(ct,`adding plugin ${e.getName()} with framerate ${t}`),t<s&&(a=Math.ceil(s/t)-1),this.analytics.added(n,s,t)):(y.i(ct,`adding plugin ${e.getName()}`),this.analytics.added(n,s)),y.i(ct,"numFrames to skip processing",a),this.pluginNumFramesToSkip[n]=a,this.pluginNumFramesSkipped[n]=a,this.validateAndThrow(n,e);try{if(yield this.analytics.initWithTime(n,()=>T(this,null,function*(){return yield e.init()})),this.pluginsMap.set(n,e),this.pluginsMap.size+1>this.canvases.length)for(let o=this.canvases.length;o<=this.pluginsMap.size;o++)this.canvases[o]=document.createElement("canvas");yield this.startPluginsLoop((r=e.getContextType)==null?void 0:r.call(e))}catch(o){throw y.e(ct,"failed to add plugin",o),yield this.removePlugin(e),o}})}validatePlugin(e){return e.checkSupport()}validateAndThrow(e,t){let i=this.validatePlugin(t);if(i.isSupported)y.i(ct,`plugin is supported,- ${t.getName()}`);else{let r;switch(i.errType){case Si.PLATFORM_NOT_SUPPORTED:throw r=K.MediaPluginErrors.PlatformNotSupported(H.VIDEO_PLUGINS,"platform not supported, see docs"),this.analytics.failure(e,r),r;case Si.DEVICE_NOT_SUPPORTED:throw r=K.MediaPluginErrors.DeviceNotSupported(H.VIDEO_PLUGINS,"video device not supported, see docs"),this.analytics.failure(e,r),r}}}removePlugin(e){return T(this,null,function*(){let t=e.getName();if(!this.pluginsMap.get(t)){y.w(ct,`plugin - ${t} not found to remove.`);return}y.i(ct,`removing plugin ${t}`),this.removePluginEntry(t),this.pluginsMap.size===0&&(y.i(ct,"No plugins left, stopping plugins loop"),yield this.stopPluginsLoop()),e.stop(),this.analytics.removed(t)})}removePluginEntry(e){this.pluginsMap.delete(e),this.pluginNumFramesToSkip[e]&&delete this.pluginNumFramesToSkip[e],this.pluginNumFramesSkipped[e]&&delete this.pluginNumFramesSkipped[e]}waitForRestart(){return T(this,null,function*(){if(!(!this.pluginsLoopRunning||this.pluginsLoopState==="running"))for(;this.pluginsLoopState==="paused";)yield Qt(100)})}cleanup(){return T(this,null,function*(){var e;for(let t of this.pluginsMap.values())yield this.removePlugin(t);(e=this.outputTrack)==null||e.stop()})}initElementsAndStream(e){this.inputCanvas||(this.inputCanvas=document.createElement("canvas")),this.outputCanvas=document.createElement("canvas"),this.inputVideo||(this.inputVideo=document.createElement("video")),this.inputCanvas.getContext("2d"),this.outputCanvas.getContext(e||In["2D"]);let t=this.outputCanvas.captureStream();this.outputTrack=t.getVideoTracks()[0]}startPluginsLoop(e){return T(this,null,function*(){if(!this.pluginsLoopRunning){this.initElementsAndStream(e),this.pluginsLoopRunning=!0;try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(t){throw this.pluginsLoopRunning=!1,y.e(ct,"error in setting processed track",t),t}this.pluginsLoop().then(()=>{y.d(ct,"processLoop stopped")})}})}stopPluginsLoop(){return T(this,null,function*(){var e;this.pluginsLoopRunning=!1,yield this.hmsTrack.setProcessedTrack(void 0),this.resetCanvases(),(e=this.outputTrack)==null||e.stop(),this.inputVideo&&(this.inputVideo.srcObject=null,this.inputVideo=void 0)})}pluginsLoop(){return T(this,null,function*(){for(;this.pluginsLoopRunning;){let e=this.hmsTrack.getMediaTrackSettings().frameRate||ia,t=Math.floor(1e3/e);if(!this.hmsTrack.enabled||this.hmsTrack.nativeTrack.readyState==="ended"){this.pluginsLoopState==="running"&&this.resetCanvases(),this.pluginsLoopState="paused",yield Qt(t);continue}let i=0;try{yield this.analytics.preProcessWithTime(()=>T(this,null,function*(){return yield this.doPreProcessing()}));let r=Date.now();yield this.processFramesThroughPlugins(),i=Math.floor(Date.now()-r),i>t&&(i=t)}catch(r){y.e(ct,"error in plugins loop",r)}this.pluginsLoopState="running",yield Qt(t-i)}})}doPreProcessing(){return T(this,null,function*(){yield this.addTrackToVideo(),yield this.updateInputCanvas()})}processFramesThroughPlugins(){return T(this,null,function*(){this.canvases[0]=this.inputCanvas;let e=0;for(let t of this.pluginsMap.values()){let i=t.getName();if(t){try{let r=this.checkIfSkipRequired(i);if(t.getPluginType()===$r.TRANSFORM){let n=(s,a)=>T(this,null,function*(){try{yield t.processVideoFrame(s,a,r)}catch(o){y.e(ct,`error in processing plugin ${i}`,o)}});if(r)e===this.pluginsMap.size-1?yield n(this.canvases[e],this.outputCanvas):yield n(this.canvases[e],this.canvases[e+1]);else{let s=this.canvases[e],a=this.canvases[e+1];e===this.pluginsMap.size-1?yield this.analytics.processWithTime(i,()=>T(this,null,function*(){return n(s,this.outputCanvas)})):yield this.analytics.processWithTime(i,()=>T(this,null,function*(){return n(s,a)}))}}else t.getPluginType()===$r.ANALYZE&&!r&&(yield this.analytics.processWithTime(i,()=>T(this,null,function*(){return yield t.processVideoFrame(this.inputCanvas)})))}catch(r){y.e(ct,`error in processing plugin ${i}`,r),yield this.removePlugin(t)}e++}}})}addTrackToVideo(){return T(this,null,function*(){var e;if(!this.inputVideo)return;let t=this.inputVideo.srcObject;t!==null&&t instanceof MediaStream&&((e=t.getVideoTracks()[0])==null?void 0:e.id)===this.hmsTrack.nativeTrack.id||(this.inputVideo.pause(),this.inputVideo.srcObject=new MediaStream([this.hmsTrack.nativeTrack]),this.inputVideo.muted=!0,this.inputVideo.playsInline=!0,yield this.inputVideo.play())})}updateInputCanvas(){return T(this,null,function*(){if(!this.inputCanvas||!this.inputVideo)return;let{width:e=$u,height:t=Du}=this.hmsTrack.getMediaTrackSettings();this.inputCanvas.height!==t&&(this.inputCanvas.height=t),this.inputCanvas.width!==e&&(this.inputCanvas.width=e),this.inputCanvas.getContext("2d").drawImage(this.inputVideo,0,0,e,t)})}resetCanvases(){if(!this.outputCanvas||!this.inputCanvas)return;let e=this.inputCanvas.getContext("2d");e&&(e.fillStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height)),this.canvases=[]}checkIfSkipRequired(e){let t=!1;return this.pluginNumFramesSkipped[e]<this.pluginNumFramesToSkip[e]?(this.pluginNumFramesSkipped[e]++,t=!0):(t=!1,this.pluginNumFramesSkipped[e]=0),t}};function ra(e,t){return function(i){return i in e&&e[i]!==t[i]}}var li=class extends el{constructor(e,t,i,r,n=new ki().build()){super(e,t,i),this.eventBus=r,this.TAG="LocalVideoTrack",this.isCurrentTab=!1,this.buildNewSettings=s=>{let{width:a,height:o,codec:l,maxFramerate:c,maxBitrate:u,deviceId:d,advanced:h}=ce(ce({},this.settings),s);return new ns(a,o,l,c,d,h,u)},this.handleSettingsChange=s=>T(this,null,function*(){let a=this.stream,o=ra(s,this.settings);o("maxBitrate")&&s.maxBitrate&&(yield a.setMaxBitrate(s.maxBitrate,this)),(o("width")||o("height")||o("advanced"))&&(yield this.nativeTrack.applyConstraints(s.toConstraints()))}),this.handleDeviceChange=(s,a=!1)=>T(this,null,function*(){if(ra(s,this.settings)("deviceId")&&this.source==="regular"){if(this.enabled){let o=yield this.replaceTrackWith(s);yield this.replaceSender(o,this.enabled),this.nativeTrack=o}a||Zt.updateSelection("videoInput",{deviceId:s.deviceId,groupId:this.nativeTrack.getSettings().groupId})}}),e.tracks.push(this),this.settings=n,n.deviceId==="default"&&t.enabled&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new Ou(this,r),this.setFirstTrackId(this.trackId)}setEnabled(e){var t=i=>super[i];return T(this,null,function*(){if(e!==this.enabled){if(this.source==="regular"){let i;e?i=yield this.replaceTrackWith(this.settings):i=yield this.replaceTrackWithBlank(),yield this.replaceSender(i,e),this.nativeTrack=i,e&&(yield this.pluginsManager.waitForRestart(),this.settings=this.buildNewSettings({deviceId:i.getSettings().deviceId}))}yield t("setEnabled").call(this,e),this.eventBus.localVideoEnabled.publish({enabled:e,track:this}),this.stream.trackUpdate(this)}})}isPublishedTrackId(e){return this.publishedTrackId===e}addSink(e){this.addSinkInternal(e,this.processedTrack||this.nativeTrack)}setSettings(e,t=!1){return T(this,null,function*(){let i=this.buildNewSettings(e);if(yield this.handleDeviceChange(i,t),!this.enabled){this.settings=i;return}yield this.handleSettingsChange(i),this.settings=i})}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(e,t){return T(this,null,function*(){return this.pluginsManager.addPlugin(e,t)})}removePlugin(e){return T(this,null,function*(){return this.pluginsManager.removePlugin(e)})}validatePlugin(e){return this.pluginsManager.validatePlugin(e)}cleanup(){var e=t=>super[t];return T(this,null,function*(){var t;e("cleanup").call(this),yield this.pluginsManager.cleanup(),(t=this.processedTrack)==null||t.stop()})}cropTo(e){return T(this,null,function*(){if(!!e&&this.source==="screen")try{this.nativeTrack.cropTo&&(yield this.nativeTrack.cropTo(e))}catch(t){throw y.e(this.TAG,"failed to crop screenshare capture - ",t),K.TracksErrors.GenericTrack(H.TRACK,"failed to crop screenshare capture")}})}getCaptureHandle(){if(this.nativeTrack.getCaptureHandle)return this.nativeTrack.getCaptureHandle()}setProcessedTrack(e){return T(this,null,function*(){if(!this.nativeTrack.enabled){this.processedTrack=e;return}if(!e){this.processedTrack&&(yield this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack)),this.processedTrack=void 0;return}e!==this.processedTrack&&(this.processedTrack?yield this.stream.replaceSenderTrack(this.processedTrack,e):yield this.stream.replaceSenderTrack(this.nativeTrack,e),this.processedTrack=e)})}getTrackIDBeingSent(){return this.getTrackBeingSent().id}getTrackBeingSent(){return this.enabled?this.processedTrack||this.nativeTrack:this.nativeTrack}replaceTrackWith(e){return T(this,null,function*(){let t=this.nativeTrack;t==null||t.stop();let i=yield Cu(e);return this.settings.deviceId==="default"&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),i})}replaceTrackWithBlank(){return T(this,null,function*(){let e=this.nativeTrack;return e==null||e.stop(),Or.getEmptyVideoTrack(e)})}replaceSender(e,t){return T(this,null,function*(){let i=this.stream;t?yield i.replaceSenderTrack(this.nativeTrack,this.processedTrack||e):yield i.replaceSenderTrack(this.processedTrack||this.nativeTrack,e),yield i.replaceStreamTrack(this.nativeTrack,e)})}},Oi="renegotiation-callback-id",tl="ion-sfu",il=100,wn=5,Mu=60,Lu=12e3,Nu=1e3,xu=5,Mi="SUBSCRIBE_ICE_CONNECTION_CALLBACK_ID",Uu=6e4,Fu=1e3,Bu="https://event.100ms.live/v2/client/report",Gu="https://event-nonprod.100ms.live/v2/client/report",Vu=100,nt={DEVICE_CHANGE:"device-change",LOCAL_AUDIO_ENABLED:"local-audio-enabled",LOCAL_VIDEO_ENABLED:"local-video-enabled",STATS_UPDATE:"stats-update",RTC_STATS_UPDATE:"rtc-stats-update",TRACK_DEGRADED:"track-degraded",TRACK_RESTORED:"track-restored",TRACK_AUDIO_LEVEL_UPDATE:"track-audio-level-update",LOCAL_AUDIO_SILENCE:"local-audio-silence",ANALYTICS:"analytics",AUDIO_PLUGIN_FAILED:"audio-plugin-failed",POLICY_CHANGE:"policy-change",LOCAL_ROLE_UPDATE:"local-role-update",AUDIO_TRACK_UPDATE:"audio-track-update",AUDIO_TRACK_ADDED:"audio-track-added",AUDIO_TRACK_REMOVED:"audio-track-removed",AUTOPLAY_ERROR:"autoplay-error"},di=class extends el{constructor(){super(...arguments),this._degraded=!1,this._degradedAt=null,this._layerDefinitions=[],this.history=new ju}get degraded(){return this._degraded}get degradedAt(){return this._degradedAt}setEnabled(e){var t=i=>super[i];return T(this,null,function*(){e!==this.enabled&&(yield t("setEnabled").call(this,e))})}preferLayer(e){!this.shouldSendVideoLayer(e,"preferLayer")||(this.stream.setVideoLayer(e,this.logIdentifier),this.pushInHistory(`uiPreferLayer-${e}`))}getSimulcastLayer(){return this.stream.getSimulcastLayer()}addSink(e){super.addSink(e),this.updateLayer("addSink"),this.pushInHistory("uiSetLayer-high")}removeSink(e){super.removeSink(e),this.updateLayer("removeSink"),this._degraded=!1,this.pushInHistory("uiSetLayer-none")}getSimulcastDefinitions(){return[...this._layerDefinitions]}setSimulcastDefinitons(e){this._layerDefinitions=e}setLayerFromServer(e,t){this._degraded=t,this._degradedAt=t?new Date:this._degradedAt,this.stream.setVideoLayerLocally(e,this.logIdentifier),this.pushInHistory(`sfuLayerUpdate-${e}`)}setDegradedFromSdk(e){this._degraded=e,this._degradedAt=e?new Date:this._degradedAt,this.updateLayer("sdkDegradation"),this.pushInHistory(e?"sdkDegraded-none":"sdkRecovered-high")}updateLayer(e){let t=this.degraded||!this.hasSinks()?mt.NONE:mt.HIGH;!this.shouldSendVideoLayer(t,e)||this.stream.setVideoLayer(t,this.logIdentifier)}pushInHistory(e){}shouldSendVideoLayer(e,t){let i=this.getSimulcastLayer();return this.degraded&&e===mt.NONE?!0:i===e?(y.d(`[Remote Track] ${this.logIdentifier}`,`Not sending update, already on layer ${e}, source=${t}`),!1):!0}},ju=class{constructor(){this.history=[]}push(e){e.time=new Date().toISOString().split("T")[1],this.history.push(e)}},or="HMSLocalStream",Dr=class extends Zo{constructor(){super(...arguments),this.connection=null}setConnection(e){this.connection=e}addTransceiver(e,t){let i=[];if(e instanceof li)if(t.length>0)y.v(or,"Simulcast enabled with layers",t),i.push(...t);else{let n={active:this.nativeStream.active};e.settings.maxBitrate&&!ts&&(n.maxBitrate=e.settings.maxBitrate),i.push(n)}let r=this.connection.addTransceiver(e.getTrackBeingSent(),{streams:[this.nativeStream],direction:"sendonly",sendEncodings:i});return this.setPreferredCodec(r,e.nativeTrack.kind),r}setMaxBitrate(e,t){return T(this,null,function*(){var i;yield(i=this.connection)==null?void 0:i.setMaxBitrate(e,t)})}setPreferredCodec(e,t){}replaceTrack(e,t){return T(this,null,function*(){yield this.replaceSenderTrack(e,t),e.stop(),this.replaceStreamTrack(e,t)})}replaceStreamTrack(e,t){this.nativeStream.addTrack(t),this.nativeStream.removeTrack(e)}replaceSenderTrack(e,t){return T(this,null,function*(){var i;let r=(i=this.connection)==null?void 0:i.getSenders().find(n=>n.track&&n.track.id===e.id);if(r===void 0){y.w(or,`No sender found for trackId=${e.id}`);return}yield r.replaceTrack(t)})}removeSender(e){let t=0;this.connection.getSenders().forEach(i=>{var r,n;if(((r=i.track)==null?void 0:r.id)===e.trackId||((n=i.track)==null?void 0:n.id)===e.getTrackIDBeingSent()){this.connection.removeTrack(i),t+=1;let s=this.tracks.indexOf(e);s!==-1?this.tracks.splice(s,1):y.e(or,`Cannot find ${e.trackId} in locally stored tracks`)}}),t!==1&&y.e(or,`Removed ${t} sender's, expected to remove 1`)}trackUpdate(e){var t;(t=this.connection)==null||t.trackUpdate(e)}},rl={audioContext:null,getAudioContext(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContext},resumeContext(){this.getAudioContext().resume().catch(e=>{y.e("AudioContext",e)})}},na={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default"},Li,Or=class{constructor(e,t,i,r,n){this.store=e,this.observer=t,this.deviceManager=i,this.eventBus=r,this.analyticsTimer=n,this.TAG="[LocalTrackManager]",this.setScreenCaptureHandleConfig()}getTracksToPublish(e){return T(this,null,function*(){let t=this.getAVTrackSettings(e);if(!t)return[];let i=!!t.audio,r=!!t.video,n=[],{videoTrack:s,audioTrack:a}=yield this.updateCurrentLocalTrackSettings(t),o=(s==null?void 0:s.stream)||(a==null?void 0:a.stream),l=Boolean(s&&this.store.getTrackById(s.trackId)),c=Boolean(a&&this.store.getTrackById(a.trackId));if(l&&c)return[];let u={audio:i&&!a&&(e.isAudioMuted?"empty":!0),video:r&&!s&&(e.isVideoMuted?"empty":!0)};this.analyticsTimer.start(Pe.LOCAL_TRACKS);try{y.d(this.TAG,"Init Local Tracks",{fetchTrackOptions:u}),n=yield this.getLocalTracks(u,t,o)}catch(d){n=yield this.retryGetLocalTracks(d,t,u,o)}return this.analyticsTimer.end(Pe.LOCAL_TRACKS),s&&r&&!l&&n.push(s),a&&i&&!c&&n.push(a),n})}getLocalTracks(){return T(this,arguments,function*(e={audio:!0,video:!0},t,i){try{let r=yield this.getNativeLocalTracks(e,t);return this.createHMSLocalTracks(r,t,i)}catch(r){throw this.eventBus.analytics.publish($e.publish({devices:this.deviceManager.getDevices(),error:r,settings:t})),r}})}getNativeLocalTracks(){return T(this,arguments,function*(e={audio:!1,video:!1},t){let i=new An(e.video===!0?t.video:null,e.audio===!0?t.audio:null,t.simulcast),r=[];return(i.audio||i.video)&&r.push(...yield this.getAVTracks(i)),r.push(...this.getEmptyTracks(e)),r})}getLocalScreen(e){return T(this,null,function*(){let t=yield this.getOrDefaultScreenshareConfig(e),{video:i,audio:r}=this.getScreenshareSettings(t.videoOnly),n={video:Xe(ce({},i.toConstraints(!0)),{displaySurface:t.displaySurface}),preferCurrentTab:t.preferCurrentTab,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio};if(r){let d=r.toConstraints();delete d.advanced,n.audio=Xe(ce({},d),{autoGainControl:!1,noiseSuppression:!1,googAutoGainControl:!1,echoCancellation:!1})}let s;try{y.d("retrieving screenshare with ",{config:t},{constraints:n}),s=yield navigator.mediaDevices.getDisplayMedia(n)}catch(d){y.w(this.TAG,"error in getting screenshare - ",d);let h=Ar(d,Ut.SCREEN);throw this.eventBus.analytics.publish($e.publish({error:h,devices:this.deviceManager.getDevices(),settings:new An(i,r,!1)})),h}let a=[],o=new Dr(s),l=s.getVideoTracks()[0],c=new li(o,l,"screen",this.eventBus,i);try{let d=this.validateCurrentTabCapture(c,t.forceCurrentTab);c.isCurrentTab=d,yield c.cropTo(t.cropTarget)}catch(d){throw s.getTracks().forEach(h=>h.stop()),d}a.push(c);let u=s.getAudioTracks()[0];if(u){let d=new zi(o,u,"screen",this.eventBus,r);a.push(d)}return y.v(this.TAG,"getLocalScreen",a),a})}setScreenCaptureHandleConfig(e){var t;!((t=navigator.mediaDevices)!=null&&t.setCaptureHandleConfig)||this.isInIframe()||(e=e||{},Object.assign(e,{handle:Ci(),exposeOrigin:!1,permittedOrigins:[window.location.origin]}),y.d("setting capture handle - ",e.handle),navigator.mediaDevices.setCaptureHandleConfig(e),this.captureHandleIdentifier=e.handle)}validateCurrentTabCapture(e,t){let i=e.getCaptureHandle(),r=!!(this.captureHandleIdentifier&&(i==null?void 0:i.handle)===this.captureHandleIdentifier);if(t&&!r)throw y.e(this.TAG,"current tab was not shared with forceCurrentTab as true"),K.TracksErrors.CurrentTabNotShared();return r}requestPermissions(){return T(this,null,function*(){try{(yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(e=>e.stop())}catch(e){y.e(this.TAG,e)}})}static getEmptyVideoTrack(e){var t,i,r;let n=((t=e==null?void 0:e.getSettings())==null?void 0:t.width)||320,s=((i=e==null?void 0:e.getSettings())==null?void 0:i.height)||240,a=10;Li||(Li=Object.assign(document.createElement("canvas"),{width:n,height:s}),(r=Li.getContext("2d"))==null||r.fillRect(0,0,n,s));let o=Li.captureStream(a).getVideoTracks()[0],l=setInterval(()=>{if(o.readyState==="ended"){clearInterval(l);return}let c=Li.getContext("2d");if(c){let u=c.getImageData(0,0,1,1).data[0]===0?1:0;c.fillStyle=`rgb(${u}, 0, 0)`,c.fillRect(0,0,1,1)}},1e3/a);return o.onended=()=>{clearInterval(l)},o.enabled=!1,o}static getEmptyAudioTrack(){let e=rl.getAudioContext(),t=e.createOscillator(),i=e.createMediaStreamDestination();t.connect(i),t.start();let r=i.stream.getAudioTracks()[0];return r.enabled=!1,r}getAVTracks(e){return T(this,null,function*(){try{let t=yield navigator.mediaDevices.getUserMedia({audio:e.audio?e.audio.toConstraints():!1,video:e.video?e.video.toConstraints():!1});return t.getVideoTracks().concat(t.getAudioTracks())}catch(t){yield this.deviceManager.init();let i=!!(!this.deviceManager.hasWebcamPermission&&e.video),r=!!(!this.deviceManager.hasMicrophonePermission&&e.audio),n=this.getErrorType(i,r);throw Ar(t,n)}})}getAVTrackSettings(e){let t=this.getAudioSettings(e),i=this.getVideoSettings(e);return!t&&!i?null:new Zs().video(i).audio(t).build()}isInIframe(){try{return window.self!==window.top}catch{return!0}}retryGetLocalTracks(e,t,i,r){return T(this,null,function*(){if(e instanceof te&&e.action===H.TRACK){this.observer.onFailure(e);let n=e.code===le.TracksErrors.OVER_CONSTRAINED,s=e.message.includes("audio"),a=e.message.includes("video");if(n){let o=new Zs().video(new ns).audio(new rs).build();y.w(this.TAG,"Fetch AV Tracks failed with overconstrained error",{fetchTrackOptions:i},{error:e});try{return yield this.getLocalTracks(i,o,r)}catch(l){let c=l instanceof te?l.nativeError:l,u=l;if((c==null?void 0:c.name)==="OverconstrainedError"){let d=K.TracksErrors.GenericTrack(H.TRACK,"Overconstrained error after dropping all constraints");d.addNativeError(c),u=d}return yield this.retryGetLocalTracks(u,t,i,r)}}i.audio=s?"empty":i.audio,i.video=a?"empty":i.video,y.w(this.TAG,"Fetch AV Tracks failed",{fetchTrackOptions:i},e);try{return yield this.getLocalTracks(i,t,r)}catch(o){return y.w(this.TAG,"Fetch empty tacks failed",o),i.audio=i.audio&&"empty",i.video=i.video&&"empty",this.observer.onFailure(o),yield this.getLocalTracks(i,t,r)}}else return y.w(this.TAG,"Fetch AV Tracks failed - unknown exception",e),this.observer.onFailure(e),[]})}getErrorType(e,t){return e&&t?Ut.AV:e?Ut.VIDEO:t?Ut.AUDIO:Ut.UNKNOWN}getEmptyTracks(e){let t=[];return e.audio==="empty"&&t.push(Or.getEmptyAudioTrack()),e.video==="empty"&&t.push(Or.getEmptyVideoTrack()),t}updateCurrentLocalTrackSettings(e){return T(this,null,function*(){let t=this.store.getLocalPeerTracks(),i=t.find(s=>s.type===Ve.VIDEO&&s.source==="regular"),r=t.find(s=>s.type===Ve.AUDIO&&s.source==="regular"),n=t.find(s=>s.type===Ve.VIDEO&&s.source==="screen");return e!=null&&e.video&&(yield i==null?void 0:i.setSettings(e.video)),e!=null&&e.audio&&(yield r==null?void 0:r.setSettings(e.audio)),e!=null&&e.screen&&(yield n==null?void 0:n.setSettings(e.screen)),{videoTrack:i,audioTrack:r}})}getAudioSettings(e){var t;let i=this.store.getPublishParams();if(!i||!((t=i.allowed)!=null&&t.includes("audio")))return null;let r=this.store.getLocalPeer(),n=r==null?void 0:r.audioTrack,s=(n==null?void 0:n.settings.deviceId)||e.audioInputDeviceId;return new Wi().codec(i.audio.codec).maxBitrate(i.audio.bitRate).deviceId(s||na.audioInputDeviceId).build()}getVideoSettings(e){var t;let i=this.store.getPublishParams();if(!i||!((t=i.allowed)!=null&&t.includes("video")))return null;let r=this.store.getLocalPeer(),n=r==null?void 0:r.videoTrack,s=(n==null?void 0:n.settings.deviceId)||e.videoDeviceId,a=i.video,{width:o=a.width,height:l=a.height}=this.store.getSimulcastDimensions("regular")||{};return new ki().codec(a.codec).maxBitrate(a.bitRate).maxFramerate(a.frameRate).setWidth(o).setHeight(l).deviceId(s||na.videoDeviceId).build()}getScreenshareSettings(e=!1){let{screen:t}=this.store.getPublishParams(),i=this.store.getSimulcastDimensions("screen");return{video:new ki().maxBitrate(t.bitRate,!1).codec(t.codec).maxFramerate(t.frameRate).setWidth((i==null?void 0:i.width)||t.width).setHeight((i==null?void 0:i.height)||t.height).build(),audio:e?void 0:new Wi().build()}}getOrDefaultScreenshareConfig(e){return T(this,null,function*(){var t;let i=Object.assign({videoOnly:!1,audioOnly:!1,forceCurrentTab:!1,preferCurrentTab:!1,selfBrowserSurface:"exclude",surfaceSwitching:"include",systemAudio:"exclude",displaySurface:"monitor"},e||{});return i.forceCurrentTab&&(i.videoOnly=!0,i.preferCurrentTab=!0,i.selfBrowserSurface="include",i.surfaceSwitching="exclude"),i.preferCurrentTab&&(i.selfBrowserSurface="include"),i.cropElement&&((t=window.CropTarget)==null?void 0:t.fromElement)&&(i.cropTarget=yield window.CropTarget.fromElement(i.cropElement)),i})}createHMSLocalTracks(e,t,i){let r=e.find(a=>a.kind==="video"),n=e.find(a=>a.kind==="audio");i?e.forEach(a=>i==null?void 0:i.nativeStream.addTrack(a)):i=new Dr(new MediaStream(e));let s=[];if(n&&(t==null?void 0:t.audio)){let a=new zi(i,n,"regular",this.eventBus,t.audio);s.push(a)}if(r&&(t==null?void 0:t.video)){let a=new li(i,r,"regular",this.eventBus,t.video);s.push(a)}return s}},qu=class{constructor(e,t){this.eventBus=e,this.listener=t,this.TAG="NetworkTestManager",this.controller=new AbortController,this.start=i=>T(this,null,function*(){var r;if(!i)return;let{url:n,timeout:s,scoreMap:a}=i,o=this.controller.signal,l=Date.now(),c=0,u=Qt(s).then(()=>{this.controller.abort()});try{let d=(r=(yield fetch(`${n}?${Date.now()}`,{signal:o})).body)==null?void 0:r.getReader();if(!d)throw Error("unable to process request");let h=()=>T(this,null,function*(){if(d)try{let p=!1;for(;!p;){let{value:g,done:v}=yield d.read();p=v,g&&(c+=g.byteLength,this.sendScore({scoreMap:a,downloadedSize:c,startTime:l}))}}catch(p){y.e(this.TAG,p)}});return Promise.race([h(),u]).then(()=>{this.sendScore({scoreMap:a,downloadedSize:c,startTime:l,finished:!0})}).catch(p=>{y.e(this.TAG,p),this.updateScoreToListener(0),this.eventBus.analytics.publish($e.previewNetworkQuality({error:p.message}))})}catch(d){y.e(this.TAG,d),d.name!=="AbortError"&&(this.updateScoreToListener(0),this.eventBus.analytics.publish($e.previewNetworkQuality({error:d.message})))}}),this.stop=()=>{this.controller.signal.aborted||this.controller.abort()},this.sendScore=({scoreMap:i,downloadedSize:r,startTime:n,finished:s=!1})=>{let a=(Date.now()-n)/1e3,o=r/1024/a*8,l=-1;for(let c in i){let u=i[c];o>=u.low&&(!u.high||o<=u.high)&&(l=Number(c))}this.updateScoreToListener(l),s&&this.eventBus.analytics.publish($e.previewNetworkQuality({score:l,downLink:o.toFixed(2)}))}}updateScoreToListener(e){var t,i;e!==this.score&&(this.score=e,(i=(t=this.listener)==null?void 0:t.onNetworkQuality)==null||i.call(t,e))}},Hu=class{constructor(e,t,i,r,n){this.store=e,this.transport=t,this.publish=i,this.removeAuxiliaryTrack=r,this.listener=n,this.handleLocalPeerRoleUpdate=s=>T(this,[s],function*({oldRole:a,newRole:o}){var l,c;let u=this.store.getLocalPeer();if(!u)return;let d=new Set(a.publishParams.allowed||[]),h=new Set(o.publishParams.allowed||[]),p=this.removeTrack(d,h,"video"),g=this.removeTrack(d,h,"audio"),v=this.removeTrack(d,h,"screen");yield this.removeVideoTracks(p),yield this.removeAudioTrack(g),yield this.removeScreenTracks(v),this.store.setPublishParams(o.publishParams);let S=((l=this.store.getConfig())==null?void 0:l.settings)||{isAudioMuted:!0,isVideoMuted:!0,audioInputDeviceId:"default",videoDeviceId:"default",audioOutputDeviceId:"default"};yield this.publish(Xe(ce({},S),{isAudioMuted:!0,isVideoMuted:!0})),(c=this.listener)==null||c.onPeerUpdate(Qe.ROLE_UPDATED,u)})}removeVideoTracks(e){return T(this,null,function*(){var t;if(!e)return;let i=this.store.getLocalPeer();i!=null&&i.videoTrack&&(yield this.transport.unpublish([i.videoTrack]),(t=this.listener)==null||t.onTrackUpdate(Ce.TRACK_REMOVED,i.videoTrack,i),i.videoTrack=void 0),yield this.removeAuxTracks(r=>r.source!=="screen"&&r.type==="video")})}removeAudioTrack(e){return T(this,null,function*(){var t;if(!e)return;let i=this.store.getLocalPeer();i!=null&&i.audioTrack&&(yield this.transport.unpublish([i.audioTrack]),(t=this.listener)==null||t.onTrackUpdate(Ce.TRACK_REMOVED,i.audioTrack,i),i.audioTrack=void 0),yield this.removeAuxTracks(r=>r.source!=="screen"&&r.type==="audio")})}removeScreenTracks(e){return T(this,null,function*(){!e||(yield this.removeAuxTracks(t=>t.source==="screen"))})}removeAuxTracks(e){return T(this,null,function*(){let t=this.store.getLocalPeer();if(t!=null&&t.auxiliaryTracks){let i=[...t.auxiliaryTracks];for(let r of i)e(r)&&(yield this.removeAuxiliaryTrack(r.trackId))}})}removeTrack(e,t,i){return e.has(i)&&!t.has(i)}},Ku=class{constructor(e){this.store=e,this.primitiveComparator=(t,i)=>t===i?0:Number(t)-Number(i),this.stringComparator=(t,i)=>t===i?0:t<i?-1:1}getPeerComparators(){return{videoEnabled:(e,t)=>{var i,r;return this.primitiveComparator(Boolean((i=e.videoTrack)==null?void 0:i.enabled),Boolean((r=t.videoTrack)==null?void 0:r.enabled))},audioEnabled:(e,t)=>{var i,r;return this.primitiveComparator(Boolean((i=e.audioTrack)==null?void 0:i.enabled),Boolean((r=t.audioTrack)==null?void 0:r.enabled))},screenShare:(e,t)=>this.primitiveComparator(e.auxiliaryTracks.some(i=>i.source==="screen"),t.auxiliaryTracks.some(i=>i.source==="screen")),audioLevel:(e,t)=>{var i,r;return this.primitiveComparator(((i=this.store.getSpeakers().find(n=>n.peer&&n.peer.peerId===(e==null?void 0:e.peerId)))==null?void 0:i.audioLevel)||-1,((r=this.store.getSpeakers().find(n=>n.peer&&n.peer.peerId===(t==null?void 0:t.peerId)))==null?void 0:r.audioLevel)||-1)},rolePriority:(e,t)=>{var i,r;return this.primitiveComparator(((i=t.role)==null?void 0:i.priority)||0,((r=e.role)==null?void 0:r.priority)||0)}}}getTrackComparators(){return{video:(e,t)=>this.primitiveComparator(e.type===Ve.VIDEO,t.type===Ve.VIDEO),audio:(e,t)=>this.primitiveComparator(e.type===Ve.AUDIO,t.type===Ve.AUDIO),enabled:(e,t)=>this.primitiveComparator(Boolean(e.enabled),Boolean(t.enabled)),peerAudioLevel:(e,t)=>{let i=this.store.getPeerByTrackId(e.trackId),r=this.store.getPeerByTrackId(t.trackId);return this.getPeerComparators().audioLevel(i,r)},audioLevel:(e,t)=>{var i,r;return this.primitiveComparator(((i=this.store.getSpeakers().find(n=>n.track.trackId===e.trackId))==null?void 0:i.audioLevel)||0,((r=this.store.getSpeakers().find(n=>n.track.trackId===t.trackId))==null?void 0:r.audioLevel)||0)},screenShare:(e,t)=>this.primitiveComparator(e.source==="screen",t.source==="screen"),rolePriority:(e,t)=>{var i,r,n,s;return this.primitiveComparator(((r=(i=this.store.getPeerByTrackId(t.trackId))==null?void 0:i.role)==null?void 0:r.priority)||0,((s=(n=this.store.getPeerByTrackId(e.trackId))==null?void 0:n.role)==null?void 0:s.priority)||0)}}}},Wu=class{constructor(){this.TAG="[HTTPAnalyticsTransport]",this.failedEvents=new Hr("client-events"),this.isConnected=!0,this.env=null}setEnv(e){this.env=e,this.flushFailedEvents()}sendEvent(e){if(!this.env){this.addEventToStorage(e);return}let t={event:e.name,payload:e.properties,event_id:String(e.timestamp),peer:e.metadata.peer,timestamp:e.timestamp,device_id:e.device_id},i=this.env===ft.PROD?Bu:Gu;fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.metadata.token}`,user_agent_v2:e.metadata.userAgent},body:JSON.stringify(t)}).then(r=>{if(r.status===401){this.removeFromStorage(e);return}if(r.status!==200)throw Error(r.statusText);this.removeFromStorage(e)}).catch(r=>{y.v(this.TAG,"Failed to send event",r,e),this.addEventToStorage(e)})}flushFailedEvents(){let e=this.failedEvents.get();e==null||e.forEach(t=>this.sendEvent(t))}addEventToStorage(e){let t=this.failedEvents.get()||[];t.find(i=>i.timestamp===e.timestamp)||(t.length===Vu&&t.shift(),t.push(e),this.failedEvents.set(t))}removeFromStorage(e){let t=this.failedEvents.get()||[],i=t.findIndex(r=>r.timestamp===e.timestamp);i>-1&&(t.splice(i,1),this.failedEvents.set(t))}},Mr=new Wu,zu=class{constructor(){this.comparator=new Ku(this),this.knownRoles={},this.peers={},this.tracks={},this.peerTrackStates={},this.speakers=[],this.videoLayers=null,this.screenshareLayers=null,this.roleDetailsArrived=!1,this.env=ft.PROD,this.userAgent=En(this.env)}getConfig(){return this.config}getEnv(){return this.env}getPublishParams(){return this.publishParams}getComparator(){return this.comparator}getRoom(){return this.room}getPolicyForRole(e){return this.knownRoles[e]}getKnownRoles(){return this.knownRoles}getLocalPeer(){if(this.localPeerId&&this.peers[this.localPeerId])return this.peers[this.localPeerId]}getRemotePeers(){return Object.values(this.peers).filter(e=>!e.isLocal)}getPeers(){return Object.values(this.peers)}getPeerById(e){if(this.peers[e])return this.peers[e]}getTracksMap(){return this.tracks}getTracks(){return Object.values(this.tracks)}getVideoTracks(){return this.getTracks().filter(e=>e.type===Ve.VIDEO)}getRemoteVideoTracks(){return this.getTracks().filter(e=>e instanceof di)}getAudioTracks(){return this.getTracks().filter(e=>e.type===Ve.AUDIO)}getPeerTracks(e){let t=e?this.peers[e]:void 0,i=[];return t!=null&&t.videoTrack&&i.push(t.videoTrack),t!=null&&t.audioTrack&&i.push(t.audioTrack),i.concat((t==null?void 0:t.auxiliaryTracks)||[])}getLocalPeerTracks(){return this.getPeerTracks(this.localPeerId)}getTrackById(e){var t,i;let r=this.tracks[e];if(r)return r;let n=this.getLocalPeer();if(n){if((t=n.audioTrack)!=null&&t.isPublishedTrackId(e))return n.audioTrack;if((i=n.videoTrack)!=null&&i.isPublishedTrackId(e))return n.videoTrack}}getPeerByTrackId(e){let t=this.tracks[e];return t.peerId?this.peers[t.peerId]:void 0}getSpeakers(){return this.speakers}getSpeakerPeers(){return this.speakers.map(e=>e.peer)}getUserAgent(){return this.userAgent}createAndSetUserAgent(e){this.userAgent=En(this.env,e)}setRoom(e){this.room=e}setKnownRoles(e){this.knownRoles=e,this.roleDetailsArrived=!0,this.updatePeersPolicy()}hasRoleDetailsArrived(){return this.roleDetailsArrived}setConfig(e){var t,i,r;if(Zt.rememberDevices(Boolean(e.rememberDeviceSelection)),e.rememberDeviceSelection){let n=Zt.getSelection();n&&(e.settings||(e.settings={}),(t=n.audioInput)!=null&&t.deviceId&&(e.settings.audioInputDeviceId=e.settings.audioInputDeviceId||n.audioInput.deviceId),(i=n.audioOutput)!=null&&i.deviceId&&(e.settings.audioOutputDeviceId=e.settings.audioOutputDeviceId||n.audioOutput.deviceId),(r=n.videoInput)!=null&&r.deviceId&&(e.settings.videoDeviceId=e.settings.videoDeviceId||n.videoInput.deviceId))}this.config=e,this.setEnv()}setPublishParams(e){this.publishParams=e}addPeer(e){this.peers[e.peerId]=e,e.isLocal&&(this.localPeerId=e.peerId)}addTrack(e){this.tracks[e.trackId]=e}getTrackState(e){return this.peerTrackStates[e]}setTrackState(e){this.peerTrackStates[e.trackInfo.track_id]=e}removePeer(e){this.localPeerId===e&&(this.localPeerId=void 0),delete this.peers[e]}removeTrack(e){delete this.tracks[e]}updateSpeakers(e){this.speakers=e}updateAudioOutputVolume(e){this.getAudioTracks().forEach(t=>t.setVolume(e))}updateAudioOutputDevice(e){return T(this,null,function*(){let t=[];this.getAudioTracks().forEach(i=>{t.push(i.setOutputDevice(e))}),yield Promise.all(t)})}getSubscribeDegradationParams(){var e,t;let i=(t=(e=this.getLocalPeer())==null?void 0:e.role)==null?void 0:t.subscribeParams.subscribeDegradation;if(i&&Object.keys(i).length>0)return i}getSimulcastLayers(e){var t,i;return e==="screen"?((t=this.screenshareLayers)==null?void 0:t.layers)||[]:((i=this.videoLayers)==null?void 0:i.layers)||[]}getSimulcastDimensions(e){let t=e==="screen"?this.screenshareLayers:this.videoLayers,i=t==null?void 0:t.width,r=t==null?void 0:t.height;return{width:i,height:r}}convertSimulcastLayers(e){return Xe(ce({},e),{layers:(e.layers||[]).map(t=>Xe(ce({},t),{maxBitrate:t.maxBitrate*1e3}))})}setVideoSimulcastLayers(e){this.videoLayers=this.convertSimulcastLayers(e)}setScreenshareSimulcastLayers(e){this.screenshareLayers=this.convertSimulcastLayers(e)}getSimulcastDefinitionsForPeer(e,t){var i;if(!e.role)return[];let r=this.getPolicyForRole(e.role.name).publishParams,n;t==="regular"?n=r.videoSimulcastLayers:t==="screen"&&(n=r.screenSimulcastLayers);let s=n==null?void 0:n.width,a=n==null?void 0:n.height;return((i=n==null?void 0:n.layers)==null?void 0:i.map(o=>{let l=yu[o.rid],c={width:s&&o.scaleResolutionDownBy?s/o.scaleResolutionDownBy:void 0,height:a&&o.scaleResolutionDownBy?a/o.scaleResolutionDownBy:void 0};return{layer:l,resolution:c}}))||[]}cleanUp(){let e=this.getTracks();for(let t of e)t.cleanup();this.room=void 0,this.config=void 0,this.localPeerId=void 0,this.roleDetailsArrived=!1}setErrorListener(e){this.errorListener=e}updatePeersPolicy(){this.getPeers().forEach(e=>{var t;if(!e.role){(t=this.errorListener)==null||t.onError(K.GenericErrors.InvalidRole(H.VALIDATION,""));return}e.role=this.getPolicyForRole(e.role.name)})}setEnv(){var e;let t=((e=this.config)==null?void 0:e.initEndpoint).split("https://")[1],i=ft.PROD;t.startsWith(ft.PROD)?i=ft.PROD:t.startsWith(ft.QA)?i=ft.QA:t.startsWith(ft.DEV)&&(i=ft.DEV),this.env=i,Mr.setEnv(i)}},sa="AnalyticsEventsService",Ju=class{constructor(e){this.store=e,this.bufferSize=il,this.transport=null,this.pendingEvents=[],this.level=Cn.INFO}setTransport(e){this.transport=e}reset(){this.transport=null,this.pendingEvents=[]}queue(e){if(e.level>=this.level&&(this.pendingEvents.push(e),this.pendingEvents.length>this.bufferSize)){let t=this.pendingEvents.shift();y.d(sa,"Max buffer size reached","Removed event to accommodate new events",t)}return this}flushFailedClientEvents(){Mr.flushFailedEvents()}flush(){var e;try{for(;this.pendingEvents.length>0;){let t=this.pendingEvents.shift();t&&(t.metadata.peer.peer_id=(e=this.store.getLocalPeer())==null?void 0:e.peerId,t.metadata.userAgent=this.store.getUserAgent(),this.transport&&this.transport.transportProvider.isConnected?this.transport.sendEvent(t):this.sendClientEventOnHTTP(t))}}catch(t){y.w(sa,"Flush Failed",t)}}sendClientEventOnHTTP(e){var t,i,r,n;let s=this.store.getRoom(),a=this.store.getLocalPeer();e.metadata.token=(t=this.store.getConfig())==null?void 0:t.authToken,e.metadata.peer={session_id:s.sessionId,room_id:s.id,room_name:s.name,template_id:s.templateId,joined_at:(i=s.joinedAt)==null?void 0:i.getTime(),session_started_at:(r=s.startedAt)==null?void 0:r.getTime(),role:(n=a==null?void 0:a.role)==null?void 0:n.name,user_name:a==null?void 0:a.name,user_data:a==null?void 0:a.metadata},Mr.sendEvent(e)}},aa={autoplayFailed:void 0,initialized:!1,autoplayCheckPromise:void 0},Qu=class{constructor(e,t,i){this.store=e,this.deviceManager=t,this.eventBus=i,this.autoPausedTracks=new Set,this.TAG="[AudioSinkManager]:",this.volume=100,this.state=ce({},aa),this.handleAudioPaused=r=>{var n;let s=(n=r.target.srcObject)==null?void 0:n.getAudioTracks()[0];if(!(s!=null&&s.enabled))return;y.d(this.TAG,"Audio Paused",r.target.id);let a=this.store.getTrackById(r.target.id);a&&(su()?setTimeout(()=>T(this,null,function*(){a&&(yield this.playAudioFor(a))}),500):this.autoPausedTracks.add(a))},this.handleTrackUpdate=({track:r,enabled:n})=>{var s;(s=window.HMS)!=null&&s.AUDIO_SINK&&(n?(r.addSink(),this.playAudioFor(r)):r.removeSink()),y.d(this.TAG,"Track updated",`${r}`)},this.handleTrackAdd=r=>T(this,[r],function*({track:n,peer:s}){var a,o,l;let c=document.createElement("audio");c.style.display="none",c.id=n.trackId,c.addEventListener("pause",this.handleAudioPaused),n.setAudioElement(c),n.setVolume(this.volume),y.d(this.TAG,"Audio track added",`${n}`),(a=this.audioSink)==null||a.append(c),this.outputDevice&&(yield n.setOutputDevice(this.outputDevice)),(o=window.HMS)!=null&&o.AUDIO_SINK?n.enabled?n.addSink():n.removeSink():c.srcObject=new MediaStream([n.nativeTrack]),(l=this.listener)==null||l.onTrackUpdate(Ce.TRACK_ADDED,n,s),yield this.handleAutoplayError(n)}),this.handleAutoplayError=r=>T(this,null,function*(){if(this.state.autoplayFailed===void 0&&(this.state.autoplayCheckPromise||(this.state.autoplayCheckPromise=new Promise(n=>{this.playAudioFor(r).then(n)})),yield this.state.autoplayCheckPromise),this.state.autoplayFailed){this.autoPausedTracks.add(r);return}yield this.playAudioFor(r)}),this.handleAudioDeviceChange=r=>{r.error||!r.selection||r.type==="video"||this.unpauseAudioTracks()},this.handleTrackRemove=r=>{this.autoPausedTracks.delete(r);let n=document.getElementById(r.trackId);n&&(n.removeEventListener("pause",this.handleAudioPaused),n.srcObject=null,n.remove(),r.setAudioElement(null)),this.audioSink&&this.audioSink.childElementCount===0&&(this.state.autoplayCheckPromise=void 0,this.state.autoplayFailed=void 0),y.d(this.TAG,"Audio track removed",`${r}`)},this.unpauseAudioTracks=()=>T(this,null,function*(){let r=[];this.autoPausedTracks.forEach(n=>{r.push(this.playAudioFor(n))}),yield Promise.all(r)}),this.eventBus.audioTrackAdded.subscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.subscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.subscribe(this.handleTrackUpdate),this.eventBus.deviceChange.subscribe(this.handleAudioDeviceChange)}setListener(e){this.listener=e}get outputDevice(){return this.deviceManager.outputDevice}getVolume(){return this.volume}setVolume(e){this.store.updateAudioOutputVolume(e),this.volume=e}unblockAutoplay(){return T(this,null,function*(){this.autoPausedTracks.size>0&&this.unpauseAudioTracks()})}init(e){if(this.state.initialized)return;this.state.initialized=!0;let t=document.createElement("div");t.id=`HMS-SDK-audio-sink-${Ci()}`,(e&&document.getElementById(e)||document.body).append(t),this.audioSink=t}cleanUp(){var e;(e=this.audioSink)==null||e.remove(),this.audioSink=void 0,this.eventBus.audioTrackAdded.unsubscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.unsubscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.unsubscribe(this.handleTrackUpdate),this.eventBus.deviceChange.unsubscribe(this.handleAudioDeviceChange),this.autoPausedTracks=new Set,this.state=ce({},aa)}playAudioFor(e){return T(this,null,function*(){let t=e.getAudioElement();if(!t){y.w(this.TAG,"No audio element found on track",e.trackId);return}try{yield t.play(),this.state.autoplayFailed=!1,this.autoPausedTracks.delete(e),y.d(this.TAG,"Played track",`${e}`)}catch(i){this.autoPausedTracks.add(e),y.e(this.TAG,"Failed to play track",`${e}`,i);let r=i;if(!this.state.autoplayFailed&&r.name==="NotAllowedError"){this.state.autoplayFailed=!0;let n=K.TracksErrors.AutoplayBlocked(H.AUTOPLAY,"");n.addNativeError(r),this.eventBus.analytics.publish($e.autoplayError()),this.eventBus.autoplayError.publish(n)}}})}},Yu=class{constructor(e,t){this.store=e,this.eventBus=t,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.hasWebcamPermission=!1,this.hasMicrophonePermission=!1,this.TAG="[Device Manager]:",this.initialized=!1,this.videoInputChanged=!1,this.audioInputChanged=!1,this.updateOutputDevice=r=>T(this,null,function*(){let n=this.audioOutput.find(s=>s.deviceId===r);return n&&(this.outputDevice=n,yield this.store.updateAudioOutputDevice(n),Zt.updateSelection("audioOutput",{deviceId:n.deviceId,groupId:n.groupId})),n}),this.getCurrentSelection=()=>{var r,n;let s=this.store.getLocalPeer(),a=this.createIdentifier((r=s==null?void 0:s.audioTrack)==null?void 0:r.getMediaTrackSettings()),o=this.createIdentifier((n=s==null?void 0:s.videoTrack)==null?void 0:n.getMediaTrackSettings()),l=this.audioInput.find(u=>this.createIdentifier(u)===a),c=this.videoInput.find(u=>this.createIdentifier(u)===o);return{audioInput:l,videoInput:c,audioOutput:this.outputDevice}},this.computeChange=(r,n)=>r.length!==n.length?!0:n.some(s=>!r.includes(this.createIdentifier(s))),this.enumerateDevices=()=>T(this,null,function*(){try{let r=yield navigator.mediaDevices.enumerateDevices(),n=this.videoInput.map(this.createIdentifier),s=this.audioInput.map(this.createIdentifier);this.audioInput=[],this.audioOutput=[],this.videoInput=[],r.forEach(a=>{a.kind==="audioinput"&&a.label?(this.hasMicrophonePermission=!0,this.audioInput.push(a)):a.kind==="audiooutput"?this.audioOutput.push(a):a.kind==="videoinput"&&a.label&&(this.hasWebcamPermission=!0,this.videoInput.push(a))}),this.videoInputChanged=this.computeChange(n,this.videoInput),this.audioInputChanged=this.computeChange(s,this.audioInput),Zt.setDevices({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput]}),this.logDevices("Enumerate Devices")}catch(r){y.e(this.TAG,"Failed enumerating devices",r)}}),this.handleDeviceChange=()=>T(this,null,function*(){yield this.enumerateDevices(),this.logDevices("After Device Change");let r=this.store.getLocalPeer();yield this.setOutputDevice(!0),yield this.handleAudioInputDeviceChange(r==null?void 0:r.audioTrack),yield this.handleVideoInputDeviceChange(r==null?void 0:r.videoTrack),this.eventBus.analytics.publish($e.deviceChange({selection:this.getCurrentSelection(),type:"change",devices:this.getDevices()}))}),this.handleAudioInputDeviceChange=r=>T(this,null,function*(){if(!r){y.d(this.TAG,"No Audio track on local peer");return}if(!this.audioInputChanged){y.d(this.TAG,"No Change in AudioInput Device");return}let n=this.getNewAudioInputDevice();if(!n||!n.deviceId){this.eventBus.analytics.publish($e.deviceChange({selection:{audioInput:n},error:new Error("Audio device not found"),devices:this.getDevices(),type:"audioInput"})),y.w(this.TAG,"Audio device not found");return}let{settings:s}=r,a=new Wi().codec(s.codec).maxBitrate(s.maxBitrate).deviceId(n.deviceId).build();try{yield r.setSettings(a,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"audioInput"}),this.logDevices("Audio Device Change Success")}catch(o){y.e(this.TAG,"[Audio Device Change]",o),this.eventBus.analytics.publish($e.deviceChange({selection:{audioInput:n},devices:this.getDevices(),type:"audioInput",error:o})),this.eventBus.deviceChange.publish({error:o,selection:n,type:"audioInput",devices:this.getDevices()})}}),this.handleVideoInputDeviceChange=r=>T(this,null,function*(){if(!r){y.d(this.TAG,"No video track on local peer");return}if(!this.videoInputChanged){y.d(this.TAG,"No Change in VideoInput Device");return}let n=this.videoInput[0];if(!n||!n.deviceId){this.eventBus.analytics.publish($e.deviceChange({selection:{videoInput:n},error:new Error("Video device not found"),devices:this.getDevices(),type:"video"})),y.w(this.TAG,"Video device not found");return}let{settings:s}=r,a=new ki().codec(s.codec).maxBitrate(s.maxBitrate).maxFramerate(s.maxFramerate).setWidth(s.width).setHeight(s.height).deviceId(n.deviceId).build();try{yield r.setSettings(a,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"video"}),this.logDevices("Video Device Change Success")}catch(o){y.e(this.TAG,"[Video Device Change]",o),this.eventBus.analytics.publish($e.deviceChange({selection:{videoInput:n},devices:this.getDevices(),type:"video",error:o})),this.eventBus.deviceChange.publish({error:o,type:"video",selection:n,devices:this.getDevices()})}});let i=({enabled:r,track:n})=>r&&n.source==="regular";this.eventBus.localVideoEnabled.waitFor(i).then(()=>T(this,null,function*(){yield this.enumerateDevices(),this.videoInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()})})),this.eventBus.localAudioEnabled.waitFor(i).then(()=>T(this,null,function*(){yield this.enumerateDevices(),this.audioInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()})}))}init(e=!1){return T(this,null,function*(){this.initialized&&!e||(!this.initialized&&navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),this.initialized=!0,yield this.enumerateDevices(),this.logDevices("Init"),yield this.setOutputDevice(),this.eventBus.deviceChange.publish({devices:this.getDevices()}),this.eventBus.analytics.publish($e.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()})))})}getDevices(){return{audioInput:this.audioInput,audioOutput:this.audioOutput,videoInput:this.videoInput}}cleanUp(){this.initialized=!1,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.outputDevice=void 0,navigator.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange)}createIdentifier(e){return e?`${e.deviceId}${e.groupId}`:""}getNewAudioInputDevice(){let e=this.audioInput.find(t=>t.deviceId==="default");return e?this.audioInput.find(t=>t.label!==e.label&&e.label.includes(t.label)):this.audioInput[0]}setOutputDevice(e=!1){return T(this,null,function*(){let t=this.getNewAudioInputDevice(),i=this.createIdentifier(this.outputDevice);this.outputDevice=this.getAudioOutputDeviceMatchingInput(t),this.outputDevice||(this.outputDevice=this.audioOutput.find(r=>this.createIdentifier(r)===i),this.outputDevice||(this.outputDevice=this.audioOutput.find(r=>r.deviceId==="default")||this.audioOutput[0])),yield this.store.updateAudioOutputDevice(this.outputDevice),e&&i!==this.createIdentifier(this.outputDevice)&&(this.eventBus.analytics.publish($e.deviceChange({selection:{audioOutput:this.outputDevice},devices:this.getDevices(),type:"audioOutput"})),this.eventBus.deviceChange.publish({selection:this.outputDevice,type:"audioOutput",devices:this.getDevices()}))})}getAudioOutputDeviceMatchingInput(e){var t,i;let r=((i=(t=this.store.getConfig())==null?void 0:t.settings)==null?void 0:i.speakerAutoSelectionBlacklist)||[];if(r==="all")return;let n=(e==null?void 0:e.label.toLowerCase())||"";if(!r.some(s=>n.includes(s.toLowerCase()))&&(e==null?void 0:e.groupId))return this.audioOutput.find(s=>e.deviceId!=="default"&&s.label===e.label)}logDevices(e=""){y.d(this.TAG,e,JSON.stringify({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput],selected:this.getCurrentSelection()},null,4))}},Zu=class{constructor(e,t){this.deviceManager=e,this.audioSinkManager=t}getVolume(){return this.audioSinkManager.getVolume()}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.audioSinkManager.setVolume(e)}getDevice(){return this.deviceManager.outputDevice}setDevice(e){return this.deviceManager.updateOutputDevice(e)}unblockAutoplay(){return T(this,null,function*(){yield this.audioSinkManager.unblockAutoplay()})}},st=class{constructor(e,t){this.eventName=e,this.eventEmitter=t,this.publish=i=>{this.eventEmitter.emit(this.eventName,i)},this.subscribe=i=>{this.eventEmitter.on(this.eventName,i)},this.subscribeOnce=i=>{this.eventEmitter.once(this.eventName,i)},this.unsubscribe=i=>{this.eventEmitter.off(this.eventName,i)},this.waitFor=i=>this.eventEmitter.waitFor(this.eventName,{filter:i}),this.removeAllListeners=()=>{this.eventEmitter.removeAllListeners(this.eventName)}}},Xu=class{constructor(){this.eventEmitter=new qr.exports.EventEmitter2,this.deviceChange=new st(nt.DEVICE_CHANGE,this.eventEmitter),this.localAudioEnabled=new st(nt.LOCAL_AUDIO_ENABLED,this.eventEmitter),this.localVideoEnabled=new st(nt.LOCAL_VIDEO_ENABLED,this.eventEmitter),this.statsUpdate=new st(nt.STATS_UPDATE,this.eventEmitter),this.trackDegraded=new st(nt.TRACK_DEGRADED,this.eventEmitter),this.trackRestored=new st(nt.TRACK_RESTORED,this.eventEmitter),this.trackAudioLevelUpdate=new st(nt.TRACK_AUDIO_LEVEL_UPDATE,this.eventEmitter),this.audioPluginFailed=new st(nt.AUDIO_PLUGIN_FAILED,this.eventEmitter),this.localAudioSilence=new st(nt.LOCAL_AUDIO_SILENCE,this.eventEmitter),this.analytics=new st(nt.ANALYTICS,this.eventEmitter),this.policyChange=new st(nt.POLICY_CHANGE,this.eventEmitter),this.localRoleUpdate=new st(nt.LOCAL_ROLE_UPDATE,this.eventEmitter),this.audioTrackUpdate=new st(nt.AUDIO_TRACK_UPDATE,this.eventEmitter),this.audioTrackAdded=new st(nt.AUDIO_TRACK_ADDED,this.eventEmitter),this.audioTrackRemoved=new st(nt.AUDIO_TRACK_REMOVED,this.eventEmitter),this.autoplayError=new st(nt.AUTOPLAY_ERROR,this.eventEmitter)}},ed=class{constructor(e,t,i){this.store=e,this.listener=t,this.audioListener=i}handleActiveSpeakers(e){var t,i,r;let n=e["speaker-list"],s=n.map(o=>({audioLevel:o.level,peer:this.store.getPeerById(o.peer_id),track:this.store.getTrackById(o.track_id)}));(t=this.audioListener)==null||t.onAudioLevelUpdate(s),this.store.updateSpeakers(s);let a=n[0];if(a){let o=this.store.getPeerById(a.peer_id);(i=this.listener)==null||i.onPeerUpdate(Qe.BECAME_DOMINANT_SPEAKER,o)}else(r=this.listener)==null||r.onPeerUpdate(Qe.RESIGNED_DOMINANT_SPEAKER,null)}},Te;(function(e){e.ROOM_STATE="room-state",e.PEER_JOIN="on-peer-join",e.PEER_LEAVE="on-peer-leave",e.PEER_LIST="peer-list",e.TRACK_METADATA_ADD="on-track-add",e.TRACK_UPDATE="on-track-update",e.CHANGE_TRACK_MUTE_STATE_UPDATE="on-change-track-mute-state-request",e.ACTIVE_SPEAKERS="active-speakers",e.CONNECTION_QUALITY="on-connection-quality-update",e.SFU_STATS="sfu-stats",e.ON_SFU_TRACK_LAYER_UPDATE="on-track-layer-update",e.BROADCAST="on-broadcast",e.ROLE_CHANGE="on-role-change",e.POLICY_CHANGE="on-policy-change",e.ROLE_CHANGE_REQUEST="on-role-change-request",e.TRACK_UPDATE_REQUEST="on-track-update-request",e.PEER_UPDATE="on-peer-update",e.PEER_LEAVE_REQUEST="on-peer-leave-request",e.UNSUPPORTED="unsupported",e.RTMP_START="on-rtmp-start",e.RTMP_STOP="on-rtmp-stop",e.RECORDING_START="on-record-start",e.RECORDING_STOP="on-record-stop",e.HLS_START="on-hls-start",e.HLS_STOP="on-hls-stop"})(Te||(Te={}));var td=class{constructor(e,t){this.store=e,this.listener=t}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t){e===Te.BROADCAST&&this.handleBroadcast(t)}handleBroadcast(e){var t;let i=e.peer,r=e.info,n=e.roles,s=this.getSender(i),a=e.private?this.store.getLocalPeer():void 0,o=[];if(n!=null&&n.length){let c=this.store.getKnownRoles();for(let u of n)c[u]&&o.push(c[u])}let l=new Qo(Xe(ce({},r),{sender:s,recipientRoles:o,recipientPeer:a,time:new Date(e.timestamp)}));y.d(this.TAG,`Received Message from sender=${i==null?void 0:i.peer_id}: ${l}`),(t=this.listener)==null||t.onMessageReceived(l)}getSender(e){let t=e?this.store.getPeerById(e.peer_id):void 0;return!t&&e&&(t=new is({peerId:e.peer_id,name:e.info.name,isLocal:!1,customerUserId:e.info.user_id,metadata:e.info.data})),t}},id=class{constructor(e){this.listener=e}handleQualityUpdate(e){var t;let i=e.peers.map(r=>({peerID:r.peer_id,downlinkQuality:r.downlink_score}));(t=this.listener)==null||t.onConnectionQualityUpdate(i)}},rd=class{constructor(e,t,i,r){this.store=e,this.peerManager=t,this.trackManager=i,this.listener=r,this.handleInitialPeerList=n=>{let s=Object.values(n.peers);this.peerManager.handlePeerList(s)},this.handleReconnectPeerList=n=>{this.handleRepeatedPeerList(n.peers)},this.handlePreviewRoomState=n=>{if(!this.store.hasRoleDetailsArrived())return;let s=n.peers;if(s==null){n.peer_count===0&&this.handleRepeatedPeerList({});return}Object.keys(s).forEach(a=>{s[a].tracks={},s[a].is_from_room_state=!0}),this.handleRepeatedPeerList(s)},this.handleRepeatedPeerList=n=>{let s=this.store.getRemotePeers(),a=Object.values(n),o=s.filter(l=>!n[l.peerId]);y.d(this.TAG,`${o}`),o.forEach(l=>{var c;let u={peer_id:l.peerId,role:((c=l.role)==null?void 0:c.name)||"",info:{name:l.name,data:l.metadata||"",user_id:l.customerUserId||""},tracks:{}};this.peerManager.handlePeerLeave(u)}),a.forEach(l=>{let c=this.store.getPeerById(l.peer_id),u=Object.values(l.tracks);c?(this.store.getPeerTracks(c.peerId).forEach(d=>{var h;l.tracks[d.trackId]||(this.removePeerTrack(c,d.trackId),(h=this.listener)==null||h.onTrackUpdate(Ce.TRACK_REMOVED,d,c))}),u.forEach(d=>{this.store.getTrackById(d.track_id)||this.store.setTrackState({peerId:c.peerId,trackInfo:d})}),this.trackManager.handleTrackUpdate({peer:{info:l.info,peer_id:l.peer_id},tracks:l.tracks}),this.peerManager.handlePeerUpdate(l)):this.peerManager.handlePeerJoin(l)})}}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t,i){if(e===Te.PEER_LIST){let r=t;i?(y.d(this.TAG,"RECONNECT_PEER_LIST event",JSON.stringify(r,null,2)),this.handleReconnectPeerList(r)):(y.d(this.TAG,"PEER_LIST event",JSON.stringify(r,null,2)),this.handleInitialPeerList(r))}else if(e===Te.ROOM_STATE){let r=t;this.handlePreviewRoomState(r)}}removePeerTrack(e,t){var i,r;if(((i=e.audioTrack)==null?void 0:i.trackId)===t)e.audioTrack=void 0;else if(((r=e.videoTrack)==null?void 0:r.trackId)===t)e.videoTrack=void 0;else{let n=e.auxiliaryTracks.findIndex(s=>s.trackId===t);n>=0&&e.auxiliaryTracks.splice(n,1)}}},Ct=e=>e?new Date(e):void 0,nd=class{constructor(e,t,i){this.store=e,this.trackManager=t,this.listener=i,this.handlePeerList=r=>{var n,s;if(r.length===0){(n=this.listener)==null||n.onPeerUpdate(Qe.PEER_LIST,[]);return}let a=[],o=new Set(r.map(l=>l.peer_id));this.store.getRemotePeers().forEach(({peerId:l,fromRoomState:c})=>{!o.has(l)&&c&&this.store.removePeer(l)});for(let l of r)a.push(this.makePeer(l));(s=this.listener)==null||s.onPeerUpdate(Qe.PEER_LIST,a),this.trackManager.processPendingTracks()},this.handlePeerJoin=r=>{var n;let s=this.makePeer(r);(n=this.listener)==null||n.onPeerUpdate(Qe.PEER_JOINED,s),this.trackManager.processPendingTracks()},this.handlePeerLeave=r=>{var n,s,a,o;let l=this.store.getPeerById(r.peer_id);this.store.removePeer(r.peer_id),y.d(this.TAG,"PEER_LEAVE",r.peer_id,`remainingPeers=${this.store.getPeers().length}`),l&&(l.audioTrack&&((n=this.listener)==null||n.onTrackUpdate(Ce.TRACK_REMOVED,l.audioTrack,l)),l.videoTrack&&((s=this.listener)==null||s.onTrackUpdate(Ce.TRACK_REMOVED,l.videoTrack,l)),(a=l.auxiliaryTracks)==null||a.forEach(c=>{var u;(u=this.listener)==null||u.onTrackUpdate(Ce.TRACK_REMOVED,c,l)}),(o=this.listener)==null||o.onPeerUpdate(Qe.PEER_LEFT,l))}}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t){switch(e){case Te.PEER_JOIN:{let i=t;this.handlePeerJoin(i);break}case Te.PEER_LEAVE:{let i=t;this.handlePeerLeave(i);break}case Te.PEER_UPDATE:this.handlePeerUpdate(t);break}}handlePeerUpdate(e){var t;let i=this.store.getPeerById(e.peer_id);if(i){if(i.role&&i.role.name!==e.role){let r=this.store.getPolicyForRole(e.role);i.updateRole(r),(t=this.listener)==null||t.onPeerUpdate(Qe.ROLE_UPDATED,i)}this.handlePeerInfoUpdate(ce({peer:i},e.info))}}handlePeerInfoUpdate({peer:e,name:t,data:i}){var r,n;!e||(t&&e.name!==t&&(e.updateName(t),(r=this.listener)==null||r.onPeerUpdate(Qe.NAME_UPDATED,e)),i&&e.metadata!==i&&(e.updateMetadata(i),(n=this.listener)==null||n.onPeerUpdate(Qe.METADATA_UPDATED,e)))}makePeer(e){let t=new pu({peerId:e.peer_id,name:e.info.name,customerUserId:e.info.user_id,metadata:e.info.data,role:this.store.getPolicyForRole(e.role),joinedAt:Ct(e.joined_at),fromRoomState:!!e.is_from_room_state});this.store.addPeer(t),y.d(this.TAG,"adding to the peerList",t.toString());for(let i in e.tracks)this.store.setTrackState({peerId:e.peer_id,trackInfo:e.tracks[i]});return t}},sd=class{constructor(e,t){this.store=e,this.eventBus=t}handlePolicyChange(e){var t;let i=this.store.getLocalPeer();if(i&&!i.role){let n=e.known_roles[e.name];i.updateRole(n)}this.store.setKnownRoles(e.known_roles),this.store.getRoom().templateId=e.template_id;let r=(t=e.known_roles[e.name])==null?void 0:t.publishParams;if(this.store.setPublishParams(r),this.setSimulcastLayers(r),(i==null?void 0:i.role)&&i.role.name!==e.name){let n=this.store.getPolicyForRole(e.name),s=i.role;i.updateRole(n),this.eventBus.localRoleUpdate.publish({oldRole:s,newRole:n})}this.eventBus.policyChange.publish(e)}setSimulcastLayers(e){if(e&&Object.keys(e).length>0){let{videoSimulcastLayers:t,screenSimulcastLayers:i}=e;this.store.setVideoSimulcastLayers(t),this.store.setScreenshareSimulcastLayers(i)}}},ad=class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){switch(e){case Te.ROLE_CHANGE_REQUEST:this.handleRoleChangeRequest(t);break;case Te.TRACK_UPDATE_REQUEST:this.handleTrackUpdateRequest(t);break;case Te.CHANGE_TRACK_MUTE_STATE_UPDATE:this.handleChangeTrackStateRequest(t);break;default:return}}handleRoleChangeRequest(e){var t;let i={requestedBy:e.requested_by?this.store.getPeerById(e.requested_by):void 0,role:this.store.getPolicyForRole(e.role),token:e.token};(t=this.listener)==null||t.onRoleChangeRequest(i)}handleTrackUpdateRequest(e){let{requested_by:t,track_id:i,mute:r}=e,n=t?this.store.getPeerById(t):void 0,s=this.store.getLocalPeerTracks().find(o=>o.publishedTrackId===i);if(!s)return;let a=()=>{var o;(o=this.listener)==null||o.onChangeTrackStateRequest({requestedBy:n,track:s,enabled:!r})};if(r){if(s.enabled===!r)return;s.setEnabled(!r).then(a)}else a()}handleChangeTrackStateRequest(e){var t;let{type:i,source:r,value:n,requested_by:s}=e,a=s?this.store.getPeerById(s):void 0,o=!n,l=this.getTracksToBeUpdated({type:i,source:r,enabled:o});if(l.length!==0)if(o)(t=this.listener)==null||t.onChangeMultiTrackStateRequest({requestedBy:a,tracks:l,type:i,source:r,enabled:!0});else{let c=[];for(let u of l)c.push(u.setEnabled(!1));Promise.all(c).then(()=>{var u;(u=this.listener)==null||u.onChangeMultiTrackStateRequest({requestedBy:a,tracks:l,enabled:!1})})}}getTracksToBeUpdated({type:e,source:t,enabled:i}){let r=this.store.getLocalPeerTracks();return e&&(r=r.filter(n=>n.type===e)),t&&(r=r.filter(n=>n.source===t)),r.filter(n=>n.enabled!==i)}},od=class{constructor(e,t){this.store=e,this.listener=t,this.TAG="RoomUpdateManager"}handleNotification(e,t){switch(e){case Te.PEER_LIST:this.onRoomState(t.room);break;case Te.RTMP_START:this.onRTMPStart(t);break;case Te.RTMP_STOP:this.onRTMPStop(t);break;case Te.RECORDING_START:this.onRecordingStart(t);break;case Te.RECORDING_STOP:this.onRecordingStop(t);break;case Te.ROOM_STATE:this.handlePreviewRoomState(t);break;default:this.onHLS(e,t);break}}handlePreviewRoomState(e){let{room:t}=e;this.onRoomState(t,e.peer_count)}onRoomState(e,t){var i,r,n;let{recording:s,streaming:a,session_id:o,started_at:l,name:c}=e,u=this.store.getRoom();u.peerCount=t,u.name=c,u.recording.server.running=!!(s!=null&&s.sfu.enabled),u.recording.browser.running=!!(s!=null&&s.browser.enabled),u.rtmp.running=!!((i=a==null?void 0:a.rtmp)!=null&&i.enabled),u.rtmp.startedAt=Ct((r=a==null?void 0:a.rtmp)==null?void 0:r.started_at),u.recording.server.startedAt=Ct(s==null?void 0:s.sfu.started_at),u.recording.browser.startedAt=Ct(s==null?void 0:s.browser.started_at),u.recording.hls=this.getPeerListHLSRecording(s),u.hls=this.convertHls(a==null?void 0:a.hls),u.sessionId=o,u.startedAt=Ct(l),(n=this.listener)==null||n.onRoomUpdate(ni.RECORDING_STATE_UPDATED,u)}onRTMPStart(e){var t;this.setRTMPStatus(!((t=e.error)!=null&&t.code),e)}onRTMPStop(e){this.setRTMPStatus(!1,e)}onRecordingStart(e){var t;this.setRecordingStatus(!((t=e.error)!=null&&t.code),e)}onRecordingStop(e){this.setRecordingStatus(!1,e)}onHLS(e,t){var i,r;if(![Te.HLS_START,Te.HLS_STOP].includes(e))return;let n=this.store.getRoom();t.enabled=e===Te.HLS_START&&!((i=t.error)!=null&&i.code),n.hls=this.convertHls(t),n.recording.hls=this.getHLSRecording(t),(r=this.listener)==null||r.onRoomUpdate(ni.HLS_STREAMING_STATE_UPDATED,n)}convertHls(e){var t;let i={running:!!(e!=null&&e.enabled),variants:[],error:this.toSdkError(e==null?void 0:e.error)};return(t=e==null?void 0:e.variants)==null||t.forEach(r=>{i.variants.push({meetingURL:r.meeting_url,url:r.url,metadata:r.metadata,startedAt:Ct(r.started_at)})}),i}getHLSRecording(e){var t,i,r;let n={running:!1};return e!=null&&e.hls_recording&&(n={running:!!(e!=null&&e.enabled),singleFilePerLayer:!!((t=e.hls_recording)!=null&&t.single_file_per_layer),hlsVod:!!((i=e.hls_recording)!=null&&i.hls_vod),startedAt:Ct((r=e==null?void 0:e.variants)==null?void 0:r[0].started_at),error:this.toSdkError(e.error)}),n}getPeerListHLSRecording(e){var t,i;let r=e==null?void 0:e.hls;return{running:!!(r!=null&&r.enabled),startedAt:Ct(r==null?void 0:r.started_at),singleFilePerLayer:!!((t=r==null?void 0:r.config)!=null&&t.single_file_per_layer),hlsVod:!!((i=r==null?void 0:r.config)!=null&&i.hls_vod)}}setRecordingStatus(e,t){var i;let r=this.store.getRoom(),n;t.type==="sfu"?(r.recording.server={running:e,startedAt:e?Ct(t.started_at):void 0,error:this.toSdkError(t.error)},n=ni.SERVER_RECORDING_STATE_UPDATED):(r.recording.browser={running:e,startedAt:e?Ct(t.started_at):void 0,error:this.toSdkError(t.error)},n=ni.BROWSER_RECORDING_STATE_UPDATED),(i=this.listener)==null||i.onRoomUpdate(n,r)}setRTMPStatus(e,t){var i;let r=this.store.getRoom();r.rtmp={running:e,startedAt:e?Ct(t.started_at):void 0,error:this.toSdkError(t.error)},(i=this.listener)==null||i.onRoomUpdate(ni.RTMP_STREAMING_STATE_UPDATED,r)}toSdkError(e){if(!(e!=null&&e.code))return;let t=e.message||"error in streaming/recording",i=new te(e.code,"ServerErrors",H.NONE,t,t);return y.e(this.TAG,"error in streaming/recording",i),i}},ld=class{constructor(e,t,i){this.store=e,this.eventBus=t,this.listener=i,this.tracksToProcess=new Map,this.handleTrackAdd=r=>{y.d(this.TAG,"ONTRACKADD",`${r}`),this.store.addTrack(r),this.tracksToProcess.set(r.trackId,r),this.processPendingTracks()},this.handleTrackRemove=r=>{var n;y.d(this.TAG,"ONTRACKREMOVE",`${r}`);let s=this.store.getTrackState(r.trackId);if(!s)return;r.type===Ve.AUDIO&&this.eventBus.audioTrackRemoved.publish(r);let a=this.store.getPeerById(s.peerId);!a||(this.removePeerTracks(a,r),this.store.removeTrack(r.trackId),(n=this.listener)==null||n.onTrackUpdate(Ce.TRACK_REMOVED,r,a))},this.handleTrackLayerUpdate=r=>{var n,s;for(let a in r.tracks){let o=r.tracks[a],l=this.store.getTrackById(a);if(!l)continue;let c=this.store.getPeerByTrackId(a);if(!!c&&l instanceof di){let u=this.isTrackDegraded(o.expected_layer,o.current_layer);l.setLayerFromServer(o.current_layer,u),u?(n=this.listener)==null||n.onTrackUpdate(Ce.TRACK_DEGRADED,l,c):(s=this.listener)==null||s.onTrackUpdate(Ce.TRACK_RESTORED,l,c)}}},this.handleTrackUpdate=r=>{var n,s;let a=this.store.getPeerById(r.peer.peer_id);if(a)for(let o in r.tracks){let l=Object.assign({},(n=this.store.getTrackState(o))==null?void 0:n.trackInfo),c=r.tracks[o],u=this.store.getTrackById(o);if(this.store.setTrackState({peerId:r.peer.peer_id,trackInfo:ce(ce({},l),c)}),!u||this.tracksToProcess.has(o))this.processPendingTracks();else{u.setEnabled(!c.mute);let d=this.processTrackUpdate(u,l,c);d&&((s=this.listener)==null||s.onTrackUpdate(d,u,a))}}}}get TAG(){return`[${this.constructor.name}]`}isTrackDegraded(e,t){let i=r=>{switch(r){case mt.HIGH:return 3;case mt.MEDIUM:return 2;case mt.LOW:return 1;case mt.NONE:return 0}};return i(t)<i(e)}handleTrackMetadataAdd(e){y.d(this.TAG,"TRACK_METADATA_ADD",JSON.stringify(e,null,2));for(let t in e.tracks)this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:e.tracks[t]});this.processPendingTracks()}processPendingTracks(){new Map(this.tracksToProcess).forEach(e=>{var t;let i=this.store.getTrackState(e.trackId);if(!i)return;let r=this.store.getPeerById(i.peerId);!r||(e.source=i.trackInfo.source,e.peerId=r.peerId,e.logIdentifier=r.name,e.setEnabled(!i.trackInfo.mute),this.addAudioTrack(r,e),this.addVideoTrack(r,e),e.type===Ve.AUDIO?this.eventBus.audioTrackAdded.publish({track:e,peer:r}):(t=this.listener)==null||t.onTrackUpdate(Ce.TRACK_ADDED,e,r),this.tracksToProcess.delete(e.trackId))})}removePeerTracks(e,t){var i,r;let n=e.auxiliaryTracks.indexOf(t);n>-1?e.auxiliaryTracks.splice(n,1):t.type===Ve.AUDIO&&((i=e.audioTrack)==null?void 0:i.trackId)===t.trackId?e.audioTrack=void 0:t.type===Ve.VIDEO&&((r=e.videoTrack)==null?void 0:r.trackId)===t.trackId&&(e.videoTrack=void 0)}addAudioTrack(e,t){t.type===Ve.AUDIO&&(!e.audioTrack&&t.source==="regular"?e.audioTrack=t:e.auxiliaryTracks.push(t))}addVideoTrack(e,t){if(t.type!==Ve.VIDEO)return;let i=t,r=this.store.getSimulcastDefinitionsForPeer(e,i.source);i.setSimulcastDefinitons(r),!e.videoTrack&&t.source==="regular"?e.videoTrack=i:e.auxiliaryTracks.push(i)}processTrackUpdate(e,t,i){let r;return e.setEnabled(!i.mute),t.mute!==i.mute?(r=i.mute?Ce.TRACK_MUTED:Ce.TRACK_UNMUTED,e.type===Ve.AUDIO&&this.eventBus.audioTrackUpdate.publish({track:e,enabled:!i.mute})):t.description!==i.description&&(r=Ce.TRACK_DESCRIPTION_CHANGED),r}},cd=class{constructor(e,t,i,r,n){this.store=e,this.listener=i,this.audioListener=r,this.connectionQualityListener=n,this.TAG="[HMSNotificationManager]",this.hasConsistentRoomStateArrived=!1,this.ignoreNotification=s=>{if(s===Te.PEER_LIST)this.hasConsistentRoomStateArrived=!0;else if(s===Te.ROOM_STATE)return this.hasConsistentRoomStateArrived;return!1},this.handleTrackAdd=s=>{this.trackManager.handleTrackAdd(s)},this.handleTrackRemove=s=>{this.trackManager.handleTrackRemove(s)},this.updateLocalPeer=({name:s,metadata:a})=>{let o=this.store.getLocalPeer();this.peerManager.handlePeerInfoUpdate({peer:o,name:s,data:a})},this.trackManager=new ld(this.store,t,this.listener),this.peerManager=new nd(this.store,this.trackManager,this.listener),this.peerListManager=new rd(this.store,this.peerManager,this.trackManager,this.listener),this.broadcastManager=new td(this.store,this.listener),this.policyChangeManager=new sd(this.store,t),this.requestManager=new ad(this.store,this.listener),this.activeSpeakerManager=new ed(this.store,this.listener,this.audioListener),this.connectionQualityManager=new id(this.connectionQualityListener),this.roomUpdateManager=new od(this.store,this.listener)}setListener(e){this.listener=e,this.trackManager.listener=e,this.peerManager.listener=e,this.peerListManager.listener=e,this.broadcastManager.listener=e,this.requestManager.listener=e,this.activeSpeakerManager.listener=e,this.roomUpdateManager.listener=e}setAudioListener(e){this.audioListener=e,this.activeSpeakerManager.audioListener=e}setConnectionQualityListener(e){this.connectionQualityListener=e,this.connectionQualityManager.listener=e}handleNotification(e,t=!1){var i,r;let n=e.method,s=e.params;[Te.ACTIVE_SPEAKERS,Te.SFU_STATS,Te.CONNECTION_QUALITY].includes(n)||y.d(this.TAG,`Received notification - ${n}`,{notification:s}),n===Te.SFU_STATS&&((i=window.HMS)==null?void 0:i.ON_SFU_STATS)&&typeof((r=window.HMS)==null?void 0:r.ON_SFU_STATS)=="function"&&window.HMS.ON_SFU_STATS(e.params),!this.ignoreNotification(n)&&(this.roomUpdateManager.handleNotification(n,s),this.peerManager.handleNotification(n,s),this.requestManager.handleNotification(n,s),this.peerListManager.handleNotification(n,s,t),this.broadcastManager.handleNotification(n,s),this.handleIsolatedMethods(n,s))}handleIsolatedMethods(e,t){switch(e){case Te.TRACK_METADATA_ADD:{this.trackManager.handleTrackMetadataAdd(t);break}case Te.TRACK_UPDATE:{this.trackManager.handleTrackUpdate(t);break}case Te.ON_SFU_TRACK_LAYER_UPDATE:{this.trackManager.handleTrackLayerUpdate(t);break}case Te.ACTIVE_SPEAKERS:this.activeSpeakerManager.handleActiveSpeakers(t);break;case Te.CONNECTION_QUALITY:this.connectionQualityManager.handleQualityUpdate(t);break;case Te.POLICY_CHANGE:this.policyChangeManager.handlePolicyChange(t);break}}},oa=class{constructor(e){this.type=e.type,this.source=e.source||"regular",this.description="",e instanceof ss?(this.mute=!e.enabled,this.track_id=e.publishedTrackId,this.stream_id=e.stream.id):(this.mute=e.mute,this.track_id=e.track_id,this.stream_id=e.stream_id)}},nl=class{constructor(e){this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(e),this.source.connect(this.audioContext.destination)}resumeContext(){this.audioContext.state==="suspended"&&(y.d(this.TAG,"AudioContext is resumed"),this.audioContext.resume())}getAudioTrack(){return this.destinationNode&&this.source.disconnect(this.destinationNode),this.destinationNode=this.audioContext.createMediaStreamDestination(),this.source.connect(this.destinationNode),this.destinationNode.stream.getAudioTracks()[0]}cleanup(){this.audioContext.state!=="closed"&&this.audioContext.close()}get TAG(){return"AudioContextManager"}},cs=class extends qr.exports.EventEmitter2{on(e,t){return super.on(e,t)}off(e,t){return super.off(e,t)}emit(e,t){return super.emit(e,t)}listeners(e){return super.listeners(e)}},ud=class extends cs{constructor(){super(...arguments),this.audioElement=null,this.seeked=!1}play(e){return T(this,null,function*(){return this.audioElement=this.getAudioElement(),new Promise((t,i)=>{this.audioElement=this.getAudioElement(),this.audioElement.src=e,this.seeked=!1,this.audioElement.onerror=()=>{let r=`Error loading ${e}`;y.e(this.TAG,r),this.stop(),i(r)},this.audioElement.oncanplaythrough=()=>T(this,null,function*(){try{if(!this.audioElement)return;if(this.audioContextManager.resumeContext(),this.track)this.seeked?this.seeked=!1:(yield this.audioElement.play(),t([this.track]));else{yield this.audioElement.play();let r=this.audioContextManager.getAudioTrack();this.track=r,t([r])}}catch(r){y.e(this.TAG,"Error playing audio",e,r.message),i(r)}}),this.audioElement.onseeked=()=>{this.seeked=!0}})})}getTracks(){return this.track?[this.track.id]:[]}getElement(){return this.audioElement}stop(){var e,t,i;(e=this.audioElement)==null||e.pause(),(t=this.audioElement)==null||t.removeAttribute("src"),this.audioElement=null,(i=this.audioContextManager)==null||i.cleanup(),this.track=void 0}getAudioElement(){if(this.audioElement)return this.audioElement;let e=document.createElement("audio");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",t=>this.emit("progress",t)),e.addEventListener("ended",()=>{this.emit("ended",null)}),this.audioContextManager=new nl(e),e}get TAG(){return"PlaylistAudioManager"}},dd=class extends cs{constructor(){super(...arguments),this.videoElement=null,this.canvasContext=null,this.tracks=[],this.DEFAUL_FPS=24,this.seeked=!1,this.drawImage=()=>{var e,t,i;this.videoElement&&!this.videoElement.paused&&!this.videoElement.ended&&((i=this.canvasContext)==null||i.drawImage(this.videoElement,0,0,(e=this.canvas)==null?void 0:e.width,(t=this.canvas)==null?void 0:t.height),this.timer=setTimeout(()=>{this.drawImage()},1e3/this.DEFAUL_FPS))}}play(e){return this.videoElement=this.getVideoElement(),this.createCanvas(),new Promise((t,i)=>{this.videoElement=this.getVideoElement(),this.videoElement.src=e,this.seeked=!1,this.videoElement.onerror=()=>{let r=`Error loading ${e}`;y.e(this.TAG,r),this.stop(),i(r)},this.videoElement.oncanplaythrough=()=>T(this,null,function*(){var r,n,s;try{if(!this.videoElement)return;if(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight,this.tracks.length===0){this.clearCanvasAndTracks();let a=this.canvas.captureStream();if(!a){y.e(this.TAG,"Browser does not support captureStream");return}this.videoElement.onplay=this.drawImage,this.audioContextManager.resumeContext(),yield this.videoElement.play();let o=this.audioContextManager.getAudioTrack();a.addTrack(o),a.getTracks().forEach(l=>{this.tracks.push(l)}),t(this.tracks)}else this.seeked?(this.seeked=!1,(s=this.canvasContext)==null||s.drawImage(this.videoElement,0,0,(r=this.canvas)==null?void 0:r.width,(n=this.canvas)==null?void 0:n.height)):(yield this.videoElement.play(),t(this.tracks))}catch(a){y.e(this.TAG,"Error playing video",e,a.message),i(a)}}),this.videoElement.onseeked=()=>{this.seeked=!0}})}getTracks(){return this.tracks.map(e=>e.id)}getElement(){return this.videoElement}stop(){var e,t,i;(e=this.videoElement)==null||e.pause(),(t=this.videoElement)==null||t.removeAttribute("src"),this.videoElement=null,(i=this.audioContextManager)==null||i.cleanup(),this.clearCanvasAndTracks()}clearCanvasAndTracks(){var e;this.tracks=[],(e=this.canvasContext)==null||e.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(this.timer)}getVideoElement(){if(this.videoElement)return this.videoElement;let e=document.createElement("video");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",t=>this.emit("progress",t)),e.addEventListener("ended",()=>{this.emit("ended",null)}),this.audioContextManager=new nl(e),e}createCanvas(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"))}get TAG(){return"PlaylistVideoManager"}},lr={audio:{list:[],currentIndex:-1,isAutoplayOn:!0},video:{list:[],currentIndex:-1,isAutoplayOn:!0}},hd=class extends cs{constructor(e,t){super(),this.sdk=e,this.eventBus=t,this.state={audio:ce({},lr.audio),video:ce({},lr.video)},this.TAG="[PlaylistManager]",this.handlePausePlaylist=i=>T(this,[i],function*({enabled:r,track:n}){var s;if(r)return;let a;n.source==="audioplaylist"&&(a=pe.audio),n.source==="videoplaylist"&&(a=pe.video),a&&((s=this.getElement(a))==null||s.pause())}),this.addTrack=(i,r)=>T(this,null,function*(){yield this.sdk.addTrack(i,r),y.d(this.TAG,"Playlist track added",Ir(i))}),this.removeTrack=i=>T(this,null,function*(){yield this.sdk.removeTrack(i),y.d(this.TAG,"Playlist track removed",i)}),this.audioManager=new ud,this.videoManager=new dd,this.addListeners()}getList(e=pe.audio){return this.state[e].list}setList(e){if(!e||e.length===0){y.w(this.TAG,"Please pass in a list of HMSPlaylistItem's");return}e.forEach(t=>{this.state[t.type].list.includes(t)||this.state[t.type].list.push(t)})}clearList(e){return T(this,null,function*(){this.isPlaying(e)&&(yield this.stop(e)),this.state[e].list=[]})}removeItem(e,t){return T(this,null,function*(){let{list:i,currentIndex:r}=this.state[t],n=i.findIndex(s=>e===s.id);return n>-1?(r===n&&this.isPlaying(t)&&(yield this.stop(t)),i.splice(n,1),!0):!1})}seek(e,t=pe.audio){let{currentIndex:i}=this.state[t];if(i===-1)throw K.PlaylistErrors.NoEntryToPlay(H.PLAYLIST,"No item is currently playing");let r=this.getElement(t);if(r){let n=Math.max(r.currentTime+e,0);r.currentTime=Math.min(n,r.duration)}}seekTo(e,t=pe.audio){let{currentIndex:i}=this.state[t];if(i===-1)throw K.PlaylistErrors.NoEntryToPlay(H.PLAYLIST,"No item is currently playing");if(e<0)throw Error("value cannot be negative");let r=this.getElement(t);r&&(r.currentTime=Math.min(e,r.duration))}setVolume(e,t=pe.audio){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");let i=this.getElement(t);i&&(i.volume=e*.01)}getVolume(e=pe.audio){let t=this.getElement(e);return t?t.volume*100:0}getCurrentTime(e=pe.audio){let t=this.getElement(e);return(t==null?void 0:t.currentTime)||0}getCurrentIndex(e=pe.audio){return this.state[e].currentIndex}getCurrentProgress(e=pe.audio){var t;let{list:i,currentIndex:r}=this.state[e],n=(t=i[r])==null?void 0:t.url,s=this.getElement(e);return!n||!s?0:Math.floor(100*(s.currentTime/s.duration))}getCurrentSelection(e=pe.audio){let{list:t,currentIndex:i}=this.state[e];if(i!==-1)return t[i]}isPlaying(e=pe.audio){let t=this.getElement(e);return!!t&&!t.paused}setIsAutoplayOn(e=pe.audio,t){this.state[e].isAutoplayOn=t}getPlaybackRate(e=pe.audio){let t=this.getElement(e);return t?t.playbackRate:1}setPlaybackRate(e=pe.audio,t){if(t<.25||t>2)throw Error("Please pass a value between 0.25 and 2.0");let i=this.getElement(e);i&&(i.playbackRate=t)}setEnabled(e,t){return T(this,arguments,function*(i,{id:r,type:n=pe.audio}){let s=this.state[n].list.findIndex(o=>o.id===r);if(!r||s===-1){y.w(this.TAG,"Pass a valid id");return}let a=this.state[n].list[s].url;i?yield this.play(a,n):yield this.pause(a,n),this.state[n].currentIndex=s,this.setDuration(n)})}playNext(){return T(this,arguments,function*(e=pe.audio){let{list:t,currentIndex:i}=this.state[e];if(i>=t.length-1)throw K.PlaylistErrors.NoEntryToPlay(H.PLAYLIST,"Reached end of playlist");yield this.play(t[i+1].url,e),this.state[e].currentIndex=i+1,this.setDuration(e)})}playPrevious(){return T(this,arguments,function*(e=pe.audio){let{list:t,currentIndex:i}=this.state[e];if(i<=0)throw K.PlaylistErrors.NoEntryToPlay(H.PLAYLIST,"Reached start of playlist");yield this.play(t[i-1].url,e),this.state[e].currentIndex=i-1,this.setDuration(e)})}stop(){return T(this,arguments,function*(e=pe.audio){var t;let i=e===pe.audio?this.audioManager:this.videoManager;(t=i.getElement())==null||t.pause(),yield this.removeTracks(e),i.stop(),this.state[e].currentIndex=-1})}cleanup(){this.state={audio:ce({},lr.audio),video:ce({},lr.video)},this.eventBus.localAudioEnabled.unsubscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.unsubscribe(this.handlePausePlaylist),this.audioManager.stop(),this.videoManager.stop()}onProgress(e){this.videoManager.on("progress",()=>{try{e({type:pe.video,progress:this.getCurrentProgress(pe.video)})}catch{y.e(this.TAG,"Error in onProgress callback")}}),this.audioManager.on("progress",()=>{try{e({type:pe.audio,progress:this.getCurrentProgress(pe.audio)})}catch{y.e(this.TAG,"Error in onProgress callback")}})}onNewTrackStart(e){this.on("newTrackStart",e)}onPlaylistEnded(e){this.on("playlistEnded",e)}onCurrentTrackEnded(e){this.on("currentTrackEnded",e)}getElement(e=pe.audio){return e===pe.audio?this.audioManager.getElement():this.videoManager.getElement()}removeTracks(){return T(this,arguments,function*(e=pe.audio){let t=(e===pe.audio?this.audioManager:this.videoManager).getTracks();for(let i of t)yield this.removeTrack(i)})}play(e){return T(this,arguments,function*(t,i=pe.audio){let r=i===pe.audio?this.audioManager:this.videoManager,n=r.getElement();if(this.isItemCurrentlyPlaying(t,i)){y.w(this.TAG,`The ${i} is currently playing`);return}if(n!=null&&n.src.includes(t))yield n.play();else{n==null||n.pause();let s=yield r.play(t);for(let a of s)yield this.addTrack(a,i===pe.audio?"audioplaylist":"videoplaylist")}})}isItemCurrentlyPlaying(e,t){let i=this.getElement(t);return!!(i&&!i.paused&&i.src.includes(e))}setDuration(e=pe.audio){let t=this.getElement(e),{list:i,currentIndex:r}=this.state[e];i[r]&&(i[r].duration=(t==null?void 0:t.duration)||0),this.emit("newTrackStart",i[r])}pause(e){return T(this,arguments,function*(t,i=pe.audio){let r=this.getElement(i);r&&!r.paused&&r.src.includes(t)?(r.pause(),y.d(this.TAG,"paused url",t)):y.w(this.TAG,"The passed in url is not currently playing")})}addListeners(){this.audioManager.on("ended",()=>this.handleEnded(pe.audio)),this.videoManager.on("ended",()=>this.handleEnded(pe.video)),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist)}handleEnded(){return T(this,arguments,function*(e=pe.audio){let{list:t,currentIndex:i,isAutoplayOn:r}=this.state[e];i===t.length-1?(yield this.stop(e),this.emit("playlistEnded",e)):r?this.playNext(e):yield this.pause(t[i].url,e),this.emit("currentTrackEnded",t[i])})}},pd=class{constructor(e,t,i="",r="",n="https://prod-init.100ms.live/init",s=!1){this.authToken=e,this.peerId=t,this.peerName=i,this.data=r,this.endpoint=n,this.autoSubscribeVideo=s}},Me;(function(e){e[e.ConnectFailed=0]="ConnectFailed",e[e.SignalDisconnect=1]="SignalDisconnect",e[e.JoinWSMessageFailed=2]="JoinWSMessageFailed",e[e.PublishIceConnectionFailed=3]="PublishIceConnectionFailed",e[e.SubscribeIceConnectionFailed=4]="SubscribeIceConnectionFailed"})(Me||(Me={}));var fd={[0]:[],[1]:[],[2]:[1],[3]:[1],[4]:[1]},Se;(function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Joined="Joined",e.Preview="Preview",e.Failed="Failed",e.Reconnecting="Reconnecting",e.Leaving="Leaving"})(Se||(Se={}));var md=class{constructor(e){this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i,e(t,i)})}},Vt="[RetryScheduler]",gd=class{constructor(e,t){this.onStateChange=e,this.sendEvent=t,this.inProgress=new Map,this.retryTaskIds=[]}schedule(e){return T(this,arguments,function*({category:t,error:i,task:r,originalState:n,maxFailedRetries:s=wn,changeState:a=!0}){yield this.scheduleTask({category:t,error:i,changeState:a,task:r,originalState:n,maxFailedRetries:s})})}reset(){this.retryTaskIds.forEach(e=>clearTimeout(e)),this.retryTaskIds=[],this.inProgress.clear()}scheduleTask(e){return T(this,arguments,function*({category:t,error:i,changeState:r,task:n,originalState:s,maxFailedRetries:a=wn,failedRetryCount:o=0}){if(y.d(Vt,"schedule: ",{category:Me[t],error:i}),o===0){let h=this.inProgress.get(t);if(h){y.d(Vt,`schedule: Already a task for ${Me[t]} scheduled, waiting for its completion`),yield h.promise;return}let p=new md((g,v)=>{});this.inProgress.set(t,p),this.sendEvent(i,t)}let l=!1,c=fd[t];for(let h in c){let p=c[parseInt(h)];try{let g=this.inProgress.get(p);g&&(y.d(Vt,`schedule: Suspending retry task of ${Me[t]}, waiting for ${Me[p]} to recover`),yield g.promise,y.d(Vt,`schedule: Resuming retry task ${Me[t]} as it's dependency ${Me[p]} is recovered`))}catch{y.d(Vt,`schedule: Stopping retry task of ${Me[t]} as it's dependency ${Me[p]} failed to recover`),l=!0;break}}if(o>=a||l){if(i.description+=`. [${Me[t]}] Could not recover after ${o} tries`,l&&(i.description+=` Could not recover all of it's required dependencies - [${c.map(h=>Me[h]).toString()}]`),i.isTerminal=!0,this.inProgress.delete(t),this.sendEvent(i,t),this.reset(),r)this.onStateChange(Se.Failed,i);else throw i;return}r&&this.onStateChange(Se.Reconnecting,i);let u=this.getDelayForRetryCount(t,o);y.i(Vt,`schedule: [${Me[t]}] [failedRetryCount=${o}] Scheduling retry task in ${u}ms`);let d;try{d=yield this.setTimeoutPromise(n,u)}catch(h){d=!1,y.w(Vt,`[${Me[t]}] Un-caught exception ${h.name} in retry-task, initiating retry`,h)}if(d){let h=this.inProgress.get(t);this.inProgress.delete(t),h==null||h.resolve(o),r&&this.inProgress.size===0&&this.onStateChange(s),y.i(Vt,`schedule: [${Me[t]}] [failedRetryCount=${o}] Recovered \u267B\uFE0F`)}else yield this.scheduleTask({category:t,error:i,changeState:r,task:n,originalState:s,maxFailedRetries:a,failedRetryCount:o+1})})}getBaseDelayForTask(e,t){return e===Me.JoinWSMessageFailed?2:Math.pow(2,t)}getDelayForRetryCount(e,t){let i=this.getBaseDelayForTask(e,t),r=e===Me.JoinWSMessageFailed?Math.random()*2:Math.random();return Math.round(Math.min(i+r,Mu)*1e3)}setTimeoutPromise(e,t){return T(this,null,function*(){return new Promise((i,r)=>{let n=window.setTimeout(()=>T(this,null,function*(){try{let s=yield e();s&&this.retryTaskIds.splice(this.retryTaskIds.indexOf(n),1),i(s)}catch(s){r(s)}}),t);this.retryTaskIds.push(n)})})}},vd=class extends os{constructor(){super(il),this.localStorage=new Hr("hms-analytics"),this.localStorage.clear(),this.initLocalStorageQueue()}enqueue(e){super.enqueue(e),this.localStorage.set(this.storage)}dequeue(){let e=super.dequeue();return this.localStorage.set(this.storage),e}initLocalStorageQueue(){var e;(e=this.localStorage.get())==null||e.forEach(t=>{let i=new Je(t);super.enqueue(i)})}},yd=class{constructor(){this.TAG="AnalyticsTransport"}sendEvent(e){try{this.sendSingleEvent(e),this.flushFailedEvents()}catch(t){y.w(this.TAG,"sendEvent failed",t)}}flushFailedEvents(e){var t;try{for(y.d(this.TAG,"Flushing failed events",this.failedEvents);this.failedEvents.size()>0;){let i=this.failedEvents.dequeue();i&&(((t=i.metadata)==null?void 0:t.peer.peer_id)===e||!i.metadata.peer.peer_id?this.sendSingleEvent(i):Mr.sendEvent(i))}}catch(i){y.w(this.TAG,"flushFailedEvents failed",i)}}sendSingleEvent(e){try{this.transportProvider.sendEvent(e),y.d(this.TAG,"Sent event",e.name,e)}catch(t){throw y.w(this.TAG,`${this.transportProvider.TAG}.sendEvent failed, adding to local storage events`,{event:e,error:t}),this.failedEvents.enqueue(e),t}}},Td=class extends yd{constructor(e){super(),this.transportProvider=e,this.failedEvents=new vd}},_t;(function(e){e[e.Publish=0]="Publish",e[e.Subscribe=1]="Subscribe"})(_t||(_t={}));var sl="VALIDATIONS";function hi(e){return e!=null}var la=()=>{if(!hi(RTCPeerConnection)){let e=K.GenericErrors.MissingRTCPeerConnection();throw y.e(sl,e),e}},ca=()=>{if(!hi(navigator.mediaDevices)){let e=K.GenericErrors.MissingMediaDevices();throw y.e(sl,e),e}};function bd(e,t){var i;let r=Wo(e.sdp);if(!((i=r.origin)!=null&&i.username.startsWith("mozilla")))return e;let n=t?Array.from(t.values()):[];return r.media.forEach(s=>{var a,o,l;let c=(a=s.msid)==null?void 0:a.split(" ")[0],u=(o=n.find(d=>d.type===s.type&&d.stream_id===c))==null?void 0:o.track_id;u&&(s.msid=(l=s.msid)==null?void 0:l.replace(/\s(.+)/,` ${u}`))}),{type:e.type,sdp:Xc(r)}}function _d(e,t){var i;if(!(e!=null&&e.sdp)||!t)return;let r=Wo(e.sdp).media.find(n=>hi(n.mid)&&parseInt(n.mid)===parseInt(t));return(i=r==null?void 0:r.msid)==null?void 0:i.split(" ")[1]}function kd(e){return e.sdp.includes("usedtx=1")?e:{type:e.type,sdp:e.sdp.replace("useinbandfec=1","useinbandfec=1;usedtx=1")}}var jt="HMSConnection",al=class{constructor(e,t){this.candidates=new Array,this.role=e,this.signal=t}get iceConnectionState(){return this.nativeConnection.iceConnectionState}get connectionState(){return this.nativeConnection.connectionState}get action(){return this.role===_t.Publish?H.PUBLISH:H.SUBSCRIBE}addTransceiver(e,t){return this.nativeConnection.addTransceiver(e,t)}createOffer(e,t){return T(this,null,function*(){try{let i=yield this.nativeConnection.createOffer(t);return y.d(jt,`[role=${this.role}] createOffer offer=${JSON.stringify(i,null,1)}`),kd(bd(i,e))}catch(i){throw K.WebrtcErrors.CreateOfferFailed(this.action,i.message)}})}createAnswer(e=void 0){return T(this,null,function*(){try{let t=yield this.nativeConnection.createAnswer(e);return y.d(jt,`[role=${this.role}] createAnswer answer=${JSON.stringify(t,null,1)}`),t}catch(t){throw K.WebrtcErrors.CreateAnswerFailed(this.action,t.message)}})}setLocalDescription(e){return T(this,null,function*(){try{y.d(jt,`[role=${this.role}] setLocalDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setLocalDescription(e)}catch(t){throw K.WebrtcErrors.SetLocalDescriptionFailed(this.action,t.message)}})}setRemoteDescription(e){return T(this,null,function*(){try{y.d(jt,`[role=${this.role}] setRemoteDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setRemoteDescription(e)}catch(t){throw K.WebrtcErrors.SetRemoteDescriptionFailed(this.action,t.message)}})}addIceCandidate(e){return T(this,null,function*(){y.d(jt,`[role=${this.role}] addIceCandidate candidate=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.addIceCandidate(e)})}get remoteDescription(){return this.nativeConnection.remoteDescription}getSenders(){return this.nativeConnection.getSenders()}logSelectedIceCandidatePairs(){(this.role===_t.Publish?this.getSenders():this.getReceivers()).forEach(e=>{var t;let i=(t=e.track)==null?void 0:t.kind;try{if(e.transport){let r=e.transport.iceTransport,n=()=>{if(typeof r.getSelectedCandidatePair=="function"){let s=r.getSelectedCandidatePair();y.d(jt,`${_t[this.role]} connection`,`selected ${i||"unknown"} candidate pair`,JSON.stringify(s,null,2))}};typeof r.onselectedcandidatepairchange=="function"&&(r.onselectedcandidatepairchange=n),n()}}catch(r){y.w(jt,`Error in logging selected ice candidate pair for ${_t[this.role]} connection`,r)}})}removeTrack(e){this.nativeConnection.removeTrack(e)}setMaxBitrate(e,t){return T(this,null,function*(){let i=this.getSenders().find(r=>{var n;return((n=r==null?void 0:r.track)==null?void 0:n.id)===t.getTrackIDBeingSent()});if(i){let r=i.getParameters();r.encodings.length>0&&(r.encodings[0].maxBitrate=e*1e3),yield i.setParameters(r)}else y.w(jt,`no sender found to setMaxBitrate for track - ${t.trackId}, sentTrackId - ${t.getTrackIDBeingSent()}`)})}getStats(){return T(this,null,function*(){return yield this.nativeConnection.getStats()})}close(){return T(this,null,function*(){this.nativeConnection.close()})}getReceivers(){return this.nativeConnection.getReceivers()}},Sd="HMSPublishConnection",Ed=class extends al{constructor(e,t,i,r){super(_t.Publish,e),this.observer=i,this.transport=r,this.nativeConnection=new RTCPeerConnection(t),this.nativeConnection.createDataChannel(tl,{protocol:"SCTP"}),this.nativeConnection.onicecandidate=({candidate:n})=>{n&&e.trickle(this.role,n)},this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)}}initAfterJoin(){this.nativeConnection.onnegotiationneeded=()=>T(this,null,function*(){y.d(Sd,"onnegotiationneeded"),yield this.observer.onRenegotiationNeeded()})}trackUpdate(e){this.transport.trackUpdate(e)}},Cd=class{constructor(e,t,i=""){this.TAG="HMSDataChannel",this.nativeChannel=e,this.observer=t,this.metadata=i,e.onmessage=r=>{this.observer.onMessage(r.data)}}get id(){return this.nativeChannel.id}get label(){return this.nativeChannel.label}get readyState(){return this.nativeChannel.readyState}send(e){y.d(this.TAG,`[${this.metadata}] Sending [size=${e.length}] message=${e}`),this.nativeChannel.send(e)}close(){this.nativeChannel.close()}},Rd=class extends al{constructor(e,t,i){super(_t.Subscribe,e),this.TAG="[HMSSubscribeConnection]",this.remoteStreams=new Map,this.pendingMessageQueue=[],this.handlePendingApiMessages=()=>{this.pendingMessageQueue.length>0&&(y.d(this.TAG,"Found pending message queue, sending messages"),this.pendingMessageQueue.forEach(r=>this.sendOverApiDataChannel(r)),this.pendingMessageQueue.length=0)},this.observer=i,this.nativeConnection=new RTCPeerConnection(t),this.initNativeConnectionCallbacks()}initNativeConnectionCallbacks(){this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)},this.nativeConnection.ondatachannel=e=>{e.channel.label===tl&&(this.apiChannel=new Cd(e.channel,{onMessage:t=>{this.observer.onApiChannelMessage(t)}},`role=${this.role}`),e.channel.onopen=this.handlePendingApiMessages)},this.nativeConnection.onicecandidate=e=>{e.candidate!==null&&this.signal.trickle(this.role,e.candidate)},this.nativeConnection.ontrack=e=>{var t;let i=e.streams[0],r=i.id;if(!this.remoteStreams.has(r)){let l=new Xo(i,this);this.remoteStreams.set(r,l),i.onremovetrack=c=>{let u=l.tracks.findIndex(d=>d.nativeTrack.id===c.track.id);if(u>=0){let d=l.tracks[u];this.observer.onTrackRemove(d),l.tracks.splice(u,1),l.tracks.length===0&&this.remoteStreams.delete(r)}}}let n=this.remoteStreams.get(r),s=e.track.kind==="audio"?ls:di,a=new s(n,e.track),o=_d(this.remoteDescription,(t=e.transceiver)==null?void 0:t.mid);o&&a.setSdpTrackId(o),n.tracks.push(a),this.observer.onTrackAdd(a)}}sendOverApiDataChannel(e){this.apiChannel&&this.apiChannel.readyState==="open"?this.apiChannel.send(e):(y.w(this.TAG,`API Data channel not ${this.apiChannel?"open":"present"}, queueing`,e),this.pendingMessageQueue.push(e))}close(){var e=t=>super[t];return T(this,null,function*(){var t;yield e("close").call(this),(t=this.apiChannel)==null||t.close()})}},Pd=class{constructor(e,t){this.store=e,this.eventBus=t,this.TAG="[TrackDegradationController]",this.MAX_RECOVER_GRACE_PERIOD=120,this.recoverAttemptCount=0,this.packetsLost=0;let i=this.store.getSubscribeDegradationParams();this.PACKETS_LOST_THRESHOLD=i.packetLossThreshold,this.MIN_DEGRADE_GRACE_PERIOD=i.degradeGracePeriodSeconds,this.MIN_RECOVER_GRACE_PERIOD=i.recoverGracePeriodSeconds,this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD}get isAttemptingRecover(){return Boolean(this.recoveringTrack)}handleRtcStatsChange(e){let t=e>this.packetsLost+this.PACKETS_LOST_THRESHOLD;this.packetsLost=e,t?this.degrade():this.recover()}degrade(){if(this.degradeGracePeriod>0){this.degradeGracePeriod--;return}if(this.isAttemptingRecover)return this.cancelRecovery();y.d(this.TAG,"Packet loss increased, Degrading",{packetsLost:this.packetsLost}),this.degradeActiveTracksByHalf(),this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD}recover(){if(this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod>0){this.recoverGracePeriod--;return}this.recoveringTrack=this.getActiveTracks(!0).find(e=>e.degraded),this.recoveringTrack&&(y.d(this.TAG,"Packet lost stable, recovering track",this.recoveringTrack),this.recoveringTrack.setDegradedFromSdk(!1),this.eventBus.trackRestored.publish(this.recoveringTrack),this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD)}cleanUp(){this.eventBus.trackDegraded.removeAllListeners(),this.eventBus.trackRestored.removeAllListeners()}degradeActiveTracksByHalf(){let e=this.getActiveTracks(!1);if(!e.length)return;y.d(this.TAG,{activeTracks:[...e]});let t=Math.ceil(e.length/2);for(;t--;){let i=e.pop();i.setDegradedFromSdk(!0),this.eventBus.trackDegraded.publish(i)}}getActiveTracks(e){return this.store.getRemoteVideoTracks().filter(t=>t.hasSinks()&&(!t.degraded||e)).sort((t,i)=>{let r=this.store.getComparator().getTrackComparators();return-1*(r.screenShare(t,i)||r.rolePriority(t,i)||r.peerAudioLevel(t,i)||this.store.getComparator().stringComparator(t.trackId,i.trackId))}).slice(0)}cancelRecovery(){this.recoveringTrack&&(this.recoveringTrack.setDegradedFromSdk(!0),this.eventBus.trackDegraded.publish(this.recoveringTrack)),this.recoveringTrack=void 0,this.recoverAttemptCount++,this.recoverGracePeriod=this.getDelayForRecoverCount(this.recoverAttemptCount),this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,y.d(this.TAG,"Recover Attempt Failed",{count:this.recoverAttemptCount,delay:this.recoverGracePeriod})}getDelayForRecoverCount(e){let t=this.MIN_RECOVER_GRACE_PERIOD+this.MIN_RECOVER_GRACE_PERIOD*e;return Math.min(t,this.MAX_RECOVER_GRACE_PERIOD)}},Ad=e=>{let t=e.stream instanceof Dr,i=t?"publish":"subscribe",r=t?e.getTrackBeingSent():e.nativeTrack;return{peerConnectionType:i,nativeTrack:r}},Id=(e,t,i,r)=>T(void 0,null,function*(){var n;let{peerConnectionType:s,nativeTrack:a}=Ad(t),o;try{o=yield(n=e[s])==null?void 0:n.call(e,a)}catch(d){y.w("[HMSWebrtcStats]","Error in getting track stats",t,a,d)}let l=wd(o),c=ol(s==="publish"?"bytesSent":"bytesReceived",l,r),u=$n("packetsLost",l,r);return l!=null&&l.remote&&Object.assign(l.remote,{packetsLostRate:$n("packetsLost",l.remote,r==null?void 0:r.remote)}),l&&Object.assign(l,{bitrate:c,packetsLostRate:u,peerId:t.peerId,peerName:i,codec:l.codec})}),wd=e=>{let t,i,r={};e==null||e.forEach(a=>{switch(a.type){case"inbound-rtp":t=a;break;case"outbound-rtp":t=a;break;case"remote-inbound-rtp":i=a;break;case"codec":r[a.id]=a.mimeType;break}});let n=t!=null&&t.codecId?r[t.codecId]:void 0,s;return n&&(s=n.substring(n.indexOf("/")+1)),t&&Object.assign(t,{remote:i,codec:s})},ua=(e,t,i)=>{let r=$d(t),n=ol(e==="publish"?"bytesSent":"bytesReceived",r,i&&i[e]);return r&&Object.assign(r,{bitrate:n})},$d=e=>{let t;return e.forEach(i=>{i.type==="transport"&&(t=e.get(i.selectedCandidatePairId))}),t||e.forEach(i=>{i.type==="candidate-pair"&&i.selected&&(t=i)}),t},Dd=e=>{let t={packetsLost:0,jitter:0};return e==null||e.forEach(i=>{i.packetsLost&&(t.packetsLost+=i.packetsLost),i.jitter>t.jitter&&(t.jitter=i.jitter)}),t},Od=(e,t)=>Array.from(new Set(e.concat(t))),ol=(e,t,i)=>$n(e,t,i)*8,$n=(e,t,i)=>{let r=t&&t[e],n=i?i[e]:null;return[t,i,hi(r),hi(n)].every(s=>!!s)?ll(r,n,t==null?void 0:t.timestamp,i==null?void 0:i.timestamp)*1e3:0},ll=(e,t,i,r)=>hi(e)&&hi(t)&&i&&r?(e-t)/(i-r):0,Md=class{constructor(e,t){this.getStats=e,this.store=t,this.TAG="[HMSWebrtcStats]",this.peerStats={},this.trackStats={};var i;this.localPeerID=(i=this.store.getLocalPeer())==null?void 0:i.peerId}getLocalPeerStats(){return this.peerStats[this.localPeerID]}getTrackStats(e){return this.trackStats[e]}updateStats(){return T(this,null,function*(){yield this.updateLocalPeerStats(),yield this.updateTrackStats()})}updateLocalPeerStats(){return T(this,null,function*(){var e,t,i,r,n,s;let a=this.getLocalPeerStats(),o;try{o=yield(t=(e=this.getStats).publish)==null?void 0:t.call(e)}catch(v){y.w(this.TAG,"Error in getting publish stats",v)}let l=o&&ua("publish",o,a),c;try{c=yield(r=(i=this.getStats).subscribe)==null?void 0:r.call(i)}catch(v){y.w(this.TAG,"Error in getting subscribe stats",v)}let u=c&&ua("subscribe",c,a),{packetsLost:d,jitter:h}=Dd(c),p=ll(d,(n=a==null?void 0:a.subscribe)==null?void 0:n.packetsLost,u==null?void 0:u.timestamp,(s=a==null?void 0:a.subscribe)==null?void 0:s.timestamp),g=u&&Object.assign(u,{packetsLostRate:p,jitter:h,packetsLost:d});this.peerStats[this.localPeerID]={publish:l,subscribe:g}})}updateTrackStats(){return T(this,null,function*(){var e;let t=this.store.getTracksMap(),i=Od(Object.keys(this.trackStats),Object.keys(t));for(let r of i){let n=t[r];if(n){let s=n.peerId&&((e=this.store.getPeerById(n.peerId))==null?void 0:e.name),a=this.getTrackStats(n.trackId),o=yield Id(this.getStats,n,s,a);o&&(this.trackStats[r]=o)}else delete this.trackStats[r]}})}},Ld=class{constructor(e,t,i,r){this.store=e,this.eventBus=t,this.publishConnection=i,this.subscribeConnection=r,this.TAG="[HMSWebrtcInternals]",this.interval=Fu,this.isMonitored=!1,this.handleStatsUpdate=()=>T(this,null,function*(){var n;yield(n=this.hmsStats)==null?void 0:n.updateStats(),this.eventBus.statsUpdate.publish(this.hmsStats)})}getPublishPeerConnection(){return this.publishConnection}getSubscribePeerConnection(){return this.subscribeConnection}getCurrentStats(){return this.hmsStats}onStatsChange(e){return this.eventBus.statsUpdate.subscribe(e),()=>{this.eventBus.statsUpdate.unsubscribe(e)}}setPeerConnections({publish:e,subscribe:t}){var i,r;this.publishConnection=e,this.subscribeConnection=t,this.hmsStats=new Md({publish:(i=this.publishConnection)==null?void 0:i.getStats.bind(this.publishConnection),subscribe:(r=this.subscribeConnection)==null?void 0:r.getStats.bind(this.subscribeConnection)},this.store)}start(){return T(this,null,function*(){if(this.isMonitored){y.d(this.TAG,"Already started");return}this.stop(),this.isMonitored=!0,y.d(this.TAG,"Starting Webrtc Stats Monitor"),this.startLoop().then(()=>y.d(this.TAG,"Stopping Webrtc Stats Monitor")).catch(e=>y.e(this.TAG,e.message))})}stop(){this.isMonitored=!1}startLoop(){return T(this,null,function*(){for(;this.isMonitored;)yield this.handleStatsUpdate(),yield Qt(this.interval)})}cleanUp(){this.stop(),this.eventBus.statsUpdate.removeAllListeners()}},Dn="InitService",Nd=class{static handleError(e,t){switch(e.status){case 404:throw K.InitAPIErrors.EndpointUnreachable(H.INIT,t.message||e.statusText);case 200:break;default:throw K.InitAPIErrors.ServerErrors(t.code||e.status,H.INIT,t.message||(e==null?void 0:e.statusText))}}static fetchInitConfig(e){return T(this,arguments,function*({token:t,peerId:i,userAgent:r,initEndpoint:n="https://prod-init.100ms.live",region:s=""}){y.d(Dn,`fetchInitConfig: initEndpoint=${n} token=${t} peerId=${i} region=${s} `);let a=xd(n,i,r,s);try{let o=yield fetch(a,{headers:{Authorization:`Bearer ${t}`}}),l=yield o.json();return this.handleError(o,l),y.d(Dn,`config is ${JSON.stringify(l,null,2)}`),Ud(l)}catch(o){let l=o;throw["Failed to fetch","NetworkError"].some(c=>l.message.includes(c))?K.InitAPIErrors.EndpointUnreachable(H.INIT,l.message):l}})}};function xd(e,t,i,r){try{let n=new URL("/init",e);return r&&r.trim().length>0&&n.searchParams.set("region",r.trim()),n.searchParams.set("peer_id",t),n.searchParams.set("user_agent_v2",i),n.toString()}catch(n){let s=n;throw y.e(Dn,s.name,s.message),s}}function Ud(e){var t;return Xe(ce({},e),{rtcConfiguration:Xe(ce({},e.rtcConfiguration),{iceServers:(t=e.rtcConfiguration)==null?void 0:t.ice_servers})})}var Vi;(function(e){e.FLAG_SERVER_SUB_DEGRADATION="subscribeDegradation",e.FLAG_SERVER_SIMULCAST="simulcast",e.FLAG_NON_WEBRTC_DISABLE_OFFER="nonWebRTCDisableOffer"})(Vi||(Vi={}));var ke;(function(e){e.JOIN="join",e.OFFER="offer",e.ANSWER="answer",e.TRICKLE="trickle",e.TRACK_UPDATE="track-update",e.BROADCAST="broadcast",e.ANALYTICS="analytics",e.SERVER_ERROR="on-error",e.SERVER_WARNING="on-warning",e.SDK_NOTIFICATION="sdk-notification",e.LEAVE="leave",e.END_ROOM="end-room",e.PING="ping",e.ROLE_CHANGE_REQUEST="role-change-request",e.ROLE_CHANGE="role-change",e.TRACK_UPDATE_REQUEST="track-update-request",e.PEER_LEAVE_REQUEST="peer-leave-request",e.CHANGE_TRACK_MUTE_STATE_REQUEST="change-track-mute-state-request",e.START_RTMP_OR_RECORDING_REQUEST="rtmp-start",e.STOP_RTMP_AND_RECORDING_REQUEST="rtmp-stop",e.UPDATE_PEER_METADATA="peer-update",e.START_HLS_STREAMING="hls-start",e.STOP_HLS_STREAMING="hls-stop",e.HLS_TIMED_METADATA="hls-timed-metadata",e.SET_METADATA="set-metadata",e.GET_METADATA="get-metadata"})(ke||(ke={}));function Fd(e){switch(e){case ke.JOIN:return H.JOIN;case ke.OFFER:return H.PUBLISH;case ke.ANSWER:return H.SUBSCRIBE;case ke.TRACK_UPDATE:return H.TRACK;default:return H.NONE}}var Bd=class{constructor(e){this.TAG="[SIGNAL]: ",this.pongResponseTimes=new os(xu),this.isJoinCompleted=!1,this.pendingTrickle=[],this.socket=null,this.callbacks=new Map,this._isConnected=!1,this.id=0,this.onCloseHandler=()=>{},this.offlineListener=()=>{y.d(this.TAG,"Window network offline"),this.setIsConnected(!1,"Window network offline")},this.onlineListener=()=>{y.d(this.TAG,"Window network online"),this.observer.onNetworkOnline()},this.observer=e,window.addEventListener("offline",this.offlineListener),window.addEventListener("online",this.onlineListener),this.onMessageHandler=this.onMessageHandler.bind(this)}get isConnected(){return this._isConnected}setIsConnected(e,t=""){y.d(this.TAG,`isConnected set id: ${this.id}, oldValue: ${this._isConnected}, newValue: ${e}`),this._isConnected!==e&&(this._isConnected&&!e?(this._isConnected=e,this.observer.onOffline(t)):!this._isConnected&&e&&(this._isConnected=e,this.observer.onOnline()))}getPongResponseTimes(){return this.pongResponseTimes.toList()}internalCall(e,t){return T(this,null,function*(){var i;let r=Ci(),n={method:e,params:t,id:r,jsonrpc:"2.0"};(i=this.socket)==null||i.send(JSON.stringify(n));try{return yield new Promise((s,a)=>{this.callbacks.set(r,{resolve:s,reject:a})})}catch(s){let a=s;throw K.WebsocketMethodErrors.ServerErrors(Number(a.code),Fd(e),a.message)}})}notify(e,t){var i;let r={method:e,params:t};(i=this.socket)==null||i.send(JSON.stringify(r))}open(e){return new Promise((t,i)=>{let r=!1;this.socket&&(this.socket.close(),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)),this.socket=new WebSocket(e);let n=a=>{y.e(this.TAG,"Error from websocket",a),r=!0,i(K.WebSocketConnectionErrors.FailedToConnect(H.JOIN,`Error opening websocket connection - ${a}`))};this.onCloseHandler=a=>{y.e(`Websocket closed code=${a.code}`),r?this.setIsConnected(!1,`code: ${a.code}${a.code!==1e3?", unexpected websocket close":""}`):(r=!0,i(K.WebSocketConnectionErrors.AbnormalClose(H.JOIN,`Error opening websocket connection - websocket closed unexpectedly with code=${a.code}`)))},this.socket.addEventListener("error",n);let s=()=>{var a,o;r=!0,t(),this.setIsConnected(!0),this.id++,(a=this.socket)==null||a.removeEventListener("open",s),(o=this.socket)==null||o.removeEventListener("error",n),this.pingPongLoop(this.id)};this.socket.addEventListener("open",s),this.socket.addEventListener("close",this.onCloseHandler),this.socket.addEventListener("message",this.onMessageHandler)})}close(){return T(this,null,function*(){window.removeEventListener("offline",this.offlineListener),window.removeEventListener("online",this.onlineListener),this.socket?(this.socket.close(1e3,"Normal Close"),this.setIsConnected(!1,"code: 1000, normal websocket close"),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)):this.setIsConnected(!1,"websocket not connected yet")})}join(e,t,i,r,n){return T(this,null,function*(){if(!this.isConnected)throw K.WebSocketConnectionErrors.WebSocketConnectionLost(H.JOIN,"Failed to send join over WS connection");let s={name:e,disableVidAutoSub:i,data:t,offer:n,server_sub_degrade:r},a=yield this.internalCall(ke.JOIN,s);return this.isJoinCompleted=!0,this.pendingTrickle.forEach(({target:o,candidate:l})=>this.trickle(o,l)),this.pendingTrickle.length=0,y.d(this.TAG,`join: response=${JSON.stringify(a,null,1)}`),a})}trickle(e,t){this.isJoinCompleted?this.notify(ke.TRICKLE,{target:e,candidate:t}):this.pendingTrickle.push({target:e,candidate:t})}offer(e,t){return T(this,null,function*(){return yield this.call(ke.OFFER,{desc:e,tracks:Object.fromEntries(t)})})}answer(e){this.notify(ke.ANSWER,{desc:e})}trackUpdate(e){this.notify(ke.TRACK_UPDATE,{version:"1.0",tracks:Object.fromEntries(e)})}broadcast(e){return T(this,null,function*(){return yield this.call(ke.BROADCAST,ce({version:"1.0"},e.toSignalParams()))})}leave(){this.notify(ke.LEAVE,{version:"1.0"})}endRoom(e,t){return T(this,null,function*(){yield this.call(ke.END_ROOM,{lock:e,reason:t})})}sendEvent(e){if(!this.isConnected)throw Error(`${this.TAG} not connected. Could not send event ${e}`);this.notify(ke.ANALYTICS,e.toSignalParams())}ping(e){let t=Date.now(),i=new Promise(n=>{setTimeout(()=>{n(Date.now()-t)},e+1)}),r=this.internalCall(ke.PING,{timestamp:t}).then(()=>Date.now()-t).catch(()=>Date.now()-t);return Promise.race([i,r])}requestRoleChange(e){return T(this,null,function*(){yield this.call(ke.ROLE_CHANGE_REQUEST,e)})}acceptRoleChangeRequest(e){return T(this,null,function*(){yield this.call(ke.ROLE_CHANGE,e)})}requestTrackStateChange(e){return T(this,null,function*(){yield this.call(ke.TRACK_UPDATE_REQUEST,e)})}requestMultiTrackStateChange(e){return T(this,null,function*(){yield this.call(ke.CHANGE_TRACK_MUTE_STATE_REQUEST,e)})}removePeer(e){return T(this,null,function*(){yield this.call(ke.PEER_LEAVE_REQUEST,e)})}startRTMPOrRecording(e){return T(this,null,function*(){yield this.call(ke.START_RTMP_OR_RECORDING_REQUEST,ce({version:"1.0"},e))})}stopRTMPAndRecording(){return T(this,null,function*(){yield this.call(ke.STOP_RTMP_AND_RECORDING_REQUEST,{version:"1.0"})})}startHLSStreaming(e){return T(this,null,function*(){yield this.call(ke.START_HLS_STREAMING,ce({version:"1.0"},e))})}stopHLSStreaming(e){return T(this,null,function*(){yield this.call(ke.STOP_HLS_STREAMING,ce({version:"1.0"},e))})}sendHLSTimedMetadata(e){return T(this,null,function*(){yield this.call(ke.HLS_TIMED_METADATA,ce({version:"1.0"},e))})}updatePeer(e){return T(this,null,function*(){yield this.call(ke.UPDATE_PEER_METADATA,ce({version:"1.0"},e))})}setSessionMetadata(e){return T(this,null,function*(){yield this.call(ke.SET_METADATA,ce({version:"1.0"},e))})}getSessionMetadata(){return this.call(ke.GET_METADATA,{version:"1.0"})}onMessageHandler(e){let t=e.data,i=JSON.parse(t);if(i.id)this.handleResponseWithId(i);else if(i.method)this.handleResponseWithMethod(i);else throw Error(`WebSocket message has no 'method' or 'id' field, message=${i}`)}handleResponseWithId(e){let t=e,i=t.id;if(this.callbacks.has(i)){let r=this.callbacks.get(i);this.callbacks.delete(i),t.result?r.resolve(t.result):r.reject(t.error)}else this.observer.onNotification(t)}handleResponseWithMethod(e){switch(e.method){case ke.OFFER:this.observer.onOffer(e.params);break;case ke.TRICKLE:this.observer.onTrickle(e.params);break;case ke.SERVER_ERROR:this.observer.onServerError(K.WebsocketMethodErrors.ServerErrors(Number(e.params.code),H.NONE,e.params.message));break;case ke.SERVER_WARNING:y.w(this.TAG,e.params);break;default:this.observer.onNotification(e);break}}pingPongLoop(e){return T(this,null,function*(){var t,i;let r=((t=window.HMS)==null?void 0:t.PING_TIMEOUT)||Lu;if(this.isConnected){let n=yield this.ping(r);this.pongResponseTimes.enqueue(n),n>r?(y.d(this.TAG,`Pong timeout ${e}, pageHidden=${ou()}`),this.id===e&&this.setIsConnected(!1,"ping pong failure")):setTimeout(()=>this.pingPongLoop(e),((i=window.HMS)==null?void 0:i.PING_INTERVAL)||Nu)}})}call(e,t){return T(this,null,function*(){let i=3,r=K.WebsocketMethodErrors.ServerErrors(500,e,`Default ${e} error`);for(let n=0;n<i;n++)try{return y.d(this.TAG,`Try number ${n+1} sending ${e}`,t),yield this.internalCall(e,t)}catch(s){if(r=s,y.e(this.TAG,`Failed sending ${e}`,{method:e,try:n+1,params:t,error:r}),!(parseInt(`${r.code/100}`)===5||r.code===429))break;let a=(2+Math.random()*2)*1e3;yield Qt(a)}throw y.e(`Sending ${e} over WS failed after ${i} retries`,{method:e,params:t,error:r}),r})}},Gd=()=>{if(!Ri||typeof navigator.connection>"u")return;let e=navigator.connection;return{downlink:e.downlink,downlinkMax:e.downlinkMax,effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,type:e.type}},he="[HMSTransport]:",Vd=class{constructor(e,t,i,r,n,s){this.observer=e,this.deviceManager=t,this.store=i,this.eventBus=r,this.analyticsEventsService=n,this.analyticsTimer=s,this.state=Se.Disconnected,this.trackStates=new Map,this.publishConnection=null,this.subscribeConnection=null,this.maxSubscribeBitrate=0,this.joinRetryCount=0,this.callbacks=new Map,this.signalObserver={onOffer:c=>T(this,null,function*(){try{if(!this.subscribeConnection)return;yield this.subscribeConnection.setRemoteDescription(c),y.d(he,`[SUBSCRIBE] Adding ${this.subscribeConnection.candidates.length} ice-candidates`,this.subscribeConnection.candidates);for(let d of this.subscribeConnection.candidates)yield this.subscribeConnection.addIceCandidate(d);this.subscribeConnection.candidates.length=0;let u=yield this.subscribeConnection.createAnswer();yield this.subscribeConnection.setLocalDescription(u),this.signal.answer(u),y.d(he,"[role=SUBSCRIBE] onOffer renegotiation DONE \u2705")}catch(u){y.d(he,"[role=SUBSCRIBE] onOffer renegotiation FAILED \u274C"),this.state=Se.Failed;let d;throw u instanceof te?d=u:d=K.GenericErrors.Unknown(H.PUBLISH,u.message),this.eventBus.analytics.publish($e.subscribeFail(d)),d}}),onTrickle:c=>T(this,null,function*(){let u=c.target===_t.Publish?this.publishConnection:this.subscribeConnection;u!=null&&u.remoteDescription?yield u.addIceCandidate(c.candidate):u==null||u.candidates.push(c.candidate)}),onNotification:c=>this.observer.onNotification(c),onServerError:c=>T(this,null,function*(){yield this.observer.onStateChange(Se.Failed,c)}),onFailure:c=>{this.joinParameters&&this.retryScheduler.schedule({category:Me.SignalDisconnect,error:c,task:this.retrySignalDisconnectTask,originalState:this.state})},onOffline:c=>T(this,null,function*(){y.d(he,"socket offline",Se[this.state]);try{this.state!==Se.Leaving&&this.joinParameters&&this.retryScheduler.schedule({category:Me.SignalDisconnect,error:K.WebSocketConnectionErrors.WebSocketConnectionLost(H.RECONNECT_SIGNAL,c),task:this.retrySignalDisconnectTask,originalState:this.state})}catch(u){console.error(u)}}),onOnline:()=>{var c;y.d(he,"socket online",Se[this.state]),this.analyticsSignalTransport.flushFailedEvents((c=this.store.getLocalPeer())==null?void 0:c.peerId)},onNetworkOnline:()=>{this.analyticsEventsService.flushFailedClientEvents()}},this.signal=new Bd(this.signalObserver),this.analyticsSignalTransport=new Td(this.signal),this.publishConnectionObserver={onRenegotiationNeeded:()=>T(this,null,function*(){yield this.performPublishRenegotiation()}),onIceConnectionChange:c=>T(this,null,function*(){(c==="disconnected"?y.w.bind(y):y.d.bind(y))(he,`Publish ice connection state change: ${c}`)}),onConnectionStateChange:c=>T(this,null,function*(){var u;(c==="disconnected"?y.w.bind(y):y.d.bind(y))(he,`Publish connection state change: ${c}`),c==="connected"&&((u=this.publishConnection)==null||u.logSelectedIceCandidatePairs()),c==="failed"&&(yield this.handleIceConnectionFailure(_t.Publish))})},this.subscribeConnectionObserver={onApiChannelMessage:c=>{this.observer.onNotification(JSON.parse(c))},onTrackAdd:c=>{y.d(he,"[Subscribe] onTrackAdd",Ir(c.nativeTrack)),this.observer.onTrackAdd(c)},onTrackRemove:c=>{y.d(he,"[Subscribe] onTrackRemove",Ir(c.nativeTrack)),this.observer.onTrackRemove(c)},onIceConnectionChange:c=>T(this,null,function*(){if((c==="disconnected"?y.w.bind(y):y.d.bind(y))(he,`Subscribe ice connection state change: ${c}`),c==="connected"){let u=this.callbacks.get(Mi);this.callbacks.delete(Mi),u&&u.promise.resolve(!0)}}),onConnectionStateChange:c=>T(this,null,function*(){var u;if((c==="disconnected"?y.w.bind(y):y.d.bind(y))(he,`Subscribe connection state change: ${c}`),c==="failed"&&(yield this.handleIceConnectionFailure(_t.Subscribe)),c==="connected"){(u=this.subscribeConnection)==null||u.logSelectedIceCandidatePairs();let d=this.callbacks.get(Mi);this.callbacks.delete(Mi),d&&d.promise.resolve(!0)}})},this.handleLocalRoleUpdate=c=>T(this,[c],function*({oldRole:u,newRole:d}){!(!this.doesRoleNeedWebRTC(u)&&this.doesRoleNeedWebRTC(d))||(y.i(he,"Local peer role updated to webrtc role, creating PeerConnections and performing inital publish negotiation \u23F3"),this.createPeerConnections(),yield this.negotiateOnFirstPublish())}),this.retryPublishIceFailedTask=()=>T(this,null,function*(){if(this.publishConnection&&(this.publishConnection.iceConnectionState!=="connected"||this.publishConnection.connectionState!=="connected")){let c=new Promise((u,d)=>{this.callbacks.set(Oi,{promise:{resolve:u,reject:d},action:H.RESTART_ICE,extra:{}})});yield this.performPublishRenegotiation({iceRestart:!0}),yield c}return!0}),this.retrySubscribeIceFailedTask=()=>T(this,null,function*(){if(this.subscribeConnection&&(this.subscribeConnection.iceConnectionState!=="connected"||this.subscribeConnection.connectionState!=="connected")){let c=new Promise((d,h)=>{this.callbacks.set(Mi,{promise:{resolve:d,reject:h},action:H.RESTART_ICE,extra:{}})}),u=new Promise(d=>{setTimeout(d,Uu,!1)});return Promise.race([c,u])}return!0}),this.retrySignalDisconnectTask=()=>T(this,null,function*(){if(y.d(he,"retrySignalDisconnectTask",{signalConnected:this.signal.isConnected}),!this.signal.isConnected)try{yield this.internalConnect(this.joinParameters.authToken,this.joinParameters.endpoint,this.joinParameters.peerId)}catch{}let c=this.store.getRoom().joinedAt?this.signal.isConnected&&(yield this.retryPublishIceFailedTask()):this.signal.isConnected;return this.signal.trackUpdate(this.trackStates),c});var a,o;this.webrtcInternals=new Ld(this.store,this.eventBus,(a=this.publishConnection)==null?void 0:a.nativeConnection,(o=this.subscribeConnection)==null?void 0:o.nativeConnection);let l=(c,u)=>T(this,null,function*(){c!==this.state&&(this.state=c,yield this.observer.onStateChange(this.state,u))});this.retryScheduler=new gd(l,this.sendErrorAnalyticsEvent.bind(this)),this.eventBus.statsUpdate.subscribe(c=>{var u,d;let h=((d=(u=c.getLocalPeerStats())==null?void 0:u.subscribe)==null?void 0:d.bitrate)||0;this.maxSubscribeBitrate=Math.max(this.maxSubscribeBitrate,h)})}getWebrtcInternals(){return this.webrtcInternals}isFlagEnabled(e){var t;let i=(t=this.initConfig)==null?void 0:t.config;return((i==null?void 0:i.enabledFlags)||[]).includes(e)}preview(e,t,i,r,n=!1){return T(this,null,function*(){let s=yield this.connect(e,t,i,r,n);return this.state=Se.Preview,this.observer.onStateChange(this.state),s})}join(e,t,i,r,n=!1){return T(this,null,function*(){y.d(he,"join: started \u23F0");try{(!this.signal.isConnected||!this.initConfig)&&(yield this.connect(e,r,t,i,n)),this.validateNotDisconnected("connect");let s=this.isFlagEnabled(Vi.FLAG_SERVER_SUB_DEGRADATION);this.initConfig&&(yield this.waitForLocalRoleAvailability(),yield this.createConnectionsAndNegotiateJoin(i,n,s),yield this.initRtcStatsMonitor(),y.d(he,"\u2705 join: Negotiated over PUBLISH connection"))}catch(s){y.e(he,`join: failed \u274C [token=${e}]`,s),this.state=Se.Failed;let a=s;throw a.isTerminal=a.isTerminal||a.code===500,yield this.observer.onStateChange(this.state,a),a}y.i(he,"\u2705 join: successful"),this.state=Se.Joined,this.observer.onStateChange(this.state)})}connect(e,t,i,r,n=!1){return T(this,null,function*(){this.setTransportStateForConnect(),this.joinParameters=new pd(e,i,r.name,r.metaData,t,n);try{return yield this.internalConnect(e,t,i)}catch(s){if(s instanceof te&&([le.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,le.WebSocketConnectionErrors.FAILED_TO_CONNECT,le.WebSocketConnectionErrors.ABNORMAL_CLOSE,le.InitAPIErrors.ENDPOINT_UNREACHABLE].includes(s.code)||s.code.toString().startsWith("5")||s.code.toString().startsWith("429"))){let a=()=>T(this,null,function*(){return yield this.internalConnect(e,t,i),Boolean(this.initConfig&&this.initConfig.endpoint)});yield this.retryScheduler.schedule({category:Me.ConnectFailed,error:s,task:a,originalState:this.state,maxFailedRetries:wn,changeState:!1})}else throw s}})}leave(e){return T(this,null,function*(){var t,i,r,n;this.retryScheduler.reset(),this.joinParameters=void 0,y.d(he,"leaving in transport");try{if(this.state=Se.Leaving,(t=this.webrtcInternals)==null||t.cleanUp(),(i=this.trackDegradationController)==null||i.cleanUp(),yield(r=this.publishConnection)==null?void 0:r.close(),yield(n=this.subscribeConnection)==null?void 0:n.close(),e)try{this.signal.leave(),y.d(he,"signal leave done")}catch(s){y.w(he,"failed to send leave on websocket to server",s)}this.analyticsEventsService.flushFailedClientEvents(),this.analyticsEventsService.reset(),yield this.signal.close()}catch(s){this.eventBus.analytics.publish($e.disconnect(s)),y.e(he,"leave: FAILED \u274C",s)}finally{this.state=Se.Disconnected,this.observer.onStateChange(this.state)}})}publish(e){return T(this,null,function*(){for(let t of e)try{yield this.publishTrack(t)}catch(i){this.eventBus.analytics.publish($e.publish({devices:this.deviceManager.getDevices(),error:i}))}})}unpublish(e){return T(this,null,function*(){for(let t of e)yield this.unpublishTrack(t)})}sendMessage(e){return T(this,null,function*(){return yield this.signal.broadcast(e)})}trackUpdate(e){let t=Array.from(this.trackStates.values()).find(i=>e.type===i.type&&e.source===i.source);if(t){let i=new oa(Xe(ce({},t),{mute:!e.enabled}));this.trackStates.set(t.track_id,i),y.d(he,"Track Update",this.trackStates,e),this.signal.trackUpdate(new Map([[t.track_id,i]]))}}changeRole(e,t,i=!1){return T(this,null,function*(){yield this.signal.requestRoleChange({requested_for:e.peerId,role:t,force:i})})}acceptRoleChange(e){return T(this,null,function*(){yield this.signal.acceptRoleChangeRequest({role:e.role.name,token:e.token})})}endRoom(e,t){return T(this,null,function*(){yield this.signal.endRoom(e,t)})}removePeer(e,t){return T(this,null,function*(){yield this.signal.removePeer({requested_for:e,reason:t})})}startRTMPOrRecording(e){return T(this,null,function*(){var t;let i={meeting_url:e.meetingURL,record:e.record};(t=e.rtmpURLs)!=null&&t.length&&(i.rtmp_urls=e.rtmpURLs),e.resolution&&(i.resolution=e.resolution),yield this.signal.startRTMPOrRecording(i)})}stopRTMPOrRecording(){return T(this,null,function*(){yield this.signal.stopRTMPAndRecording()})}startHLSStreaming(e){return T(this,null,function*(){let t={};e&&e.variants&&e.variants.length>0&&(t.variants=e.variants.map(i=>{let r={meeting_url:i.meetingURL};return i.metadata&&(r.metadata=i.metadata),r})),e!=null&&e.recording&&(t.hls_recording={single_file_per_layer:e.recording.singleFilePerLayer,hls_vod:e.recording.hlsVod}),yield this.signal.startHLSStreaming(t)})}stopHLSStreaming(e){return T(this,null,function*(){var t;if(e){let i={variants:(t=e==null?void 0:e.variants)==null?void 0:t.map(r=>{let n={meeting_url:r.meetingURL};return r.metadata&&(n.metadata=r.metadata),n})};yield this.signal.stopHLSStreaming(i)}yield this.signal.stopHLSStreaming()})}sendHLSTimedMetadata(e){return T(this,null,function*(){if(e.length>0){let t={metadata_objs:e};yield this.signal.sendHLSTimedMetadata(t)}})}changeName(e){return T(this,null,function*(){let t=this.store.getLocalPeer();t&&t.name!==e&&(yield this.signal.updatePeer({name:e}))})}changeMetadata(e){return T(this,null,function*(){yield this.signal.updatePeer({data:e})})}getSessionMetadata(){return this.signal.getSessionMetadata()}setSessionMetadata(e){return T(this,null,function*(){yield this.signal.setSessionMetadata({data:e})})}changeTrackState(e){return T(this,null,function*(){yield this.signal.requestTrackStateChange(e)})}changeMultiTrackState(e){return T(this,null,function*(){yield this.signal.requestMultiTrackStateChange(e)})}publishTrack(e){return T(this,null,function*(){e.publishedTrackId=e.getTrackIDBeingSent(),y.d(he,`\u23F3 publishTrack: trackId=${e.trackId}, toPublishTrackId=${e.publishedTrackId}`,`${e}`),this.trackStates.set(e.publishedTrackId,new oa(e));let t=new Promise((s,a)=>{this.callbacks.set(Oi,{promise:{resolve:s,reject:a},action:H.PUBLISH,extra:{}})}),i=e.stream;i.setConnection(this.publishConnection);let r=this.store.getSimulcastLayers(e.source);i.addTransceiver(e,r),y.time(`publish-${e.trackId}-${e.type}`),yield t,y.timeEnd(`publish-${e.trackId}-${e.type}`),this.store.addTrack(e);let n=e.settings.maxBitrate;n&&(yield i.setMaxBitrate(n,e).then(()=>{y.d(he,`Setting maxBitrate for ${e.source} ${e.type} to ${n} kpbs`)}).catch(s=>y.w(he,"Failed setting maxBitrate",s))),y.d(he,`\u2705 publishTrack: trackId=${e.trackId}`,`${e}`,this.callbacks)})}unpublishTrack(e){return T(this,null,function*(){if(y.d(he,`\u23F3 unpublishTrack: trackId=${e.trackId}`,`${e}`),e.publishedTrackId&&this.trackStates.has(e.publishedTrackId))this.trackStates.delete(e.publishedTrackId);else{let i=Array.from(this.trackStates.values()).find(r=>e.type===r.type&&e.source===r.source);i&&this.trackStates.delete(i.track_id)}let t=new Promise((i,r)=>{this.callbacks.set(Oi,{promise:{resolve:i,reject:r},action:H.UNPUBLISH,extra:{}})});e.stream.removeSender(e),yield t,yield e.cleanup(),this.store.removeTrack(e.trackId),y.d(he,`\u2705 unpublishTrack: trackId=${e.trackId}`,this.callbacks)})}waitForLocalRoleAvailability(){if(!this.store.hasRoleDetailsArrived())return new Promise(e=>{this.eventBus.policyChange.subscribeOnce(()=>e())})}createConnectionsAndNegotiateJoin(e,t=!1,i=!0){return T(this,null,function*(){let r=this.doesLocalPeerNeedWebRTC();r&&this.createPeerConnections(),yield this.negotiateJoinWithRetry({name:e.name,data:e.metaData,autoSubscribeVideo:t,serverSubDegrade:i,isWebRTC:r})})}createPeerConnections(){this.initConfig&&(this.publishConnection||(this.publishConnection=new Ed(this.signal,this.initConfig.rtcConfiguration,this.publishConnectionObserver,this)),this.subscribeConnection||(this.subscribeConnection=new Rd(this.signal,this.initConfig.rtcConfiguration,this.subscribeConnectionObserver)))}negotiateJoinWithRetry(e){return T(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n,isWebRTC:s=!0}){try{yield this.negotiateJoin({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n,isWebRTC:s})}catch(a){y.e(he,"Join negotiation failed \u274C",a);let o=a instanceof te?a:K.WebsocketMethodErrors.ServerErrors(500,H.JOIN,`Websocket join error - ${a.message}`);if(parseInt(`${o.code/100}`)===5||o.code===429){this.joinRetryCount=0,o.isTerminal=!1;let l=()=>T(this,null,function*(){return this.joinRetryCount++,yield this.negotiateJoin({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n,isWebRTC:s})});yield this.retryScheduler.schedule({category:Me.JoinWSMessageFailed,error:o,task:l,originalState:Se.Joined,maxFailedRetries:3,changeState:!1})}else throw a}})}negotiateJoin(e){return T(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n,isWebRTC:s=!0}){return s?yield this.negotiateJoinWebRTC({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n}):yield this.negotiateJoinNonWebRTC({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n})})}negotiateJoinWebRTC(e){return T(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n}){if(y.d(he,"\u23F3 join: Negotiating over PUBLISH connection"),!this.publishConnection)return y.e(he,"Publish peer connection not found, cannot negotiate"),!1;let s=yield this.publishConnection.createOffer();yield this.publishConnection.setLocalDescription(s);let a=yield this.signal.join(t,i,!r,n,s);yield this.publishConnection.setRemoteDescription(a);for(let o of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(o);return this.publishConnection.initAfterJoin(),!!a})}negotiateJoinNonWebRTC(e){return T(this,arguments,function*({name:t,data:i,autoSubscribeVideo:r,serverSubDegrade:n}){return y.d(he,"\u23F3 join: Negotiating Non-WebRTC"),!!(yield this.signal.join(t,i,!r,n))})}negotiateOnFirstPublish(){return T(this,null,function*(){if(y.d(he,"\u23F3 Negotiating offer over PUBLISH connection"),!this.publishConnection)return y.e(he,"Publish peer connection not found, cannot negotiate"),!1;let e=yield this.publishConnection.createOffer(this.trackStates);yield this.publishConnection.setLocalDescription(e);let t=yield this.signal.offer(e,this.trackStates);yield this.publishConnection.setRemoteDescription(t);for(let i of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(i);return this.publishConnection.initAfterJoin(),!!t})}performPublishRenegotiation(e){return T(this,null,function*(){y.d(he,"\u23F3 [role=PUBLISH] onRenegotiationNeeded START",this.trackStates);let t=this.callbacks.get(Oi);if(t){if(!this.publishConnection){y.e(he,"Publish peer connection not found, cannot renegotiate");return}try{let i=yield this.publishConnection.createOffer(this.trackStates,e);yield this.publishConnection.setLocalDescription(i),y.time("renegotiation-offer-exchange");let r=yield this.signal.offer(i,this.trackStates);this.callbacks.delete(Oi),y.timeEnd("renegotiation-offer-exchange"),yield this.publishConnection.setRemoteDescription(r),t.promise.resolve(!0),y.d(he,"[role=PUBLISH] onRenegotiationNeeded DONE \u2705")}catch(i){let r;i instanceof te?r=i:r=K.GenericErrors.Unknown(H.PUBLISH,i.message),t.promise.reject(r),y.d(he,"[role=PUBLISH] onRenegotiationNeeded FAILED \u274C")}}})}handleIceConnectionFailure(e){return T(this,null,function*(){e===_t.Publish?this.retryScheduler.schedule({category:Me.PublishIceConnectionFailed,error:K.WebrtcErrors.ICEFailure(H.PUBLISH),task:this.retryPublishIceFailedTask,originalState:Se.Joined}):this.retryScheduler.schedule({category:Me.SubscribeIceConnectionFailed,error:K.WebrtcErrors.ICEFailure(H.SUBSCRIBE),task:this.retrySubscribeIceFailedTask,originalState:Se.Joined,maxFailedRetries:1})})}internalConnect(e,t,i){return T(this,null,function*(){y.d(he,"connect: started \u23F0");let r=new Date;try{return this.analyticsTimer.start(Pe.INIT),this.initConfig=yield Nd.fetchInitConfig({token:e,peerId:i,userAgent:this.store.getUserAgent(),initEndpoint:t}),this.analyticsTimer.end(Pe.INIT),this.validateNotDisconnected("post init"),yield this.openSignal(e,i),y.d(he,"Adding Analytics Transport: JsonRpcSignal"),this.analyticsEventsService.setTransport(this.analyticsSignalTransport),this.analyticsEventsService.flush(),this.initConfig}catch(n){throw this.state!==Se.Reconnecting&&this.eventBus.analytics.publish($e.connect(n,this.getAdditionalAnalyticsProperties(),r,new Date,t)),y.d(he,"\u274C internal connect: failed",n),n}})}validateNotDisconnected(e){if(this.state===Se.Disconnected)throw y.w(he,"aborting join as transport state is disconnected"),K.GenericErrors.ValidationFailed(`leave called before join could complete - stage=${e}`)}openSignal(e,t){return T(this,null,function*(){if(!this.initConfig)throw K.InitAPIErrors.InitConfigNotAvailable(H.INIT,"Init Config not found");y.d(he,"\u23F3 internal connect: connecting to ws endpoint",this.initConfig.endpoint);let i=new URL(this.initConfig.endpoint);i.searchParams.set("peer",t),i.searchParams.set("token",e),i.searchParams.set("user_agent_v2",this.store.getUserAgent()),this.endpoint=i.toString(),this.analyticsTimer.start(Pe.WEBSOCKET_CONNECT),yield this.signal.open(this.endpoint),this.analyticsTimer.end(Pe.WEBSOCKET_CONNECT),this.analyticsTimer.start(Pe.ON_POLICY_CHANGE),y.d(he,"\u2705 internal connect: connected to ws endpoint")})}initRtcStatsMonitor(){return T(this,null,function*(){var e,t,i,r;(i=this.webrtcInternals)==null||i.setPeerConnections({publish:(e=this.publishConnection)==null?void 0:e.nativeConnection,subscribe:(t=this.subscribeConnection)==null?void 0:t.nativeConnection}),this.store.getSubscribeDegradationParams()&&(this.isFlagEnabled(Vi.FLAG_SERVER_SUB_DEGRADATION)||(yield(r=this.webrtcInternals)==null?void 0:r.start(),this.trackDegradationController=new Pd(this.store,this.eventBus),this.eventBus.statsUpdate.subscribe(n=>{var s,a,o;(o=this.trackDegradationController)==null||o.handleRtcStatsChange(((a=(s=n.getLocalPeerStats())==null?void 0:s.subscribe)==null?void 0:a.packetsLost)||0)})),this.eventBus.trackDegraded.subscribe(n=>{this.eventBus.analytics.publish($e.degradationStats(n,!0)),this.observer.onTrackDegrade(n)}),this.eventBus.trackRestored.subscribe(n=>{this.eventBus.analytics.publish($e.degradationStats(n,!1)),this.observer.onTrackRestore(n)}))})}doesRoleNeedWebRTC(e){var t,i;if(!this.isFlagEnabled(Vi.FLAG_NON_WEBRTC_DISABLE_OFFER))return!0;let r=Boolean(e.publishParams.allowed&&((t=e.publishParams.allowed)==null?void 0:t.length)>0),n=Boolean(e.subscribeParams.subscribeToRoles&&((i=e.subscribeParams.subscribeToRoles)==null?void 0:i.length)>0);return r||n}doesLocalPeerNeedWebRTC(){var e;let t=(e=this.store.getLocalPeer())==null?void 0:e.role;return t?this.doesRoleNeedWebRTC(t):!0}setTransportStateForConnect(){if(this.state===Se.Failed&&(this.state=Se.Disconnected),this.state!==Se.Disconnected&&this.state!==Se.Reconnecting)throw K.WebsocketMethodErrors.AlreadyJoined(H.JOIN,`Cannot join a meeting in ${this.state} state`);this.state===Se.Disconnected&&(this.state=Se.Connecting,this.observer.onStateChange(this.state))}sendErrorAnalyticsEvent(e,t){let i=this.getAdditionalAnalyticsProperties(),r;switch(t){case Me.ConnectFailed:r=$e.connect(e,i);break;case Me.SignalDisconnect:r=$e.disconnect(e,i);break;case Me.JoinWSMessageFailed:r=$e.join({error:e,time:this.analyticsTimer.getTimeTaken(Pe.JOIN),init_response_time:this.analyticsTimer.getTimeTaken(Pe.INIT),ws_connect_time:this.analyticsTimer.getTimeTaken(Pe.WEBSOCKET_CONNECT),on_policy_change_time:this.analyticsTimer.getTimeTaken(Pe.ON_POLICY_CHANGE),local_tracks_time:this.analyticsTimer.getTimeTaken(Pe.LOCAL_TRACKS),retries_join:this.joinRetryCount});break;case Me.PublishIceConnectionFailed:r=$e.publish({error:e});break;case Me.SubscribeIceConnectionFailed:r=$e.subscribeFail(e);break}this.eventBus.analytics.publish(r)}getAdditionalAnalyticsProperties(){var e,t,i,r,n,s,a,o;let l=Gd(),c=typeof document<"u"&&document.hidden,u=this.store.getRemoteVideoTracks().filter(p=>p.degraded).length,d=(r=(i=(t=(e=this.getWebrtcInternals())==null?void 0:e.getCurrentStats())==null?void 0:t.getLocalPeerStats())==null?void 0:i.publish)==null?void 0:r.bitrate,h=(o=(a=(s=(n=this.getWebrtcInternals())==null?void 0:n.getCurrentStats())==null?void 0:s.getLocalPeerStats())==null?void 0:a.subscribe)==null?void 0:o.bitrate;return{network_info:l,document_hidden:c,num_degraded_tracks:u,bitrate:{publish:d,subscribe:h},max_sub_bitrate:this.maxSubscribeBitrate,recent_pong_response_times:this.signal.getPongResponseTimes(),transport_state:this.state}}};function da(e){if(!e||e.length===0)throw K.InitAPIErrors.InvalidTokenFormat(H.INIT,"Token cannot be an empty string or undefined or null");let t=e.split(".");if(t.length!==3)throw K.InitAPIErrors.InvalidTokenFormat(H.INIT,"Expected 3 '.' separate fields - header, payload and signature respectively");let i=atob(t[1]);try{let r=JSON.parse(i);return{roomId:r.room_id,userId:r.user_id,role:r.role}}catch(r){throw K.InitAPIErrors.InvalidTokenFormat(H.INIT,`couldn't parse to json - ${r.message}`)}}var ha={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default"},pa={published:!1,isInitialised:!1,isReconnecting:!1,isPreviewInProgress:!1,deviceManagersInitialised:!1},jd=class{constructor(){this.TAG="[HMSSdk]:",this.transportState=Se.Disconnected,this.analyticsTimer=new mu,this.sdkState=ce({},pa),this.handleAutoplayError=e=>{var t,i;(i=(t=this.errorListener)==null?void 0:t.onError)==null||i.call(t,e)},this.observer={onNotification:e=>{if(e.method===Te.PEER_LEAVE_REQUEST){this.handlePeerLeaveRequest(e.params);return}e.method===Te.POLICY_CHANGE&&this.analyticsTimer.end(Pe.ON_POLICY_CHANGE),this.notificationManager.handleNotification(e,this.sdkState.isReconnecting)},onTrackAdd:e=>{this.notificationManager.handleTrackAdd(e)},onTrackRemove:e=>{this.notificationManager.handleTrackRemove(e)},onTrackDegrade:e=>{var t,i;y.d(this.TAG,"Sending Track Update Track Degraded",e),(i=this.listener)==null||i.onTrackUpdate(Ce.TRACK_DEGRADED,e,(t=this.store)==null?void 0:t.getPeerByTrackId(e.trackId))},onTrackRestore:e=>{var t,i;y.d(this.TAG,"Sending Track Update Track Restored",e),(i=this.listener)==null||i.onTrackUpdate(Ce.TRACK_RESTORED,e,(t=this.store)==null?void 0:t.getPeerByTrackId(e.trackId))},onFailure:e=>{var t;(t=this.errorListener)==null||t.onError(e)},onStateChange:(e,t)=>T(this,null,function*(){var i,r,n,s;switch(e){case Se.Preview:case Se.Joined:this.transportState===Se.Reconnecting&&((i=this.listener)==null||i.onReconnected());break;case Se.Failed:yield this.leave(),(n=(r=this.errorListener)==null?void 0:r.onError)==null||n.call(r,t),this.sdkState.isReconnecting=!1;break;case Se.Reconnecting:this.sdkState.isReconnecting=!0,(s=this.listener)==null||s.onReconnecting(t);break}this.transportState=e,y.d(this.TAG,"Transport State Change",this.transportState)})},this.handlePeerLeaveRequest=e=>{var t;let i=e.requested_by?this.store.getPeerById(e.requested_by):void 0,r={roomEnded:e.room_end,reason:e.reason,requestedBy:i};(t=this.listener)==null||t.onRemovedFromRoom(r),this.internalLeave(!1)},this.handleDeviceChange=e=>{var t,i,r,n,s,a;if(y.d(this.TAG,"Device Change event",e),(i=(t=this.deviceChangeListener)==null?void 0:t.onDeviceChange)==null||i.call(t,e),e.error&&e.type){let o=e.type.includes("audio")?(r=this.localPeer)==null?void 0:r.audioTrack:(n=this.localPeer)==null?void 0:n.videoTrack;(s=this.errorListener)==null||s.onError(e.error),[le.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,le.TracksErrors.DEVICE_IN_USE,le.TracksErrors.DEVICE_NOT_AVAILABLE].includes(e.error.code)&&o&&(o.setEnabled(!1),(a=this.listener)==null||a.onTrackUpdate(Ce.TRACK_MUTED,o,this.localPeer))}},this.handleAudioPluginError=e=>{var t;y.e(this.TAG,"Audio Plugin Error event",e),(t=this.errorListener)==null||t.onError(e)},this.handleLocalRoleUpdate=e=>T(this,[e],function*({oldRole:t,newRole:i}){var r;yield this.transport.handleLocalRoleUpdate({oldRole:t,newRole:i}),yield(r=this.roleChangeManager)==null?void 0:r.handleLocalPeerRoleUpdate({oldRole:t,newRole:i})}),this.sendAudioPresenceFailed=()=>{let e=K.TracksErrors.NoAudioDetected(H.PREVIEW);this.sendAnalyticsEvent($e.audioDetectionFail(e,this.deviceManager.getCurrentSelection().audioInput))},this.sendJoinAnalyticsEvent=(e=!1,t)=>{this.eventBus.analytics.publish($e.join(Xe(ce({error:t},this.analyticsTimer.getTimes(Pe.INIT,Pe.WEBSOCKET_CONNECT,Pe.ON_POLICY_CHANGE,Pe.LOCAL_TRACKS)),{time:this.analyticsTimer.getTimeTaken(Pe.JOIN),is_preview_called:e})))},this.sendPreviewAnalyticsEvent=e=>{this.eventBus.analytics.publish($e.preview(Xe(ce({error:e},this.analyticsTimer.getTimes(Pe.INIT,Pe.WEBSOCKET_CONNECT,Pe.ON_POLICY_CHANGE,Pe.LOCAL_TRACKS)),{time:this.analyticsTimer.getTimeTaken(Pe.PREVIEW)})))},this.sendAnalyticsEvent=e=>{this.analyticsEventsService.queue(e).flush()}}initStoreAndManagers(){if(this.sdkState.isInitialised){this.notificationManager.setListener(this.listener),this.audioSinkManager.setListener(this.listener);return}this.sdkState.isInitialised=!0,this.store=new zu,this.eventBus=new Xu,this.networkTestManager=new qu(this.eventBus,this.listener),this.playlistManager=new hd(this,this.eventBus),this.notificationManager=new cd(this.store,this.eventBus,this.listener,this.audioListener),this.deviceManager=new Yu(this.store,this.eventBus),this.audioSinkManager=new Qu(this.store,this.deviceManager,this.eventBus),this.audioOutput=new Zu(this.deviceManager,this.audioSinkManager),this.audioSinkManager.setListener(this.listener),this.eventBus.autoplayError.subscribe(this.handleAutoplayError),this.localTrackManager=new Or(this.store,this.observer,this.deviceManager,this.eventBus,this.analyticsTimer),this.analyticsEventsService=new Ju(this.store),this.transport=new Vd(this.observer,this.deviceManager,this.store,this.eventBus,this.analyticsEventsService,this.analyticsTimer),this.eventBus.analytics.subscribe(this.sendAnalyticsEvent),this.eventBus.deviceChange.subscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.subscribe(this.handleAudioPluginError)}validateJoined(e){if(!this.localPeer)throw K.GenericErrors.NotConnected(H.VALIDATION,`Not connected - ${e}`)}refreshDevices(){return T(this,null,function*(){this.validateJoined("refreshDevices"),yield this.deviceManager.init(!0)})}getWebrtcInternals(){var e;return(e=this.transport)==null?void 0:e.getWebrtcInternals()}getPlaylistManager(){return this.playlistManager}getRecordingState(){var e;return(e=this.store.getRoom())==null?void 0:e.recording}getRTMPState(){var e;return(e=this.store.getRoom())==null?void 0:e.rtmp}getHLSState(){var e;return(e=this.store.getRoom())==null?void 0:e.hls}get localPeer(){var e;return(e=this.store)==null?void 0:e.getLocalPeer()}preview(e,t){return T(this,null,function*(){if(ca(),la(),this.sdkState.isPreviewInProgress)return Promise.reject(K.GenericErrors.PreviewAlreadyInProgress(H.PREVIEW,"Preview already called"));this.analyticsTimer.start(Pe.PREVIEW),this.setUpPreview(e,t),e.alwaysRequestPermissions&&this.localTrackManager.requestPermissions().then(()=>T(this,null,function*(){yield this.initDeviceManagers()}));let i=!1,r=!1,n=setTimeout(()=>{var s,a;(!i||!r)&&((a=(s=this.listener)==null?void 0:s.onNetworkQuality)==null||a.call(s,-1))},3e3);return new Promise((s,a)=>{let o=()=>T(this,null,function*(){var l;let c=yield this.localTrackManager.getTracksToPublish(e.settings||ha);c.forEach(u=>this.setLocalPeerTrack(u)),(l=this.localPeer)!=null&&l.audioTrack&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),this.sdkState.isPreviewInProgress=!1,this.analyticsTimer.end(Pe.PREVIEW),t.onPreview(this.store.getRoom(),c),this.sendPreviewAnalyticsEvent(),s()});this.eventBus.policyChange.subscribeOnce(o),this.transport.preview(e.authToken,e.initEndpoint,this.localPeer.peerId,{name:e.userName,metaData:e.metaData||""},e.autoVideoSubscribe).then(l=>{var c;i=!0,clearTimeout(n),l&&e.captureNetworkQualityInPreview&&this.networkTestManager.start((c=l.config)==null?void 0:c.networkHealth).then(()=>{r=!0})}).catch(l=>{var c;this.analyticsTimer.end(Pe.PREVIEW),(c=this.errorListener)==null||c.onError(l),this.sendPreviewAnalyticsEvent(l),this.sdkState.isPreviewInProgress=!1,a(l)})})})}join(e,t){return T(this,null,function*(){var i,r,n,s;if(ca(),la(),this.sdkState.isPreviewInProgress)throw K.GenericErrors.NotReady(H.JOIN,"Preview is in progress, can't join");this.analyticsTimer.start(Pe.JOIN);let a=this.transportState===Se.Preview,{roomId:o,userId:l,role:c}=da(e.authToken);(i=this.networkTestManager)==null||i.stop(),(n=(r=this.localPeer)==null?void 0:r.audioTrack)==null||n.destroyAudioLevelMonitor(),this.listener=t,this.commonSetup(e,o,t),this.removeDevicesFromConfig(e),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.localPeer?(this.localPeer.name=e.userName,this.localPeer.role=this.store.getPolicyForRole(c),this.localPeer.customerUserId=l,this.localPeer.metadata=e.metaData):this.createAndAddLocalPeerToStore(e,c,l),this.roleChangeManager=new Hu(this.store,this.transport,this.publish.bind(this),this.removeTrack.bind(this),this.listener),this.eventBus.localRoleUpdate.subscribe(this.handleLocalRoleUpdate),y.d(this.TAG,"SDK Store",this.store),y.d(this.TAG,`\u23F3 Joining room ${o}`),y.time(`join-room-${o}`);try{yield this.transport.join(e.authToken,this.localPeer.peerId,{name:e.userName,metaData:e.metaData},e.initEndpoint,e.autoVideoSubscribe),y.d(this.TAG,`\u2705 Joined room ${o}`),rl.resumeContext(),yield this.notifyJoin(),this.sendJoinAnalyticsEvent(a),[this.store.getPublishParams(),!this.sdkState.published,!ts].every(u=>!!u)&&this.publish(e.settings||ha).catch(u=>{var d;y.e(this.TAG,"Error in publish",u),(d=this.listener)==null||d.onError(u)})}catch(u){throw this.analyticsTimer.end(Pe.JOIN),(s=this.listener)==null||s.onError(u),this.sendJoinAnalyticsEvent(a,u),y.e(this.TAG,"Unable to join room",u),u}y.timeEnd(`join-room-${o}`)})}stringifyMetadata(e){e.metaData&&typeof e.metaData!="string"?e.metaData=JSON.stringify(e.metaData):e.metaData||(e.metaData="")}cleanUp(){var e,t;this.cleanDeviceManagers(),this.eventBus.analytics.unsubscribe(this.sendAnalyticsEvent),this.analyticsTimer.cleanUp(),Zt.cleanup(),this.playlistManager.cleanup(),y.cleanUp(),this.sdkState=ce({},pa),this.localPeer&&((e=this.localPeer.audioTrack)==null||e.cleanup(),this.localPeer.audioTrack=void 0,(t=this.localPeer.videoTrack)==null||t.cleanup(),this.localPeer.videoTrack=void 0),this.store.cleanUp(),this.listener=void 0,this.roleChangeManager&&this.eventBus.localRoleUpdate.unsubscribe(this.roleChangeManager.handleLocalPeerRoleUpdate)}leave(){return this.internalLeave()}internalLeave(e=!0){return T(this,null,function*(){var t,i;let r=this.store.getRoom();if(r){let n=r.id;(t=this.networkTestManager)==null||t.stop(),y.d(this.TAG,`\u23F3 Leaving room ${n}`),yield(i=this.transport)==null?void 0:i.leave(e),this.cleanUp(),y.d(this.TAG,`\u2705 Left room ${n}`)}})}getLocalPeer(){return this.store.getLocalPeer()}getPeers(){let e=this.store.getPeers();return e.length<50&&y.d(this.TAG,`Got peers(${e.length})`,e.toString()),e}getAudioOutput(){return this.audioOutput}sendMessage(e,t){this.sendMessageInternal({message:t,type:e})}sendBroadcastMessage(e,t){return T(this,null,function*(){return yield this.sendMessageInternal({message:e,type:t})})}sendGroupMessage(e,t,i){return T(this,null,function*(){let r=this.store.getKnownRoles();if((t.filter(n=>r[n.name])||[]).length===0)throw K.GenericErrors.ValidationFailed("No valid role is present",t);return yield this.sendMessageInternal({message:e,recipientRoles:t,type:i})})}sendDirectMessage(e,t,i){return T(this,null,function*(){var r;if(!this.store.getPeerById(t.peerId))throw K.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);if(((r=this.localPeer)==null?void 0:r.peerId)===t.peerId)throw K.GenericErrors.ValidationFailed("Cannot send message to self");return yield this.sendMessageInternal({message:e,recipientPeer:t,type:i})})}sendMessageInternal(e){return T(this,arguments,function*({recipientRoles:t,recipientPeer:i,type:r="chat",message:n}){if(n.replace(/\u200b/g," ").trim()==="")throw y.w(this.TAG,"sendMessage","Ignoring empty message send"),K.GenericErrors.ValidationFailed("Empty message not allowed");let s=new Qo({sender:this.localPeer,type:r,message:n,recipientPeer:i,recipientRoles:t,time:new Date});y.d(this.TAG,"Sending Message: ",s);let a=yield this.transport.sendMessage(s);return s.time=new Date(a.timestamp),s})}startScreenShare(e,t){return T(this,null,function*(){var i,r,n;let s=this.store.getPublishParams();if(!s)return;let{allowed:a}=s;if(!(a&&a.includes("screen"))){y.e(this.TAG,`Role ${(i=this.localPeer)==null?void 0:i.role} cannot share screen`);return}if((n=(r=this.localPeer)==null?void 0:r.auxiliaryTracks)!=null&&n.find(l=>l.source==="screen"))throw Error("Cannot share multiple screens");let o=yield this.getScreenshareTracks(e,t);if(!this.localPeer){y.d(this.TAG,"Screenshared when not connected"),o.forEach(l=>{l.cleanup()});return}yield this.transport.publish(o),o.forEach(l=>{var c,u,d;l.peerId=(c=this.localPeer)==null?void 0:c.peerId,(u=this.localPeer)==null||u.auxiliaryTracks.push(l),(d=this.listener)==null||d.onTrackUpdate(Ce.TRACK_ADDED,l,this.localPeer)})})}stopEndedScreenshare(e){return T(this,null,function*(){y.d(this.TAG,"\u2705 Screenshare ended natively"),yield this.stopScreenShare(),e()})}stopScreenShare(){return T(this,null,function*(){var e;y.d(this.TAG,"\u2705 Screenshare ended from app");let t=(e=this.localPeer)==null?void 0:e.auxiliaryTracks.filter(i=>i.source==="screen");if(t)for(let i of t)yield this.removeTrack(i.trackId)})}addTrack(e,t="regular"){return T(this,null,function*(){var i,r,n,s;if(!e){y.w(this.TAG,"Please pass a valid MediaStreamTrack");return}if(!this.localPeer)throw K.GenericErrors.NotConnected(H.VALIDATION,"No local peer present, cannot addTrack");if(this.localPeer.auxiliaryTracks.find(d=>d.trackId===e.id))return;let a=e.kind,o=new MediaStream([e]),l=new Dr(o),c=a==="audio"?zi:li,u=new c(l,e,t,this.eventBus);this.setPlaylistSettings({track:e,hmsTrack:u,source:t}),yield(i=this.transport)==null?void 0:i.publish([u]),u.peerId=(r=this.localPeer)==null?void 0:r.peerId,(n=this.localPeer)==null||n.auxiliaryTracks.push(u),(s=this.listener)==null||s.onTrackUpdate(Ce.TRACK_ADDED,u,this.localPeer)})}removeTrack(e){return T(this,null,function*(){var t;if(!this.localPeer)throw K.GenericErrors.NotConnected(H.VALIDATION,"No local peer present, cannot removeTrack");let i=this.localPeer.auxiliaryTracks.findIndex(r=>r.trackId===e);if(i>-1){let r=this.localPeer.auxiliaryTracks[i];yield this.transport.unpublish([r]),r.source==="audioplaylist"?this.playlistManager.stop(pe.audio):r.source==="videoplaylist"&&this.playlistManager.stop(pe.video),this.localPeer.auxiliaryTracks.splice(i,1),(t=this.listener)==null||t.onTrackUpdate(Ce.TRACK_REMOVED,r,this.localPeer)}else y.w(this.TAG,`No track found for ${e}`)})}setAnalyticsLevel(e){this.analyticsEventsService.level=e}setLogLevel(e){y.level=e}addAudioListener(e){this.audioListener=e,this.notificationManager.setAudioListener(e)}addConnectionQualityListener(e){this.notificationManager.setConnectionQualityListener(e)}changeRole(e,t,i=!1){return T(this,null,function*(){var r;!e.role||e.role.name===t||(yield(r=this.transport)==null?void 0:r.changeRole(e,t,i))})}acceptChangeRole(e){return T(this,null,function*(){var t;yield(t=this.transport)==null?void 0:t.acceptRoleChange(e)})}endRoom(e,t){return T(this,null,function*(){var i;if(!this.localPeer)throw K.GenericErrors.NotConnected(H.VALIDATION,"No local peer present, cannot end room");yield(i=this.transport)==null?void 0:i.endRoom(e,t),yield this.leave()})}removePeer(e,t){return T(this,null,function*(){var i;if(!this.localPeer)throw K.GenericErrors.NotConnected(H.VALIDATION,"No local peer present, cannot remove peer");if(!this.store.getPeerById(e.peerId))throw K.GenericErrors.ValidationFailed("Invalid peer, given peer not present in room",e);yield(i=this.transport)==null?void 0:i.removePeer(e.peerId,t)})}startRTMPOrRecording(e){return T(this,null,function*(){var t;if(!this.localPeer)throw K.GenericErrors.NotConnected(H.VALIDATION,"No local peer present, cannot start streaming or recording");yield(t=this.transport)==null?void 0:t.startRTMPOrRecording(e)})}stopRTMPAndRecording(){return T(this,null,function*(){var e;if(!this.localPeer)throw K.GenericErrors.NotConnected(H.VALIDATION,"No local peer present, cannot stop streaming or recording");yield(e=this.transport)==null?void 0:e.stopRTMPOrRecording()})}startHLSStreaming(e){return T(this,null,function*(){var t;if(!this.localPeer)throw K.GenericErrors.NotConnected(H.VALIDATION,"No local peer present, cannot start HLS streaming");yield(t=this.transport)==null?void 0:t.startHLSStreaming(e)})}stopHLSStreaming(e){return T(this,null,function*(){var t;if(!this.localPeer)throw K.GenericErrors.NotConnected(H.VALIDATION,"No local peer present, cannot stop HLS streaming");yield(t=this.transport)==null?void 0:t.stopHLSStreaming(e)})}sendHLSTimedMetadata(e){return T(this,null,function*(){var t;this.validateJoined("sendHLSTimedMetadata"),yield(t=this.transport)==null?void 0:t.sendHLSTimedMetadata(e)})}changeName(e){return T(this,null,function*(){var t;this.validateJoined("changeName"),yield(t=this.transport)==null?void 0:t.changeName(e),this.notificationManager.updateLocalPeer({name:e})})}changeMetadata(e){return T(this,null,function*(){var t;this.validateJoined("changeMetadata"),yield(t=this.transport)==null?void 0:t.changeMetadata(e),this.notificationManager.updateLocalPeer({metadata:e})})}setSessionMetadata(e){return T(this,null,function*(){yield this.transport.setSessionMetadata(e)})}getSessionMetadata(){return T(this,null,function*(){return(yield this.transport.getSessionMetadata()).data})}getRoles(){return Object.values(this.store.getKnownRoles())}changeTrackState(e,t){return T(this,null,function*(){var i;if(e.type===Ve.VIDEO&&e.source!=="regular"){y.w(this.TAG,"Muting non-regular video tracks is currently not supported");return}if(e.enabled===t){y.w(this.TAG,`Aborting change track state, track already has enabled - ${t}`,e);return}if(!this.store.getTrackById(e.trackId))throw K.GenericErrors.ValidationFailed("No track found for change track state",e);let r=this.store.getPeerByTrackId(e.trackId);if(!r)throw K.GenericErrors.ValidationFailed("No peer found for change track state",e);yield(i=this.transport)==null?void 0:i.changeTrackState({requested_for:r.peerId,track_id:e.trackId,stream_id:e.stream.id,mute:!t})})}changeMultiTrackState(e){return T(this,null,function*(){var t;if(typeof e.enabled!="boolean")throw K.GenericErrors.ValidationFailed("Pass a boolean for enabled");let{enabled:i,roles:r,type:n,source:s}=e;yield(t=this.transport)==null?void 0:t.changeMultiTrackState({value:!i,type:n,source:s,roles:r==null?void 0:r.map(a=>a==null?void 0:a.name)})})}setFrameworkInfo(e){this.frameworkInfo=e}publish(e){return T(this,null,function*(){let t=yield this.localTrackManager.getTracksToPublish(e);yield this.setAndPublishTracks(t),this.sdkState.published=!0})}setAndPublishTracks(e){return T(this,null,function*(){var t;for(let i of e)yield this.transport.publish([i]),this.setLocalPeerTrack(i),(t=this.listener)==null||t.onTrackUpdate(Ce.TRACK_ADDED,i,this.localPeer);yield this.initDeviceManagers()})}setLocalPeerTrack(e){var t;switch(e.peerId=(t=this.localPeer)==null?void 0:t.peerId,e.type){case Ve.AUDIO:this.localPeer.audioTrack=e;break;case Ve.VIDEO:this.localPeer.videoTrack=e;break}}initDeviceManagers(){return T(this,null,function*(){var e,t,i,r,n;this.sdkState.deviceManagersInitialised||(this.sdkState.deviceManagersInitialised=!0,yield this.deviceManager.init(),(yield this.deviceManager.updateOutputDevice((t=(e=this.store.getConfig())==null?void 0:e.settings)==null?void 0:t.audioOutputDeviceId))||(yield this.deviceManager.updateOutputDevice((r=(i=Zt.getSelection())==null?void 0:i.audioOutput)==null?void 0:r.deviceId)),this.audioSinkManager.init((n=this.store.getConfig())==null?void 0:n.audioSinkElementId))})}cleanDeviceManagers(){this.eventBus.deviceChange.unsubscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.unsubscribe(this.handleAudioPluginError),this.eventBus.autoplayError.unsubscribe(this.handleAutoplayError),this.deviceManager.cleanUp(),this.audioSinkManager.cleanUp()}initPreviewTrackAudioLevelMonitor(){var e;let t=(e=this.localPeer)==null?void 0:e.audioTrack;t==null||t.initAudioLevelMonitor(),this.eventBus.trackAudioLevelUpdate.subscribe(i=>{var r;let n=i&&i.track.trackId===(t==null?void 0:t.trackId)?[{audioLevel:i.audioLevel,peer:this.localPeer,track:t}]:[];this.store.updateSpeakers(n),(r=this.audioListener)==null||r.onAudioLevelUpdate(n)}),this.eventBus.localAudioSilence.subscribe(this.sendAudioPresenceFailed)}notifyJoin(){var e;let t=this.store.getLocalPeer(),i=this.store.getRoom();if(i.joinedAt=new Date,t&&(t.joinedAt=i.joinedAt),t==null?void 0:t.role){this.analyticsTimer.end(Pe.JOIN),(e=this.listener)==null||e.onJoin(i);return}return new Promise(r=>{this.eventBus.policyChange.subscribeOnce(()=>{var n;this.analyticsTimer.end(Pe.JOIN),(n=this.listener)==null||n.onJoin(i),r()})})}setUpPreview(e,t){this.listener=t,this.sdkState.isPreviewInProgress=!0;let{roomId:i,userId:r,role:n}=da(e.authToken);this.commonSetup(e,i,t),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.createAndAddLocalPeerToStore(e,n,r),y.d(this.TAG,"SDK Store",this.store)}setPlaylistSettings(e){return T(this,arguments,function*({track:t,hmsTrack:i,source:r}){if(r==="videoplaylist"){let n={};if(t.kind==="audio")n.maxBitrate=64;else{n.maxBitrate=1e3;let{width:s,height:a}=t.getSettings();n.width=s,n.height=a}yield i.setSettings(n)}else r==="audioplaylist"&&(yield i.setSettings({maxBitrate:64}))})}createAndAddLocalPeerToStore(e,t,i){let r=this.store.getPolicyForRole(t),n=new hu({name:e.userName||"",customerUserId:i,metadata:e.metaData||"",role:r});this.store.addPeer(n)}commonSetup(e,t,i){this.stringifyMetadata(e),e.initEndpoint||(e.initEndpoint="https://prod-init.100ms.live"),this.errorListener=i,this.deviceChangeListener=i,this.initStoreAndManagers(),this.store.setErrorListener(this.errorListener),this.store.getRoom()||this.store.setRoom(new du(t,this.store))}removeDevicesFromConfig(e){this.store.getConfig()&&e.settings&&(delete e.settings.audioOutputDeviceId,delete e.settings.videoDeviceId,delete e.settings.audioInputDeviceId)}getScreenshareTracks(e,t){return T(this,null,function*(){let[i,r]=yield this.localTrackManager.getLocalScreen(t),n=()=>{this.stopEndedScreenshare(e)},s=[];if(t!=null&&t.audioOnly){if(i.nativeTrack.stop(),!r)throw K.TracksErrors.NothingToReturn(H.TRACK,"Select share audio when sharing screen","No audio found");s.push(r),r.nativeTrack.onended=n}else s.push(i),i.nativeTrack.onended=n,r&&s.push(r);return s})}};y.i("adapter",`${Rr.browserDetails.browser} v${Rr.browserDetails.version}`);function qd(e,t){return e===t}function Hd(e,t,i){if(t===null||i===null||t.length!==i.length)return!1;for(var r=t.length,n=0;n<r;n++)if(!e(t[n],i[n]))return!1;return!0}function Kd(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qd,i=null,r=null;return function(){return Hd(t,i,arguments)||(r=e.apply(null,arguments)),i=arguments,r}}function Wd(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every(function(r){return typeof r=="function"})){var i=t.map(function(r){return typeof r}).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, "+("instead received the following types: ["+i+"]"))}return t}function zd(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return function(){for(var n=arguments.length,s=Array(n),a=0;a<n;a++)s[a]=arguments[a];var o=0,l=s.pop(),c=Wd(s),u=e.apply(void 0,[function(){return o++,l.apply(null,arguments)}].concat(i)),d=e(function(){for(var h=[],p=c.length,g=0;g<p;g++)h.push(c[g].apply(null,arguments));return u.apply(null,h)});return d.resultFunc=l,d.dependencies=c,d.recomputations=function(){return o},d.resetRecomputations=function(){return o=0},d}}var q=zd(Kd),Jd=Object.defineProperty,Qd=Object.defineProperties,Yd=Object.getOwnPropertyDescriptors,fa=Object.getOwnPropertySymbols,Zd=Object.prototype.hasOwnProperty,Xd=Object.prototype.propertyIsEnumerable,ma=(e,t,i)=>t in e?Jd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,si=(e,t)=>{for(var i in t||(t={}))Zd.call(t,i)&&ma(e,i,t[i]);if(fa)for(var i of fa(t))Xd.call(t,i)&&ma(e,i,t[i]);return e},us=(e,t)=>Qd(e,Yd(t)),eh=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),re=(e,t,i)=>new Promise((r,n)=>{var s=l=>{try{o(i.next(l))}catch(c){n(c)}},a=l=>{try{o(i.throw(l))}catch(c){n(c)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,a);o((i=i.apply(e,t)).next())}),th=eh((e,t)=>{t.exports={version:"0.7.1",license:"MIT",main:"dist/index.cjs.js",module:"dist/index.js",typings:"dist/index.d.ts",files:["dist","src"],engines:{node:">=12"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",format:"prettier --write src/**/*.ts",test:"jest --maxWorkers=1","test:watch":"jest --watch","test:coverage":"jest --coverage",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",docs:"rm -rf ./docs && typedoc && rm -f ./docs/README.md && mkdir ./docs/home &&mv ./docs/modules.md ./docs/home/content.md && node ../../scripts/docs-store && npx prettier --write './docs/**/*'"},name:"@100mslive/hms-video-store",author:"100ms",sideEffects:!1,dependencies:{"@100mslive/hms-video":"0.6.1",eventemitter2:"^6.4.7",immer:"^9.0.6",reselect:"4.0.0",zustand:"3.5.7"},devDependencies:{"ts-node":"^10.4.0",tslib:"^2.2.0"},description:"This is an addon to the core sdk provided by 100ms. It abstracts away the intricacies of data management and provides a flux based reactive data store where data flows in only one direction.",repository:{type:"git",url:"git+https://github.com/100mslive/hms-video-store.git"},keywords:["video","webrtc","conferencing","100ms"],bugs:{url:"https://github.com/100mslive/hms-video-store/issues"},homepage:"https://github.com/100mslive/hms-video-store#readme",gitHead:"b4d98c849c3e4ae4e583b2e2c8f9813193cf1d7c"}}),je;(function(e){e.Disconnected="Disconnected",e.Preview="Preview",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed"})(je||(je={}));var cl=()=>({room:{id:"",isConnected:!1,name:"",peers:[],localPeer:"",roomState:je.Disconnected,recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[]}),ul=()=>({peerStats:{},trackStats:{},localPeer:{id:""}}),ga;(function(e){e.CHAT="chat"})(ga||(ga={}));var ot;(function(e){e.INFO="info",e.ERROR="error"})(ot||(ot={}));var Ee;(function(e){e.PEER_JOINED="PEER_JOINED",e.PEER_LEFT="PEER_LEFT",e.PEER_LIST="PEER_LIST",e.NEW_MESSAGE="NEW_MESSAGE",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED",e.TRACK_ADDED="TRACK_ADDED",e.TRACK_REMOVED="TRACK_REMOVED",e.TRACK_MUTED="TRACK_MUTED",e.TRACK_UNMUTED="TRACK_UNMUTED",e.TRACK_DEGRADED="TRACK_DEGRADED",e.TRACK_RESTORED="TRACK_RESTORED",e.TRACK_DESCRIPTION_CHANGED="TRACK_DESCRIPTION_CHANGED",e.ROLE_UPDATED="ROLE_UPDATED",e.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",e.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",e.ROOM_ENDED="ROOM_ENDED",e.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",e.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",e.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",e.NAME_UPDATED="NAME_UPDATED",e.METADATA_UPDATED="METADATA_UPDATED"})(Ee||(Ee={}));var De;(function(e){e.audio="audio",e.video="video"})(De||(De={}));var dl={[Qe.PEER_JOINED]:Ee.PEER_JOINED,[Qe.PEER_LEFT]:Ee.PEER_LEFT,[Qe.ROLE_UPDATED]:Ee.ROLE_UPDATED,[Qe.NAME_UPDATED]:Ee.NAME_UPDATED,[Qe.METADATA_UPDATED]:Ee.METADATA_UPDATED},hl={[Ce.TRACK_ADDED]:Ee.TRACK_ADDED,[Ce.TRACK_REMOVED]:Ee.TRACK_REMOVED,[Ce.TRACK_MUTED]:Ee.TRACK_MUTED,[Ce.TRACK_UNMUTED]:Ee.TRACK_UNMUTED,[Ce.TRACK_DEGRADED]:Ee.TRACK_DEGRADED,[Ce.TRACK_RESTORED]:Ee.TRACK_RESTORED,[Ce.TRACK_DESCRIPTION_CHANGED]:Ee.TRACK_DESCRIPTION_CHANGED};function Yi(e,t){let i,r;if(t)for(let n of t.auxiliaryTracks){let s=e[n];ih(s)&&(r=ds(s)?s:r,i=hs(s)?s:i)}return{video:i,audio:r}}function ds(e){return e&&e.type==="audio"}function hs(e){return e&&e.type==="video"}function ih(e){return e&&e.source==="screen"}function pl(e){return e&&e.source==="audioplaylist"}function ps(e){return e&&e.source==="videoplaylist"}function rh(e){return e?Boolean(e==null?void 0:e.degraded):!1}function fs(e,t){return t&&e.tracks[t]?e.tracks[t].enabled:!1}function nh(e,t){return t&&e.tracks[t]?e.tracks[t].displayEnabled:!1}var yt=e=>e.room;q(yt,e=>e.id);var At=e=>e.peers,fl=e=>e.messages.byID,ml=e=>e.messages.allIDs,He=e=>e.tracks,gl=e=>e.settings,sh=e=>e.appData,ah=e=>e.devices,vl=e=>e.speakers,yl=q([yt],e=>e&&e.isConnected);q([yl,yt],(e,t)=>e?t.peerCount!==void 0?t.peerCount||1:t.peers.length:Math.max(t.peerCount!==void 0?t.peerCount:t.peers.length-1,0));var Tl=q([yt,At],(e,t)=>e.peers.map(i=>t[i])),oh=q(He,e=>Object.values(e)),St=q(yt,At,(e,t)=>t[e.localPeer]),ji=q(yt,e=>e.localPeer);q(St,e=>e==null?void 0:e.name);q(St,e=>e==null?void 0:e.roleName);var Ft=q(St,e=>e==null?void 0:e.audioTrack),Bt=q(St,e=>e==null?void 0:e.videoTrack),lh=q(St,e=>e==null?void 0:e.auxiliaryTracks),ch=q([Ft,Bt,lh],(e,t,i)=>{let r=[...i];return e&&r.unshift(e),t&&r.unshift(t),r});q(Tl,e=>e.filter(t=>!t.isLocal));q(At,vl,(e,t)=>{let i=Object.entries(t).sort((r,n)=>{var s,a;let o=((s=r[1])==null?void 0:s.audioLevel)||0;return(((a=n[1])==null?void 0:a.audioLevel)||0)>o?1:-1});if(i.length>0&&i[0][1].audioLevel&&i[0][1].audioLevel>0){let r=i[0][1].peerID;if(r in e)return e[r]}return null});var uh=e=>{let t=St(e);return fs(e,t==null?void 0:t.audioTrack)},On=e=>{let t=St(e);return fs(e,t==null?void 0:t.videoTrack)},dh=e=>{let t=St(e);return nh(e,t==null?void 0:t.videoTrack)},Mn=q(St,He,(e,t)=>{let{video:i,audio:r}=Yi(t,e);return!!(i||r)}),bl=q(At,He,(e,t)=>{let i;for(let r in e){let n=e[r],{video:s,audio:a}=Yi(t,n);if(s)return n;a&&!i&&(i=n)}return i}),hh=q(bl,e=>!!e);q(At,He,(e,t)=>{for(let i in e){let r=e[i],{audio:n,video:s}=Yi(t,r);if(!s&&!!n)return r}});q(At,He,(e,t)=>{let i=[],r=[];for(let n in e){let s=e[n],{video:a,audio:o}=Yi(t,s);a?i.push(s):o&&r.push(s)}return i.concat(r)});q(At,He,(e,t)=>{for(let i in t){let r=t[i];if(ps(r)&&hs(r)&&r.peerId)return e[r.peerId]}});q(At,He,(e,t)=>{for(let i in t){let r=t[i];if(pl(r)&&r.peerId)return e[r.peerId]}});q(oh,e=>e.filter(rh));var ph=q(ml,e=>e.length);q(fl,e=>Object.values(e).filter(t=>!t.read).length);var Kr=q(ml,fl,(e,t)=>{let i=[];return e.forEach(r=>{i.push(t[r])}),i}),wt=q([yt],e=>e&&e.roomState);q(wt,e=>e===je.Preview);var fh=q(yt,e=>e.roomState!==je.Disconnected),Ji=e=>e.roles;q([Ji],e=>Object.keys(e));var ms=q([St,Ji],(e,t)=>e!=null&&e.roleName?t[e.roleName]:null);q([ms],e=>{var t;return(t=e==null?void 0:e.subscribeParams)!=null&&t.subscribeToRoles?e.subscribeParams.subscribeToRoles.length>0:!1});var mh=q(ms,e=>e==null?void 0:e.permissions);q(yt,e=>e.recording);q(yt,e=>e.rtmp);q(yt,e=>e.hls);q(yt,e=>e.sessionId);q(yt,e=>e.startedAt);var _l=(e=De.audio)=>t=>t.playlist[e].list,gs=(e=De.audio)=>t=>t.playlist[e].selection,kl=(e=De.audio)=>t=>t.playlist[e].progress,Sl=(e=De.audio)=>t=>t.playlist[e].currentTime,El=(e=De.audio)=>t=>t.playlist[e].playbackRate,Cl=(e=De.audio)=>t=>t.playlist[e].volume,Rl=(e=De.audio)=>q(_l(e),t=>Object.values(t)),Pl=(e=De.audio)=>q(_l(e),gs(e),(t,i)=>{if(i.id)return t[i.id]}),gh={selection:gs(De.audio),progress:kl(De.audio),currentTime:Sl(De.audio),playbackRate:El(De.audio),volume:Cl(De.audio),list:Rl(De.audio),selectedItem:Pl(De.audio)},vh={selection:gs(De.video),progress:kl(De.video),currentTime:Sl(De.video),playbackRate:El(De.video),volume:Cl(De.video),list:Rl(De.video),selectedItem:Pl(De.video)};function Ke(e){return t=>i=>e(i,t)}var Ni="HMS-Store:",Ie=class{static v(e,...t){this.log(ze.VERBOSE,e,...t)}static d(...e){this.log(ze.DEBUG,...e)}static i(...e){this.log(ze.INFO,...e)}static w(...e){this.log(ze.WARN,...e)}static e(...e){this.log(ze.ERROR,...e)}static time(e){this.log(ze.TIME,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(ze.TIMEEND,"[HMSPerformanceTiming]",e,e)}static cleanUp(){performance.clearMarks(),performance.clearMeasures()}static log(e,...t){if(!(this.level.valueOf()>e.valueOf()))switch(e){case ze.VERBOSE:{console.log(Ni,...t);break}case ze.DEBUG:{console.debug(Ni,...t);break}case ze.INFO:{console.info(Ni,...t);break}case ze.WARN:{console.warn(Ni,...t);break}case ze.ERROR:{console.error(Ni,...t);break}case ze.TIME:{performance.mark(t[1]);break}case ze.TIMEEND:{let i=t[0],r=t[1];try{let n=performance.measure(r,r);this.log(ze.DEBUG,i,r,n==null?void 0:n.duration),performance.clearMarks(r),performance.clearMeasures(r)}catch(n){this.log(ze.DEBUG,i,r,n)}break}}}};Ie.level=ze.VERBOSE;var vs=(e,t)=>t,Zi=(e,t)=>t,Al=(e,t)=>t,yh=(e,t)=>t,Gt=q([At,vs],(e,t)=>t?e[t]:null),Th=q([He,Zi],(e,t)=>t?e[t]:null),bh=q([He,Zi],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="video"?i:null});q([He,Zi],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="audio"?i:null});q([He,Zi],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="audio"&&(i==null?void 0:i.source)==="screen"?i:null});q([He,Zi],(e,t)=>{if(!t)return null;let i=e[t];return(i==null?void 0:i.type)==="video"&&(i==null?void 0:i.source)==="screen"?i:null});var ri=Ke(Gt);Ke(q([sh,yh],(e,t)=>{if(e)return t?e[t]:e}));Ke(q(Gt,e=>e==null?void 0:e.name));var Il=Ke(Th),wl=Ke(bh),_h=Ke((e,t)=>{let i=Gt(e,t);if(i&&i.videoTrack&&i.videoTrack!=="")return e.tracks[i.videoTrack]}),kh=Ke((e,t)=>{let i=Gt(e,t);if(i&&i.audioTrack&&i.audioTrack!=="")return e.tracks[i.audioTrack]}),$l=_h,Dl=(e,t)=>t?e.speakers[t]:null;Ke(q(Dl,e=>(e==null?void 0:e.audioLevel)||0));var Sh=(e,t)=>{let i=kh(t)(e);return Dl(e,i==null?void 0:i.id)},Eh=Ke(q(Sh,e=>(e==null?void 0:e.audioLevel)||0)),Ch=Ke((e,t)=>{if(t)return e.connectionQualities[t]});Ke(q(He,Gt,(e,t)=>{let i=t==null?void 0:t.auxiliaryTracks.find(r=>{let n=e[r];return ps(n)&&hs(n)});return i?e[i]:void 0}));Ke(q(He,Gt,(e,t)=>{let i=t==null?void 0:t.auxiliaryTracks.find(r=>{let n=e[r];return ps(n)&&ds(n)});return i?e[i]:void 0}));Ke(q(He,Gt,(e,t)=>{let i=t==null?void 0:t.auxiliaryTracks.find(r=>{let n=e[r];return pl(n)&&ds(n)});return i?e[i]:void 0}));var Rh=Ke(q(He,Gt,(e,t)=>Yi(e,t))),Ph=e=>q(Rh(e),t=>t.video),Ah=Ke((e,t)=>{let i=Gt(e,t);return fs(e,i==null?void 0:i.audioTrack)}),Ih=q([Kr,ji,vs],(e,t,i)=>{if(i)return e.filter(r=>{var n;return!r.recipientPeer&&!((n=r.recipientRoles)!=null&&n.length)||r.sender&&![t,i].includes(r.sender)?!1:[t,i].includes(r.recipientPeer)})}),wh=q([Kr,Al],(e,t)=>{if(t)return e.filter(i=>{var r,n;return(r=i.recipientRoles)!=null&&r.length?(n=i.recipientRoles)==null?void 0:n.includes(t):!1})}),$h=q(Kr,e=>e.filter(t=>{var i;return!t.recipientPeer&&!((i=t.recipientRoles)!=null&&i.length)}));q([wh,Al],e=>e?e.filter(t=>!t.read).length:0);q([Ih,vs],e=>e?e.filter(t=>!t.read).length:0);q($h,e=>e.filter(t=>!t.read).length);q([At,He],(e,t)=>Object.values(e).map(i=>{var r;return{peer:i,isAudioEnabled:i.audioTrack?(r=t[i.audioTrack])==null?void 0:r.enabled:!1}}));var Dh=e=>e.roleChangeRequests[0]||null;q([Dh,At,Ji],(e,t,i)=>e?{requestedBy:e.requestedBy?t[e.requestedBy]:void 0,role:i[e.roleName],token:e.token}:null);q([ms],e=>{var t;let i=!1,r=!1,n=!1;return(t=e==null?void 0:e.publishParams)!=null&&t.allowed&&(i=e.publishParams.allowed.includes("video"),r=e.publishParams.allowed.includes("audio"),n=e.publishParams.allowed.includes("screen")),{video:i,audio:r,screen:n}});q([Bt,He],(e,t)=>{let i=null;return e&&(i=t[e]),(i==null?void 0:i.plugins)||[]});q([Ft,He],(e,t)=>{let i=null;return e&&(i=t[e]),(i==null?void 0:i.plugins)||[]});var ln="hmsNotification",Oh=class{constructor(e){this.id=0,this.onNotification=(t,i)=>{let r=n=>{if(i){let s;if(Array.isArray(i)?s=i.includes(n.type):s=i===n.type,!s)return}t(n)};return this.eventEmitter.addListener(ln,r),()=>{this.eventEmitter.removeListener(ln,r)}},this.store=e,this.eventEmitter=new qr.exports.EventEmitter2({maxListeners:Object.keys(Ee).length})}sendPlaylistTrackEnded(e){let t=this.createNotification(Ee.PLAYLIST_TRACK_ENDED,e,ot.INFO);this.emitEvent(t)}sendDeviceChange(e){var t;let i=this.createNotification(Ee.DEVICE_CHANGE_UPDATE,e,e.error?ot.ERROR:ot.INFO,`Selected ${e.type} device - ${(t=e.selection)==null?void 0:t.label}`);this.emitEvent(i)}sendLeaveRoom(e){var t;let i=(t=e.requestedBy)==null?void 0:t.name,r=this.createNotification(e.roomEnded||!i?Ee.ROOM_ENDED:Ee.REMOVED_FROM_ROOM,e,ot.INFO,`${e.roomEnded?"Room ended":"Removed from room"} ${i?`by ${i}`:""}`);this.emitEvent(r)}sendPeerList(e){let t=this.createNotification(Ee.PEER_LIST,e,ot.INFO);this.emitEvent(t)}sendPeerUpdate(e,t){let i=this.store.getState(ri(t==null?void 0:t.id))||t,r=dl[e];if(r){let n=this.createNotification(r,i,ot.INFO);this.emitEvent(n)}}sendTrackUpdate(e,t){let i=this.store.getState(Il(t)),r=hl[e];if(r){let n=this.createNotification(r,i,ot.INFO);this.emitEvent(n)}}sendMessageReceived(e){let t=this.createNotification(Ee.NEW_MESSAGE,e,ot.INFO);this.emitEvent(t)}sendError(e){let t=this.createNotification(Ee.ERROR,e,ot.ERROR);this.emitEvent(t)}sendReconnecting(e){let t=this.createNotification(Ee.RECONNECTING,e,ot.ERROR);this.emitEvent(t)}sendReconnected(){let e=this.createNotification(Ee.RECONNECTED,null,ot.INFO);this.emitEvent(e)}sendChangeTrackStateRequest(e){let t=this.createNotification(Ee.CHANGE_TRACK_STATE_REQUEST,e,ot.INFO);this.emitEvent(t)}sendChangeMultiTrackStateRequest(e){let t=this.createNotification(Ee.CHANGE_MULTI_TRACK_STATE_REQUEST,e,ot.INFO);this.emitEvent(t)}emitEvent(e){this.eventEmitter.emit(ln,e)}createNotification(e,t,i,r=""){return this.id++,{id:this.id,type:e,message:r,data:t,severity:i}}};function Mh(e){return e instanceof ls||e instanceof di}var Lh=(e,t)=>{let i=_s(Object.keys(e),Object.keys(t));for(let r of i){let n=e[r],s=t[r];ys(n,s)?(Yt(n.auxiliaryTracks,s.auxiliaryTracks)&&(s.auxiliaryTracks=n.auxiliaryTracks),Object.assign(n,s)):Ts(n,s)?delete e[r]:bs(n,s)&&(e[r]=s)}},Nh=(e,t)=>{let i=_s(Object.keys(e),Object.keys(t));for(let r of i){let n=e[r],s=t[r];ys(n,s)?(xh(n,s),Object.assign(n,s)):Ts(n,s)?delete e[r]:bs(n,s)&&(e[r]=s)}},va=(e,t)=>{let i=_s(Object.keys(e),Object.keys(t));for(let r of i){let n=e[r],s=t[r];ys(n,s)?Object.assign(n,s):Ts(n,s)?delete e[r]:bs(n,s)&&(e[r]=s)}},xh=(e,t)=>{e.plugins&&Yt(e.plugins,t.plugins)&&(t.plugins=e.plugins),e.type==="video"&&e.layerDefinitions&&Yt(e.layerDefinitions,t.layerDefinitions)&&(t.layerDefinitions=e.layerDefinitions)},ys=(e,t)=>e&&t,Ts=(e,t)=>e&&!t,bs=(e,t)=>!e&&t,Yt=(e,t)=>{if(e===t||e.length===0&&(t==null?void 0:t.length)===0)return!0;if(!e||!t||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},_s=(e,t)=>{let i=new Set;for(let r of e)i.add(r);for(let r of t)i.add(r);return Array.from(i)},Ge=class{static convertPeer(e){var t,i,r;return{id:e.peerId,name:e.name,roleName:(t=e.role)==null?void 0:t.name,isLocal:e.isLocal,videoTrack:(i=e.videoTrack)==null?void 0:i.trackId,audioTrack:(r=e.audioTrack)==null?void 0:r.trackId,auxiliaryTracks:e.auxiliaryTracks.map(n=>n.trackId),customerUserId:e.customerUserId,metadata:e.metadata,joinedAt:e.joinedAt}}static convertTrack(e,t){let i={id:e.trackId,source:e.source,type:e.type,enabled:e.enabled,displayEnabled:e.enabled,peerId:e.peerId||t};return this.enrichTrack(i,e),i}static enrichTrack(e,t){let i=t.getMediaTrackSettings();t instanceof ls&&(e.volume=t.getVolume()||0),Ge.updateDeviceID(e,t),e.type==="video"&&(e.source==="screen"?(e.displaySurface=i.displaySurface,Ge.enrichScreenTrack(e,t)):e.source==="regular"&&(e.facingMode=i.facingMode),e.height=i.height,e.width=i.width,Ge.enrichVideoTrack(e,t)),Ge.enrichPluginsDetails(e,t)}static updateDeviceID(e,t){var i;t instanceof li||t instanceof zi?e.deviceID=t.settings.deviceId:e.deviceID=(i=t.getMediaTrackSettings())==null?void 0:i.deviceId}static enrichVideoTrack(e,t){t instanceof di&&(e.layer=t.getSimulcastLayer(),e.degraded=t.degraded,Yt(t.getSimulcastDefinitions(),e.layerDefinitions)||(e.layerDefinitions=t.getSimulcastDefinitions()))}static enrichScreenTrack(e,t){var i,r;if(t instanceof li){let n=(i=t.getCaptureHandle)==null?void 0:i.call(t);(n==null?void 0:n.handle)!==((r=e.captureHandle)==null?void 0:r.handle)&&(e.captureHandle=n),t.isCurrentTab&&(e.displaySurface="selfBrowser")}}static enrichPluginsDetails(e,t){(t instanceof li||t instanceof zi)&&(Yt(t.getPlugins(),e.plugins)||(e.plugins=t.getPlugins()))}static convertRoom(e){var t,i;let{recording:r,rtmp:n,hls:s}=Ge.convertRecordingStreamingState(e==null?void 0:e.recording,e==null?void 0:e.rtmp,e==null?void 0:e.hls);return{id:e.id,name:e.name,localPeer:(i=(t=e.localPeer)==null?void 0:t.peerId)!=null?i:"",recording:r,rtmp:n,hls:s,sessionId:e.sessionId,startedAt:e.startedAt,joinedAt:e.joinedAt,peerCount:e.peerCount}}static convertMessage(e){var t,i,r,n,s,a,o;return{sender:(t=e.sender)==null?void 0:t.peerId,senderName:(i=e.sender)==null?void 0:i.name,senderRole:(n=(r=e.sender)==null?void 0:r.role)==null?void 0:n.name,senderUserId:(s=e.sender)==null?void 0:s.customerUserId,recipientPeer:(a=e.recipientPeer)==null?void 0:a.peerId,recipientRoles:(o=e.recipientRoles)==null?void 0:o.map(l=>l.name),time:e.time,type:e.type,message:e.message}}static convertRoles(e){let t={};return e&&e.forEach(i=>{t[i.name]=i}),t}static convertRoleChangeRequest(e){var t;return{requestedBy:(t=e.requestedBy)==null?void 0:t.peerId,roleName:e.role.name,token:e.token}}static convertException(e){return{code:e.code,action:e.action,name:e.name,message:e.message,description:e.description,isTerminal:e.isTerminal,nativeError:e.nativeError,timestamp:new Date}}static convertDeviceChangeUpdate(e){let t={devices:e.devices,selection:e.selection,type:e.type};return e.error&&(t.error=this.convertException(e.error)),t}static convertPlaylist(e){let t=this.getConvertedPlaylistType(e,De.audio),i=this.getConvertedPlaylistType(e,De.video);return{audio:t,video:i}}static convertPlaylistItem(e,t){let i=t.type,r=e.getCurrentSelection(i),n=e.isPlaying(i),s=t.url===(r==null?void 0:r.url);return us(si({},t),{type:t.type,selected:s,playing:s&&n})}static getConvertedPlaylistType(e,t){let i={},r=e.getCurrentSelection(t),n=e.getCurrentProgress(t),s=e.getVolume(t),a=e.getList(t),o=e.getCurrentIndex(t);return e.getList(t).forEach(l=>{i[l.id]=Ge.convertPlaylistItem(e,l)}),{list:i,selection:{id:r==null?void 0:r.id,hasPrevious:o>0,hasNext:o<a.length-1},progress:n,volume:s,currentTime:e.getCurrentTime(t),playbackRate:e.getPlaybackRate(t)}}static convertRecordingStreamingState(e,t,i){var r;return{recording:{browser:si({running:!1},e==null?void 0:e.browser),server:si({running:!1},e==null?void 0:e.server),hls:si({running:!1},e==null?void 0:e.hls)},rtmp:si({running:!1},t),hls:{variants:((r=i==null?void 0:i.variants)==null?void 0:r.map(n=>n))||[],running:!!(i!=null&&i.running),error:i==null?void 0:i.error}}}},ya=class{constructor(e,t,i,r){this.playlistManager=e,this.syncPlaylistState=i,this.store=r,this.type=t}play(e){return re(this,null,function*(){if(!e){Ie.w("Please pass id to play");return}yield this.playlistManager.setEnabled(!0,{id:e,type:this.type})})}pause(){return re(this,null,function*(){let e=this.type===De.audio?gh:vh,t=this.store.getState(e.selection);if(!t.id){Ie.w("No item is currently playing to pause");return}yield this.playlistManager.setEnabled(!1,{id:t.id,type:this.type})})}playNext(){return re(this,null,function*(){yield this.playlistManager.playNext(this.type)})}playPrevious(){return re(this,null,function*(){yield this.playlistManager.playPrevious(this.type)})}seek(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState(`seekOn${this.type}Playlist`)}seekTo(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState(`seekToOn${this.type}Playlist`)}setVolume(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState(`setVolumeOn${this.type}Playlist`)}setList(e){this.playlistManager.setList(e),this.syncPlaylistState(`setListOn${this.type}Playlist`)}stop(){return re(this,null,function*(){yield this.playlistManager.stop(this.type),this.syncPlaylistState(`stop${this.type}Playlist`)})}setIsAutoplayOn(e){this.playlistManager.setIsAutoplayOn(this.type,e)}setPlaybackRate(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState(`set${this.type}PlaybackRate`)}removeItem(e){return re(this,null,function*(){let t=yield this.playlistManager.removeItem(e,this.type);return t&&this.syncPlaylistState(`remove${this.type}PlaylistItem`),t})}clearList(){return re(this,null,function*(){yield this.playlistManager.clearList(this.type),this.syncPlaylistState(`clear${this.type}Playlist`)})}},Uh=class{constructor(e,t,i){this.hmsSDKTracks={},this.hmsSDKPeers={},this.isRoomJoinCalled=!1,this.ignoredMessageTypes=[],this.setProgress=({type:r,progress:n})=>{this.setState(s=>{s.playlist[r].progress=n,s.playlist[r].currentTime=this.sdk.getPlaylistManager().getCurrentTime(r)},"playlistProgress")},this.syncPlaylistState=r=>{this.setState(n=>{Object.assign(n.playlist,Ge.convertPlaylist(this.sdk.getPlaylistManager()))},r)},this.sendPeerUpdateNotification=(r,n)=>{let s=this.store.getState(ri(n.peerId)),a=dl[r]||"peerUpdate";this.syncRoomState(a),s||(s=this.store.getState(ri(n.peerId))),this.hmsNotifications.sendPeerUpdate(r,s)},this.setState=(r,n)=>this.store.namedSetState(r,n),this.store=e,this.sdk=t,this.hmsNotifications=i}refreshDevices(){return re(this,null,function*(){yield this.sdk.refreshDevices()})}unblockAudio(){return re(this,null,function*(){yield this.sdk.getAudioOutput().unblockAutoplay()})}setVolume(e,t){t?this.setTrackVolume(e,t):(this.sdk.getAudioOutput().setVolume(e),this.syncRoomState("setOutputVolume"))}setAudioOutputDevice(e){return re(this,null,function*(){(yield this.sdk.getAudioOutput().setDevice(e))&&this.setState(t=>{t.settings.audioOutputDeviceId=e},"setAudioOutputDevice")})}setPreferredLayer(e,t){let i=this.hmsSDKTracks[e];i?i instanceof di?(i.preferLayer(t),this.updateVideoLayer(e,"setPreferredLayer")):Ie.w(`track ${e} is not an video track`):this.logPossibleInconsistency(`track ${e} not present, unable to set preffer layer`)}preview(e){return re(this,null,function*(){if(this.isRoomJoinCalled){this.logPossibleInconsistency("attempting to call preview after join was called");return}let t=this.store.getState(wt);if(t===je.Preview||t===je.Connecting){this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting");return}try{this.setState(i=>{i.room.roomState=je.Connecting},"connecting"),yield this.sdkPreviewWithListeners(e)}catch(i){throw Ie.e("Cannot show preview. Failed to connect to room - ",i),i}})}join(e){return re(this,null,function*(){if(this.isRoomJoinCalled){this.logPossibleInconsistency("room join is called again");return}try{this.isRoomJoinCalled=!0,this.setState(t=>{t.room.roomState=je.Connecting},"join"),yield this.sdkJoinWithListeners(e)}catch(t){throw this.isRoomJoinCalled=!1,Ie.e("Failed to connect to room - ",t),t}})}leave(){return re(this,null,function*(){if(!this.store.getState(fh)){this.logPossibleInconsistency("room leave is called when no room is connected");return}let e=this.store.getState(wt);return this.setState(t=>{t.room.roomState=je.Disconnecting},"leaving"),this.sdk.leave().then(()=>{this.resetState("leave"),Ie.i("left room")}).catch(t=>{Ie.e("error in leaving room - ",t),this.setState(i=>{i.room.roomState=e},"revertLeave")})})}setScreenShareEnabled(e,t){return re(this,null,function*(){typeof t=="boolean"&&(t={audioOnly:t});try{e?yield this.startScreenShare(t):yield this.stopScreenShare()}catch(i){throw this.hmsNotifications.sendError(Ge.convertException(i)),i}})}addTrack(e,t="regular"){return re(this,null,function*(){yield this.sdk.addTrack(e,t),this.syncRoomState("addTrack")})}removeTrack(e){return re(this,null,function*(){yield this.sdk.removeTrack(e),this.syncRoomState("removeTrack")})}setLocalAudioEnabled(e){return re(this,null,function*(){let t=this.store.getState(Ft);t&&(yield this.setEnabledTrack(t,e))})}setLocalVideoEnabled(e){return re(this,null,function*(){let t=this.store.getState(Bt);t&&(yield this.setEnabledTrack(t,e))})}setEnabledTrack(e,t){return re(this,null,function*(){var i;if(((i=this.store.getState().tracks[e])==null?void 0:i.enabled)===t){this.logPossibleInconsistency(`local track[${e}] enabled state - ${t}`);return}this.setState(n=>{n.tracks[e]?n.tracks[e].displayEnabled=t:this.logPossibleInconsistency("track id not found for setEnabled")},"displayEnabled");try{yield this.setEnabledSDKTrack(e,t),this.syncRoomState("setEnabled")}catch(n){throw this.setState(s=>{s.tracks[e].displayEnabled=!t},"rollbackDisplayEnabled"),this.hmsNotifications.sendError(Ge.convertException(n)),n}let r=t?Ce.TRACK_UNMUTED:Ce.TRACK_MUTED;this.hmsNotifications.sendTrackUpdate(r,e)})}setAudioSettings(e){return re(this,null,function*(){let t=this.store.getState(Ft);t&&(yield this.setSDKLocalAudioTrackSettings(t,e),this.syncRoomState("setAudioSettings"))})}setVideoSettings(e){return re(this,null,function*(){let t=this.store.getState(Bt);t&&(yield this.setSDKLocalVideoTrackSettings(t,e),this.syncRoomState("setVideoSettings"))})}sendMessage(e){this.sendBroadcastMessage(e)}sendBroadcastMessage(e,t){return re(this,null,function*(){let i=yield this.sdk.sendBroadcastMessage(e,t);this.updateMessageInStore(i,{message:e,type:t})})}sendGroupMessage(e,t,i){return re(this,null,function*(){let r=this.store.getState(Ji),n=t.map(a=>r[a]),s=yield this.sdk.sendGroupMessage(e,n,i);this.updateMessageInStore(s,{message:e,recipientRoles:t,type:i})})}sendDirectMessage(e,t,i){return re(this,null,function*(){let r=this.hmsSDKPeers[t],n=yield this.sdk.sendDirectMessage(e,r,i);this.updateMessageInStore(n,{message:e,recipientPeer:r.peerId,type:i})})}updateMessageInStore(e,t){if(!e)throw Ie.w("sendMessage","Failed to send message",t),Error(`sendMessage Failed - ${JSON.stringify(t)}`);let i=Ge.convertMessage(e);return i.read=!0,i.senderName="You",i.ignored=this.ignoredMessageTypes.includes(i.type),this.putMessageInStore(i),i}setMessageRead(e,t){this.setState(i=>{t?i.messages.byID[t]?i.messages.byID[t].read=e:this.logPossibleInconsistency("no message with id is found"):i.messages.allIDs.forEach(r=>{i.messages.byID[r].read=e})},"setMessageRead")}attachVideo(e,t){return re(this,null,function*(){if(this.localAndVideoUnmuting(e))return new Promise(i=>{let r=this.store.subscribe(n=>re(this,null,function*(){n&&(yield this.attachVideoInternal(e,t),r(),i())}),On)});yield this.attachVideoInternal(e,t)})}detachVideo(e,t){return re(this,null,function*(){let i=this.hmsSDKTracks[e];(i==null?void 0:i.type)==="video"?(i.removeSink(t),this.updateVideoLayer(e,"detachVideo")):(t&&(t.srcObject=null),this.logPossibleInconsistency("no video track found to remove sink"))})}addPluginToVideoTrack(e,t){return re(this,null,function*(){return this.addRemoveVideoPlugin(e,"add",t)})}addPluginToAudioTrack(e){return re(this,null,function*(){return this.addRemoveAudioPlugin(e,"add")})}validateVideoPluginSupport(e){let t={};if(t.isSupported=!1,!e)return Ie.w("no plugin passed in for checking support"),t.errMsg="no plugin passed in for checking support",t;let i=this.store.getState(Bt);if(!i)return Ie.w("video Track not added to local peer yet"),t.errMsg="call this function only after local peer has video track",t;let r=this.hmsSDKTracks[i];return r?t=r.validatePlugin(e):(Ie.w(`track ${i} not present, unable to validate plugin`),t.errMsg=`track ${i} not present, unable to validate plugin`),t}validateAudioPluginSupport(e){let t={};if(t.isSupported=!1,!e)return Ie.w('no plugin passed in for checking support"'),t.errMsg='no plugin passed in for checking support"',t;let i=this.store.getState(Ft);if(!i)return Ie.w("audio track not added to local peer yet"),t.errMsg="call this function only after local peer has audio track",t;let r=this.hmsSDKTracks[i];return r?t=r.validatePlugin(e):(Ie.w(`track ${i} not present, unable to validate plugin`),t.errMsg=`track ${i} not present, unable to validate plugin`),t}removePluginFromVideoTrack(e){return re(this,null,function*(){return this.addRemoveVideoPlugin(e,"remove")})}removePluginFromAudioTrack(e){return re(this,null,function*(){return this.addRemoveAudioPlugin(e,"remove")})}changeRole(e,t,i=!1){return re(this,null,function*(){let r=this.hmsSDKPeers[e];if(!r){this.logPossibleInconsistency(`Unknown peer ID given ${e} for changerole`);return}yield this.sdk.changeRole(r,t,i)})}acceptChangeRole(e){return re(this,null,function*(){let t=e.requestedBy?this.hmsSDKPeers[e.requestedBy.id]:void 0;t||Ie.w(`peer for which role change is requested no longer available - ${e.requestedBy}`);let i={requestedBy:t,role:e.role,token:e.token};yield this.sdk.acceptChangeRole(i),this.removeRoleChangeRequest(e)})}initAppData(e){this.setState(t=>{t.appData=e},"initAppData")}setAppData(e,t,i){let r=(t==null?void 0:t.constructor.name)==="Object";this.setState(n=>{if(n.appData)i&&r?Object.assign(n.appData[e],t):n.appData[e]=t;else{let s={[e]:t};n.appData=s}},`setAppData-${e}`)}rejectChangeRole(e){this.removeRoleChangeRequest(e)}endRoom(e,t){return re(this,null,function*(){let i=this.store.getState(mh);if(!(i!=null&&i.endRoom)){Ie.w("You are not allowed to perform this action - endRoom");return}let r=this.store.getState(wt);this.setState(n=>{n.room.roomState=je.Disconnecting},"endingRoom");try{yield this.sdk.endRoom(e,t),this.resetState("endRoom")}catch(n){Ie.e("error in ending room - ",n),this.setState(s=>{s.room.roomState=r},"revertEndRoom")}})}removePeer(e,t){return re(this,null,function*(){let i=this.hmsSDKPeers[e];if(i&&!i.isLocal)yield this.sdk.removePeer(i,t);else{this.logPossibleInconsistency(`No remote peer found for peerID - ${e}`);return}})}startRTMPOrRecording(e){return re(this,null,function*(){yield this.sdk.startRTMPOrRecording(e)})}stopRTMPAndRecording(){return re(this,null,function*(){yield this.sdk.stopRTMPAndRecording()})}startHLSStreaming(e){return re(this,null,function*(){yield this.sdk.startHLSStreaming(e)})}stopHLSStreaming(e){return re(this,null,function*(){yield this.sdk.stopHLSStreaming(e)})}sendHLSTimedMetadata(e){return re(this,null,function*(){yield this.sdk.sendHLSTimedMetadata(e)})}changeName(e){return re(this,null,function*(){yield this.sdk.changeName(e)})}changeMetadata(e){return re(this,null,function*(){typeof e!="string"&&(e=JSON.stringify(e)),yield this.sdk.changeMetadata(e)})}setSessionMetadata(e){return re(this,null,function*(){yield this.sdk.setSessionMetadata(e),this.setState(t=>{t.sessionMetadata=e},"setSessionMetadata")})}populateSessionMetadata(){return re(this,null,function*(){let e=yield this.sdk.getSessionMetadata();this.setState(t=>{t.sessionMetadata=e},"populateSessionMetadata")})}setRemoteTrackEnabled(e,t){return re(this,null,function*(){if(typeof e=="string"){let i=this.hmsSDKTracks[e];i&&Mh(i)?yield this.sdk.changeTrackState(i,t):this.logPossibleInconsistency(`No remote track with ID ${e} found for change track state`)}else Array.isArray(e)&&e.forEach(i=>this.setRemoteTrackEnabled(i,t))})}setRemoteTracksEnabled(e){return re(this,null,function*(){let t={enabled:e.enabled,type:e.type,source:e.source};if(e.roles){let i=this.store.getState(Ji);t.roles=e.roles.map(r=>i[r])}yield this.sdk.changeMultiTrackState(t)})}setLogLevel(e){Ie.level=e,this.sdk.setLogLevel(e)}setFrameworkInfo(e){this.sdk.setFrameworkInfo(e)}ignoreMessageTypes(e,t=!1){if(t)this.ignoredMessageTypes=e;else for(let i of e)this.ignoredMessageTypes.includes(i)||this.ignoredMessageTypes.push(i)}resetState(e="resetState"){this.isRoomJoinCalled=!1,this.hmsSDKTracks={},Ie.cleanUp(),this.setState(t=>{Object.assign(t,cl())},e)}sdkJoinWithListeners(e){return re(this,null,function*(){yield this.sdk.join(e,{onJoin:this.onJoin.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)})})}onRemovedFromRoom(e){var t;let i=this.store.getState(ri((t=e.requestedBy)==null?void 0:t.peerId));this.hmsNotifications.sendLeaveRoom(us(si({},e),{requestedBy:i||void 0}));let r=e.roomEnded||!i?"roomEnded":"removedFromRoom";Ie.i(`resetting state after peer removed ${r}`,e),this.resetState(r)}onDeviceChange(e){let t=e.devices;if(!t)return;let i=this.store.getState(St);if(this.setState(r=>{Yt(r.devices.audioInput,t.audioInput)||(r.devices.audioInput=t.audioInput),Yt(r.devices.videoInput,t.videoInput)||(r.devices.videoInput=t.videoInput),Yt(r.devices.audioOutput,t.audioOutput)||(r.devices.audioOutput=t.audioOutput),this.hmsSDKPeers[i==null?void 0:i.id]&&Object.assign(r.settings,this.getMediaSettings(this.hmsSDKPeers[i==null?void 0:i.id]))},"deviceChange"),e.selection){let r=Ge.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(r)}}sdkPreviewWithListeners(e){return re(this,null,function*(){yield this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})})}onNetworkQuality(e){this.setState(t=>{var i;let r=t.room.localPeer||((i=this.sdk.getLocalPeer())==null?void 0:i.peerId);r&&(t.connectionQualities[r]={peerID:r,downlinkQuality:e})},"ConnectionQuality")}startScreenShare(e){return re(this,null,function*(){this.store.getState(Mn)?this.logPossibleInconsistency("start screenshare is called while it's on"):(yield this.sdk.startScreenShare(()=>this.syncRoomState("screenshareStopped"),e),this.syncRoomState("startScreenShare"))})}stopScreenShare(){return re(this,null,function*(){this.store.getState(Mn)?(yield this.sdk.stopScreenShare(),this.syncRoomState("stopScreenShare")):this.logPossibleInconsistency("stop screenshare is called while it's not on")})}attachVideoInternal(e,t){return re(this,null,function*(){let i=this.hmsSDKTracks[e];i&&i.type==="video"?(i.addSink(t),this.updateVideoLayer(e,"attachVideo")):this.logPossibleInconsistency("no video track found to add sink")})}syncRoomState(e){e=`${e}_fullSync`,Ie.time(`store-sync-${e}`);let t={},i=[],r={},n={},s={},a=this.sdk.getPeers();for(let u of a){let d=Ge.convertPeer(u);t[d.id]=d,i.push(d.id),this.hmsSDKPeers[d.id]=u;let h=[u.audioTrack,u.videoTrack,...u.auxiliaryTracks];for(let p of h){if(!p)continue;let g=Ge.convertTrack(p);r[g.id]=g,n[p.trackId]=p}d.isLocal&&Object.assign(s,this.getMediaSettings(u))}let o=this.sdk.getRecordingState(),l=this.sdk.getRTMPState(),c=this.sdk.getHLSState();this.setState(u=>{u.room.peers=i;let d=u.peers,h=u.tracks;Lh(d,t),Nh(h,r),Object.assign(u.settings,s),this.hmsSDKTracks=n,Object.assign(u.roles,Ge.convertRoles(this.sdk.getRoles())),Object.assign(u.playlist,Ge.convertPlaylist(this.sdk.getPlaylistManager())),Object.assign(u.room,Ge.convertRecordingStreamingState(o,l,c))},e),Ie.timeEnd(`store-sync-${e}`)}onPreview(e){this.setState(t=>{Object.assign(t.room,Ge.convertRoom(e)),t.room.roomState=je.Preview},"previewStart"),this.syncRoomState("previewSync")}onJoin(e){let t=this.sdk.getPlaylistManager();this.audioPlaylist=new ya(t,De.audio,this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new ya(t,De.video,this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState(i=>{Object.assign(i.room,Ge.convertRoom(e)),i.room.isConnected=!0,i.room.roomState=je.Connected},"joined"),t.onProgress(this.setProgress),t.onNewTrackStart(i=>{this.syncPlaylistState(`${i.type}PlaylistUpdate`)}),t.onPlaylistEnded(i=>{this.syncPlaylistState(`${i}PlaylistEnded`)}),t.onCurrentTrackEnded(i=>{this.hmsNotifications.sendPlaylistTrackEnded(Ge.convertPlaylistItem(t,i)),this.syncPlaylistState(`${i.type}PlaylistItemEnded`)})}onRoomUpdate(e,t){this.setState(i=>{Object.assign(i.room,Ge.convertRoom(t))},e)}onPeerUpdate(e,t){if(![Qe.BECAME_DOMINANT_SPEAKER,Qe.RESIGNED_DOMINANT_SPEAKER].includes(e)){if(Array.isArray(t)){this.syncRoomState("peersJoined");let i=[];for(let r of t){let n=this.store.getState(ri(r.peerId));n&&i.push(n)}this.hmsNotifications.sendPeerList(i);return}this.sendPeerUpdateNotification(e,t)}}onTrackUpdate(e,t,i){if(e===Ce.TRACK_REMOVED)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,i);else{let r=hl[e]||"trackUpdate";this.syncRoomState(r),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}onMessageReceived(e){let t=Ge.convertMessage(e);t.read=!1,t.ignored=this.ignoredMessageTypes.includes(t.type),this.putMessageInStore(t),this.hmsNotifications.sendMessageReceived(t)}putMessageInStore(e){e.ignored||this.setState(t=>{e.id=String(this.store.getState(ph)+1),t.messages.byID[e.id]=e,t.messages.allIDs.push(e.id)},"newMessage")}onAudioLevelUpdate(e){this.setState(t=>{let i={};e.forEach(n=>{if(!n.track||!n.peer)return;let s=n.track.trackId;i[s]=n.audioLevel,t.speakers[s]||(t.speakers[s]={audioLevel:n.audioLevel,peerID:n.peer.peerId,trackID:s})});let r=Object.entries(t.speakers);for(let[n,s]of r)s.audioLevel=i[n]||0,s.audioLevel===0&&delete t.speakers[n]},"audioLevel")}onConnectionQualityUpdate(e){this.setState(t=>{let i=new Set;e.forEach(n=>{let s=n.peerID;!s||(i.add(s),t.connectionQualities[s]?Object.assign(t.connectionQualities[s],n):t.connectionQualities[s]=n)});let r=Object.keys(t.connectionQualities);for(let n of r)i.has(n)||delete t.connectionQualities[n]},"connectionQuality")}onChangeTrackStateRequest(e){var t;let i=this.store.getState(ri((t=e.requestedBy)==null?void 0:t.peerId)),r=this.getStoreLocalTrackIDfromSDKTrack(e.track),n=this.store.getState(Il(r));if(!n)return this.logPossibleInconsistency(`Not found track for which track state change was requested, ${e.track}`);e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:i||void 0,track:n,enabled:e.enabled})}onChangeMultiTrackStateRequest(e){var t;let i=this.store.getState(ri((t=e.requestedBy)==null?void 0:t.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");let r=[],n=this.store.getState(He);for(let s of e.tracks){let a=this.getStoreLocalTrackIDfromSDKTrack(s);a&&n[a]&&r.push(n[a])}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:i||void 0,tracks:r,enabled:e.enabled,type:e.type,source:e.source})}onReconnected(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState(e=>{e.room.roomState=e.room.isConnected?je.Connected:je.Preview},"reconnected")}onReconnecting(e){let t=Ge.convertException(e);Ie.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState(i=>{i.room.roomState=je.Reconnecting,i.errors.push(t)},"reconnecting")}onError(e){let t=Ge.convertException(e);t.isTerminal?(this.leave().then(()=>Ie.e("error from SDK, left room.")),this.setState(i=>{i.room.roomState=je.Failed,i.errors.push(t)},"errorTerminal")):this.store.getState().errors.length<50&&this.setState(i=>{i.errors.push(t)},"error"),this.syncRoomState("errorSync"),this.hmsNotifications.sendError(t),Ie.e("received error from sdk",t instanceof te?`${t}`:t)}updateVideoLayer(e,t){let i=this.hmsSDKTracks[e];if(i&&i instanceof di){let r=this.store.getState(wl(e));((r==null?void 0:r.layer)!==i.getSimulcastLayer()||(r==null?void 0:r.degraded)!==i.degraded)&&this.setState(n=>{let s=n.tracks[e];s.layer=i.getSimulcastLayer(),s.degraded=i.degraded},t)}}handleTrackRemove(e,t){this.setState(i=>{let r=i.peers[t.peerId],n=i.tracks,s=e.trackId;if(this.isSameStoreSDKTrack(s,r==null?void 0:r.audioTrack))r==null||delete r.audioTrack;else if(this.isSameStoreSDKTrack(s,r==null?void 0:r.videoTrack))r==null||delete r.videoTrack;else{let a=r==null?void 0:r.auxiliaryTracks.indexOf(s);a>-1&&this.isSameStoreSDKTrack(s,r==null?void 0:r.auxiliaryTracks[a])&&(r==null||r.auxiliaryTracks.splice(a,1))}delete n[s],delete this.hmsSDKTracks[s]},"trackRemoved")}setEnabledSDKTrack(e,t){return re(this,null,function*(){let i=this.hmsSDKTracks[e];i?yield i.setEnabled(t):this.logPossibleInconsistency(`track ${e} not present, unable to enabled/disable`)})}setSDKLocalVideoTrackSettings(e,t){return re(this,null,function*(){let i=this.hmsSDKTracks[e];i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}setSDKLocalAudioTrackSettings(e,t){return re(this,null,function*(){let i=this.hmsSDKTracks[e];i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}getMediaSettings(e){var t;let i=this.store.getState(gl),r=e.audioTrack,n=e.videoTrack;return{audioInputDeviceId:(r==null?void 0:r.settings.deviceId)||i.audioInputDeviceId,videoInputDeviceId:(n==null?void 0:n.settings.deviceId)||i.videoInputDeviceId,audioOutputDeviceId:(t=this.sdk.getAudioOutput().getDevice())==null?void 0:t.deviceId}}setTrackVolume(e,t){let i=this.hmsSDKTracks[t];i?i instanceof as?(i.setVolume(e),this.setState(r=>{let n=r.tracks[t];n&&n.type==="audio"&&(n.volume=e)},"trackVolume")):Ie.w(`track ${t} is not an audio track`):this.logPossibleInconsistency(`track ${t} not present, unable to set volume`)}localAndVideoUnmuting(e){if(this.store.getState(St).videoTrack!==e)return!1;let t=this.store.getState(dh),i=this.store.getState(On);return t&&!i}logPossibleInconsistency(e){Ie.w("possible inconsistency detected - ",e)}addRemoveVideoPlugin(e,t,i){return re(this,null,function*(){if(!e){Ie.w("Invalid plugin received in store");return}let r=this.store.getState(Bt);if(r){let n=this.hmsSDKTracks[r];n?(t==="add"?yield n.addPlugin(e,i):t==="remove"&&(yield n.removePlugin(e)),this.syncRoomState(`${t}VideoPlugin`)):this.logPossibleInconsistency(`track ${r} not present, unable to remove plugin`)}})}addRemoveAudioPlugin(e,t){return re(this,null,function*(){if(!e){Ie.w("Invalid plugin received in store");return}let i=this.store.getState(Ft);if(i){let r=this.hmsSDKTracks[i];r?(t==="add"?yield r.addPlugin(e):t==="remove"&&(yield r.removePlugin(e)),this.syncRoomState(`${t}AudioPlugin`)):this.logPossibleInconsistency(`track ${i} not present, unable to remove plugin`)}})}isSameStoreSDKTrack(e,t){var i;return t?((i=this.hmsSDKTracks[t])==null?void 0:i.trackId)===e:!1}onRoleChangeRequest(e){this.setState(t=>{t.roleChangeRequests.length===0&&t.roleChangeRequests.push(Ge.convertRoleChangeRequest(e))},"roleChangeRequest")}removeRoleChangeRequest(e){this.setState(t=>{let i=t.roleChangeRequests.findIndex(r=>r.token===e.token);i!==-1&&t.roleChangeRequests.splice(i,1)},"removeRoleChangeRequest")}onRoleUpdate(){this.syncRoomState("roleUpdate")}getStoreLocalTrackIDfromSDKTrack(e){return this.store.getState(ch).find(t=>this.hmsSDKTracks[t].trackId===e.trackId)}},Ol=e=>Ri?`${e} ${document.title}`:e,Fh=(e,t,i)=>{let r;i.getState(wt)===je.Connected&&(r=Ta(e,t,i)),i.subscribe(n=>{[je.Connected,je.Reconnecting].includes(n)?r||(r=Ta(e,t,i)):[je.Disconnected,je.Failed].includes(n)&&r&&(Vh(t,n),r(),r=void 0)},wt)},Ta=(e,t,i)=>{var r,n;let s=Bh(i,t);(r=e.getWebrtcInternals())==null||r.start();let a=(n=e.getWebrtcInternals())==null?void 0:n.onStatsChange(o=>Gh(t,o,i));return()=>{s(),a&&a()}},Bh=(e,t)=>{let i,r,n;return e.getState(ji)?t.namedSetState(s=>{s.localPeer.id=e.getState(ji)},"localpeer-id"):i=e.subscribe(s=>{s&&t.namedSetState(a=>{a.localPeer.id=s},"localpeer-id")},ji),e.getState(Bt)?t.namedSetState(s=>{s.localPeer.videoTrack=e.getState(Bt)},"localpeer-videotrack-id"):r=e.subscribe(s=>{s&&t.namedSetState(a=>{a.localPeer.videoTrack=s},"localpeer-videotrack-id")},Bt),e.getState(Ft)?t.namedSetState(s=>{s.localPeer.videoTrack=e.getState(Ft)},"localpeer-audiotrack-id"):n=e.subscribe(s=>{s&&t.namedSetState(a=>{a.localPeer.videoTrack=s},"localpeer-audiotrack-id")},Ft),()=>{i==null||i(),r==null||r(),n==null||n()}},Gh=(e,t,i)=>{let r=i.getState(He);e.namedSetState(n=>{let s={},a=Object.keys(r);for(let l of a){let c=t.getTrackStats(l);c&&(s[l]=c)}va(n.trackStats,s);let o={[i.getState(ji)]:t.getLocalPeerStats()};va(n.peerStats,o)},"webrtc-stats")},Vh=(e,t="resetState")=>{e.namedSetState(i=>{Object.assign(i,ul())},t)},jh=class{constructor(e,t){this.hmsStore=e,this.sdk=t,this.store=Ht.createNewHMSStore(Ol("HMSStatsStore"),ul),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=()=>new Promise(i=>{var r,n;this.hmsStore.getState(wt)==="Connected"?i((n=(r=this.sdk)==null?void 0:r.getWebrtcInternals())==null?void 0:n.getPublishPeerConnection()):this.hmsStore.subscribe(s=>{var a,o;s==="Connected"&&i((o=(a=this.sdk)==null?void 0:a.getWebrtcInternals())==null?void 0:o.getPublishPeerConnection())},wt)}),this.getSubscribePeerConnection=()=>new Promise(i=>{var r,n;this.hmsStore.getState(wt)==="Connected"?i((n=(r=this.sdk)==null?void 0:r.getWebrtcInternals())==null?void 0:n.getSubscribePeerConnection()):this.hmsStore.subscribe(s=>{var a,o;s==="Connected"&&i((o=(a=this.sdk)==null?void 0:a.getWebrtcInternals())==null?void 0:o.getSubscribePeerConnection())},wt)}),this.sdk&&Fh(this.sdk,this.store,this.hmsStore)}},qh=e=>e.localPeer.id,Hh=e=>e.localPeer.audioTrack,Kh=e=>e.localPeer.videoTrack,Wh=(e,t)=>t,zh=(e,t)=>t,ks=e=>e.trackStats,Ml=e=>e.peerStats,ei=q([Ml,qh],(e,t)=>e[t]);q(ei,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.packetsLost});q(ei,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.jitter});q(ei,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.bitrate});q(ei,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.bitrate});q(ei,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.availableOutgoingBitrate});q(ei,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.availableIncomingBitrate});q(ei,e=>{var t;return(t=e==null?void 0:e.publish)==null?void 0:t.bytesSent});q(ei,e=>{var t;return(t=e==null?void 0:e.subscribe)==null?void 0:t.bytesReceived});q([Ml,Wh],(e,t)=>t?e[t]:void 0);var Xi=q([ks,zh],(e,t)=>t?e[t]:void 0);Ke(q(Xi,e=>e==null?void 0:e.bitrate));Ke(q(Xi,e=>e==null?void 0:e.bytesReceived));Ke(q(Xi,e=>e==null?void 0:e.framesPerSecond));Ke(q(Xi,e=>e==null?void 0:e.jitter));Ke(q(Xi,e=>e==null?void 0:e.packetsLost));var Ll=q([ks,Hh],(e,t)=>t?e[t]:void 0),Wr=q([ks,Kh],(e,t)=>t?e[t]:void 0);q(Ll,e=>e==null?void 0:e.bitrate);q(Wr,e=>e==null?void 0:e.bitrate);q(Ll,e=>e==null?void 0:e.bytesSent);q(Wr,e=>e==null?void 0:e.bytesSent);q(Wr,e=>e==null?void 0:e.framesPerSecond);q(Wr,e=>e==null?void 0:e.qualityLimitationReason);var Ht=class{constructor(e,t,i){this.getStats=()=>(this.stats||(this.stats=new jh(this.store,this.sdk)),this.stats),e?this.store=e:this.store=Ht.createNewHMSStore(Ol("HMSStore"),cl),i?this.notifications=i:this.notifications=new Oh(this.store),t?this.actions=t:(this.sdk=new jd,this.actions=new Uh(this.store,this.sdk,this.notifications)),this.actions.setFrameworkInfo({type:"js",sdkVersion:th().version}),this.initialTriggerOnSubscribe=!1,Ri&&(window.__hms=this)}triggerOnSubscribe(){this.initialTriggerOnSubscribe||(Ht.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}getStore(){return this.store}getHMSActions(){return this.actions}getActions(){return this.actions}getNotifications(){return{onNotification:this.notifications.onNotification}}static createNewHMSStore(e,t){let i=Dc(()=>t()),r=i.setState;i.setState=a=>{let o=typeof a=="function"?wc(a):a;r(o)};let n=i.getState;i.getState=a=>a?a(n()):n(),Ht.compareWithShallowCheckInSubscribe(i);let s=Ht.setUpDevtools(i,e);return us(si({},i),{namedSetState:s})}static makeStoreTriggerOnSubscribe(e){let t=e.subscribe;e.subscribe=(i,r,n)=>(i(e.getState(r),void 0),t(i,r,n))}static compareWithShallowCheckInSubscribe(e){let t=e.subscribe;e.subscribe=(i,r,n)=>(r||(r=s=>s),n=n||$c,t(i,r,n))}static setUpDevtools(e,t){let i;try{i=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!i)return s=>{e.setState(s)};let r=i.connect(Ht.devtoolsOptions(t));r.prefix=t?`${t} > `:"";let n=e.setState;return e.setState=s=>{n(s),r.send(`${r.prefix}setState`,e.getState())},r.subscribe(Ht.devtoolsSubscribe(r,e,n)),r.send("setUpStore",e.getState()),(s,a)=>{n(s);let o=a||`${r.prefix}action`;r.send(o,e.getState())}}static devtoolsOptions(e){return{name:e,actionsBlacklist:["audioLevel","playlistProgress","connectionQuality"]}}static devtoolsSubscribe(e,t,i){return r=>{var n,s,a,o;if(r.type==="DISPATCH"&&r.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(r.payload.type)?i(JSON.parse(r.state)):t.setState(JSON.parse(r.state));else if(r.type==="DISPATCH"&&((n=r.payload)==null?void 0:n.type)==="COMMIT")e.init(t.getState());else if(r.type==="DISPATCH"&&((s=r.payload)==null?void 0:s.type)==="IMPORT_STATE"){let l=(a=r.payload.nextLiftedState)==null?void 0:a.actionsById;(((o=r.payload.nextLiftedState)==null?void 0:o.computedStates)||[]).forEach(({state:c},u)=>{let d=l[u]||`${e.prefix}setState`;u===0?e.init(c):(i(c),e.send(d,t.getState()))})}}}};const zr=new Ht;zr.triggerOnSubscribe();const dt=zr.getActions(),Ot=zr.getStore(),Nl=zr.getNotifications();function ba(e){let t,i,r;var n=e[4];function s(a){return{}}return n&&(i=$s(n,s())),{c(){t=I("div"),i&&F(i.$$.fragment),f(t,"class","Icon svelte-1r8bims")},m(a,o){N(a,t,o),i&&x(i,t,null),r=!0},p(a,o){if(n!==(n=a[4])){if(i){Ne();const l=i;P(l.$$.fragment,1,0,()=>{U(l,1)}),xe()}n?(i=$s(n,s()),F(i.$$.fragment),C(i.$$.fragment,1),x(i,t,null)):i=null}},i(a){r||(i&&C(i.$$.fragment,a),r=!0)},o(a){i&&P(i.$$.fragment,a),r=!1},d(a){a&&L(t),i&&U(i)}}}function Jh(e){let t,i,r,n,s,a,o,l,c,u=e[4]!==null&&ba(e);return{c(){t=I("span"),i=I("input"),r=W(),u&&u.c(),n=W(),s=I("div"),a=be(e[1]),i.value=e[0],f(i,"type",e[2]),f(i,"name",e[3]),f(i,"class","svelte-1r8bims"),fe(i,"IconedInput",e[4]!==null),f(s,"class","Placeholder svelte-1r8bims"),fe(s,"Iconed",e[4]!==null),fe(s,"Lifted",e[5]||e[6]),fe(s,"Focused",e[5]),f(t,"class","svelte-1r8bims")},m(d,h){N(d,t,h),_(t,i),_(t,r),u&&u.m(t,null),_(t,n),_(t,s),_(s,a),o=!0,l||(c=[_e(i,"input",e[7]),_e(i,"focus",e[8]),_e(i,"blur",e[9])],l=!0)},p(d,[h]){(!o||h&1&&i.value!==d[0])&&(i.value=d[0]),(!o||h&4)&&f(i,"type",d[2]),(!o||h&8)&&f(i,"name",d[3]),(!o||h&16)&&fe(i,"IconedInput",d[4]!==null),d[4]!==null?u?(u.p(d,h),h&16&&C(u,1)):(u=ba(d),u.c(),C(u,1),u.m(t,n)):u&&(Ne(),P(u,1,1,()=>{u=null}),xe()),(!o||h&2)&&Ze(a,d[1]),(!o||h&16)&&fe(s,"Iconed",d[4]!==null),(!o||h&96)&&fe(s,"Lifted",d[5]||d[6]),(!o||h&32)&&fe(s,"Focused",d[5])},i(d){o||(C(u),o=!0)},o(d){P(u),o=!1},d(d){d&&L(t),u&&u.d(),l=!1,lt(c)}}}function Qh(e,t,i){let r,{value:n=""}=t;console.log(n);let s=!1,{placeholder:a="Placeholder"}=t,{type:o="text"}=t,{name:l=""}=t,{icon:c=null}=t;function u(p){i(0,n=p.target.value)}Pt(()=>{i(0,n="")});const d=()=>i(5,s=!0),h=()=>i(5,s=!1);return e.$$set=p=>{"value"in p&&i(0,n=p.value),"placeholder"in p&&i(1,a=p.placeholder),"type"in p&&i(2,o=p.type),"name"in p&&i(3,l=p.name),"icon"in p&&i(4,c=p.icon)},e.$$.update=()=>{e.$$.dirty&1&&i(6,r=n!=="")},[n,a,o,l,c,s,r,u,d,h]}class ci extends ee{constructor(t){super(),X(this,t,Qh,Jh,Z,{value:0,placeholder:1,type:2,name:3,icon:4})}}function Yh(e){let t,i,r,n,s,a,o,l;const c=e[7].default,u=Ur(c,e,e[6],null);return{c(){t=I("button"),i=I("div"),n=W(),u&&u.c(),f(i,"class","Ripple svelte-1u8sht2"),f(i,"style",r=`left:${e[2]}px;top:${e[3]}px;`),fe(i,"RippleActive",e[4]),f(t,"class",s=bi(e[1])+" svelte-1u8sht2"),f(t,"type",e[0])},m(d,h){N(d,t,h),_(t,i),_(t,n),u&&u.m(t,null),a=!0,o||(l=[_e(t,"click",e[5]),_e(t,"click",e[8])],o=!0)},p(d,[h]){(!a||h&12&&r!==(r=`left:${d[2]}px;top:${d[3]}px;`))&&f(i,"style",r),(!a||h&16)&&fe(i,"RippleActive",d[4]),u&&u.p&&(!a||h&64)&&Br(u,c,d,d[6],a?Fr(c,d[6],h,null):Gr(d[6]),null),(!a||h&2&&s!==(s=bi(d[1])+" svelte-1u8sht2"))&&f(t,"class",s),(!a||h&1)&&f(t,"type",d[0])},i(d){a||(C(u,d),a=!0)},o(d){P(u,d),a=!1},d(d){d&&L(t),u&&u.d(d),o=!1,lt(l)}}}function Zh(e,t,i){let{$$slots:r={},$$scope:n}=t,s=0,a=0,o=!1;function l(h){console.log(h.offsetX,h.offsetY),i(2,s=h.offsetX),i(3,a=h.offsetY),i(4,o=!0),setTimeout(()=>i(4,o=!1),500)}let{type:c="button"}=t,{classes:u="RippleButton"}=t;function d(h){ao.call(this,e,h)}return e.$$set=h=>{"type"in h&&i(0,c=h.type),"classes"in h&&i(1,u=h.classes),"$$scope"in h&&i(6,n=h.$$scope)},[c,u,s,a,o,l,n,r,d]}class Tt extends ee{constructor(t){super(),X(this,t,Zh,Yh,Z,{type:0,classes:1})}}const vi=[];function Xh(e,t){return{subscribe:pt(e,t).subscribe}}function pt(e,t=M){let i;const r=new Set;function n(o){if(Z(e,o)&&(e=o,i)){const l=!vi.length;for(const c of r)c[1](),vi.push(c,e);if(l){for(let c=0;c<vi.length;c+=2)vi[c][0](vi[c+1]);vi.length=0}}}function s(o){n(o(e))}function a(o,l=M){const c=[o,l];return r.add(c),r.size===1&&(i=t(n)||M),o(e),()=>{r.delete(c),r.size===0&&(i(),i=null)}}return{set:n,update:s,subscribe:a}}function ep(e,t){t.subscribe(r=>{if(r==="")return;let n=new URL(window.location.href).hash;const s=new RegExp(`(&${e}=)([^&]+)`,"i");if(n.match(s)===null){if(r==="")return;n===""&&(n="#"),history.pushState({},null,n+`&${e}=`+r);return}console.log("trying to replace",s,r,n),n=n.replace(s,"$1"+r),history.pushState({},null,n)});function i(){console.log("!!!traceURL!!!");const r=new URL(window.location.href).hash,n=/&(.+)=(.+)/,s=r.match(n);if(console.log("!!!traceURL!!!",r),s===null){t.set("");return}const a=s[1],o=s[2];console.log("!!!traceURL!!!",e,o),e===a&&t.set(o)}window.addEventListener("popstate",i),window.addEventListener("hashchange",i),i()}const er=pt("");ep("token",er);const Ss=pt(!1),Ye=pt({type:"info",message:"Welcome!"});function tp(e){let t,i,r,n,s,a,o;return{c(){t=ae("svg"),i=ae("path"),r=ae("animateTransform"),n=ae("path"),s=ae("animateTransform"),a=ae("path"),o=ae("animateTransform"),f(r,"attributeName","transform"),f(r,"attributeType","XML"),f(r,"type","rotate"),f(r,"dur","2s"),f(r,"from","0 50 50"),f(r,"to","360 50 50"),f(r,"repeatCount","indefinite"),f(i,"fill","#fff"),f(i,"d",`M31.6,3.5C5.9,13.6-6.6,42.7,3.5,68.4c10.1,25.7,39.2,38.3,64.9,28.1l-3.1-7.9c-21.3,8.4-45.4-2-53.8-23.3\r
  c-8.4-21.3,2-45.4,23.3-53.8L31.6,3.5z`),f(s,"attributeName","transform"),f(s,"attributeType","XML"),f(s,"type","rotate"),f(s,"dur","1s"),f(s,"from","0 50 50"),f(s,"to","-360 50 50"),f(s,"repeatCount","indefinite"),f(n,"fill","#fff"),f(n,"d",`M42.3,39.6c5.7-4.3,13.9-3.1,18.1,2.7c4.3,5.7,3.1,13.9-2.7,18.1l4.1,5.5c8.8-6.5,10.6-19,4.1-27.7\r
  c-6.5-8.8-19-10.6-27.7-4.1L42.3,39.6z`),f(o,"attributeName","transform"),f(o,"attributeType","XML"),f(o,"type","rotate"),f(o,"dur","2s"),f(o,"from","0 50 50"),f(o,"to","360 50 50"),f(o,"repeatCount","indefinite"),f(a,"fill","#fff"),f(a,"d",`M82,35.7C74.1,18,53.4,10.1,35.7,18S10.1,46.6,18,64.3l7.6-3.4c-6-13.5,0-29.3,13.5-35.3s29.3,0,35.3,13.5\r
  L82,35.7z`),f(t,"version","1.1"),f(t,"id","L7"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),f(t,"x","0px"),f(t,"y","0px"),f(t,"viewBox","0 0 100 100"),f(t,"enable-background","new 0 0 100 100"),f(t,"xml:space","preserve")},m(l,c){N(l,t,c),_(t,i),_(i,r),_(t,n),_(n,s),_(t,a),_(a,o)},p:M,i:M,o:M,d(l){l&&L(t)}}}class Jr extends ee{constructor(t){super(),X(this,t,null,tp,Z,{})}}function ip(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","M6 42v-3h4.6V6h19.5v2.25h7.35V39H42v3h-7.55V11.25H30.1V42Zm7.6-33v30Zm8.95 17q.85 0 1.425-.575.575-.575.575-1.425 0-.85-.575-1.425Q23.4 22 22.55 22q-.85 0-1.425.575-.575.575-.575 1.425 0 .85.575 1.425Q21.7 26 22.55 26ZM13.6 39h13.5V9H13.6Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class rp extends ee{constructor(t){super(),X(this,t,null,ip,Z,{})}}function np(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","M7 44q-1.2 0-2.1-.9Q4 42.2 4 41V17q0-1.2.9-2.1.9-.9 2.1-.9h11.85V7q0-1.2.9-2.1.9-.9 2.1-.9h4.35q1.2 0 2.1.9.9.9.9 2.1v7H41q1.2 0 2.1.9.9.9.9 2.1v24q0 1.2-.9 2.1-.9.9-2.1.9Zm0-3h34V17H29.2q0 1.4-.925 2.2-.925.8-2.325.8h-3.9q-1.35 0-2.275-.8-.925-.8-.925-2.2H7v24Zm4.6-5.35h11.95v-.7q0-.9-.45-1.6-.45-.7-1.15-.95-1.6-.55-2.5-.725-.9-.175-1.75-.175-.95 0-2.025.225t-2.425.675q-.75.25-1.2.95-.45.7-.45 1.6Zm16.8-3.35h8.5v-2.5h-8.5Zm-10.7-2.5q1.15 0 1.925-.8.775-.8.775-1.9 0-1.15-.775-1.925-.775-.775-1.925-.775-1.1 0-1.9.775-.8.775-.8 1.925 0 1.1.8 1.9.8.8 1.9.8Zm10.7-3.15h8.5v-2.5h-8.5ZM21.85 17h4.35V7h-4.35ZM24 29Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class sp extends ee{constructor(t){super(),X(this,t,null,np,Z,{})}}function ap(e){let t;return{c(){t=be("Join")},m(i,r){N(i,t,r)},i:M,o:M,d(i){i&&L(t)}}}function op(e){let t,i;return t=new Jr({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function lp(e){let t,i,r,n;const s=[op,ap],a=[];function o(l,c){return l[2]?0:1}return t=o(e),i=a[t]=s[t](e),{c(){i.c(),r=ht()},m(l,c){a[t].m(l,c),N(l,r,c),n=!0},p(l,c){let u=t;t=o(l),t!==u&&(Ne(),P(a[u],1,1,()=>{a[u]=null}),xe(),i=a[t],i||(i=a[t]=s[t](l),i.c()),C(i,1),i.m(r.parentNode,r))},i(l){n||(C(i),n=!0)},o(l){P(i),n=!1},d(l){a[t].d(l),l&&L(r)}}}function cp(e){let t,i,r,n,s,a,o,l,c,u,d,h,p,g;function v(D){e[4](D)}let S={name:"name",placeholder:"What's your name?",icon:sp};e[0]!==void 0&&(S.value=e[0]),r=new ci({props:S}),ut.push(()=>Jt(r,"value",v));function G(D){e[5](D)}let w={name:"token",placeholder:"What is the token for your room?",icon:rp};return e[1]!==void 0&&(w.value=e[1]),o=new ci({props:w}),ut.push(()=>Jt(o,"value",G)),d=new Tt({props:{type:"submit",classes:e[0]===""||e[1]===""||e[2]?"btn-disabled":"btn-primary",$$slots:{default:[lp]},$$scope:{ctx:e}}}),{c(){t=I("form"),i=I("span"),F(r.$$.fragment),s=W(),a=I("span"),F(o.$$.fragment),c=W(),u=I("span"),F(d.$$.fragment),f(i,"class","Name svelte-h0luil"),f(a,"class","Token svelte-h0luil"),f(u,"class","Submit svelte-h0luil"),f(t,"class","card card-shadow svelte-h0luil")},m(D,V){N(D,t,V),_(t,i),x(r,i,null),_(t,s),_(t,a),x(o,a,null),_(t,c),_(t,u),x(d,u,null),h=!0,p||(g=_e(t,"submit",Vr(e[3])),p=!0)},p(D,[V]){const z={};!n&&V&1&&(n=!0,z.value=D[0],zt(()=>n=!1)),r.$set(z);const J={};!l&&V&2&&(l=!0,J.value=D[1],zt(()=>l=!1)),o.$set(J);const oe={};V&7&&(oe.classes=D[0]===""||D[1]===""||D[2]?"btn-disabled":"btn-primary"),V&132&&(oe.$$scope={dirty:V,ctx:D}),d.$set(oe)},i(D){h||(C(r.$$.fragment,D),C(o.$$.fragment,D),C(d.$$.fragment,D),h=!0)},o(D){P(r.$$.fragment,D),P(o.$$.fragment,D),P(d.$$.fragment,D),h=!1},d(D){D&&L(t),U(r),U(o),U(d),p=!1,g()}}}const xl="name",Ln="token";async function up(e,t){localStorage.setItem(xl,e),localStorage.setItem(Ln,t);try{er.set(t),await dt.join({userName:e,authToken:t,rememberDeviceSelection:!0}),Ye.set({type:"good",message:"Succeefully joined the room. "})}catch(i){Ye.set({type:"error",message:i.message})}}function dp(e,t,i){let r=localStorage.getItem(xl)||"",n="";const s=er.subscribe(u=>{i(1,n=u||(localStorage.getItem(Ln)!==null?localStorage.getItem(Ln):""))});let a=!1;async function o(){i(2,a=!0),await up(r,n),i(2,a=!1)}Pt(s);function l(u){r=u,i(0,r)}function c(u){n=u,i(1,n)}return[r,n,a,o,l,c]}class hp extends ee{constructor(t){super(),X(this,t,dp,cp,Z,{})}}function Mt(e){return Xh(Ot.getState(e),t=>Ot.subscribe(t,e))}const pp=Mt(yl),Ul=Mt(Tl),fp=Mt(uh),mp=Mt(On),gp=Mt(ah),vp=Mt(gl),Fl=Mt(Kr),yp=Mt(Mn),Tp=Mt(hh),bp=Mt(bl);function _p(e){let t;return{c(){t=be("Sign in")},m(i,r){N(i,t,r)},d(i){i&&L(t)}}}function kp(e){let t,i,r;return i=new Tt({props:{classes:"btn-lite",$$slots:{default:[_p]},$$scope:{ctx:e}}}),i.$on("click",Sp),{c(){t=I("span"),F(i.$$.fragment),f(t,"class","svelte-2p9wv1")},m(n,s){N(n,t,s),x(i,t,null),r=!0},p(n,[s]){const a={};s&1&&(a.$$scope={dirty:s,ctx:n}),i.$set(a)},i(n){r||(C(i.$$.fragment,n),r=!0)},o(n){P(i.$$.fragment,n),r=!1},d(n){n&&L(t),U(i)}}}const Qr=pt(!1);function Sp(){Qr.set(!0)}class Ep extends ee{constructor(t){super(),X(this,t,null,kp,Z,{})}}function Cp(e){let t,i;return{c(){t=I("div"),i=be(e[0]),cn(t,"background",e[1]),f(t,"class","avatar svelte-9v2kxo")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}function Rp(e){const t=e.split(/\s+/);return t.length===0?"":t.length===1?t[0].substring(0,2):t[0].charAt(0)+t[1].charAt(0)}function Pp(e,t,i){let{name:r}=t;const n=Rp(r).toUpperCase(),s=["#616161","#3F51B5","#4CAF50","#FFA000","#795548","#E91E63","#2F80FF","#8BC34A","#F57C00","#673AB7","#009688","#FBC02D"],a=((n==null?void 0:n.codePointAt(0))||0)%s.length,o=s[a];return e.$$set=l=>{"name"in l&&i(2,r=l.name)},[n,o,r]}class Bl extends ee{constructor(t){super(),X(this,t,Pp,Cp,Z,{name:2})}}function Ap(e){let t;return{c(){t=be("Log out")},m(i,r){N(i,t,r)},d(i){i&&L(t)}}}function Ip(e){let t,i;return t=new Tt({props:{classes:"btn-lite",$$slots:{default:[Ap]},$$scope:{ctx:e}}}),t.$on("click",wp),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},p(r,[n]){const s={};n&1&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}const Lr=pt(!1);function wp(){Lr.set(!0)}class $p extends ee{constructor(t){super(),X(this,t,null,Ip,Z,{})}}function Dp(e){let t,i,r,n,s,a;return r=new Bl({props:{name:e[0]+""}}),s=new $p({}),{c(){t=I("section"),i=I("div"),F(r.$$.fragment),n=W(),F(s.$$.fragment),f(i,"class","InitialAvatar svelte-j5vlzk"),f(i,"title",e[0]),f(t,"class","svelte-j5vlzk")},m(o,l){N(o,t,l),_(t,i),x(r,i,null),_(t,n),x(s,t,null),a=!0},p(o,[l]){const c={};l&1&&(c.name=o[0]+""),r.$set(c),(!a||l&1)&&f(i,"title",o[0])},i(o){a||(C(r.$$.fragment,o),C(s.$$.fragment,o),a=!0)},o(o){P(r.$$.fragment,o),P(s.$$.fragment,o),a=!1},d(o){o&&L(t),U(r),U(s)}}}function Op(e,t,i){let r;return Le(e,Gl,n=>i(0,r=n)),[r]}class Mp extends ee{constructor(t){super(),X(this,t,Op,Dp,Z,{})}}function Lp(e){let t,i;return t=new Mp({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Np(e){let t,i;return t=new Ep({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function xp(e){let t,i,r,n;const s=[Np,Lp],a=[];function o(l,c){return l[0]===""?0:1}return i=o(e),r=a[i]=s[i](e),{c(){t=I("section"),r.c(),f(t,"class","svelte-rm3wqd")},m(l,c){N(l,t,c),a[i].m(t,null),n=!0},p(l,[c]){let u=i;i=o(l),i!==u&&(Ne(),P(a[u],1,1,()=>{a[u]=null}),xe(),r=a[i],r||(r=a[i]=s[i](l),r.c()),C(r,1),r.m(t,null))},i(l){n||(C(r),n=!0)},o(l){P(r),n=!1},d(l){l&&L(t),a[i].d()}}}const Pi=pt(""),Gl=pt("");function Up(e,t,i){let r,n=M;return Le(e,Pi,s=>i(0,r=s)),e.$$.on_destroy.push(()=>n()),[r]}class Fp extends ee{constructor(t){super(),X(this,t,Up,xp,Z,{})}}function Bp(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","M18.6 32h3v-6.6h6.6v-3h-6.6v-6.6h-3v6.6H12v3h6.6ZM7 40q-1.2 0-2.1-.9Q4 38.2 4 37V11q0-1.2.9-2.1Q5.8 8 7 8h26q1.2 0 2.1.9.9.9.9 2.1v10.75l8-8v20.5l-8-8V37q0 1.2-.9 2.1-.9.9-2.1.9Zm0-3h26V11H7v26Zm0 0V11v26Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class Gp extends ee{constructor(t){super(),X(this,t,null,Bp,Z,{})}}function Vp(e){let t,i,r;return t=new Gp({}),{c(){F(t.$$.fragment),i=be(" New Meeting")},m(n,s){x(t,n,s),N(n,i,s),r=!0},i(n){r||(C(t.$$.fragment,n),r=!0)},o(n){P(t.$$.fragment,n),r=!1},d(n){U(t,n),n&&L(i)}}}function jp(e){let t,i,r;return i=new Tt({props:{classes:"btn-lite",$$slots:{default:[Vp]},$$scope:{ctx:e}}}),i.$on("click",e[0]),{c(){t=I("span"),F(i.$$.fragment),f(t,"class","svelte-qhn4a6")},m(n,s){N(n,t,s),x(i,t,null),r=!0},p(n,[s]){const a={};s&4&&(a.$$scope={dirty:s,ctx:n}),i.$set(a)},i(n){r||(C(i.$$.fragment,n),r=!0)},o(n){P(i.$$.fragment,n),r=!1},d(n){n&&L(t),U(i)}}}const Es=pt(!1);function qp(e,t,i){let r;Le(e,Pi,s=>i(1,r=s));function n(){Es.set(!0),r===""&&(Qr.set(!0),Ye.set({type:"warn",message:"Please log in first to create a room."}))}return[n]}class Hp extends ee{constructor(t){super(),X(this,t,qp,jp,Z,{})}}function Kp(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","m12.45 37.65-2.1-2.1L21.9 24 10.35 12.45l2.1-2.1L24 21.9l11.55-11.55 2.1 2.1L26.1 24l11.55 11.55-2.1 2.1L24 26.1Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class Cs extends ee{constructor(t){super(),X(this,t,null,Kp,Z,{})}}function Wp(e){let t,i,r,n,s;return i=new Cs({}),{c(){t=I("button"),F(i.$$.fragment),f(t,"class","CloseButton svelte-7l8tml"),f(t,"type","button")},m(a,o){N(a,t,o),x(i,t,null),r=!0,n||(s=_e(t,"click",e[0]),n=!0)},p:M,i(a){r||(C(i.$$.fragment,a),r=!0)},o(a){P(i.$$.fragment,a),r=!1},d(a){a&&L(t),U(i),n=!1,s()}}}function zp(e){function t(i){ao.call(this,e,i)}return[t]}class Vl extends ee{constructor(t){super(),X(this,t,zp,Wp,Z,{})}}function Jp(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","m24 30.75-12-12 2.15-2.15L24 26.5l9.85-9.85L36 18.8Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class jl extends ee{constructor(t){super(),X(this,t,null,Jp,Z,{})}}function ql(e){const t=e-1;return t*t*t+1}function Xt(e,{delay:t=0,duration:i=400,easing:r=ql,x:n=0,y:s=0,opacity:a=0}={}){const o=getComputedStyle(e),l=+o.opacity,c=o.transform==="none"?"":o.transform,u=l*(1-a);return{delay:t,duration:i,easing:r,css:(d,h)=>`
			transform: ${c} translate(${(1-d)*n}px, ${(1-d)*s}px);
			opacity: ${l-u*h}`}}function _a(e,t,i){const r=e.slice();return r[4]=t[i],r}function ka(e){let t,i=[],r=new Map,n,s,a,o=Nn;const l=c=>c[4];for(let c=0;c<o.length;c+=1){let u=_a(e,o,c),d=l(u);r.set(d,i[c]=Sa(d,u))}return{c(){t=I("div");for(let c=0;c<i.length;c+=1)i[c].c();f(t,"class","OptionsContainer card card-shadow svelte-1me5r5v")},m(c,u){N(c,t,u);for(let d=0;d<i.length;d+=1)i[d].m(t,null);a=!0},p(c,u){u&9&&(o=Nn,i=oi(i,u,l,1,c,o,r,t,Bi,Sa,null,_a))},i(c){a||(Dt(()=>{s&&s.end(1),n=Qi(t,Xt,{y:-20,duration:200}),n.start()}),a=!0)},o(c){n&&n.invalidate(),s=qn(t,Xt,{y:-20,duration:200}),a=!1},d(c){c&&L(t);for(let u=0;u<i.length;u+=1)i[u].d();c&&s&&s.end()}}}function Sa(e,t){let i,r=xn(t[4])+"",n,s,a,o;return{key:e,first:null,c(){i=I("button"),n=be(r),s=W(),f(i,"type","button"),f(i,"class","btn-lite Option svelte-1me5r5v"),fe(i,"btn-selected",t[4]===t[0]),this.first=i},m(l,c){N(l,i,c),_(i,n),_(i,s),a||(o=_e(i,"click",t[3](t[4])),a=!0)},p(l,c){t=l,c&1&&fe(i,"btn-selected",t[4]===t[0])},d(l){l&&L(i),a=!1,o()}}}function Qp(e){let t,i,r,n,s,a=xn(e[0])+"",o,l,c,u,d,h,p,g;u=new jl({});let v=e[1]&&ka(e);return{c(){t=I("section"),i=I("label"),i.textContent="Region (Optional):",r=W(),n=I("div"),s=I("button"),o=be(a),l=W(),c=I("div"),F(u.$$.fragment),d=W(),v&&v.c(),f(i,"for","RegionOption"),f(i,"class","svelte-1me5r5v"),f(c,"class","Expand svelte-1me5r5v"),fe(c,"Retract",e[1]),f(s,"type","button"),f(s,"id","RegionOption"),f(n,"class","ButtonContainer svelte-1me5r5v"),f(t,"class","normal-text svelte-1me5r5v")},m(S,G){N(S,t,G),_(t,i),_(t,r),_(t,n),_(n,s),_(s,o),_(s,l),_(s,c),x(u,c,null),_(n,d),v&&v.m(n,null),h=!0,p||(g=_e(s,"click",e[2]),p=!0)},p(S,[G]){(!h||G&1)&&a!==(a=xn(S[0])+"")&&Ze(o,a),(!h||G&2)&&fe(c,"Retract",S[1]),S[1]?v?(v.p(S,G),G&2&&C(v,1)):(v=ka(S),v.c(),C(v,1),v.m(n,null)):v&&(Ne(),P(v,1,1,()=>{v=null}),xe())},i(S){h||(C(u.$$.fragment,S),C(v),h=!0)},o(S){P(u.$$.fragment,S),P(v),h=!1},d(S){S&&L(t),U(u),v&&v.d(),p=!1,g()}}}const Nn=["auto","us","in","eu"];function xn(e){return e==="auto"?"Auto":e.toUpperCase()}function Yp(e,t,i){let{region:r=Nn[0]}=t,n=!1;function s(){i(1,n=!n)}function a(o){return()=>{i(0,r=o),i(1,n=!1)}}return e.$$set=o=>{"region"in o&&i(0,r=o.region)},[r,n,s,a]}class Zp extends ee{constructor(t){super(),X(this,t,Yp,Qp,Z,{region:0})}}const Hl="http://127.0.0.1:8000";function Xp(e){let t;return{c(){t=be("Send")},m(i,r){N(i,t,r)},i:M,o:M,d(i){i&&L(t)}}}function ef(e){let t,i;return t=new Jr({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function tf(e){let t,i,r,n;const s=[ef,Xp],a=[];function o(l,c){return l[3]?0:1}return t=o(e),i=a[t]=s[t](e),{c(){i.c(),r=ht()},m(l,c){a[t].m(l,c),N(l,r,c),n=!0},p(l,c){let u=t;t=o(l),t!==u&&(Ne(),P(a[u],1,1,()=>{a[u]=null}),xe(),i=a[t],i||(i=a[t]=s[t](l),i.c()),C(i,1),i.m(r.parentNode,r))},i(l){n||(C(i),n=!0)},o(l){P(i),n=!1},d(l){a[t].d(l),l&&L(r)}}}function rf(e){let t,i,r,n,s,a,o,l,c,u,d,h,p,g,v,S,G,w,D;function V(Y){e[6](Y)}let z={placeholder:"Name"};e[0]!==void 0&&(z.value=e[0]),n=new ci({props:z}),ut.push(()=>Jt(n,"value",V));function J(Y){e[7](Y)}let oe={placeholder:"Description (optional)"};e[1]!==void 0&&(oe.value=e[1]),o=new ci({props:oe}),ut.push(()=>Jt(o,"value",J));function ue(Y){e[8](Y)}let Q={};return e[2]!==void 0&&(Q.region=e[2]),u=new Zp({props:Q}),ut.push(()=>Jt(u,"region",ue)),g=new Tt({props:{type:"submit",classes:e[0]===""||e[1]===""||e[3]?"btn-disabled":"btn-primary",$$slots:{default:[tf]},$$scope:{ctx:e}}}),S=new Vl({}),S.$on("click",e[5]),{c(){t=I("form"),i=I("h1"),i.textContent="Create a new meeting room",r=W(),F(n.$$.fragment),a=W(),F(o.$$.fragment),c=W(),F(u.$$.fragment),h=W(),p=I("span"),F(g.$$.fragment),v=W(),F(S.$$.fragment),f(i,"class","normal-text svelte-cgu3r"),f(p,"class","Submit svelte-cgu3r"),f(t,"class","card card-dropin card-shadow svelte-cgu3r")},m(Y,se){N(Y,t,se),_(t,i),_(t,r),x(n,t,null),_(t,a),x(o,t,null),_(t,c),x(u,t,null),_(t,h),_(t,p),x(g,p,null),_(t,v),x(S,t,null),G=!0,w||(D=_e(t,"submit",Vr(e[4])),w=!0)},p(Y,[se]){const de={};!s&&se&1&&(s=!0,de.value=Y[0],zt(()=>s=!1)),n.$set(de);const Ae={};!l&&se&2&&(l=!0,Ae.value=Y[1],zt(()=>l=!1)),o.$set(Ae);const Ue={};!d&&se&4&&(d=!0,Ue.region=Y[2],zt(()=>d=!1)),u.$set(Ue);const ie={};se&11&&(ie.classes=Y[0]===""||Y[1]===""||Y[3]?"btn-disabled":"btn-primary"),se&520&&(ie.$$scope={dirty:se,ctx:Y}),g.$set(ie)},i(Y){G||(C(n.$$.fragment,Y),C(o.$$.fragment,Y),C(u.$$.fragment,Y),C(g.$$.fragment,Y),C(S.$$.fragment,Y),G=!0)},o(Y){P(n.$$.fragment,Y),P(o.$$.fragment,Y),P(u.$$.fragment,Y),P(g.$$.fragment,Y),P(S.$$.fragment,Y),G=!1},d(Y){Y&&L(t),U(n),U(o),U(u),U(g),U(S),w=!1,D()}}}const nf=Hl+"/rooms/api";function sf(e,t,i,r){return console.error("ACCESS_TOKEN: ",r),fetch(nf,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r},body:JSON.stringify({name:e,description:t,region:i})})}async function af(e,t,i){let r=!1;const n=await sf(e,t,i,tc(Pi));if(n.status!==201){const s=await n.text();Ye.set({type:"error",message:"Create Room error: "+s}),r=!0}else{const s=await n.json();er.set(s.room_token),Ye.set({type:"good",message:"Successfully created a room! Now you can join the room with the token we just entered for you :)"})}return r}function of(e,t,i){let r="",n="",s,a=!1;async function o(){i(3,a=!0);let h=null;try{h=await af(r,n,s)}catch(p){Ye.set({type:"error",message:"Create Room error: "+p.message})}h===!1&&l(),i(3,a=!1)}function l(){Es.set(!1)}function c(h){r=h,i(0,r)}function u(h){n=h,i(1,n)}function d(h){s=h,i(2,s)}return[r,n,s,a,o,l,c,u,d]}class lf extends ee{constructor(t){super(),X(this,t,of,rf,Z,{})}}function cf(e){let t,i,r;const n=e[1].default,s=Ur(n,e,e[0],null);return{c(){t=I("section"),i=I("div"),s&&s.c(),f(i,"class","WindowContainer svelte-bnrwrx"),f(t,"class","svelte-bnrwrx")},m(a,o){N(a,t,o),_(t,i),s&&s.m(i,null),r=!0},p(a,[o]){s&&s.p&&(!r||o&1)&&Br(s,n,a,a[0],r?Fr(n,a[0],o,null):Gr(a[0]),null)},i(a){r||(C(s,a),r=!0)},o(a){P(s,a),r=!1},d(a){a&&L(t),s&&s.d(a)}}}function uf(e,t,i){let{$$slots:r={},$$scope:n}=t;return e.$$set=s=>{"$$scope"in s&&i(0,n=s.$$scope)},[n,r]}class Ai extends ee{constructor(t){super(),X(this,t,uf,cf,Z,{})}}function Ea(e){let t,i;return t=new Ai({props:{$$slots:{default:[df]},$$scope:{ctx:e}}}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function df(e){let t,i;return t=new lf({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function hf(e){let t,i,r=e[0]&&e[1]!==""&&Ea(e);return{c(){r&&r.c(),t=ht()},m(n,s){r&&r.m(n,s),N(n,t,s),i=!0},p(n,[s]){n[0]&&n[1]!==""?r?s&3&&C(r,1):(r=Ea(n),r.c(),C(r,1),r.m(t.parentNode,t)):r&&(Ne(),P(r,1,1,()=>{r=null}),xe())},i(n){i||(C(r),i=!0)},o(n){P(r),i=!1},d(n){r&&r.d(n),n&&L(t)}}}function pf(e,t,i){let r,n;return Le(e,Es,s=>i(0,r=s)),Le(e,Pi,s=>i(1,n=s)),[r,n]}class ff extends ee{constructor(t){super(),X(this,t,pf,hf,Z,{})}}function mf(e){let t,i,r,n,s,a,o,l,c,u,d,h,p;const g=e[4].default,v=Ur(g,e,e[3],null);return{c(){t=I("section"),i=I("h1"),r=be(e[0]),n=W(),s=I("p"),v&&v.c(),a=W(),o=I("div"),l=I("button"),l.textContent="Yes",c=W(),u=I("button"),u.textContent="no",f(i,"class","normal-text svelte-1lal7nh"),f(s,"class","svelte-1lal7nh"),f(l,"class","btn-danger svelte-1lal7nh"),f(u,"class","btn-lite svelte-1lal7nh"),f(o,"class","svelte-1lal7nh"),f(t,"class","card card-shadow card-dropin svelte-1lal7nh")},m(S,G){N(S,t,G),_(t,i),_(i,r),_(t,n),_(t,s),v&&v.m(s,null),_(t,a),_(t,o),_(o,l),_(o,c),_(o,u),d=!0,h||(p=[_e(l,"click",function(){kt(e[1])&&e[1].apply(this,arguments)}),_e(u,"click",function(){kt(e[2])&&e[2].apply(this,arguments)})],h=!0)},p(S,[G]){e=S,(!d||G&1)&&Ze(r,e[0]),v&&v.p&&(!d||G&8)&&Br(v,g,e,e[3],d?Fr(g,e[3],G,null):Gr(e[3]),null)},i(S){d||(C(v,S),d=!0)},o(S){P(v,S),d=!1},d(S){S&&L(t),v&&v.d(S),h=!1,lt(p)}}}function gf(e,t,i){let{$$slots:r={},$$scope:n}=t,{title:s}=t,{handleYes:a,handleNo:o}=t;return e.$$set=l=>{"title"in l&&i(0,s=l.title),"handleYes"in l&&i(1,a=l.handleYes),"handleNo"in l&&i(2,o=l.handleNo),"$$scope"in l&&i(3,n=l.$$scope)},[s,a,o,n,r]}class vf extends ee{constructor(t){super(),X(this,t,gf,mf,Z,{title:0,handleYes:1,handleNo:2})}}function yf(e){let t;return{c(){t=be("Are you sure to log out?")},m(i,r){N(i,t,r)},d(i){i&&L(t)}}}function Tf(e){let t,i;return t=new vf({props:{title:"Log Out",handleYes:e[0],handleNo:e[1],$$slots:{default:[yf]},$$scope:{ctx:e}}}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},p(r,[n]){const s={};n&4&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function bf(e){function t(){Pi.set(""),Lr.set(!1)}function i(){Lr.set(!1)}return[t,i]}class _f extends ee{constructor(t){super(),X(this,t,bf,Tf,Z,{})}}function Ca(e){let t,i;return t=new Ai({props:{$$slots:{default:[kf]},$$scope:{ctx:e}}}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function kf(e){let t,i;return t=new _f({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Sf(e){let t,i,r=e[0]&&Ca(e);return{c(){r&&r.c(),t=ht()},m(n,s){r&&r.m(n,s),N(n,t,s),i=!0},p(n,[s]){n[0]?r?s&1&&C(r,1):(r=Ca(n),r.c(),C(r,1),r.m(t.parentNode,t)):r&&(Ne(),P(r,1,1,()=>{r=null}),xe())},i(n){i||(C(r),i=!0)},o(n){P(r),i=!1},d(n){r&&r.d(n),n&&L(t)}}}function Ef(e,t,i){let r;return Le(e,Lr,n=>i(0,r=n)),[r]}class Cf extends ee{constructor(t){super(),X(this,t,Ef,Sf,Z,{})}}function Rf(e){let t;return{c(){t=be(e[6])},m(i,r){N(i,t,r)},p(i,r){r&64&&Ze(t,i[6])},i:M,o:M,d(i){i&&L(t)}}}function Pf(e){let t,i;return t=new Jr({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},p:M,i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Af(e){let t,i,r,n;const s=[Pf,Rf],a=[];function o(l,c){return l[5]?0:1}return t=o(e),i=a[t]=s[t](e),{c(){i.c(),r=ht()},m(l,c){a[t].m(l,c),N(l,r,c),n=!0},p(l,c){let u=t;t=o(l),t===u?a[t].p(l,c):(Ne(),P(a[u],1,1,()=>{a[u]=null}),xe(),i=a[t],i?i.p(l,c):(i=a[t]=s[t](l),i.c()),C(i,1),i.m(r.parentNode,r))},i(l){n||(C(i),n=!0)},o(l){P(i),n=!1},d(l){a[t].d(l),l&&L(r)}}}function If(e){let t,i,r,n,s,a,o,l,c,u,d,h,p,g,v,S,G,w,D,V,z=e[1]?"Login":"Create Account",J,oe,ue,Q,Y,se,de,Ae,Ue;function ie(k){e[10](k)}let rt={placeholder:"User Name"};e[2]!==void 0&&(rt.value=e[2]),s=new ci({props:rt}),ut.push(()=>Jt(s,"value",ie));function at(k){e[11](k)}let m={placeholder:"Password",type:e[7]};e[3]!==void 0&&(m.value=e[3]),l=new ci({props:m}),ut.push(()=>Jt(l,"value",at));function b(k){e[12](k)}let R={placeholder:"Confirm Password",type:e[7]};return e[4]!==void 0&&(R.value=e[4]),h=new ci({props:R}),ut.push(()=>Jt(h,"value",b)),Q=new Tt({props:{type:"submit",classes:e[2]===""||e[3]===""||e[1]&&e[4]===""||e[5]?"btn-disabled":"btn-primary",$$slots:{default:[Af]},$$scope:{ctx:e}}}),se=new Vl({}),se.$on("click",e[8]),{c(){t=I("form"),i=I("h1"),r=be(e[6]),n=W(),F(s.$$.fragment),o=W(),F(l.$$.fragment),u=W(),d=I("span"),F(h.$$.fragment),g=W(),v=I("div"),S=I("label"),G=I("input"),w=be(`\r
            Show Password`),D=W(),V=I("button"),J=be(z),oe=W(),ue=I("span"),F(Q.$$.fragment),Y=W(),F(se.$$.fragment),f(i,"class","normal-text svelte-1mn5qqk"),f(d,"class","CreatAccount svelte-1mn5qqk"),fe(d,"ZoomIn",e[1]),f(G,"type","checkbox"),f(S,"class","ShowPassword svelte-1mn5qqk"),f(V,"class","SwitchMode svelte-1mn5qqk"),f(V,"type","button"),f(v,"class","Options svelte-1mn5qqk"),f(ue,"class","Submit svelte-1mn5qqk"),f(t,"class","card card-dropin card-shadow svelte-1mn5qqk")},m(k,A){N(k,t,A),_(t,i),_(i,r),_(t,n),x(s,t,null),_(t,o),x(l,t,null),_(t,u),_(t,d),x(h,d,null),_(t,g),_(t,v),_(v,S),_(S,G),G.checked=e[0],_(S,w),_(v,D),_(v,V),_(V,J),_(t,oe),_(t,ue),x(Q,ue,null),_(t,Y),x(se,t,null),de=!0,Ae||(Ue=[_e(G,"change",e[13]),_e(V,"click",e[14]),_e(t,"submit",Vr(e[9]))],Ae=!0)},p(k,[A]){(!de||A&64)&&Ze(r,k[6]);const E={};!a&&A&4&&(a=!0,E.value=k[2],zt(()=>a=!1)),s.$set(E);const $={};A&128&&($.type=k[7]),!c&&A&8&&(c=!0,$.value=k[3],zt(()=>c=!1)),l.$set($);const O={};A&128&&(O.type=k[7]),!p&&A&16&&(p=!0,O.value=k[4],zt(()=>p=!1)),h.$set(O),(!de||A&2)&&fe(d,"ZoomIn",k[1]),A&1&&(G.checked=k[0]),(!de||A&2)&&z!==(z=k[1]?"Login":"Create Account")&&Ze(J,z);const B={};A&62&&(B.classes=k[2]===""||k[3]===""||k[1]&&k[4]===""||k[5]?"btn-disabled":"btn-primary"),A&32864&&(B.$$scope={dirty:A,ctx:k}),Q.$set(B)},i(k){de||(C(s.$$.fragment,k),C(l.$$.fragment,k),C(h.$$.fragment,k),C(Q.$$.fragment,k),C(se.$$.fragment,k),de=!0)},o(k){P(s.$$.fragment,k),P(l.$$.fragment,k),P(h.$$.fragment,k),P(Q.$$.fragment,k),P(se.$$.fragment,k),de=!1},d(k){k&&L(t),U(s),U(l),U(h),U(Q),U(se),Ae=!1,lt(Ue)}}}const Kl=Hl+"/auth/";function wf(e,t){return fetch(Kl+"login/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})})}function $f(e,t,i){return fetch(Kl+"register/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:e,password:t,password2:i})})}async function Df(e,t,i){let r=!1;const n=await $f(e,t,i);if(n.status!==201){const s=await n.text();Ye.set({type:"error",message:"Create account error: "+s}),r=!0}else{const s=await n.json();console.error("READER",s)}return r}async function Ra(e,t){let i=!1;const r=await wf(e,t);if(r.status!==200){const n=await r.json();Ye.set({type:"error",message:"Login error: "+n.detail}),i=!0}else{const n=await r.json();Pi.set(n.access),Gl.set(e)}return i}function Of(e,t,i){let r,n,s="",a="",o="",l=!1,c=!1,u=!1;function d(){Qr.set(!1)}async function h(){i(5,u=!0);let w=null;try{c?(w=await Df(s,a,o),w=await Ra(s,a)):w=await Ra(s,a)}catch(D){Ye.set({type:"error",message:"Login error: "+D.message})}w===!1&&(c?Ye.set({type:"good",message:"Welcome, "+s+"."}):Ye.set({type:"good",message:"Welcome back, "+s+"."}),d()),i(5,u=!1)}function p(w){s=w,i(2,s)}function g(w){a=w,i(3,a)}function v(w){o=w,i(4,o)}function S(){l=this.checked,i(0,l)}const G=()=>i(1,c=!c);return e.$$.update=()=>{e.$$.dirty&1&&i(7,r=l?"text":"password"),e.$$.dirty&2&&i(6,n=c?"Create Account":"Login")},[l,c,s,a,o,u,n,r,d,h,p,g,v,S,G]}class Mf extends ee{constructor(t){super(),X(this,t,Of,If,Z,{})}}function Pa(e){let t,i;return t=new Ai({props:{$$slots:{default:[Lf]},$$scope:{ctx:e}}}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Lf(e){let t,i;return t=new Mf({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Nf(e){let t,i,r=e[0]&&Pa(e);return{c(){r&&r.c(),t=ht()},m(n,s){r&&r.m(n,s),N(n,t,s),i=!0},p(n,[s]){n[0]?r?s&1&&C(r,1):(r=Pa(n),r.c(),C(r,1),r.m(t.parentNode,t)):r&&(Ne(),P(r,1,1,()=>{r=null}),xe())},i(n){i||(C(r),i=!0)},o(n){P(r),i=!1},d(n){r&&r.d(n),n&&L(t)}}}function xf(e,t,i){let r;return Le(e,Qr,n=>i(0,r=n)),[r]}class Uf extends ee{constructor(t){super(),X(this,t,xf,Nf,Z,{})}}class Ff extends ee{constructor(t){super(),X(this,t,null,null,Z,{})}}function Bf(e){let t;return{c(){t=I("section"),t.innerHTML=`<h1 class="normal-text svelte-sjtk2n">Simon made a video meeting app with 100ms.</h1> 
    <p class="sub-text svelte-sjtk2n">The frontend took most of the time and maybe I over engineered a little bit.</p>`,f(t,"class","svelte-sjtk2n")},m(i,r){N(i,t,r)},p:M,i:M,o:M,d(i){i&&L(t)}}}class Gf extends ee{constructor(t){super(),X(this,t,null,Bf,Z,{})}}function Vf(e){let t,i,r,n,s,a,o,l,c,u,d;return r=new Gf({}),o=new hp({}),u=new Hp({}),{c(){t=I("section"),i=I("div"),F(r.$$.fragment),n=W(),s=I("div"),a=I("div"),F(o.$$.fragment),l=W(),c=I("div"),F(u.$$.fragment),f(i,"class","OpeningWords svelte-15zurzp"),f(a,"class","JoinRoomForm svelte-15zurzp"),f(c,"class","CreateRoom svelte-15zurzp"),f(s,"class","JoinCreate svelte-15zurzp"),f(t,"class","svelte-15zurzp")},m(h,p){N(h,t,p),_(t,i),x(r,i,null),_(t,n),_(t,s),_(s,a),x(o,a,null),_(s,l),_(s,c),x(u,c,null),d=!0},p:M,i(h){d||(C(r.$$.fragment,h),C(o.$$.fragment,h),C(u.$$.fragment,h),d=!0)},o(h){P(r.$$.fragment,h),P(o.$$.fragment,h),P(u.$$.fragment,h),d=!1},d(h){h&&L(t),U(r),U(o),U(u)}}}class jf extends ee{constructor(t){super(),X(this,t,null,Vf,Z,{})}}function qf(e){let t,i,r,n,s;return{c(){t=ae("svg"),i=ae("text"),r=be(`SIMON \r
	`),n=ae("text"),s=be("MEET"),f(i,"x","25%"),f(i,"y","50%"),f(i,"dy",".35em"),f(i,"text-anchor","middle"),f(i,"class","svelte-5tj7sk"),f(n,"class","AnimatedText svelte-5tj7sk"),f(n,"x","60%"),f(n,"y","50%"),f(n,"dy",".35em"),f(n,"text-anchor","middle"),f(t,"viewBox","0 0 1320 300"),f(t,"class","svelte-5tj7sk")},m(a,o){N(a,t,o),_(t,i),_(i,r),_(t,n),_(n,s)},p:M,i:M,o:M,d(a){a&&L(t)}}}class Hf extends ee{constructor(t){super(),X(this,t,null,qf,Z,{})}}function Kf(e){let t,i,r,n,s,a,o;return r=new Hf({}),a=new Fp({}),{c(){t=I("section"),i=I("div"),F(r.$$.fragment),n=W(),s=I("div"),F(a.$$.fragment),f(i,"class","Logo svelte-birkkd"),f(s,"class","User svelte-birkkd"),f(t,"class","svelte-birkkd")},m(l,c){N(l,t,c),_(t,i),x(r,i,null),_(t,n),_(t,s),x(a,s,null),o=!0},p:M,i(l){o||(C(r.$$.fragment,l),C(a.$$.fragment,l),o=!0)},o(l){P(r.$$.fragment,l),P(a.$$.fragment,l),o=!1},d(l){l&&L(t),U(r),U(a)}}}class Wf extends ee{constructor(t){super(),X(this,t,null,Kf,Z,{})}}function zf(e){let t,i,r,n,s,a,o,l,c,u,d,h,p,g,v,S,G;return r=new Wf({}),o=new jf({}),u=new Ff({}),h=new Uf({}),g=new Cf({}),S=new ff({}),{c(){t=I("section"),i=I("div"),F(r.$$.fragment),n=W(),s=I("div"),a=I("div"),F(o.$$.fragment),l=W(),c=I("div"),F(u.$$.fragment),d=W(),F(h.$$.fragment),p=W(),F(g.$$.fragment),v=W(),F(S.$$.fragment),f(i,"class","TopBar svelte-1xu0qz8"),f(a,"class","ToDo svelte-1xu0qz8"),f(c,"class","FeatureIntro svelte-1xu0qz8"),f(s,"class","Content svelte-1xu0qz8"),f(t,"class","svelte-1xu0qz8")},m(w,D){N(w,t,D),_(t,i),x(r,i,null),_(t,n),_(t,s),_(s,a),x(o,a,null),_(s,l),_(s,c),x(u,c,null),N(w,d,D),x(h,w,D),N(w,p,D),x(g,w,D),N(w,v,D),x(S,w,D),G=!0},p:M,i(w){G||(C(r.$$.fragment,w),C(o.$$.fragment,w),C(u.$$.fragment,w),C(h.$$.fragment,w),C(g.$$.fragment,w),C(S.$$.fragment,w),G=!0)},o(w){P(r.$$.fragment,w),P(o.$$.fragment,w),P(u.$$.fragment,w),P(h.$$.fragment,w),P(g.$$.fragment,w),P(S.$$.fragment,w),G=!1},d(w){w&&L(t),U(r),U(o),U(u),w&&L(d),U(h,w),w&&L(p),U(g,w),w&&L(v),U(S,w)}}}class Jf extends ee{constructor(t){super(),X(this,t,null,zf,Z,{})}}function Qf(e){let t;return{c(){t=I("video"),f(t,"class","peer-video svelte-nb3mex"),t.autoplay=!0,t.muted=!0,t.playsInline=!0,fe(t,"local",e[0])},m(i,r){N(i,t,r),e[3](t)},p(i,[r]){r&1&&fe(t,"local",i[0])},i:M,o:M,d(i){i&&L(t),e[3](null)}}}function Yf(e,t,i){let{isLocal:r}=t,{peerId:n}=t,s;jn(()=>Ot.subscribe(o=>{!o||!s||(o!=null&&o.enabled?dt.attachVideo(o.id,s):dt.detachVideo(o.id,s))},$l(n)));function a(o){ut[o?"unshift":"push"](()=>{s=o,i(1,s)})}return e.$$set=o=>{"isLocal"in o&&i(0,r=o.isLocal),"peerId"in o&&i(2,n=o.peerId)},[r,s,n,a]}class Zf extends ee{constructor(t){super(),X(this,t,Yf,Qf,Z,{isLocal:0,peerId:2})}}function Xf(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","M3.046 3.046a.75.75 0 000 1.06l16.847 16.848a.75.75 0 101.06-1.06L4.108 3.045a.75.75 0 00-1.06 0zm.256 6.303a13.888 13.888 0 012.175-1.432l1.356 1.356c-.847.401-1.65.902-2.391 1.497a.91.91 0 01-1.14-1.42zm2.066 3.625A9.79 9.79 0 018.57 11.01l1.451 1.451a7.969 7.969 0 00-3.42 1.854.91.91 0 11-1.233-1.34zm7.503-2.543l2.563 2.563a7.968 7.968 0 011.927 1.297.91.91 0 101.227-1.346 9.79 9.79 0 00-5.717-2.514zm2.391 7.271L12.05 14.49h-.057a5.698 5.698 0 00-1.752.277c-.852.276-1.63.75-2.267 1.386a.91.91 0 101.286 1.29 3.878 3.878 0 013.66-1.019c.683.17 1.308.521 1.807 1.019.15.15.34.236.535.259zM9.048 6.608l1.582 1.583a12.07 12.07 0 018.928 2.584.91.91 0 001.14-1.42 13.89 13.89 0 00-11.65-2.747z"),f(i,"fill","red"),f(t,"viewBox","0 0 24 24"),f(t,"fill","none"),f(t,"xmlns","http://www.w3.org/2000/svg")},m(r,n){N(r,t,n),_(t,i)},p:M,d(r){r&&L(t)}}}function em(e){let t,i,r,n,s,a,o,l,c;return{c(){t=ae("svg"),i=ae("path"),n=ae("path"),a=ae("path"),l=ae("path"),f(i,"d","M6.875 0c2.549.035 4.679.902 6.445 2.648.366.362.45.796.216 1.096-.239.306-.714.34-1.142.072a2.28 2.28 0 0 1-.341-.271C9.24.862 4.924.775 1.992 3.346c-.284.249-.594.419-.983.393-.272-.019-.49-.135-.613-.388-.125-.261-.05-.498.114-.713.073-.092.156-.177.245-.254C2.516.804 4.591.039 6.875 0Z"),f(i,"fill",r=qt(4,e[0])),f(i,"transform","translate(-.333)"),f(n,"d","M7.056 2.964c1.756.035 3.208.7 4.499 1.763.162.134.277.315.354.512.098.251.114.503-.075.72-.193.222-.452.259-.725.198-.293-.066-.518-.247-.738-.443a4.859 4.859 0 0 0-6.198-.26c-.166.127-.318.271-.475.409-.242.211-.513.343-.843.317-.43-.034-.679-.397-.561-.81.062-.211.181-.4.345-.546 1.265-1.162 2.733-1.836 4.417-1.86Z"),f(n,"fill",s=qt(3,e[0])),f(n,"transform","translate(-.333)"),f(a,"d","M7.384,6.052C8.293,6.068 9.157,6.449 9.783,7.108C10.005,7.339 10.157,7.6 10.07,7.942C9.959,8.377 9.435,8.581 9.071,8.243C7.935,7.191 6.356,7.183 5.152,8.183C4.816,8.462 4.6,8.485 4.332,8.27C4.063,8.055 3.998,7.691 4.177,7.358C4.273,7.179 4.414,7.038 4.57,6.911C5.26,6.349 6.149,6.05 7.384,6.052L7.384,6.052Z"),f(a,"fill",o=qt(2,e[0])),f(l,"d","M8.214,9.941C8.214,10.234 8.097,10.515 7.888,10.721C7.68,10.928 7.398,11.042 7.104,11.039C6.471,11.036 5.982,10.541 5.993,9.912C6.004,9.259 6.499,8.766 7.133,8.779C7.744,8.791 8.22,9.301 8.214,9.941Z"),f(l,"fill",c=qt(1,e[0])),f(t,"viewBox","0 0 14 12"),f(t,"xmlns","http://www.w3.org/2000/svg")},m(u,d){N(u,t,d),_(t,i),_(t,n),_(t,a),_(t,l)},p(u,d){d&1&&r!==(r=qt(4,u[0]))&&f(i,"fill",r),d&1&&s!==(s=qt(3,u[0]))&&f(n,"fill",s),d&1&&o!==(o=qt(2,u[0]))&&f(a,"fill",o),d&1&&c!==(c=qt(1,u[0]))&&f(l,"fill",c)},d(u){u&&L(t)}}}function tm(e){let t;function i(s,a){if(s[0]!==void 0&&s[0]>0)return em;if(s[0]===0)return Xf}let r=i(e),n=r&&r(e);return{c(){t=I("section"),n&&n.c(),f(t,"class","svelte-kyc0hb")},m(s,a){N(s,t,a),n&&n.m(t,null)},p(s,[a]){r===(r=i(s))&&n?n.p(s,a):(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(t,null)))},i:M,o:M,d(s){s&&L(t),n&&n.d()}}}const im=(e,t)=>Ot.subscribe(i=>{t(i==null?void 0:i.downlinkQuality)},Ch(e)),qt=(e,t)=>{const i="#303740";return e<=t?t>=4?"#37F28D":t>=3?"#FAC919":"#ED4C5A":i};function rm(e,t,i){let{peerId:r}=t,n;const s=im(r,a=>i(0,n=a));return Pt(s),e.$$set=a=>{"peerId"in a&&i(1,r=a.peerId)},[n,r]}class nm extends ee{constructor(t){super(),X(this,t,rm,tm,Z,{peerId:1})}}function sm(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","m34.3 29.95-2.15-2.15q1.05-1.3 1.55-2.925.5-1.625.5-3.325h3q0 2.3-.75 4.45-.75 2.15-2.15 3.95ZM23.05 18.7Zm4.85 4.85-2.65-2.6V9.05q0-.85-.6-1.45T23.2 7q-.85 0-1.45.6t-.6 1.45v7.75l-3-3V9.05q0-2.1 1.475-3.575T23.2 4q2.1 0 3.575 1.475T28.25 9.05v12.5q0 .4-.075 1t-.275 1ZM21.7 42v-6.8q-5.3-.55-8.9-4.45-3.6-3.9-3.6-9.2h3q0 4.55 3.225 7.65 3.225 3.1 7.775 3.1 1.9 0 3.65-.625t3.2-1.725l2.15 2.15q-1.55 1.3-3.45 2.075-1.9.775-4.05 1.025V42Zm19.85 3.25L1.8 5.5l1.9-1.9 39.75 39.75Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class Wl extends ee{constructor(t){super(),X(this,t,null,sm,Z,{})}}function am(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","M24 26.85q-2.15 0-3.6-1.55-1.45-1.55-1.45-3.75V9q0-2.1 1.475-3.55Q21.9 4 24 4t3.575 1.45Q29.05 6.9 29.05 9v12.55q0 2.2-1.45 3.75-1.45 1.55-3.6 1.55Zm0-11.4ZM22.5 42v-6.8q-5.3-.55-8.9-4.45-3.6-3.9-3.6-9.2h3q0 4.55 3.225 7.65Q19.45 32.3 24 32.3q4.55 0 7.775-3.1Q35 26.1 35 21.55h3q0 5.3-3.6 9.2-3.6 3.9-8.9 4.45V42ZM24 23.85q.9 0 1.475-.675.575-.675.575-1.625V9q0-.85-.6-1.425Q24.85 7 24 7t-1.45.575q-.6.575-.6 1.425v12.55q0 .95.575 1.625T24 23.85Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class zl extends ee{constructor(t){super(),X(this,t,null,am,Z,{})}}function om(e){let t,i;return t=new Zf({props:{isLocal:e[0].isLocal,peerId:e[0].id}}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},p(r,n){const s={};n&1&&(s.isLocal=r[0].isLocal),n&1&&(s.peerId=r[0].id),t.$set(s)},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function lm(e){let t,i,r;return i=new Bl({props:{name:e[0].name}}),{c(){t=I("div"),F(i.$$.fragment),f(t,"class","avatar-container svelte-6muxnv")},m(n,s){N(n,t,s),x(i,t,null),r=!0},p(n,s){const a={};s&1&&(a.name=n[0].name),i.$set(a)},i(n){r||(C(i.$$.fragment,n),r=!0)},o(n){P(i.$$.fragment,n),r=!1},d(n){n&&L(t),U(i)}}}function cm(e){let t,i;return t=new zl({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function um(e){let t,i;return t=new Wl({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function dm(e){let t,i,r,n,s,a,o,l,c,u,d,h,p,g=e[0].name+"",v,S,G,w=e[0].isLocal?" (You)":"",D,V,z;const J=[lm,om],oe=[];function ue(de,Ae){var Ue,ie;return!((Ue=de[1])!=null&&Ue.enabled)||((ie=de[1])==null?void 0:ie.degraded)?0:1}i=ue(e),r=oe[i]=J[i](e),a=new nm({props:{peerId:e[0].id}});const Q=[um,cm],Y=[];function se(de,Ae){return de[2]?1:0}return c=se(e),u=Y[c]=Q[c](e),{c(){t=I("div"),r.c(),n=W(),s=I("div"),F(a.$$.fragment),o=W(),l=I("div"),u.c(),d=W(),h=I("div"),p=I("span"),v=be(g),S=W(),G=I("div"),D=be(w),f(s,"class","ConnectionQuality svelte-6muxnv"),f(l,"class","MicState svelte-6muxnv"),f(p,"class","svelte-6muxnv"),f(h,"class","peer-name normal-text svelte-6muxnv"),f(t,"class","video-container svelte-6muxnv"),f(t,"style",V=e[3]+"transition: all 0.5s ease-in-out;"),fe(t,"PeerHovering",e[0].id===e[4])},m(de,Ae){N(de,t,Ae),oe[i].m(t,null),_(t,n),_(t,s),x(a,s,null),_(t,o),_(t,l),Y[c].m(l,null),_(t,d),_(t,h),_(h,p),_(p,v),_(h,S),_(h,G),_(G,D),z=!0},p(de,[Ae]){let Ue=i;i=ue(de),i===Ue?oe[i].p(de,Ae):(Ne(),P(oe[Ue],1,1,()=>{oe[Ue]=null}),xe(),r=oe[i],r?r.p(de,Ae):(r=oe[i]=J[i](de),r.c()),C(r,1),r.m(t,n));const ie={};Ae&1&&(ie.peerId=de[0].id),a.$set(ie);let rt=c;c=se(de),c!==rt&&(Ne(),P(Y[rt],1,1,()=>{Y[rt]=null}),xe(),u=Y[c],u||(u=Y[c]=Q[c](de),u.c()),C(u,1),u.m(l,null)),(!z||Ae&1)&&g!==(g=de[0].name+"")&&Ze(v,g),(!z||Ae&1)&&w!==(w=de[0].isLocal?" (You)":"")&&Ze(D,w),(!z||Ae&8&&V!==(V=de[3]+"transition: all 0.5s ease-in-out;"))&&f(t,"style",V),(!z||Ae&17)&&fe(t,"PeerHovering",de[0].id===de[4])},i(de){z||(C(r),C(a.$$.fragment,de),C(u),z=!0)},o(de){P(r),P(a.$$.fragment,de),P(u),z=!1},d(de){de&&L(t),oe[i].d(),U(a),Y[c].d()}}}const hm=(e,t)=>Ot.subscribe(i=>t(i),Eh(e));console.log("all speakers",Ot.getState(vl));const pm=(e,t)=>Ot.subscribe(i=>{t(i)},$l(e)),fm=(e,t)=>Ot.subscribe(i=>{t(i)},Ah(e)),tr=pt("");tr.subscribe(e=>console.error(e));function Wt(e){return()=>{tr.set(e)}}function Jl(){tr.set("")}function mm(e,t,i){let r,n,s=M;Le(e,tr,p=>i(4,n=p)),e.$$.on_destroy.push(()=>s());let{peer:a}=t,o,l=0,c=!1;const u=pm(a.id,p=>i(1,o=p)),d=hm(a.id,p=>i(5,l=p)),h=fm(a.id,p=>i(2,c=p));return Pt(()=>{u(),d(),h()}),e.$$set=p=>{"peer"in p&&i(0,a=p.peer)},e.$$.update=()=>{e.$$.dirty&32&&i(3,r=(p=>{const g=S=>1/(1+Math.exp(-S)),v="lightgreen";return`box-shadow: ${p?`0px 0px ${24*g(p)}px ${v}, 0px 0px ${16*g(p)}px ${v}`:""};`})(l))},[a,o,c,r,n,l]}class gm extends ee{constructor(t){super(),X(this,t,mm,dm,Z,{peer:0})}}function Aa(e,t,i){const r=e.slice();return r[4]=t[i],r}function Ia(e,t){let i,r,n,s;return r=new gm({props:{peer:t[4]}}),{key:e,first:null,c(){i=I("div"),F(r.$$.fragment),n=W(),f(i,"class","tile svelte-1pa7gn"),this.first=i},m(a,o){N(a,i,o),x(r,i,null),_(i,n),s=!0},p(a,o){t=a;const l={};o&2&&(l.peer=t[4]),r.$set(l)},i(a){s||(C(r.$$.fragment,a),s=!0)},o(a){P(r.$$.fragment,a),s=!1},d(a){a&&L(i),U(r)}}}function vm(e){let t,i,r=[],n=new Map,s,a=e[1];const o=l=>l[4].id;for(let l=0;l<a.length;l+=1){let c=Aa(e,a,l),u=o(c);n.set(u,r[l]=Ia(u,c))}return{c(){t=I("div"),i=I("div");for(let l=0;l<r.length;l+=1)r[l].c();f(i,"class","gallery svelte-1pa7gn"),f(t,"class","gallery-container svelte-1pa7gn")},m(l,c){N(l,t,c),_(t,i);for(let u=0;u<r.length;u+=1)r[u].m(i,null);e[2](t),s=!0},p(l,[c]){c&2&&(a=l[1],Ne(),r=oi(r,c,o,1,l,a,n,i,uo,Ia,null,Aa),xe())},i(l){if(!s){for(let c=0;c<a.length;c+=1)C(r[c]);s=!0}},o(l){for(let c=0;c<r.length;c+=1)P(r[c]);s=!1},d(l){l&&L(t);for(let c=0;c<r.length;c+=1)r[c].d();e[2](null)}}}function ym({containerHeight:e,containerWidth:t,numTiles:i,aspectRatio:r=1}){let n={rows:0,cols:0,height:0,width:0};if(i<=0||t<=0||e<=0)return n;let s=0;for(let a=1;a<=i;a++){const o=Math.ceil(i/a);let l=Math.floor(t/a),c=Math.floor(l/r);const u=Math.floor(e/o);c>u&&(c=u,l=Math.floor(u*r));const d=l*c;d>s&&(s=d,n={rows:o,cols:a,height:c,width:l})}return n}function Tm(e,t,i){let r;Le(e,Ul,o=>i(1,r=o));let n;const s=(o,l)=>{if(!n)return;const c=o.getBoundingClientRect().width,u=o.getBoundingClientRect().height,d=l.length;let h=ym({containerHeight:u,containerWidth:c,numTiles:d});n.style.setProperty("--width",`${h.width}px`),n.style.setProperty("--height",`${h.height}px`),n.style.setProperty("--cols",`${h.cols}`)};jn(()=>{const o=new ResizeObserver(()=>s(n,r));return o.observe(n),()=>o.unobserve(n)});function a(o){ut[o?"unshift":"push"](()=>{n=o,i(0,n)})}return e.$$.update=()=>{e.$$.dirty&3&&s(n,r)},[n,r,a]}class Ql extends ee{constructor(t){super(),X(this,t,Tm,vm,Z,{})}}function bm(e){let t;return{c(){t=I("video"),f(t,"class","peer-video svelte-16bvc5t"),cn(t,"--objectFit",e[1]),t.autoplay=!0,t.muted=!0,t.playsInline=!0,fe(t,"mirror",e[0])},m(i,r){N(i,t,r),e[4](t)},p(i,[r]){r&2&&cn(t,"--objectFit",i[1]),r&1&&fe(t,"mirror",i[0])},i:M,o:M,d(i){i&&L(t),e[4](null)}}}function _m(e,t,i){let{mirror:r}=t,{trackId:n}=t,{objectFit:s="cover"}=t,a,o;function l(u,d){a&&a(),!(!u||!d)&&(a=Ot.subscribe(h=>{!h||(h!=null&&h.enabled?dt.attachVideo(h.id,d):dt.detachVideo(h.id,d))},wl(u)))}Pt(()=>a==null?void 0:a());function c(u){ut[u?"unshift":"push"](()=>{o=u,i(2,o)})}return e.$$set=u=>{"mirror"in u&&i(0,r=u.mirror),"trackId"in u&&i(3,n=u.trackId),"objectFit"in u&&i(1,s=u.objectFit)},e.$$.update=()=>{e.$$.dirty&12&&l(n,o)},[r,s,o,n,c]}class km extends ee{constructor(t){super(),X(this,t,_m,bm,Z,{mirror:0,trackId:3,objectFit:1})}}function Sm(e){var n;let t,i,r;return i=new km({props:{mirror:!1,trackId:(n=e[0])==null?void 0:n.id,objectFit:"contain"}}),{c(){t=I("div"),F(i.$$.fragment),f(t,"class","screenshare-container svelte-1djfyo")},m(s,a){N(s,t,a),x(i,t,null),r=!0},p(s,[a]){var l;const o={};a&1&&(o.trackId=(l=s[0])==null?void 0:l.id),i.$set(o)},i(s){r||(C(i.$$.fragment,s),r=!0)},o(s){P(i.$$.fragment,s),r=!1},d(s){s&&L(t),U(i)}}}function Em(e,t,i){let r;Le(e,bp,o=>i(1,r=o));let n,s;const a=o=>{n&&n(),o&&(n=Ot.subscribe(l=>{i(0,s=l)},Ph(o)))};return Pt(()=>n==null?void 0:n()),e.$$.update=()=>{e.$$.dirty&2&&a(r==null?void 0:r.id)},[s,r]}class Cm extends ee{constructor(t){super(),X(this,t,Em,Sm,Z,{})}}function Rm(e){let t;return{c(){t=be("Allow Audio")},m(i,r){N(i,t,r)},i:M,o:M,d(i){i&&L(t)}}}function Pm(e){let t,i;return t=new Jr({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Am(e){let t,i,r,n;const s=[Pm,Rm],a=[];function o(l,c){return l[0]?0:1}return t=o(e),i=a[t]=s[t](e),{c(){i.c(),r=ht()},m(l,c){a[t].m(l,c),N(l,r,c),n=!0},p(l,c){let u=t;t=o(l),t!==u&&(Ne(),P(a[u],1,1,()=>{a[u]=null}),xe(),i=a[t],i||(i=a[t]=s[t](l),i.c()),C(i,1),i.m(r.parentNode,r))},i(l){n||(C(i),n=!0)},o(l){P(i),n=!1},d(l){a[t].d(l),l&&L(r)}}}function Im(e){let t,i,r,n,s,a,o,l;return o=new Tt({props:{classes:"btn-primary",$$slots:{default:[Am]},$$scope:{ctx:e}}}),o.$on("click",e[1]),{c(){t=I("section"),i=I("h2"),i.textContent="Couldn't Play Audio :(",r=W(),n=I("p"),n.innerHTML=`The browser wants us to get a confirmation for playing the Audio.
        <br/>
		Please allow audio to proceed.`,s=W(),a=I("span"),F(o.$$.fragment),f(i,"class","normal-text svelte-4kp3uc"),f(n,"class","normal-text"),f(a,"class","svelte-4kp3uc"),f(t,"class","card card-dropin")},m(c,u){N(c,t,u),_(t,i),_(t,r),_(t,n),_(t,s),_(t,a),x(o,a,null),l=!0},p(c,[u]){const d={};u&9&&(d.$$scope={dirty:u,ctx:c}),o.$set(d)},i(c){l||(C(o.$$.fragment,c),l=!0)},o(c){P(o.$$.fragment,c),l=!1},d(c){c&&L(t),U(o)}}}const Rs=pt(!0),wm=()=>Nl.onNotification(e=>{if(e.type===Ee.ERROR){const t=e.data;(t==null?void 0:t.code)===3008&&Rs.set(!0)}});function $m(e,t,i){let r=!1;const n=async()=>{i(0,r=!0),await dt.unblockAudio(),Rs.set(!1),i(0,r=!1)},s=wm();return Pt(s),[r,n]}class Dm extends ee{constructor(t){super(),X(this,t,$m,Im,Z,{})}}function wa(e){let t,i;return t=new Ai({props:{$$slots:{default:[Om]},$$scope:{ctx:e}}}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Om(e){let t,i;return t=new Dm({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Mm(e){let t,i,r=e[0]&&wa(e);return{c(){r&&r.c(),t=ht()},m(n,s){r&&r.m(n,s),N(n,t,s),i=!0},p(n,[s]){n[0]?r?s&1&&C(r,1):(r=wa(n),r.c(),C(r,1),r.m(t.parentNode,t)):r&&(Ne(),P(r,1,1,()=>{r=null}),xe())},i(n){i||(C(r),i=!0)},o(n){P(r),i=!1},d(n){r&&r.d(n),n&&L(t)}}}function Lm(e,t,i){let r;return Le(e,Rs,n=>i(0,r=n)),[r]}class Nm extends ee{constructor(t){super(),X(this,t,Lm,Mm,Z,{})}}function xm(e){let t,i,r;return{c(){t=ae("svg"),i=ae("path"),r=ae("path"),f(i,"fill","#E04F5F"),f(i,"d","M504.1,256C504.1,119,393,7.9,256,7.9C119,7.9,7.9,119,7.9,256C7.9,393,119,504.1,256,504.1C393,504.1,504.1,393,504.1,256z"),f(r,"fill","#FFF"),f(r,"d","M285,256l72.5-84.2c7.9-9.2,6.9-23-2.3-31c-9.2-7.9-23-6.9-30.9,2.3L256,222.4l-68.2-79.2c-7.9-9.2-21.8-10.2-31-2.3c-9.2,7.9-10.2,21.8-2.3,31L227,256l-72.5,84.2c-7.9,9.2-6.9,23,2.3,31c4.1,3.6,9.2,5.3,14.3,5.3c6.2,0,12.3-2.6,16.6-7.6l68.2-79.2l68.2,79.2c4.3,5,10.5,7.6,16.6,7.6c5.1,0,10.2-1.7,14.3-5.3c9.2-7.9,10.2-21.8,2.3-31L285,256z"),f(t,"viewBox","0 0 512 512"),f(t,"width","64px"),f(t,"height","64px")},m(n,s){N(n,t,s),_(t,i),_(t,r)},p:M,i:M,o:M,d(n){n&&L(t)}}}class Um extends ee{constructor(t){super(),X(this,t,null,xm,Z,{})}}function $a(e,t,i){const r=e.slice();return r[6]=t[i],r}function Da(e,t,i){const r=e.slice();return r[6]=t[i],r}function Oa(e,t,i){const r=e.slice();return r[6]=t[i],r}function Ma(e,t){let i,r=t[6].label+"",n,s;return{key:e,first:null,c(){i=I("option"),n=be(r),i.__value=s=t[6].deviceId,i.value=i.__value,this.first=i},m(a,o){N(a,i,o),_(i,n)},p(a,o){t=a,o&2&&r!==(r=t[6].label+"")&&Ze(n,r),o&2&&s!==(s=t[6].deviceId)&&(i.__value=s,i.value=i.__value)},d(a){a&&L(i)}}}function La(e,t){let i,r=t[6].label+"",n,s;return{key:e,first:null,c(){i=I("option"),n=be(r),i.__value=s=t[6].deviceId,i.value=i.__value,this.first=i},m(a,o){N(a,i,o),_(i,n)},p(a,o){t=a,o&2&&r!==(r=t[6].label+"")&&Ze(n,r),o&2&&s!==(s=t[6].deviceId)&&(i.__value=s,i.value=i.__value)},d(a){a&&L(i)}}}function Na(e,t){let i,r=t[6].label+"",n,s;return{key:e,first:null,c(){i=I("option"),n=be(r),i.__value=s=t[6].deviceId,i.value=i.__value,this.first=i},m(a,o){N(a,i,o),_(i,n)},p(a,o){t=a,o&2&&r!==(r=t[6].label+"")&&Ze(n,r),o&2&&s!==(s=t[6].deviceId)&&(i.__value=s,i.value=i.__value)},d(a){a&&L(i)}}}function Fm(e){let t,i,r,n,s,a,o,l,c,u,d=[],h=new Map,p,g,v,S,G,w,D=[],V=new Map,z,J,oe,ue,Q,Y,se=[],de=new Map,Ae,Ue,ie,rt;r=new Um({});let at=e[1].videoInput;const m=E=>E[6].deviceId;for(let E=0;E<at.length;E+=1){let $=Oa(e,at,E),O=m($);h.set(O,d[E]=Ma(O,$))}let b=e[1].audioInput;const R=E=>E[6].deviceId;for(let E=0;E<b.length;E+=1){let $=Da(e,b,E),O=R($);V.set(O,D[E]=La(O,$))}let k=e[1].audioOutput;const A=E=>E[6].deviceId;for(let E=0;E<k.length;E+=1){let $=$a(e,k,E),O=A($);de.set(O,se[E]=Na(O,$))}return{c(){t=I("section"),i=I("button"),F(r.$$.fragment),n=W(),s=I("h1"),s.textContent="Device Settings",a=W(),o=I("div"),l=I("label"),l.textContent="Video",c=W(),u=I("select");for(let E=0;E<d.length;E+=1)d[E].c();g=W(),v=I("div"),S=I("label"),S.textContent="Audio",G=W(),w=I("select");for(let E=0;E<D.length;E+=1)D[E].c();J=W(),oe=I("div"),ue=I("label"),ue.textContent="Speaker",Q=W(),Y=I("select");for(let E=0;E<se.length;E+=1)se[E].c();f(i,"class","CloseButton svelte-1e8aimq"),f(s,"class","normal-text svelte-1e8aimq"),f(l,"class","sub-text svelte-1e8aimq"),f(l,"for","video"),f(u,"id","video"),f(u,"class","svelte-1e8aimq"),f(o,"class","selection svelte-1e8aimq"),f(S,"class","sub-text svelte-1e8aimq"),f(S,"for","audio"),f(w,"id","audio"),f(w,"class","svelte-1e8aimq"),f(v,"class","selection svelte-1e8aimq"),f(ue,"class","sub-text svelte-1e8aimq"),f(ue,"for","speaker"),f(Y,"id","speaker"),f(Y,"class","svelte-1e8aimq"),f(oe,"class","selection svelte-1e8aimq"),f(t,"class","card card-shadow card-dropin")},m(E,$){N(E,t,$),_(t,i),x(r,i,null),_(t,n),_(t,s),_(t,a),_(t,o),_(o,l),_(o,c),_(o,u);for(let O=0;O<d.length;O+=1)d[O].m(u,null);gi(u,e[0].videoInputDeviceId),_(t,g),_(t,v),_(v,S),_(v,G),_(v,w);for(let O=0;O<D.length;O+=1)D[O].m(w,null);gi(w,e[0].audioInputDeviceId),_(t,J),_(t,oe),_(oe,ue),_(oe,Q),_(oe,Y);for(let O=0;O<se.length;O+=1)se[O].m(Y,null);gi(Y,e[0].audioOutputDeviceId),Ue=!0,ie||(rt=[_e(i,"click",e[5]),_e(u,"change",e[2]),_e(w,"change",e[3]),_e(Y,"change",e[4])],ie=!0)},p(E,[$]){$&2&&(at=E[1].videoInput,d=oi(d,$,m,1,E,at,h,u,Bi,Ma,null,Oa)),(!Ue||$&3&&p!==(p=E[0].videoInputDeviceId))&&gi(u,E[0].videoInputDeviceId),$&2&&(b=E[1].audioInput,D=oi(D,$,R,1,E,b,V,w,Bi,La,null,Da)),(!Ue||$&3&&z!==(z=E[0].audioInputDeviceId))&&gi(w,E[0].audioInputDeviceId),$&2&&(k=E[1].audioOutput,se=oi(se,$,A,1,E,k,de,Y,Bi,Na,null,$a)),(!Ue||$&3&&Ae!==(Ae=E[0].audioOutputDeviceId))&&gi(Y,E[0].audioOutputDeviceId)},i(E){Ue||(C(r.$$.fragment,E),Ue=!0)},o(E){P(r.$$.fragment,E),Ue=!1},d(E){E&&L(t),U(r);for(let $=0;$<d.length;$+=1)d[$].d();for(let $=0;$<D.length;$+=1)D[$].d();for(let $=0;$<se.length;$+=1)se[$].d();ie=!1,lt(rt)}}}function Bm(e,t,i){let r,n;Le(e,vp,c=>i(0,r=c)),Le(e,gp,c=>i(1,n=c));const s=c=>dt.setVideoSettings({deviceId:c.target.value}),a=c=>dt.setAudioSettings({deviceId:c.target.value}),o=c=>dt.setAudioOutputDevice(c.target.value);function l(){Ss.set(!1)}return[r,n,s,a,o,l]}class Gm extends ee{constructor(t){super(),X(this,t,Bm,Fm,Z,{})}}function xa(e){let t,i;return t=new Ai({props:{$$slots:{default:[Vm]},$$scope:{ctx:e}}}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Vm(e){let t,i;return t=new Gm({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function jm(e){let t,i,r=e[0]&&xa(e);return{c(){r&&r.c(),t=ht()},m(n,s){r&&r.m(n,s),N(n,t,s),i=!0},p(n,[s]){n[0]?r?s&1&&C(r,1):(r=xa(n),r.c(),C(r,1),r.m(t.parentNode,t)):r&&(Ne(),P(r,1,1,()=>{r=null}),xe())},i(n){i||(C(r),i=!0)},o(n){P(r),i=!1},d(n){r&&r.d(n),n&&L(t)}}}function qm(e,t,i){let r;return Le(e,Ss,n=>i(0,r=n)),[r]}class Hm extends ee{constructor(t){super(),X(this,t,qm,jm,Z,{})}}function Km(e){let t;return{c(){t=be("Leave Room")},m(i,r){N(i,t,r)},d(i){i&&L(t)}}}function Wm(e){let t,i,r;return i=new Tt({props:{classes:"btn-danger",$$slots:{default:[Km]},$$scope:{ctx:e}}}),i.$on("click",zm),{c(){t=I("span"),F(i.$$.fragment),f(t,"title","Leave Room")},m(n,s){N(n,t,s),x(i,t,null),r=!0},p(n,[s]){const a={};s&1&&(a.$$scope={dirty:s,ctx:n}),i.$set(a)},i(n){r||(C(i.$$.fragment,n),r=!0)},o(n){P(i.$$.fragment,n),r=!1},d(n){n&&L(t),U(i)}}}const Nr=pt(!1);function zm(){Nr.set(!0)}class Jm extends ee{constructor(t){super(),X(this,t,null,Wm,Z,{})}}function Qm(e){let t,i,r,n,s,a,o,l,c,u,d;return{c(){t=I("section"),i=I("h1"),i.textContent="Leave Room",r=W(),n=I("p"),n.textContent="Are you sure you want to leave the room?",s=W(),a=I("div"),o=I("button"),o.textContent="Yes",l=W(),c=I("button"),c.textContent="no",f(i,"class","normal-text svelte-19qorri"),f(o,"class","btn-danger svelte-19qorri"),f(c,"class","btn-lite svelte-19qorri"),f(a,"class","svelte-19qorri"),f(t,"class","card card-shadow card-dropin")},m(h,p){N(h,t,p),_(t,i),_(t,r),_(t,n),_(t,s),_(t,a),_(a,o),_(a,l),_(a,c),u||(d=[_e(o,"click",e[0]),_e(c,"click",e[1])],u=!0)},p:M,i:M,o:M,d(h){h&&L(t),u=!1,lt(d)}}}function Ym(e){function t(){Nr.set(!1),dt.leave(),Ye.set({type:"info",message:"You left the room."})}function i(){Nr.set(!1)}return[t,i]}class Zm extends ee{constructor(t){super(),X(this,t,Ym,Qm,Z,{})}}function Ua(e){let t,i;return t=new Ai({props:{$$slots:{default:[Xm]},$$scope:{ctx:e}}}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Xm(e){let t,i;return t=new Zm({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function eg(e){let t,i,r=e[0]&&Ua(e);return{c(){r&&r.c(),t=ht()},m(n,s){r&&r.m(n,s),N(n,t,s),i=!0},p(n,[s]){n[0]?r?s&1&&C(r,1):(r=Ua(n),r.c(),C(r,1),r.m(t.parentNode,t)):r&&(Ne(),P(r,1,1,()=>{r=null}),xe())},i(n){i||(C(r),i=!0)},o(n){P(r),i=!1},d(n){r&&r.d(n),n&&L(t)}}}function tg(e,t,i){let r;return Le(e,Nr,n=>i(0,r=n)),[r]}class ig extends ee{constructor(t){super(),X(this,t,tg,eg,Z,{})}}function rg(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","M24 33.3q3.9 0 6.6-2.7 2.7-2.7 2.7-6.6 0-3.9-2.7-6.6-2.7-2.7-6.6-2.7-3.9 0-6.6 2.7-2.7 2.7-2.7 6.6 0 3.9 2.7 6.6 2.7 2.7 6.6 2.7ZM24 44q-4.1 0-7.75-1.575-3.65-1.575-6.375-4.3-2.725-2.725-4.3-6.375Q4 28.1 4 24q0-4.15 1.575-7.8 1.575-3.65 4.3-6.35 2.725-2.7 6.375-4.275Q19.9 4 24 4q4.15 0 7.8 1.575 3.65 1.575 6.35 4.275 2.7 2.7 4.275 6.35Q44 19.85 44 24q0 4.1-1.575 7.75-1.575 3.65-4.275 6.375t-6.35 4.3Q28.15 44 24 44Zm0-3q7.1 0 12.05-4.975Q41 31.05 41 24q0-7.1-4.95-12.05Q31.1 7 24 7q-7.05 0-12.025 4.95Q7 16.9 7 24q0 7.05 4.975 12.025Q16.95 41 24 41Zm0-17Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class ng extends ee{constructor(t){super(),X(this,t,null,rg,Z,{})}}function sg(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","M24 44q-4.1 0-7.75-1.575-3.65-1.575-6.375-4.3-2.725-2.725-4.3-6.375Q4 28.1 4 24q0-4.15 1.575-7.8 1.575-3.65 4.3-6.35 2.725-2.7 6.375-4.275Q19.9 4 24 4q4.15 0 7.8 1.575 3.65 1.575 6.35 4.275 2.7 2.7 4.275 6.35Q44 19.85 44 24q0 4.1-1.575 7.75-1.575 3.65-4.275 6.375t-6.35 4.3Q28.15 44 24 44Zm0-3q7.1 0 12.05-4.975Q41 31.05 41 24q0-7.1-4.95-12.05Q31.1 7 24 7q-7.05 0-12.025 4.95Q7 16.9 7 24q0 7.05 4.975 12.025Q16.95 41 24 41Zm0-17Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class ag extends ee{constructor(t){super(),X(this,t,null,sg,Z,{})}}function Yl(e,{from:t,to:i},r={}){const n=getComputedStyle(e),s=n.transform==="none"?"":n.transform,[a,o]=n.transformOrigin.split(" ").map(parseFloat),l=t.left+t.width*a/i.width-(i.left+a),c=t.top+t.height*o/i.height-(i.top+o),{delay:u=0,duration:d=p=>Math.sqrt(p)*120,easing:h=ql}=r;return{delay:u,duration:kt(d)?d(Math.sqrt(l*l+c*c)):d,easing:h,css:(p,g)=>{const v=g*l,S=g*c,G=p+g*t.width/i.width,w=p+g*t.height/i.height;return`transform: ${s} translate(${v}px, ${S}px) scale(${G}, ${w});`}}}function Fa(e,t,i){const r=e.slice();return r[7]=t[i],r}function Ba(e){let t,i=[],r=new Map,n,s,a,o=e[3];const l=c=>c[7];for(let c=0;c<o.length;c+=1){let u=Fa(e,o,c),d=l(u);r.set(d,i[c]=Ga(d,u))}return{c(){t=I("div");for(let c=0;c<i.length;c+=1)i[c].c();f(t,"class","Filter card card-shadow svelte-1ahefp6")},m(c,u){N(c,t,u);for(let d=0;d<i.length;d+=1)i[d].m(t,null);a=!0},p(c,u){if(u&25){o=c[3],Ne();for(let d=0;d<i.length;d+=1)i[d].r();i=oi(i,u,l,1,c,o,r,t,gc,Ga,null,Fa);for(let d=0;d<i.length;d+=1)i[d].a();xe()}},i(c){if(!a){for(let u=0;u<o.length;u+=1)C(i[u]);Dt(()=>{s&&s.end(1),n=Qi(t,Xt,{y:-20,duration:200}),n.start()}),a=!0}},o(c){for(let u=0;u<i.length;u+=1)P(i[u]);n&&n.invalidate(),s=qn(t,Xt,{y:-10,duration:200}),a=!1},d(c){c&&L(t);for(let u=0;u<i.length;u+=1)i[u].d();c&&s&&s.end()}}}function og(e){let t,i;return t=new ag({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function lg(e){let t,i;return t=new ng({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Ga(e,t){let i,r,n,s,a,o,l=t[0][t[7]].name+"",c,u,d,h,p=M,g,v,S;const G=[lg,og],w=[];function D(V,z){return V[0][V[7]].isSelected?0:1}return n=D(t),s=w[n]=G[n](t),{key:e,first:null,c(){i=I("button"),r=I("div"),s.c(),a=W(),o=I("div"),c=be(l),u=W(),f(r,"class","Checkbox svelte-1ahefp6"),f(o,"class","Name svelte-1ahefp6"),f(i,"class",d=bi(t[0][t[7]].isSelected?"btn-selected":"btn-lite")+" svelte-1ahefp6"),this.first=i},m(V,z){N(V,i,z),_(i,r),w[n].m(r,null),_(i,a),_(i,o),_(o,c),_(i,u),g=!0,v||(S=[_e(i,"click",function(){kt(t[4](t[7]))&&t[4](t[7]).apply(this,arguments)}),_e(i,"mouseover",function(){kt(Wt(t[7]))&&Wt(t[7]).apply(this,arguments)}),_e(i,"focus",function(){kt(Wt(t[7]))&&Wt(t[7]).apply(this,arguments)}),_e(i,"mouseleave",Jl)],v=!0)},p(V,z){t=V;let J=n;n=D(t),n!==J&&(Ne(),P(w[J],1,1,()=>{w[J]=null}),xe(),s=w[n],s||(s=w[n]=G[n](t),s.c()),C(s,1),s.m(r,null)),(!g||z&9)&&l!==(l=t[0][t[7]].name+"")&&Ze(c,l),(!g||z&9&&d!==(d=bi(t[0][t[7]].isSelected?"btn-selected":"btn-lite")+" svelte-1ahefp6"))&&f(i,"class",d)},r(){h=i.getBoundingClientRect()},f(){so(i),p()},a(){p(),p=no(i,h,Yl,{duration:200})},i(V){g||(C(s),g=!0)},o(V){P(s),g=!1},d(V){V&&L(i),w[n].d(),v=!1,lt(S)}}}function cg(e){let t,i,r,n,s,a,o=e[2]?"Filtering":"Everyone",l,c,u,d,h;n=new jl({});let p=e[1]&&Ba(e);return{c(){t=I("section"),i=I("button"),r=I("div"),F(n.$$.fragment),s=W(),a=I("div"),l=be(o),c=W(),p&&p.c(),f(r,"class","Expand svelte-1ahefp6"),fe(r,"Retract",e[1]),f(a,"class","IsFiltering svelte-1ahefp6"),f(i,"class","Activate btn-lite svelte-1ahefp6"),fe(i,"Filtering",e[2]),f(t,"class","svelte-1ahefp6")},m(g,v){N(g,t,v),_(t,i),_(i,r),x(n,r,null),_(i,s),_(i,a),_(a,l),_(t,c),p&&p.m(t,null),u=!0,d||(h=_e(i,"click",e[5]),d=!0)},p(g,[v]){(!u||v&2)&&fe(r,"Retract",g[1]),(!u||v&4)&&o!==(o=g[2]?"Filtering":"Everyone")&&Ze(l,o),(!u||v&4)&&fe(i,"Filtering",g[2]),g[1]?p?(p.p(g,v),v&2&&C(p,1)):(p=Ba(g),p.c(),C(p,1),p.m(t,null)):p&&(Ne(),P(p,1,1,()=>{p=null}),xe())},i(g){u||(C(n.$$.fragment,g),C(p),u=!0)},o(g){P(n.$$.fragment,g),P(p),u=!1},d(g){g&&L(t),U(n),p&&p.d(),d=!1,h()}}}const yr=pt({});function ug(e,t,i){let r,n,s=M;Le(e,yr,d=>i(0,n=d)),e.$$.on_destroy.push(()=>s());let a=!1,o=!1;const l=Ul.subscribe(d=>{const h=n;d.map(({id:p,name:g})=>{n[p]!==void 0?h[p]=n[p]:h[p]={name:g,isSelected:!0}}),yr.set(h)});Pt(l);function c(d){return()=>{yr.update(h=>(h[d].isSelected=!h[d].isSelected,i(2,o=!Object.values(h).reduce((p,g)=>p&&g.isSelected,!0)),h))}}const u=()=>i(1,a=!a);return e.$$.update=()=>{e.$$.dirty&1&&i(3,r=Object.keys(n))},[n,a,o,r,c,u]}class dg extends ee{constructor(t){super(),X(this,t,ug,cg,Z,{})}}function hg(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","M4 34V6.1q0-.7.65-1.4T6 4h25.95q.75 0 1.4.675Q34 5.35 34 6.1v17.8q0 .7-.65 1.4t-1.4.7H12Zm10.05 2q-.7 0-1.375-.7T12 33.9V29h25V12h5q.7 0 1.35.7.65.7.65 1.45v29.8L36.05 36ZM31 7H7v19.75L10.75 23H31ZM7 7v19.75Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class pg extends ee{constructor(t){super(),X(this,t,null,hg,Z,{})}}function Va(e){let t,i,r;return{c(){t=I("div"),i=be(e[0]),f(t,"class","UnreadMessagesNumber svelte-1ohj85h"),fe(t,"None",e[0]===0)},m(n,s){N(n,t,s),_(t,i)},p(n,s){s&1&&Ze(i,n[0]),s&1&&fe(t,"None",n[0]===0)},i(n){r||Dt(()=>{r=Qi(t,Xt,{y:20,duration:200}),r.start()})},o:M,d(n){n&&L(t)}}}function fg(e){let t,i,r,n=e[0],s,a,o;i=new pg({});let l=Va(e);return{c(){t=I("button"),F(i.$$.fragment),r=W(),l.c(),f(t,"class","btn-control")},m(c,u){N(c,t,u),x(i,t,null),_(t,r),l.m(t,null),s=!0,a||(o=_e(t,"click",e[1]),a=!0)},p(c,[u]){u&1&&Z(n,n=c[0])?(Ne(),P(l,1,1,M),xe(),l=Va(c),l.c(),C(l,1),l.m(t,null)):l.p(c,u)},i(c){s||(C(i.$$.fragment,c),C(l),s=!0)},o(c){P(i.$$.fragment,c),P(l),s=!1},d(c){c&&L(t),U(i),l.d(c),a=!1,o()}}}const xr=pt(!1);function mg(e,t,i){let r,n=M;Le(e,xr,l=>i(2,r=l)),e.$$.on_destroy.push(()=>n());let s=0;const a=Fl.subscribe(l=>{l.length!==0&&(r||i(0,s+=1))});function o(){xr.update(l=>!l),i(0,s=0)}return Pt(a),[s,o]}class gg extends ee{constructor(t){super(),X(this,t,mg,fg,Z,{})}}function ja(e,t,i){const r=e.slice();return r[12]=t[i],r}function qa(e){let t,i,r=e[12].message+"",n,s,a,o,l=e[12].senderName+"",c,u,d=e[6](e[12].time)+"",h,p,g,v;return{c(){t=I("div"),i=I("p"),n=be(r),s=W(),a=I("span"),o=I("b"),c=be(l),u=be(", "),h=be(d),f(i,"class","chat-message-message svelte-ttxho1"),f(o,"class","svelte-ttxho1"),f(a,"class","chat-message-info svelte-ttxho1"),f(t,"class","chat-message svelte-ttxho1"),fe(t,"YourMsg",e[12].senderName==="You"),fe(t,"HoveringChatSender",e[4]===e[12].sender)},m(S,G){N(S,t,G),_(t,i),_(i,n),_(t,s),_(t,a),_(a,o),_(o,c),_(a,u),_(a,h),g||(v=[_e(t,"mouseover",function(){kt(Wt(e[12].sender))&&Wt(e[12].sender).apply(this,arguments)}),_e(t,"focus",function(){kt(Wt(e[12].sender))&&Wt(e[12].sender).apply(this,arguments)}),_e(t,"mouseleave",Jl)],g=!0)},p(S,G){e=S,G&4&&r!==(r=e[12].message+"")&&Ze(n,r),G&4&&l!==(l=e[12].senderName+"")&&Ze(c,l),G&4&&d!==(d=e[6](e[12].time)+"")&&Ze(h,d),G&4&&fe(t,"YourMsg",e[12].senderName==="You"),G&20&&fe(t,"HoveringChatSender",e[4]===e[12].sender)},i(S){p||Dt(()=>{p=Qi(t,Xt,{y:20,duration:200}),p.start()})},o:M,d(S){S&&L(t),g=!1,lt(v)}}}function Ha(e,t){var a;let i,r,n=M,s=((a=t[3][t[12].sender])==null?void 0:a.isSelected)&&qa(t);return{key:e,first:null,c(){i=I("div"),s&&s.c(),f(i,"class","ChatContainer svelte-ttxho1"),this.first=i},m(o,l){N(o,i,l),s&&s.m(i,null)},p(o,l){var c;t=o,(c=t[3][t[12].sender])!=null&&c.isSelected?s?(s.p(t,l),l&12&&C(s,1)):(s=qa(t),s.c(),C(s,1),s.m(i,null)):s&&(s.d(1),s=null)},r(){r=i.getBoundingClientRect()},f(){so(i),n()},a(){n(),n=no(i,r,Yl,{duration:200})},i(o){C(s)},o:M,d(o){o&&L(i),s&&s.d()}}}function Ka(e){let t;return{c(){t=I("div"),t.innerHTML="<p>There are no messages here</p>",f(t,"class","chat-no-messages svelte-ttxho1")},m(i,r){N(i,t,r)},d(i){i&&L(t)}}}function vg(e){let t,i,r,n,s,a,o,l,c,u,d=[],h=new Map,p,g,v,S,G,w,D,V,z;s=new dg({}),l=new Cs({});let J=e[2];const oe=Q=>Q[12].id;for(let Q=0;Q<J.length;Q+=1){let Y=ja(e,J,Q),se=oe(Y);h.set(se,d[Q]=Ha(se,Y))}let ue=e[2].length===0&&Ka();return{c(){t=I("section"),i=I("div"),r=I("span"),r.textContent="Chat",n=W(),F(s.$$.fragment),a=W(),o=I("button"),F(l.$$.fragment),c=W(),u=I("div");for(let Q=0;Q<d.length;Q+=1)d[Q].c();p=W(),ue&&ue.c(),g=W(),v=I("form"),S=I("input"),G=W(),w=I("div"),f(o,"class","Close svelte-ttxho1"),f(i,"class","Header normal-text svelte-ttxho1"),f(u,"class","chat-messages svelte-ttxho1"),f(S,"placeholder","Send a message..."),f(S,"autocomplete","off"),f(S,"aria-autocomplete","none"),f(S,"class","chat-input svelte-ttxho1"),f(v,"class","flex-center chat-input-container svelte-ttxho1"),f(w,"class","SmallSpike svelte-ttxho1"),f(t,"class","card card-shadow svelte-ttxho1")},m(Q,Y){N(Q,t,Y),_(t,i),_(i,r),_(i,n),x(s,i,null),_(i,a),_(i,o),x(l,o,null),_(t,c),_(t,u);for(let se=0;se<d.length;se+=1)d[se].m(u,null);_(u,p),ue&&ue.m(u,null),e[8](u),_(t,g),_(t,v),_(v,S),ws(S,e[1]),_(t,G),_(t,w),D=!0,V||(z=[_e(o,"click",e[7]),_e(S,"input",e[9]),_e(v,"submit",Vr(e[5]))],V=!0)},p(Q,[Y]){if(Y&92){J=Q[2];for(let se=0;se<d.length;se+=1)d[se].r();d=oi(d,Y,oe,1,Q,J,h,u,mc,Ha,p,ja);for(let se=0;se<d.length;se+=1)d[se].a()}Q[2].length===0?ue||(ue=Ka(),ue.c(),ue.m(u,null)):ue&&(ue.d(1),ue=null),Y&2&&S.value!==Q[1]&&ws(S,Q[1])},i(Q){if(!D){C(s.$$.fragment,Q),C(l.$$.fragment,Q);for(let Y=0;Y<J.length;Y+=1)C(d[Y]);D=!0}},o(Q){P(s.$$.fragment,Q),P(l.$$.fragment,Q),D=!1},d(Q){Q&&L(t),U(s),U(l);for(let Y=0;Y<d.length;Y+=1)d[Y].d();ue&&ue.d(),e[8](null),V=!1,lt(z)}}}function yg(e,t,i){let r,n,s;Le(e,Fl,v=>i(2,r=v)),Le(e,yr,v=>i(3,n=v)),Le(e,tr,v=>i(4,s=v));let a;const o=(v=!1)=>{a&&a.scrollTo({top:a.scrollHeight,behavior:v?"auto":"smooth"})};let l="";const c=async()=>{if(l&&l.trim().length>0)try{await dt.sendBroadcastMessage(l),i(1,l="")}catch(v){Ye.set({type:"error",message:`Failed to send message - ${v.message}`})}},u=v=>v.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0});let d;uc(()=>{d=a&&a.offsetHeight+a.scrollTop>a.scrollHeight-20}),dc(()=>{d&&o()}),jn(()=>o(!0));const h=()=>{xr.set(!1)};function p(v){ut[v?"unshift":"push"](()=>{a=v,i(0,a)})}function g(){l=this.value,i(1,l)}return[a,l,r,n,s,c,u,h,p,g]}class Tg extends ee{constructor(t){super(),X(this,t,yg,vg,Z,{})}}function bg(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","m19.4 44-1-6.3q-.95-.35-2-.95t-1.85-1.25l-5.9 2.7L4 30l5.4-3.95q-.1-.45-.125-1.025Q9.25 24.45 9.25 24q0-.45.025-1.025T9.4 21.95L4 18l4.65-8.2 5.9 2.7q.8-.65 1.85-1.25t2-.9l1-6.35h9.2l1 6.3q.95.35 2.025.925Q32.7 11.8 33.45 12.5l5.9-2.7L44 18l-5.4 3.85q.1.5.125 1.075.025.575.025 1.075t-.025 1.05q-.025.55-.125 1.05L44 30l-4.65 8.2-5.9-2.7q-.8.65-1.825 1.275-1.025.625-2.025.925l-1 6.3ZM24 30.5q2.7 0 4.6-1.9 1.9-1.9 1.9-4.6 0-2.7-1.9-4.6-1.9-1.9-4.6-1.9-2.7 0-4.6 1.9-1.9 1.9-1.9 4.6 0 2.7 1.9 4.6 1.9 1.9 4.6 1.9Zm0-3q-1.45 0-2.475-1.025Q20.5 25.45 20.5 24q0-1.45 1.025-2.475Q22.55 20.5 24 20.5q1.45 0 2.475 1.025Q27.5 22.55 27.5 24q0 1.45-1.025 2.475Q25.45 27.5 24 27.5Zm0-3.5Zm-2.2 17h4.4l.7-5.6q1.65-.4 3.125-1.25T32.7 32.1l5.3 2.3 2-3.6-4.7-3.45q.2-.85.325-1.675.125-.825.125-1.675 0-.85-.1-1.675-.1-.825-.35-1.675L40 17.2l-2-3.6-5.3 2.3q-1.15-1.3-2.6-2.175-1.45-.875-3.2-1.125L26.2 7h-4.4l-.7 5.6q-1.7.35-3.175 1.2-1.475.85-2.625 2.1L10 13.6l-2 3.6 4.7 3.45q-.2.85-.325 1.675-.125.825-.125 1.675 0 .85.125 1.675.125.825.325 1.675L8 30.8l2 3.6 5.3-2.3q1.2 1.2 2.675 2.05Q19.45 35 21.1 35.4Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class _g extends ee{constructor(t){super(),X(this,t,null,bg,Z,{})}}function kg(e){let t,i;return t=new _g({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Sg(e){let t,i;return t=new Tt({props:{classes:"btn-setting",$$slots:{default:[kg]},$$scope:{ctx:e}}}),t.$on("click",e[0]),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},p(r,[n]){const s={};n&2&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Eg(e){function t(){Ss.set(!0)}return[t]}class Cg extends ee{constructor(t){super(),X(this,t,Eg,Sg,Z,{})}}function Rg(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","M 23 3 A 4 4 0 0 0 19 7 A 4 4 0 0 0 19.09375 7.8359375 L 10.011719 12.376953 A 4 4 0 0 0 7 11 A 4 4 0 0 0 3 15 A 4 4 0 0 0 7 19 A 4 4 0 0 0 10.013672 17.625 L 19.089844 22.164062 A 4 4 0 0 0 19 23 A 4 4 0 0 0 23 27 A 4 4 0 0 0 27 23 A 4 4 0 0 0 23 19 A 4 4 0 0 0 19.986328 20.375 L 10.910156 15.835938 A 4 4 0 0 0 11 15 A 4 4 0 0 0 10.90625 14.166016 L 19.988281 9.625 A 4 4 0 0 0 23 11 A 4 4 0 0 0 27 7 A 4 4 0 0 0 23 3 z"),f(t,"fill","#000000"),f(t,"viewBox","0 0 30 30"),f(t,"width","30px"),f(t,"height","30px")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class Pg extends ee{constructor(t){super(),X(this,t,null,Rg,Z,{})}}function Ag(e){let t,i;return t=new Pg({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Ig(e){let t,i;return t=new Tt({props:{classes:"btn-control",$$slots:{default:[Ag]},$$scope:{ctx:e}}}),t.$on("click",e[0]),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},p(r,[n]){const s={};n&4&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function wg(e,t,i){let r;Le(e,er,s=>i(1,r=s));function n(){const s=`${window.location.origin}${window.location.pathname}#&token=${r}`;navigator.clipboard.writeText(s).then(function(){Ye.set({type:"good",message:"Copied link to clip board "})},function(a){Ye.set({type:"error",message:"failed ot copy link to clip board "+a.message})})}return[n]}class $g extends ee{constructor(t){super(),X(this,t,wg,Ig,Z,{})}}function Dg(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","M21.2 8a2.75 2.75 0 00-2.75-2.75H5.55A2.75 2.75 0 002.8 8v7.64a2.75 2.75 0 002.75 2.75h3.075a.75.75 0 000-1.5H5.55c-.69 0-1.25-.56-1.25-1.25V8c0-.69.56-1.25 1.25-1.25h12.9c.69 0 1.25.56 1.25 1.25v7.64c0 .69-.56 1.25-1.25 1.25h-2.7a.75.75 0 000 1.5h2.7a2.75 2.75 0 002.75-2.75V8zM8.008 13.307a.925.925 0 101.309 1.308l1.89-1.89v6.839a.925.925 0 001.85 0v-6.839l1.89 1.89a.925.925 0 101.309-1.308l-3.47-3.47a.926.926 0 00-1.308 0l-3.47 3.47z"),f(i,"fill","currentColor"),f(t,"width","24px"),f(t,"height","24px"),f(t,"viewBox","0 0 24 24"),f(t,"fill","none"),f(t,"xmlns","http://www.w3.org/2000/svg")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class Og extends ee{constructor(t){super(),X(this,t,null,Dg,Z,{})}}function Mg(e){let t,i;return t=new Og({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Lg(e){let t,i,r;return i=new Tt({props:{classes:"btn-control",$$slots:{default:[Mg]},$$scope:{ctx:e}}}),i.$on("click",e[1]),{c(){t=I("span"),F(i.$$.fragment),f(t,"class","svelte-1s6nypy"),fe(t,"Sharing",e[0])},m(n,s){N(n,t,s),x(i,t,null),r=!0},p(n,[s]){const a={};s&4&&(a.$$scope={dirty:s,ctx:n}),i.$set(a),(!r||s&1)&&fe(t,"Sharing",n[0])},i(n){r||(C(i.$$.fragment,n),r=!0)},o(n){P(i.$$.fragment,n),r=!1},d(n){n&&L(t),U(i)}}}function Ng(e,t,i){let r;Le(e,yp,s=>i(0,r=s));function n(){dt.setScreenShareEnabled(!r)}return[r,n]}class xg extends ee{constructor(t){super(),X(this,t,Ng,Lg,Z,{})}}function Ug(e){let t,i,r;return i=new Wl({}),{c(){t=I("span"),F(i.$$.fragment),f(t,"title","Turn on audio")},m(n,s){N(n,t,s),x(i,t,null),r=!0},i(n){r||(C(i.$$.fragment,n),r=!0)},o(n){P(i.$$.fragment,n),r=!1},d(n){n&&L(t),U(i)}}}function Fg(e){let t,i,r;return i=new zl({}),{c(){t=I("span"),F(i.$$.fragment),f(t,"title","Turn off audio")},m(n,s){N(n,t,s),x(i,t,null),r=!0},i(n){r||(C(i.$$.fragment,n),r=!0)},o(n){P(i.$$.fragment,n),r=!1},d(n){n&&L(t),U(i)}}}function Bg(e){let t,i,r,n;const s=[Fg,Ug],a=[];function o(l,c){return l[0]?0:1}return t=o(e),i=a[t]=s[t](e),{c(){i.c(),r=ht()},m(l,c){a[t].m(l,c),N(l,r,c),n=!0},p(l,c){let u=t;t=o(l),t!==u&&(Ne(),P(a[u],1,1,()=>{a[u]=null}),xe(),i=a[t],i||(i=a[t]=s[t](l),i.c()),C(i,1),i.m(r.parentNode,r))},i(l){n||(C(i),n=!0)},o(l){P(i),n=!1},d(l){a[t].d(l),l&&L(r)}}}function Gg(e){let t,i;return t=new Tt({props:{classes:"btn-control",$$slots:{default:[Bg]},$$scope:{ctx:e}}}),t.$on("click",e[1]),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},p(r,[n]){const s={};n&5&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Vg(e,t,i){let r;Le(e,fp,s=>i(0,r=s));function n(){dt.setLocalAudioEnabled(!r)}return[r,n]}class jg extends ee{constructor(t){super(),X(this,t,Vg,Gg,Z,{})}}function qg(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","M7 40q-1.2 0-2.1-.9Q4 38.2 4 37V11q0-1.2.9-2.1Q5.8 8 7 8h26q1.2 0 2.1.9.9.9.9 2.1v10.75l8-8v20.5l-8-8V37q0 1.2-.9 2.1-.9.9-2.1.9Zm0-3h26V11H7v26Zm0 0V11v26Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class Hg extends ee{constructor(t){super(),X(this,t,null,qg,Z,{})}}function Kg(e){let t,i;return{c(){t=ae("svg"),i=ae("path"),f(i,"d","m44 34.25-8-8v5.55l-3-3V11H15.2l-3-3H33q1.2 0 2.1.9.9.9.9 2.1v10.75l8-8Zm-1.6 12.4L1.95 6.2l2.1-2.1L44.5 44.55ZM24.2 20Zm-4.35 4.1ZM7.95 8l3 3H7v26h26v-3.95l3 3V37q0 1.2-.9 2.1-.9.9-2.1.9H7q-1.2 0-2.1-.9Q4 38.2 4 37V11q0-1.2.9-2.1Q5.8 8 7 8Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 48 48")},m(r,n){N(r,t,n),_(t,i)},p:M,i:M,o:M,d(r){r&&L(t)}}}class Wg extends ee{constructor(t){super(),X(this,t,null,Kg,Z,{})}}function zg(e){let t,i;return t=new Wg({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Jg(e){let t,i;return t=new Hg({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Qg(e){let t,i,r,n;const s=[Jg,zg],a=[];function o(l,c){return l[0]?0:1}return t=o(e),i=a[t]=s[t](e),{c(){i.c(),r=ht()},m(l,c){a[t].m(l,c),N(l,r,c),n=!0},p(l,c){let u=t;t=o(l),t!==u&&(Ne(),P(a[u],1,1,()=>{a[u]=null}),xe(),i=a[t],i||(i=a[t]=s[t](l),i.c()),C(i,1),i.m(r.parentNode,r))},i(l){n||(C(i),n=!0)},o(l){P(i),n=!1},d(l){a[t].d(l),l&&L(r)}}}function Yg(e){let t,i;return t=new Tt({props:{classes:"btn-control",$$slots:{default:[Qg]},$$scope:{ctx:e}}}),t.$on("click",e[1]),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},p(r,[n]){const s={};n&5&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function Zg(e,t,i){let r;Le(e,mp,s=>i(0,r=s));function n(){dt.setLocalVideoEnabled(!r)}return[r,n]}class Xg extends ee{constructor(t){super(),X(this,t,Zg,Yg,Z,{})}}function Wa(e){let t,i,r,n,s;return i=new Tg({}),{c(){t=I("div"),F(i.$$.fragment),f(t,"class","ChatRoom svelte-15ziops")},m(a,o){N(a,t,o),x(i,t,null),s=!0},i(a){s||(C(i.$$.fragment,a),Dt(()=>{n&&n.end(1),r=Qi(t,Xt,{y:20,duration:200}),r.start()}),s=!0)},o(a){P(i.$$.fragment,a),r&&r.invalidate(),n=qn(t,Xt,{y:20,duration:200}),s=!1},d(a){a&&L(t),U(i),a&&n&&n.end()}}}function ev(e){let t,i,r,n,s,a,o,l,c,u,d,h,p,g,v,S,G,w,D,V;r=new xg({}),a=new jg({}),l=new Xg({}),u=new Cg({}),h=new Jm({}),S=new gg({});let z=e[0]&&Wa();return D=new $g({}),{c(){t=I("section"),i=I("div"),F(r.$$.fragment),n=W(),s=I("div"),F(a.$$.fragment),o=W(),F(l.$$.fragment),c=W(),F(u.$$.fragment),d=W(),F(h.$$.fragment),p=W(),g=I("div"),v=I("div"),F(S.$$.fragment),G=W(),z&&z.c(),w=W(),F(D.$$.fragment),f(i,"class","Divider svelte-15ziops"),f(s,"class","Divider svelte-15ziops"),f(v,"class","ChatContainer svelte-15ziops"),f(g,"class","Divider svelte-15ziops"),f(t,"class","svelte-15ziops")},m(J,oe){N(J,t,oe),_(t,i),x(r,i,null),_(t,n),_(t,s),x(a,s,null),_(s,o),x(l,s,null),_(s,c),x(u,s,null),_(s,d),x(h,s,null),_(t,p),_(t,g),_(g,v),x(S,v,null),_(v,G),z&&z.m(v,null),_(g,w),x(D,g,null),V=!0},p(J,[oe]){J[0]?z?oe&1&&C(z,1):(z=Wa(),z.c(),C(z,1),z.m(v,null)):z&&(Ne(),P(z,1,1,()=>{z=null}),xe())},i(J){V||(C(r.$$.fragment,J),C(a.$$.fragment,J),C(l.$$.fragment,J),C(u.$$.fragment,J),C(h.$$.fragment,J),C(S.$$.fragment,J),C(z),C(D.$$.fragment,J),V=!0)},o(J){P(r.$$.fragment,J),P(a.$$.fragment,J),P(l.$$.fragment,J),P(u.$$.fragment,J),P(h.$$.fragment,J),P(S.$$.fragment,J),P(z),P(D.$$.fragment,J),V=!1},d(J){J&&L(t),U(r),U(a),U(l),U(u),U(h),U(S),z&&z.d(),U(D)}}}function tv(e,t,i){let r;return Le(e,xr,n=>i(0,r=n)),[r]}class iv extends ee{constructor(t){super(),X(this,t,tv,ev,Z,{})}}function rv(e){let t,i,r,n,s,a,o;return r=new Cm({}),a=new Ql({}),{c(){t=I("div"),i=I("div"),F(r.$$.fragment),n=W(),s=I("div"),F(a.$$.fragment),f(i,"class","screenshare svelte-afmkxg"),f(s,"class","gallery svelte-afmkxg"),f(t,"class","screenshare-view svelte-afmkxg")},m(l,c){N(l,t,c),_(t,i),x(r,i,null),_(t,n),_(t,s),x(a,s,null),o=!0},i(l){o||(C(r.$$.fragment,l),C(a.$$.fragment,l),o=!0)},o(l){P(r.$$.fragment,l),P(a.$$.fragment,l),o=!1},d(l){l&&L(t),U(r),U(a)}}}function nv(e){let t,i;return t=new Ql({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function sv(e){let t,i,r,n,s,a,o,l,c,u,d,h,p,g;const v=[nv,rv],S=[];function G(w,D){return w[0]?1:0}return r=G(e),n=S[r]=v[r](e),o=new iv({}),c=new Hm({}),d=new ig({}),p=new Nm({}),{c(){t=I("section"),i=I("div"),n.c(),s=W(),a=I("div"),F(o.$$.fragment),l=W(),F(c.$$.fragment),u=W(),F(d.$$.fragment),h=W(),F(p.$$.fragment),f(i,"class","conference-section svelte-afmkxg"),f(a,"class","BottomBar svelte-afmkxg"),f(t,"class","svelte-afmkxg")},m(w,D){N(w,t,D),_(t,i),S[r].m(i,null),_(t,s),_(t,a),x(o,a,null),N(w,l,D),x(c,w,D),N(w,u,D),x(d,w,D),N(w,h,D),x(p,w,D),g=!0},p(w,[D]){let V=r;r=G(w),r!==V&&(Ne(),P(S[V],1,1,()=>{S[V]=null}),xe(),n=S[r],n||(n=S[r]=v[r](w),n.c()),C(n,1),n.m(i,null))},i(w){g||(C(n),C(o.$$.fragment,w),C(c.$$.fragment,w),C(d.$$.fragment,w),C(p.$$.fragment,w),g=!0)},o(w){P(n),P(o.$$.fragment,w),P(c.$$.fragment,w),P(d.$$.fragment,w),P(p.$$.fragment,w),g=!1},d(w){w&&L(t),S[r].d(),U(o),w&&L(l),U(c,w),w&&L(u),U(d,w),w&&L(h),U(p,w)}}}function av(e,t,i){let r;return Le(e,Tp,n=>i(0,r=n)),[r]}class ov extends ee{constructor(t){super(),X(this,t,av,sv,Z,{})}}function lv(e){let t,i;return t=new Jf({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function cv(e){let t,i;return t=new ov({}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}function uv(e){let t,i,r,n;const s=[cv,lv],a=[];function o(l,c){return l[0]?0:1}return i=o(e),r=a[i]=s[i](e),{c(){t=I("section"),r.c(),f(t,"class","svelte-1evr0tg")},m(l,c){N(l,t,c),a[i].m(t,null),n=!0},p(l,[c]){let u=i;i=o(l),i!==u&&(Ne(),P(a[u],1,1,()=>{a[u]=null}),xe(),r=a[i],r||(r=a[i]=s[i](l),r.c()),C(r,1),r.m(t,null))},i(l){n||(C(r),n=!0)},o(l){P(r),n=!1},d(l){l&&L(t),a[i].d()}}}function dv(e,t,i){let r;return Le(e,pp,n=>i(0,r=n)),[r]}class hv extends ee{constructor(t){super(),X(this,t,dv,uv,Z,{})}}function pv(e){let t,i;const r=e[1].default,n=Ur(r,e,e[0],null);return{c(){t=I("span"),n&&n.c(),f(t,"class","svelte-qy6wx6")},m(s,a){N(s,t,a),n&&n.m(t,null),i=!0},p(s,[a]){n&&n.p&&(!i||a&1)&&Br(n,r,s,s[0],i?Fr(r,s[0],a,null):Gr(s[0]),null)},i(s){i||(C(n,s),i=!0)},o(s){P(n,s),i=!1},d(s){s&&L(t),n&&n.d(s)}}}function fv(e,t,i){let{$$slots:r={},$$scope:n}=t;return e.$$set=s=>{"$$scope"in s&&i(0,n=s.$$scope)},[n,r]}class mv extends ee{constructor(t){super(),X(this,t,fv,pv,Z,{})}}function gv(e){let t,i,r,n;return r=new hv({}),{c(){t=I("section"),i=I("span"),F(r.$$.fragment),f(i,"class","Content svelte-yzbfju"),f(t,"class","svelte-yzbfju")},m(s,a){N(s,t,a),_(t,i),x(r,i,null),n=!0},p:M,i(s){n||(C(r.$$.fragment,s),n=!0)},o(s){P(r.$$.fragment,s),n=!1},d(s){s&&L(t),U(r)}}}function vv(e){let t,i;return t=new mv({props:{$$slots:{default:[gv]},$$scope:{ctx:e}}}),{c(){F(t.$$.fragment)},m(r,n){x(t,r,n),i=!0},p(r,[n]){const s={};n&1&&(s.$$scope={dirty:n,ctx:r}),t.$set(s)},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){U(t,r)}}}class yv extends ee{constructor(t){super(),X(this,t,null,vv,Z,{})}}function za(e){let t=e[1],i,r,n=Ja(e);return{c(){n.c(),i=ht()},m(s,a){n.m(s,a),N(s,i,a),r=!0},p(s,a){a&2&&Z(t,t=s[1])?(Ne(),P(n,1,1,M),xe(),n=Ja(s),n.c(),C(n,1),n.m(i.parentNode,i)):n.p(s,a)},i(s){r||(C(n),r=!0)},o(s){P(n),r=!1},d(s){s&&L(i),n.d(s)}}}function Ja(e){let t,i,r,n=e[1].message+"",s,a,o,l,c,u,d,h,p;return c=new Cs({}),{c(){t=I("section"),i=I("div"),r=I("div"),s=be(n),a=W(),o=I("div"),l=I("button"),F(c.$$.fragment),f(r,"class","Message svelte-p6w9lj"),f(l,"class","Close svelte-p6w9lj"),f(o,"class","CloseContainer svelte-p6w9lj"),f(i,"class",u=bi("MessageContainer "+e[1].type)+" svelte-p6w9lj"),fe(i,"Disappear",e[0]),f(t,"class","svelte-p6w9lj")},m(g,v){N(g,t,v),_(t,i),_(i,r),_(r,s),_(i,a),_(i,o),_(o,l),x(c,l,null),d=!0,h||(p=_e(l,"click",e[2]),h=!0)},p(g,v){(!d||v&2)&&n!==(n=g[1].message+"")&&Ze(s,n),(!d||v&2&&u!==(u=bi("MessageContainer "+g[1].type)+" svelte-p6w9lj"))&&f(i,"class",u),(!d||v&3)&&fe(i,"Disappear",g[0])},i(g){d||(C(c.$$.fragment,g),d=!0)},o(g){P(c.$$.fragment,g),d=!1},d(g){g&&L(t),U(c),h=!1,p()}}}function Tv(e){let t,i,r=e[1].type!=="none"&&za(e);return{c(){r&&r.c(),t=ht()},m(n,s){r&&r.m(n,s),N(n,t,s),i=!0},p(n,[s]){n[1].type!=="none"?r?(r.p(n,s),s&2&&C(r,1)):(r=za(n),r.c(),C(r,1),r.m(t.parentNode,t)):r&&(Ne(),P(r,1,1,()=>{r=null}),xe())},i(n){i||(C(r),i=!0)},o(n){P(r),i=!1},d(n){r&&r.d(n),n&&L(t)}}}const bv=e=>Nl.onNotification(t=>{switch(t.type){case Ee.PEER_JOINED:e("info",`${t.data.name} joined the room`);break;case Ee.PEER_LEFT:e("info",`${t.data.name} left the room`);break;case Ee.DEVICE_CHANGE_UPDATE:e("info",t.message);break;case Ee.ERROR:const i=t.data,r=i==null?void 0:i.code;if(console.log("error received ",i),i.isTerminal)e("error",`Error, you're disconnected: ${i.message}: ${i.description}`);else if([3001,3011].includes(r)){const s=r===3011?"Please enable permissions from system settings":"Please enable permissions from the address bar or browser settings";e("error",`${i.message} => ${s}`)}else e("error",`Error: ${i.message}: ${i.description}`);break;case Ee.RECONNECTING:e("warn","You are offline for now. While we try to reconnect, please check your internet connection.");break;case Ee.RECONNECTED:e("good","You are now connected");break}});let Qa=null,Ya=null;function _v(e,t,i){let r;Le(e,Ye,l=>i(1,r=l));let n=!1;function s(){i(0,n=!0)}const a=Ye.subscribe(l=>{i(0,n=!1),clearTimeout(Qa),clearTimeout(Ya),!(l.type==="none"||l.type==="error"||l.type==="warn")&&(Qa=setTimeout(()=>{i(0,n=!0)},5e3))}),o=bv((l,c)=>Ye.set({type:l,message:c}));return Pt(a),Pt(o),e.$$.update=()=>{e.$$.dirty&1&&n&&(Ya=setTimeout(()=>{Ye.set({type:"none",message:""})},500))},[n,r,s]}class kv extends ee{constructor(t){super(),X(this,t,_v,Tv,Z,{})}}function Sv(e){let t,i,r,n,s;return i=new yv({}),n=new kv({}),{c(){t=I("main"),F(i.$$.fragment),r=W(),F(n.$$.fragment)},m(a,o){N(a,t,o),x(i,t,null),_(t,r),x(n,t,null),s=!0},p:M,i(a){s||(C(i.$$.fragment,a),C(n.$$.fragment,a),s=!0)},o(a){P(i.$$.fragment,a),P(n.$$.fragment,a),s=!1},d(a){a&&L(t),U(i),U(n)}}}class Ev extends ee{constructor(t){super(),X(this,t,null,Sv,Z,{})}}new Ev({target:document.getElementById("app")});
